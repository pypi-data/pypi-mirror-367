{"version":3,"file":"integrationConfig.js","names":["$","$accessToken","$workspace","$error","insertAfter","hide","selectize","create","dropdownParent","searchField","valueField","labelField","render","option","item","escape","name","onChange","value","val","options","$control","width","disable","showError","errorStr","html","_","show","lastKey","changeWorkspaceEnabled","throttle","apiKey","trim","length","load","callback","params","URLSearchParams","append","url","SITE_ROOT","fetch","toString","then","rsp","json","result","enable","data","error","console","gettext","catch","err","on"],"sources":["../../../../../../rbintegrations/static/js/asana/integrationConfig.ts"],"sourcesContent":["/**\n * A result from the Asana workspace query URL.\n *\n * Version Added:\n *     4.0.1\n */\ninterface AsanaWorkspaceResult {\n    /** The ID of the workspace. */\n    gid: string;\n\n    /** The name of the workspace. */\n    name: string;\n}\n\n\n/**\n * The response from the Asana workspace query URL.\n *\n * Version Added:\n *     4.0.1\n */\ninterface WorkspaceQueryResponse {\n    result: string;\n    error?: string;\n    data?: AsanaWorkspaceResult[];\n}\n\n\n$(function() {\n    const $accessToken: JQuery<HTMLInputElement> = $('#id_asana_access_token');\n    const $workspace = $('#id_asana_workspace');\n    const $error = $('<div class=\"errorlist\">')\n        .insertAfter($accessToken)\n        .hide();\n\n    $workspace.selectize({\n        create: false,\n        dropdownParent: 'body',\n        searchField: 'name',\n        valueField: 'gid',\n        labelField: 'name',\n        render: {\n            option(\n                item: AsanaWorkspaceResult,\n                escape: (value: string) => string,\n            ): string {\n                return `<div>${escape(item.name)}</div>`;\n            },\n        },\n        onChange(value: string) {\n            $('#id_asana_workspace_name').val(this.options[value].name);\n        },\n    });\n\n    const selectize = $workspace[0].selectize;\n    selectize.$control.width($('#id_name').width());\n    selectize.disable();\n\n    function showError(errorStr: string) {\n        $error\n            .html(dedent`\n                <span class=\"rb-icon rb-icon-warning\"></span>\n                ${_.escape(errorStr)}\n            `)\n            .show();\n    }\n\n    let lastKey = null;\n\n    const changeWorkspaceEnabled = _.throttle(() => {\n        const apiKey = $accessToken.val().trim();\n\n        if (lastKey === apiKey) {\n            return;\n        }\n\n        lastKey = apiKey;\n        $error.hide();\n        selectize.disable();\n\n        if (apiKey.length === 0) {\n            return;\n        }\n\n        selectize.load((callback: (data?: AsanaWorkspaceResult[]) => void) => {\n            const params = new URLSearchParams();\n            params.append('api_key', apiKey);\n\n            const url = `${SITE_ROOT}rbintegrations/asana/workspaces/`;\n\n            fetch(`${url}?${params.toString()}`)\n                .then(rsp => rsp.json())\n                .then((rsp: WorkspaceQueryResponse) => {\n                    if (rsp.result === 'success') {\n                        selectize.enable();\n                        callback(rsp.data);\n                    } else if (rsp.result === 'error') {\n                        showError(rsp.error);\n                        callback();\n                    } else {\n                        console.error(dedent`\n                            Unexpected error when fetching Asana workspace list: `,\n                            rsp);\n                        showError(_`Unable to communicate with Asana`);\n                    }\n                })\n                .catch(err => {\n                    console.error(dedent`\n                        Unexpected error when fetching Asana workspace list: `,\n                        err);\n                    showError(_`Unable to communicate with Asana`);\n                });\n        });\n    }, 100);\n\n    $accessToken.on('change keyup', changeWorkspaceEnabled);\n    changeWorkspaceEnabled();\n});\n"],"mappings":"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","ignoreList":[]}