pages:
  artifacts:
    paths:
      - public
  image: sphinxdoc/sphinx
  rules:
    - if: $CI_COMMIT_TAG =~ /^v.*/    
  script:
    - apt update
    - bash ./scripts/build_documentation.sh
  stage: doc
  tags: &id001
  - ci.inria.fr
  - linux
  - small

test:
  image: $PYTHON_IMAGE
  only:
    - main
    - dev-arno
  parallel:
    matrix:
      # fix python version to be fully deterministic
      - PYTHON_IMAGE: ruanad/tseqmock-env-test:py3.10.12 
  script:
    - bash scripts/test.sh
  stage: test
  tags: *id001

publish:
  stage: deploy
  tags: *id001
  image: python:latest
  script:
    - pip install build twine
    - python -m build
    - twine upload dist/*
  rules:
    - if: $CI_COMMIT_TAG =~ /^v.*/

stages:
  - test
  - doc
  - deploy