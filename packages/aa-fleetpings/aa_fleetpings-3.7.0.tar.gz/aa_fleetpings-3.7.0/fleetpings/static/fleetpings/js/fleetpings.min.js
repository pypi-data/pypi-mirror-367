import Autocomplete from"/static/fleetpings/libs/bootstrap5-autocomplete/1.1.39/autocomplete.min.js";$(document).ready(()=>{const s={checkboxPrePing:$("input#id_pre_ping"),checkboxFormupTimeNow:$("input#id_formup_now"),checkboxCreateSrpLink:$("input#id_srp_link"),checkboxCreateOptimer:$("input#id_optimer"),checkboxFleetSrp:$("input#id_srp"),selectPingTarget:$("select#id_ping_target"),selectPingChannel:$("select#id_ping_channel"),selectFleetType:$("select#id_fleet_type"),inputCsrfMiddlewareToken:$('input[name="csrfmiddlewaretoken"]'),inputFleetComms:$("input#id_fleet_comms"),inputFleetCommander:$("input#id_fleet_commander"),inputFleetName:$("input#id_fleet_name"),inputFormupTime:$("input#id_formup_time"),inputFormupTimestamp:$("input#id_formup_timestamp"),inputFormupLocation:$("input#id_formup_location"),inputFleetDoctrine:$("input#id_fleet_doctrine"),inputFleetDoctrineUrl:$("input#id_fleet_doctrine_url"),inputWebhookEmbedColor:$("input#id_webhook_embed_color")},e=(s.inputFormupTime.datetimepicker({lang:fleetpingsSettings.dateTimeLocale,maskInput:!0,format:"Y-m-d H:i",dayOfWeekStart:1,step:15}),async e=>{const t=await fetch(e);if(t.ok)return t.text();{const i=`Error ${t.status}: ${t.statusText}`;throw new Error(i)}}),t=()=>{e(fleetpingsSettings.url.pingTargets).then(e=>{""!==e&&$(s.selectPingTarget).html(e)}).catch(e=>{console.error("Error fetching ping targets:",e)}),e(fleetpingsSettings.url.pingWebhooks).then(e=>{""!==e&&$(s.selectPingChannel).html(e)}).catch(e=>{console.error("Error fetching webhooks:",e)}),e(fleetpingsSettings.url.fleetTypes).then(e=>{""!==e&&$(s.selectFleetType).html(e)}).catch(e=>{console.error("Error fetching fleet types:",e)})},i=()=>{const i={onSelectItem:(e,t)=>{"fleet-doctrine-list"===t.e.datalist&&m()},preventBrowserAutocomplete:!0};e(fleetpingsSettings.url.formupLocations).then(e=>{if(""!==e.trim()){$(s.inputFormupLocation).after(e);const t=Object.assign({},i,{onRenderItem:(e,t)=>`<l-i set="fl" name="${e.value.toLowerCase()}" size="16"></l-i> ${t}`});new Autocomplete(document.getElementById("id_formup_location"),t)}}).catch(e=>{console.error("Error fetching formup locations:",e)}),e(fleetpingsSettings.url.fleetComms).then(e=>{if(""!==e.trim()){$(s.inputFleetComms).after(e);const t=Object.assign({},i,{onRenderItem:(e,t)=>`<l-i set="fl" name="${e.value.toLowerCase()}" size="16"></l-i> ${t}`});new Autocomplete(document.getElementById("id_fleet_comms"),t)}}).catch(e=>{console.error("Error fetching fleet comms:",e)}),e(fleetpingsSettings.url.fleetDoctrines).then(e=>{if(""!==e.trim()){$(s.inputFleetDoctrine).after(e);const t=Object.assign({},i,{onRenderItem:(e,t)=>`<l-i set="fl" name="${e.value.toLowerCase()}" size="16"></l-i> ${t}`});new Autocomplete(document.getElementById("id_fleet_doctrine"),t)}}).catch(e=>{console.error("Error fetching fleet doctrines:",e)})},n=(e,t=10)=>{$(e).fadeTo(1e3*t,500).slideUp(500,()=>{$(e).remove()})},o=(e,t)=>{$(t).html(`<div class="alert alert-success alert-dismissible alert-message-success d-flex align-items-center fade show">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),n(".alert-message-success")},r=(e,t)=>{$(t).html(`<div class="alert alert-danger alert-dismissible alert-message-error d-flex align-items-center fade show">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),n(".alert-message-error",9999)},l=e=>e&&e.replace(/<(|\/|[^>/bi]|\/[^>bi]|[^/>][^>]+|\/[^>][^>]+)>/g,""),c=(t,i)=>{if(i=i||!1,t){let e=l(t).replace(/&/g,"&amp;");return!0===i&&(e=e.replace(/"/g,"&quot;")),e=!1===i?e.replace(/"/g,'\\"'):e}return t},p=e=>{const t=new Date(e);return(t.getTime()-60*t.getTimezoneOffset()*1e3)/1e3},a=()=>{const t=new ClipboardJS("button#copyFleetPing");t.on("success",e=>{o(fleetpingsSettings.translation.copyToClipboard.success,".aa-fleetpings-ping-copyresult"),e.clearSelection(),t.destroy()}),t.on("error",()=>{r(fleetpingsSettings.translation.copyToClipboard.error,".aa-fleetpings-ping-copyresult"),t.destroy()})},m=($(s.selectPingTarget).change(()=>{"@everyone"===s.selectPingTarget.val()?$(".hint-ping-everyone").show("fast"):$(".hint-ping-everyone").hide("fast")}),$(s.inputFormupTime).change(()=>{const e=p(l(s.inputFormupTime.val()));$(s.inputFormupTimestamp).val(e)}),()=>{const e=l(s.inputFleetDoctrine.val());let t=null;if(""!==e){const i=$('#fleet-doctrine-list [value="'+c(e,!1)+'"]').data("doctrine-url");"undefined"!==i&&""!==i&&(t=i)}$(s.inputFleetDoctrineUrl).val(t)});$(s.selectFleetType).change(()=>{const e=$("option:selected",s.selectFleetType);let t=null;""!==e&&(t=l(e.data("embed-color"))),$(s.inputWebhookEmbedColor).val(t)}),!0===fleetpingsSettings.srpModuleAvailableToUser&&(s.checkboxFleetSrp.is(":checked")&&s.checkboxFormupTimeNow.is(":checked")?$(".fleetpings-create-srp-link").show("fast"):(s.checkboxCreateSrpLink.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast")),s.checkboxFleetSrp.change(()=>{s.checkboxFleetSrp.is(":checked")&&s.checkboxFormupTimeNow.is(":checked")?$(".fleetpings-create-srp-link").show("fast"):(s.checkboxCreateSrpLink.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast"))})),s.checkboxPrePing.on("change",()=>{s.checkboxPrePing.is(":checked")?(s.checkboxFormupTimeNow.prop("checked",!1),s.inputFormupTime.prop("disabled",!1),!0===fleetpingsSettings.optimerInstalled&&$(".fleetpings-create-optimer").show("fast"),!0===fleetpingsSettings.srpModuleAvailableToUser&&(s.checkboxCreateSrpLink.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast"))):(s.checkboxFormupTimeNow.prop("checked",!0),s.inputFormupTime.prop("disabled",!0),!0===fleetpingsSettings.optimerInstalled&&(s.checkboxCreateOptimer.prop("checked",!1),$(".fleetpings-create-optimer").hide("fast")),!0===fleetpingsSettings.srpModuleAvailableToUser&&s.checkboxFleetSrp.is(":checked")&&$(".fleetpings-create-srp-link").show("fast"))}),s.checkboxFormupTimeNow.on("change",()=>{s.checkboxFormupTimeNow.is(":checked")?(s.checkboxPrePing.prop("checked",!1),s.inputFormupTime.prop("disabled",!0),!0===fleetpingsSettings.optimerInstalled&&(s.checkboxCreateOptimer.prop("checked",!1),$(".fleetpings-create-optimer").hide("fast")),!0===fleetpingsSettings.srpModuleAvailableToUser&&s.checkboxFleetSrp.is(":checked")&&$(".fleetpings-create-srp-link").show("fast")):(s.checkboxPrePing.prop("checked",!0),s.inputFormupTime.prop("disabled",!1),!0===fleetpingsSettings.optimerInstalled&&$(".fleetpings-create-optimer").show("fast"),!0===fleetpingsSettings.srpModuleAvailableToUser&&(s.checkboxCreateSrpLink.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast")))}),$("form").submit(e=>{if(e.preventDefault(),$(".fleetpings-form-message div").remove(),!0===fleetpingsSettings.srpModuleAvailableToUser&&s.checkboxCreateSrpLink.is(":checked")){const i=[s.inputFleetName.val(),s.inputFleetDoctrine.val()];if(i.includes(""))return r(fleetpingsSettings.translation.srp.error.missingFields,".fleetpings-form-message"),!1}if(!0===fleetpingsSettings.optimerInstalled&&s.checkboxCreateOptimer.is(":checked")){const n=[s.inputFleetName.val(),s.inputFleetDoctrine.val(),s.inputFormupLocation.val(),s.inputFormupTime.val(),s.inputFleetCommander.val()];if(n.includes(""))return r(fleetpingsSettings.translation.optimer.error.missingFields,".fleetpings-form-message"),!1}const t=$("#aa-fleetping-form").serializeArray().reduce((e,t)=>(e[t.name]=t.value,e),{});$.ajax({url:fleetpingsSettings.url.fleetPing,type:"post",data:t,headers:{"X-CSRFToken":s.inputCsrfMiddlewareToken.val()},success:e=>{!0===e.success?($(".aa-fleetpings-no-ping").hide("fast"),$(".aa-fleetpings-ping").show("fast"),$(".aa-fleetpings-ping-text").html(e.ping_context),e.message&&o(e.message,".fleetpings-form-message")):e.message?r(e.message,".fleetpings-form-message"):r("Something went wrong, no details given.",".fleetpings-form-message")}})}),$("button#copyFleetPing").on("click",()=>{a()}),t(),i()});
//# sourceMappingURL=fleetpings.min.js.map