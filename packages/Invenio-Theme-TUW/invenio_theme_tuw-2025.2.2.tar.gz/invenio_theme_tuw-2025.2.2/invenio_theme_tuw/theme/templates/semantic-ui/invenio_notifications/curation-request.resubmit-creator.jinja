{%- set curation_request = notification.context.request %}
{%- set group = curation_request.receiver %}
{%- set creator = curation_request.created_by %}
{%- set record = curation_request.topic %}
{%- set request_id = curation_request.id %}
{%- set creator_name = creator.username or creator.profile.full_name %}
{%- set record_title = record_ui["metadata"]["title"] %}
{%- set message = notification.context.message | safe if notification.context.message else '' %}

{# TODO: use request.links.self_html when issue issue is resolved: https://github.com/inveniosoftware/invenio-rdm-records/issues/1327 #}
{%- set request_link = "{ui}/me/requests/{id}".format(ui=config.SITE_UI_URL, id=request_id) %}
{%- set account_settings_link = "{ui}/account/settings/notifications".format(ui=config.SITE_UI_URL) %}

{#- Subject for emails -#}
{%- block subject -%}
    {{ _("ðŸ“¥ Record resubmitted for review") }}
{%- endblock subject -%}

{#- HTML body for emails -#}
{%- block html_body -%}
<p>
    {%- if message %}
    {{ _("You resubmitted your record '%(record_title)s' for review with the following message:", record_title=record_title) }}
    {%- else %}
    {{ _("You resubmitted your record '%(record_title)s' for review.", record_title=record_title) }}
    {%- endif %}
</p>
{%- if message %}
<p>
    <em>{{message}}</em>
</p>
{%- endif %}
<p>
    <a href="{{ request_link }}" class="button">{{ _("See the curation request")}}</a>
</p>
<hr />
<p style="font-size:smaller;">
    {{ _('This is an auto-generated message. To manage notifications, visit your <a href="%(account_settings_link)s">account settings</a>.', account_settings_link=account_settings_link) }}
</p>
{%- endblock html_body %}
{#- End of HTML body for emails -#}

{#- Plaintext body for emails -#}
{%- block plain_body -%}
{%- if not message %}
{{ _("You resubmitted your record '%(record_title)s' for review.", record_title=record_title) }}
{%- else %}
{{ _("You resubmitted your record '%(record_title)s' for review with the following message:", record_title=record_title) }}

{{message}}
{%- endif %}

{{ _("See the curation request") }}: {{ request_link }}

{{ _("This is an auto-generated message. To manage notifications, visit your account settings")}}
{%- endblock plain_body %}
{#- End of plaintext body -#}

{#- Markdown body for Slack/Mattermost/chat -#}
{%- block md_body -%}
{%- if not message %}
{{ _("You resubmitted your record *'%(record_title)s'* for review*.", record_title=record_title) }}
{%- else %}
{{ _("You resubmitted your record *'%(record_title)s'* for review* with the following message:", record_title=record_title) }}

> {{message}}
{%- endif %}

[{{ _("See the curation request") }}]({{ request_link }})

{{ _("This is an auto-generated message. To manage notifications, visit your account settings")}}
{%- endblock md_body %}
{#- End of Markdown body -#}
