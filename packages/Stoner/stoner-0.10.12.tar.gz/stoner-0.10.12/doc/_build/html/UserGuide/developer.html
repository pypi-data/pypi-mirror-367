<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Developer’s Guide &#8212; Stoner Pacakge API Documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/better.css?v=58ad701a" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=0b74bb8b" />
    <script src="../_static/documentation_options.js?v=29a6c3e3"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contributors and Credits" href="credits.html" />
    <link rel="prev" title="ConvertingScripts from Older Versions of the Stoner Package" href="upgrade.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  </head><body>
    <header id="pageheader"><h1><a href="../index.html ">
        Stoner Pacakge API Documentation
    </a></h1></header>
  <div class="related top">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="upgrade.html" title="Previous document">ConvertingScripts from Older Versions of the Stoner Package</a>
        </li>
        <li>
          <a href="credits.html" title="Next document">Contributors and Credits</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="../index.html">Stoner Package</a></li>
      <li>
        <a href="ugindex.html">The Stoner Python Package User Guide</a>
      </li> 
    </ul>
  </nav>
  </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="developer-s-guide">
<h1>Developer’s Guide<a class="headerlink" href="#developer-s-guide" title="Link to this heading">¶</a></h1>
<p>This section provides some notes and guidance on extending the Stoner Package.</p>
<section id="understanding-the-class-structure">
<h2>Understanding the Class Structure<a class="headerlink" href="#understanding-the-class-structure" title="Link to this heading">¶</a></h2>
<p>The Stoner Package makes use of several classes to handle representing experimental data that are hidden away from the casual user of the package.
From the end-user perspective, the <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFile</span></code> class contains several attributes that behave like data types that the user is familiar with:</p>
<ul class="simple">
<li><p>data
Although this is essentially a numpy array, it is in fact a subclass of a <a class="reference external" href="https://numpy.org/doc/stable/reference/maskedarray.baseclass.html#numpy.ma.MaskedArray" title="(in NumPy v2.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ma.MaskedArray</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DataArray</span></code>, with an extra attribute
<code class="xref py py-attr docutils literal notranslate"><span class="pre">DataArray.setas</span></code> that is used to label the columns of data and to track assignments to types of columns (x,y,z etc). As
<code class="xref py py-class docutils literal notranslate"><span class="pre">DataArray</span></code> can thus track what columns mean in cartersian coordinate systems, it can provide an on-the-fly conversion to polar
coordinate systems. <code class="xref py py-class docutils literal notranslate"><span class="pre">DataArray</span></code> also keeps track of the row numbers of the array and can label its rows with the <code class="xref py py-attr docutils literal notranslate"><span class="pre">DataArray.i</span></code>
attribute.</p></li>
<li><p>metadata
In many respects this looks like a standard dictionary, albeit one that sorts its keys in alphabetical order. Actually it is a subclass of a
blist.sortedDict that maintains a second dictionary with matching keys that stores information about the data type of the values in the metadata
in order to support export to non-duck typed environments.</p></li>
<li><p>column_headers
This appears to be a standard list of strings, except that it is kept in sync with the size of the numerical data array, adding extra entries or
losing them as the data array gains or loses columns. Actually this is proxied through to the <code class="xref py py-attr docutils literal notranslate"><span class="pre">DataArray.setas</span></code> attribute</p></li>
<li><p>setas
This is a simple proxy through to the <code class="xref py py-attr docutils literal notranslate"><span class="pre">DataFile.data</span></code> attribute’s <code class="xref py py-attr docutils literal notranslate"><span class="pre">DataArray.setas</span></code> attribute. As described above, this provides
the column labelling and assignment functionality, it also handles the code to index columns by number, name, regular expression pattern. Internally
this attribute stores a simple list of the column assignments, but supports being called with a variety of arguments and keyword arguments to manipulate
that list. Attempting to set this attribute results in a translation to the appropriate function call, whilst getting it is converted to expressing it
as a list. The attribute also supports both dictionary like and list like get and set item calls to access elements by index, or indices by assignment.</p></li>
</ul>
<figure class="align-default" id="id1">
<img alt="../_images/class_heirarchy.svg" src="../_images/class_heirarchy.svg" />
<figcaption>
<p><span class="caption-text">The relationships between the various classes that make up the <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFile</span></code> structure. The dashed arrows represent proxy attributes, solid
arrows represent direct attributes. The arrow labels indicate the attribute names, whilst the labels in the boxes are the class names.</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="adding-new-data-file-types">
<h2>Adding New Data File Types<a class="headerlink" href="#adding-new-data-file-types" title="Link to this heading">¶</a></h2>
<p>The first question to ask is whether the data file format that you are working with is one that others in the group will be interested in using.
If so, then the best thing would be to include it in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">Stoner.FileFormats</span></code> module in the package, otherwise you should just write
the class in your own script files. In either case, develop the class in your own script files first.</p>
<p>The best way to implement handling a new data format is to write a new subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFile</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NewInstrumentFile</span><span class="p">(</span><span class="n">DataFile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extends DataFile to load files from somewhere else</span>

<span class="sd">    Written by Gavin Burnell 11/3/2012&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>A document string should be provided that will help the user identify the function of the new class (and avoid using names that might be commonly replicated !).
Only one method needs to be implemented: a new <code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFile._load()</span></code> method. Ththis should have the following structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Just call the parent class but with the right parameters set&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</pre></div>
</div>
<p>then follows the code to actually read the file. It <strong>must</strong> at the very least provide a column header for
every column of data and read in as much numeric data as possible and it <strong>should</strong> read as
much of the meta data as possible. The function terminates by returning a copy of the current object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
<p>One useful function for reading metadata from files is <code class="xref py py-meth docutils literal notranslate"><span class="pre">typeHintedDict.string_to_type()</span></code> which will try to convert a
string representation of data into a sensible Python type.</p>
<p>There are two class attributes, <code class="xref py py-attr docutils literal notranslate"><span class="pre">DataFile.priority</span></code> that can be used to tweak the automatic file
importing code.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">32</span>
</pre></div>
</div>
<p>When the subclasses are tried to see if they can load an undetermined file, they are tried in order of
priority. If your load code can make a positive determination that it has the correct file
(eg by looking for some magic combination of characters at the start of the file) and can throw an
exception if it tries loading an incorrect file, then you can give it a lower priority number to
force it to run earlier. Conversely if your only way of identifying your own files is seeing they make
sense when you try to load them and that you might partially succeed with a file from another system (as
can happen if you have a tab or comma separated text file), then you should raise the priority number.
Currently Lpy:class:<cite>DataFile</cite> defaults to 32, <code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.FileFormats.CSVFile</span></code> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.FileFormats.BigBlueFile</span></code> have values of 128 and 64 respectively.</p>
<p>THe other attribute one might add is <code class="xref py py-attr docutils literal notranslate"><span class="pre">DataFile.patterns</span></code> which is a list of filename extension glob patterns that
will match the expected filenames for this format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">patterns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.txt&quot;</span><span class="p">,</span><span class="s2">&quot;*/dat&quot;</span><span class="p">,</span><span class="s2">&quot;*/qda&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Any custome data class <strong>should</strong> try to identify if the file is the correct format and if so it <strong>must</strong> raise a
<code class="xref py py-class docutils literal notranslate"><span class="pre">StonerLoadError</span></code> exception in order that the autoloading code will known to try a different subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFile</span></code>.</p>
<p>If you need to write any additional methods please make sure that they have Google code-style document
strings so that the API documentation is picked up correctly.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/StonerLogo2.png" alt="Logo of Stoner Package"/>
            </a></p>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Developer’s Guide</a><ul>
<li><a class="reference internal" href="#understanding-the-class-structure">Understanding the Class Structure</a></li>
<li><a class="reference internal" href="#adding-new-data-file-types">Adding New Data File Types</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="upgrade.html"
                          title="previous chapter">ConvertingScripts from Older Versions of the Stoner Package</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="credits.html"
                          title="next chapter">Contributors and Credits</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/UserGuide/developer.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<form class="search" action="../search.html" method="get">
  <input type="text" name="q"
   placeholder="type to search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="related bottom">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="upgrade.html" title="Previous document">ConvertingScripts from Older Versions of the Stoner Package</a>
        </li>
        <li>
          <a href="credits.html" title="Next document">Contributors and Credits</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="../index.html">Stoner Package</a></li>
      <li>
        <a href="ugindex.html">The Stoner Python Package User Guide</a>
      </li> 
    </ul>
  </nav>
  </div>
  <footer id="pagefooter">&copy; 2013-15, Gavin Burnell et al.Last updated on Apr 16, 2025.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a>
      8.2.3
        with the <a href="http://github.com/irskep/sphinx-better-theme">
          better</a> theme.

  </footer>

  
  </body>
</html>