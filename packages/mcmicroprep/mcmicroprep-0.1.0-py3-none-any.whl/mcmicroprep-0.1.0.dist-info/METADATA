Metadata-Version: 2.1
Name: mcmicroprep
Version: 0.1.0
Summary: 
Author: Ajit Johnson Nirmal
Author-email: ajitjohnson.n@gmail.com
Requires-Python: >=3.10,<4.0
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Requires-Dist: lxml (>=6.0.0,<7.0.0)
Requires-Dist: ome-types (>=0.6.1,<0.7.0)
Requires-Dist: pandas (>=2.3.1,<3.0.0)
Requires-Dist: pydantic (>=2.11.7,<3.0.0)
Description-Content-Type: text/markdown

# ğŸ§ª mcmicroprep ğŸš€

A **command-line tool** for preparing multiplexed imaging datasets (ğŸ¦  Olympus, ğŸ©¸ RareCyte) for the MCMICRO Nextflow pipeline.


## ğŸ› ï¸ Installation

1. **Prerequisites**

   - Conda or Miniconda installed ğŸ
   - Python **3.10+** environment ğŸŒŸ
   - SLURM & Nextflow (`labsyspharm/mcmicro`) on your `$PATH`

2. **Create Conda env**

   ```bash
   conda create -n mcmicroprep python=3.12
   conda activate mcmicroprep
   ```

3. **Install package**

   ```bash
   pip install mcmicroprep
   ```

## ğŸ“ Expected Dataset Structure

Your dataset root should contain one subdirectory per slide. Structures vary by vendor:

### ğŸ¦  Olympus

Each *slide directory* must contain at least one `*_frames/` folder â€”-- this is the minimum required structure. Additional files or folders may be present and do not need to be removed.

```
.DATASET FOLDER
â”œâ”€â”€ slide1/
â”‚   â”œâ”€â”€ image1_frames/
â”‚   â”œâ”€â”€ image2_frames/
â”œâ”€â”€ slide2/
â””â”€â”€ slideN/
```

After running for **Olympus**: each slide/image folder would be as follows

```
slide1/
â”œâ”€â”€ raw/                   # image1_frames/, image2_frames/
â”œâ”€â”€ misc_files/            # JSON, logs
â”œâ”€â”€ batch_submission.sh    # pipeline wrapper
â”œâ”€â”€ mcmicro_template.sh    # Nextflow template
â”œâ”€â”€ base.config
â”œâ”€â”€ markers.csv
â””â”€â”€ params.yml            
```

### ğŸ©¸ RareCyte

Slide dirs may contain `*.rcpnl` at any depth: â€”-- this is the minimum required structure. Additional files or folders may be present and do not need to be removed.

```
/path/to/dataset/
â”œâ”€â”€ slide1/
â”‚   â”œâ”€â”€ img001.rcpnl
â”‚   â”œâ”€â”€ subA/img002.rcpnl
â”‚   â””â”€â”€ other files
â””â”€â”€ slideN/
```

After running for **RareCyte**:

```
slide1/
â”œâ”€â”€ raw/                   # all .rcpnl files
â”‚   â”œâ”€â”€ img001.rcpnl
â”‚   â””â”€â”€ img002.rcpnl
â”œâ”€â”€ misc_files/            # CSV, text
â”œâ”€â”€ batch_submission.sh
â”œâ”€â”€ mcmicro_template.sh
â”œâ”€â”€ base.config
â”œâ”€â”€ markers.csv
â””â”€â”€ params.yml             
```

## ğŸš€ Usage

> **Note**: Configured for the HMS O2 cluster (SLURM). Generalize by editing SLURM directives in `templates/common/`.

### ğŸ¦  Olympus

```bash
preparemcmicro \
  --microscope olympus \
  --image-root /path/to/dataset
```

### ğŸ©¸ RareCyte

```bash
preparemcmicro \
  --microscope rarecyte \
  --image-root /path/to/dataset
```

## ğŸ› ï¸ Next Steps for Users

1. âœï¸ **Edit **`` in each slide directory to include your experiment-specific cycle-to-marker mappings.
2. ğŸ“¤ **Upload** the entire processed dataset folder to the O2 cluster if you ran this locally.
3. ğŸš€ **Start the job** on O2:
   ```bash
   cd /n/scratch/users/USERNAME/<DATASET FOLDER>
   bash batch_submission.sh --dataset_path /n/scratch/users/USERNAME/<DATASET FOLDER>
   ```

Happy processing! ğŸ”¬


