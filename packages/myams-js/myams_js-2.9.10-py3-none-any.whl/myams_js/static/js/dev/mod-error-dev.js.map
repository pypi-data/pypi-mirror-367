{"version":3,"file":"mod-error-dev.js","names":["$","MyAMS","ERRORS_TEMPLATE_STRING","ERROR_TEMPLATE","templates","markup","allowCode","error","_exports","showErrors","parent","errors","Promise","resolve","reject","require","then","alert","status","header","i18n","ERROR_OCCURED","message","isArray","ERRORS_OCCURED","form","clearAlerts","messages","push","widget","widgets","label","length","props","render","prependTo","input","id","name","exists","setInvalid","fieldsets","parents","each","idx","elt","click","panels","panel","tabs","siblings","index","addClass","scrollBox","helpers","scrollTo","offset","showHTTPError","messageBox","title","hideTimestamp","timeout","window","env","bundle","config","modules","console","debug"],"sources":["mod-error.js"],"sourcesContent":["/* global MyAMS */\n/**\n * MyAMS errors management\n */\n\nimport 'jsrender';\n\nconst $ = MyAMS.$;\n\n\nconst ERRORS_TEMPLATE_STRING = `\n\t<div class=\"alert alert-{{:status}}\" role=\"alert\">\n\t\t<button type=\"button\" class=\"close\" data-dismiss=\"alert\" \n\t\t\t\taria-label=\"{{*: MyAMS.i18n.BTN_CLOSE }}\">\n\t\t\t<i class=\"fa fa-times\" aria-hidden=\"true\"></i>\t\n\t\t</button>\n\t\t{{if header}}\n\t\t<h5 class=\"alert-heading\">{{:header}}</h5>\n\t\t{{/if}}\n\t\t{{if message}}\n\t\t<p>{{:message}}</p>\n\t\t{{/if}}\n\t\t{{if messages}}\n\t\t<ul>\n\t\t{{for messages}}\n\t\t\t<li>\n\t\t\t\t{{if header}}<strong>{{:header}} :</strong>{{/if}}\n\t\t\t\t{{:message}}\n\t\t\t</li>\n\t\t{{/for}}\n\t\t</ul>\n\t\t{{/if}}\n\t\t{{if widgets}}\n\t\t<ul>\n\t\t{{for widgets}}\n\t\t\t<li>\n\t\t\t\t{{if header}}<strong>{{:header}} :</strong>{{/if}}\n\t\t\t\t{{:message}}\n\t\t\t</li>\n\t\t{{/for}}\n\t\t</ul>\n\t\t{{/if}}\n\t</div>`;\n\nconst ERROR_TEMPLATE = $.templates({\n\tmarkup: ERRORS_TEMPLATE_STRING,\n\tallowCode: true\n});\n\n\nexport const error = {\n\n\t/**\n\t * Show errors as alert in given parent\n\t *\n\t * @param parent: alert parent element\n\t * @param errors: errors properties\n\t */\n\tshowErrors: (parent, errors) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (!parent) {\n\t\t\t\tparent = $('#content >section:first-child >div:first-child');\n\t\t\t}\n\t\t\tif (typeof errors === 'string') {  // simple error message\n\t\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\t\tMyAMS.alert.alert({\n\t\t\t\t\t\tparent: parent,\n\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\theader: MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\tmessage: errors\n\t\t\t\t\t});\n\t\t\t\t}).then(resolve, reject);\n\t\t\t} else if ($.isArray(errors)) {  // array of messages\n\t\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\t\tMyAMS.alert.alert({\n\t\t\t\t\t\tparent: parent,\n\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\theader: MyAMS.i18n.ERRORS_OCCURED,\n\t\t\t\t\t\tmessage: errors\n\t\t\t\t\t});\n\t\t\t\t}).then(resolve, reject);\n\t\t\t} else {  // full errors with widgets\n\t\t\t\tMyAMS.require('i18n', 'ajax', 'alert', 'form').then(() => {\n\t\t\t\t\t// clear previous alerts\n\t\t\t\t\tMyAMS.form.clearAlerts(parent);\n\t\t\t\t\t// create new alert\n\t\t\t\t\tconst messages = [];\n\t\t\t\t\tfor (const message of errors.messages || []) {\n\t\t\t\t\t\tif (typeof message === 'string') {\n\t\t\t\t\t\t\tmessages.push({\n\t\t\t\t\t\t\t\theader: null,\n\t\t\t\t\t\t\t\tmessage: message\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmessages.push(message);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (const widget of errors.widgets || []) {\n\t\t\t\t\t\tmessages.push({\n\t\t\t\t\t\t\theader: widget.label,\n\t\t\t\t\t\t\tmessage: widget.message\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst\n\t\t\t\t\t\theader = errors.header ||\n\t\t\t\t\t\t\t(messages.length > 1 ? MyAMS.i18n.ERRORS_OCCURED : MyAMS.i18n.ERROR_OCCURED),\n\t\t\t\t\t\tprops = {\n\t\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\t\theader: header,\n\t\t\t\t\t\t\tmessage: errors.error || null,\n\t\t\t\t\t\t\tmessages: messages\n\t\t\t\t\t\t};\n\t\t\t\t\t$(ERROR_TEMPLATE.render(props)).prependTo(parent);\n\t\t\t\t\t// update status of invalid widgets\n\t\t\t\t\tfor (const widget of errors.widgets || []) {\n\t\t\t\t\t\tlet input;\n\t\t\t\t\t\tif (widget.id) {\n\t\t\t\t\t\t\tinput = $(`#${widget.id}`, parent);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinput = $(`[name=\"${widget.name}\"]`, parent);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (input.exists()) {\n\t\t\t\t\t\t\tMyAMS.form.setInvalid(parent, input, widget.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// open parent fieldsets switchers\n\t\t\t\t\t\tconst fieldsets = input.parents('fieldset.switched');\n\t\t\t\t\t\tfieldsets.each((idx, elt) => {\n\t\t\t\t\t\t\t$('legend.switcher', elt).click();\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// open parent tab panels\n\t\t\t\t\t\tconst panels = input.parents('.tab-pane');\n\t\t\t\t\t\tpanels.each((idx, elt) => {\n\t\t\t\t\t\t\tconst\n\t\t\t\t\t\t\t\tpanel = $(elt),\n\t\t\t\t\t\t\t\ttabs = panel.parents('.tab-content')\n\t\t\t\t\t\t\t\t\t.siblings('.nav-tabs');\n\t\t\t\t\t\t\t$(`li:nth-child(${panel.index() + 1})`, tabs)\n\t\t\t\t\t\t\t\t.addClass('is-invalid');\n\t\t\t\t\t\t\t$('li.is-invalid:first a', tabs)\n\t\t\t\t\t\t\t\t.click();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tMyAMS.require('helpers').then(() => {\n\t\t\t\t\t\tlet scrollBox = parent.parents('.modal-body');\n\t\t\t\t\t\tif (!scrollBox.exists()) {\n\t\t\t\t\t\t\tscrollBox = $('#main');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tMyAMS.helpers.scrollTo(scrollBox, parent, { offset: -15 });\n\t\t\t\t\t});\n\t\t\t\t}).then(resolve, reject);\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Display message for standard HTTP error\n\t *\n\t * @param error: error object\n\t */\n\tshowHTTPError: (error) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tMyAMS.require('alert').then(() => {\n\t\t\t\tMyAMS.alert.messageBox({\n\t\t\t\t\tstatus: 'error',\n\t\t\t\t\ttitle: error.title,\n\t\t\t\t\tmessage: error.message,\n\t\t\t\t\thideTimestamp: false,\n\t\t\t\t\ttimeout: 0\n\t\t\t\t});\n\t\t\t}).then(resolve, reject);\n\t\t});\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('error');\n\t} else {\n\t\tMyAMS.error = error;\n\t\tconsole.debug(\"MyAMS: error module loaded...\");\n\t}\n}\n"],"mappings":"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","ignoreList":[]}