{"version":3,"file":"mod-tree-dev.js","names":["$","MyAMS","tree","_exports","switchTreeNode","evt","removeChildNodes","nodeId","each","idx","elt","row","data","dtTable","remove","draw","node","currentTarget","switcher","tr","parents","first","table","DataTable","tooltip","hasClass","html","removeClass","location","treeNodesTarget","sourceName","require","then","ajax","post","can_sort","is","result","length","newRow","add","core","initContent","addClass","switchTree","th","tableID","filter","target","deleteElement","form","options","console","debug","node_id","sortTree","details","amsReorderUrl","amsReorderSource","rowID","rowParentID","parent","prev","parentID","action","exists","amsTreeSwitcherClass","amsTreeSwitcherExpandedClass","localTarget","getFunctionByName","postData","child","order","JSON","stringify","listattr","call","startsWith","window","protocol","amsLocation","removeRow","removeChildRows","childs","childRow","childID","attr","status","handleJSON","oldRow","resultRow","setTimeout","removeData","env","bundle","config","modules","push"],"sources":["mod-tree.js"],"sourcesContent":["/* global MyAMS */\n/**\n * MyAMS tree management\n */\n\nconst $ = MyAMS.$;\n\n\nexport const tree = {\n\n\t/**\n\t * Open/close tree node inside a table\n\t */\n\tswitchTreeNode: (evt) => {\n\n\t\tconst removeChildNodes = (nodeId) => {\n\t\t\t$(`tr[data-ams-tree-node-parent-id=\"${nodeId}\"]`).each((idx, elt) => {\n\t\t\t\tconst row = $(elt);\n\t\t\t\tremoveChildNodes(row.data('ams-tree-node-id'));\n\t\t\t\tdtTable.row(row).remove().draw();\n\t\t\t});\n\t\t}\n\n\t\tconst\n\t\t\tnode = $(evt.currentTarget),\n\t\t\tswitcher = $('.switcher', node),\n\t\t\ttr = node.parents('tr').first(),\n\t\t\ttable = tr.parents('table').first(),\n\t\t\tdtTable = table.DataTable();\n\t\tnode.tooltip('hide');\n\t\tif (switcher.hasClass('expanded')) {\n\t\t\tremoveChildNodes(tr.data('ams-tree-node-id'));\n\t\t\tswitcher.html('<i class=\"far fa-plus-square\"></i>')\n\t\t\t\t.removeClass('expanded');\n\t\t} else {\n\t\t\tconst\n\t\t\t\tlocation = tr.data('ams-location') || table.data('ams-location') || '',\n\t\t\t\ttreeNodesTarget = tr.data('ams-tree-nodes-target') ||\n\t\t\t\t\ttable.data('ams-tree-nodes-target') || 'get-tree-nodes.json',\n\t\t\t\tsourceName = tr.data('ams-element-name');\n\t\t\tswitcher.html('<i class=\"fas fa-spinner fa-spin\"></i>');\n\t\t\tMyAMS.require('ajax').then(() => {\n\t\t\t\tMyAMS.ajax.post(`${location}/${sourceName}/${treeNodesTarget}`, {\n\t\t\t\t\tcan_sort: !$('td.sorter', tr).is(':empty')\n\t\t\t\t}).then((result) => {\n\t\t\t\t\tif (result.length > 0) {\n\t\t\t\t\t\tlet newRow;\n\t\t\t\t\t\tfor (const row of result) {\n\t\t\t\t\t\t\tnewRow = $(row);\n\t\t\t\t\t\t\tdtTable.row.add(newRow).draw();\n\t\t\t\t\t\t\tMyAMS.core.initContent(newRow).then();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tswitcher.html('<i class=\"far fa-minus-square\"></i>')\n\t\t\t\t\t\t.addClass('expanded');\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\n\t/**\n\t * Open close all tree nodes\n\t */\n\tswitchTree: (evt) => {\n\t\tconst\n\t\t\tnode = $(evt.currentTarget),\n\t\t\tswitcher = $('.switcher', node),\n\t\t\tth = node.parents('th'),\n\t\t\ttable = th.parents('table').first(),\n\t\t\ttableID = table.data('ams-tree-node-id'),\n\t\t\tdtTable = table.DataTable();\n\t\tnode.tooltip('hide');\n\t\tif (switcher.hasClass('expanded')) {\n\t\t\t$('tr[data-ams-tree-node-parent-id]').filter(`tr[data-ams-tree-node-parent-id!=\"${tableID}\"]`).each((idx, elt) => {\n\t\t\t\tdtTable.row(elt).remove().draw();\n\t\t\t});\n\t\t\t$('.switcher', table).each((idx, elt) => {\n\t\t\t\t$(elt).html('<i class=\"far fa-plus-square\"></i>')\n\t\t\t\t\t.removeClass('expanded');\n\t\t\t});\n\t\t} else {\n\t\t\tconst\n\t\t\t\tlocation = table.data('ams-location') || '',\n\t\t\t\ttarget = table.data('ams-tree-nodes-target') || 'get-tree.json',\n\t\t\t\ttr = $('tbody tr', table.first());\n\t\t\tswitcher.html('<i class=\"fas fa-spinner fa-spin\"></i>');\n\t\t\tMyAMS.require('ajax').then(() => {\n\t\t\t\tMyAMS.ajax.post(`${location}/${target}`, {\n\t\t\t\t\tcan_sort: !$('td.sorter', tr).is(':empty')\n\t\t\t\t}).then((result) => {\n\t\t\t\t\t$(`tr[data-ams-tree-node-id]`, table).each((idx, elt) => {\n\t\t\t\t\t\tdtTable.row(elt).remove().draw();\n\t\t\t\t\t});\n\t\t\t\t\t$(result).each((idx, elt) => {\n\t\t\t\t\t\tconst newRow = $(elt);\n\t\t\t\t\t\tdtTable.row.add(newRow).draw();\n\t\t\t\t\t});\n\t\t\t\t\tMyAMS.core.initContent(table).then();\n\t\t\t\t\tswitcher.html('<i class=\"far fa-minus-square\"></i>')\n\t\t\t\t\t\t.addClass('expanded');\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\n\t/**\n\t * Custom tree element delete callback\n\t *\n\t * @param form: source form, which can be null if callback wasn't triggered from a form\n\t * @param options: callback options\n\t */\n\tdeleteElement: (form, options) => {\n\t\tconsole.debug(options);\n\t\tconst nodeId = options.node_id;\n\t\tif (nodeId) {\n\t\t\t$(`tr[data-ams-tree-node-parent-id=\"${nodeId}\"]`).each((idx, elt) => {\n\t\t\t\tconst\n\t\t\t\t\ttable = $(elt).parents('table'),\n\t\t\t\t\tdtTable  = table.DataTable();\n\t\t\t\tdtTable.row(elt).remove().draw();\n\t\t\t});\n\t\t}\n\t},\n\n\t/**\n\t * Sort and re-parent tree elements\n\t */\n\tsortTree: (evt, details) => {\n\t\tconst\n\t\t\ttable = $(evt.target),\n\t\t\tdtTable = table.DataTable(),\n\t\t\tdata = $(table).data();\n\t\tlet target = data.amsReorderUrl;\n\t\tif (target) {\n\t\t\t// Disable row click handler\n\t\t\tconst row = $(data.amsReorderSource.node);\n\t\t\trow.data('ams-disabled-handlers', 'click');\n\t\t\ttry {\n\t\t\t\t// Get root ID\n\t\t\t\tconst tableID = row.parents('table').first().data('ams-tree-node-id');\n\t\t\t\t// Get moved row ID\n\t\t\t\tconst rowID = row.data('ams-tree-node-id');\n\t\t\t\tconst rowParentID = row.data('ams-tree-node-parent-id');\n\t\t\t\t// Get new parent ID\n\t\t\t\tconst parent = row.prev('tr');\n\t\t\t\tlet parentID,\n\t\t\t\t\tswitcher,\n\t\t\t\t\taction;\n\t\t\t\tif (parent.exists()) {\n\t\t\t\t\t// Move below an existing row\n\t\t\t\t\tparentID = parent.data('ams-tree-node-id');\n\t\t\t\t\t// Check switcher state\n\t\t\t\t\tswitcher = $(`.${data.amsTreeSwitcherClass || 'switcher'}`, parent);\n\t\t\t\t\tif (switcher.hasClass(data.amsTreeSwitcherExpandedClass || 'expanded')) {\n\t\t\t\t\t\t// Opened folder: move as child\n\t\t\t\t\t\tif (rowParentID === parentID) {\n\t\t\t\t\t\t\t// Don't change parent\n\t\t\t\t\t\t\taction = 'reorder';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Change parent\n\t\t\t\t\t\t\taction = 'reparent';\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Closed folder or simple item: move as sibling\n\t\t\t\t\t\tparentID = parent.data('ams-tree-node-parent-id');\n\t\t\t\t\t\tif (rowParentID === parentID) {\n\t\t\t\t\t\t\t// Don't change parent\n\t\t\t\t\t\t\taction = 'reorder';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Change parent\n\t\t\t\t\t\t\taction = 'reparent';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Move to site root\n\t\t\t\t\tparentID = tableID;\n\t\t\t\t\tswitcher = null;\n\t\t\t\t\tif (rowParentID === parentID) {\n\t\t\t\t\t\t// Already child of site root\n\t\t\t\t\t\taction = 'reorder';\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Move from inner folder to site root\n\t\t\t\t\t\taction = 'reparent';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Call ordering target\n\t\t\t\tconst localTarget = MyAMS.core.getFunctionByName(target);\n\t\t\t\tconst postData = {\n\t\t\t\t\taction: action,\n\t\t\t\t\tchild: rowID,\n\t\t\t\t\tparent: parentID,\n\t\t\t\t\torder: JSON.stringify($('tr[data-ams-tree-node-id]', table).listattr('data-ams-tree-node-id')),\n\t\t\t\t\tcan_sort: !$('td.sorter', row).is(':empty')\n\t\t\t\t};\n\t\t\t\tif (typeof localTarget === 'function') {\n\t\t\t\t\tlocalTarget.call(table, dtTable, postData);\n\t\t\t\t} else {\n\t\t\t\t\tif (!target.startsWith(window.location.protocol)) {\n\t\t\t\t\t\tconst location = data.amsLocation;\n\t\t\t\t\t\tif (location) {\n\t\t\t\t\t\t\ttarget = `${location}/${target}`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tMyAMS.require('ajax').then(() => {\n\t\t\t\t\t\tMyAMS.ajax.post(target, postData).then((result) => {\n\n\t\t\t\t\t\t\tconst removeRow = (rowID) => {\n\t\t\t\t\t\t\t\tconst row = $(`tr[data-ams-tree-node-id=\"${rowID}\"]`, table);\n\t\t\t\t\t\t\t\tdtTable.row(row).remove().draw();\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tconst removeChildRows = (rowID) => {\n\t\t\t\t\t\t\t\tconst childs = $(`tr[data-ams-tree-node-parent-id=\"${rowID}\"]`, table);\n\t\t\t\t\t\t\t\tchilds.each((idx, elt) => {\n\t\t\t\t\t\t\t\t\tconst\n\t\t\t\t\t\t\t\t\t\tchildRow = $(elt),\n\t\t\t\t\t\t\t\t\t\tchildID = childRow.attr('data-ams-tree-node-id');\n\t\t\t\t\t\t\t\t\tremoveChildRows(childID);\n\t\t\t\t\t\t\t\t\tdtTable.row(childRow).remove().draw();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif (result.status) {\n\t\t\t\t\t\t\t\tMyAMS.ajax.handleJSON(result);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Remove parent row if changed parent\n\t\t\t\t\t\t\t\tif (postData.action === 'reparent') {\n\t\t\t\t\t\t\t\t\tremoveRow(parentID);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Remove moved row children\n\t\t\t\t\t\t\t\tremoveChildRows(parentID);\n\t\t\t\t\t\t\t\tremoveChildRows(rowID);\n\t\t\t\t\t\t\t\tdtTable.row(row).remove().draw();\n\t\t\t\t\t\t\t\tlet newRow,\n\t\t\t\t\t\t\t\t\toldRow;\n\t\t\t\t\t\t\t\tfor (const resultRow of result) {\n\t\t\t\t\t\t\t\t\tnewRow = $(resultRow);\n\t\t\t\t\t\t\t\t\toldRow = $(`tr[id=\"${newRow.attr('id')}\"]`);\n\t\t\t\t\t\t\t\t\tdtTable.row(oldRow).remove().draw();\n\t\t\t\t\t\t\t\t\tdtTable.row.add(newRow).draw();\n\t\t\t\t\t\t\t\t\tMyAMS.core.initContent(newRow).then();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} finally {\n\t\t\t\t// Restore row click handler\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t$(row).removeData('ams-disabled-handlers');\n\t\t\t\t}, 50);\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n};\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('tree');\n\t} else {\n\t\tMyAMS.tree = tree;\n\t\tconsole.debug(\"MyAMS: tree module loaded...\");\n\t}\n}\n"],"mappings":"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","ignoreList":[]}