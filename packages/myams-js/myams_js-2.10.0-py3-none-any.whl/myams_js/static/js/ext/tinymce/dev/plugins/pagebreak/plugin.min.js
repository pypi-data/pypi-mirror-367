!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=tinymce.util.Tools.resolve("tinymce.Env"),a=function(e){return e.getParam("pagebreak_split_block",!1)},t=function(e){var a='<img src="'+n.transparentSrc+'" class="mce-pagebreak" data-mce-resize="false" data-mce-placeholder />';return e?"<p>"+a+"</p>":a},r=function(e){var n=function(e){return e.getParam("pagebreak_separator","\x3c!-- pagebreak --\x3e")}(e),r=function(){return a(e)},o=new RegExp(n.replace(/[\?\.\*\[\]\(\)\{\}\+\^\$\:]/g,(function(e){return"\\"+e})),"gi");e.on("BeforeSetContent",(function(e){e.content=e.content.replace(o,t(r()))})),e.on("PreInit",(function(){e.serializer.addNodeFilter("img",(function(a){for(var t,o,c=a.length;c--;)if((o=(t=a[c]).attr("class"))&&-1!==o.indexOf("mce-pagebreak")){var i=t.parent;if(e.schema.getBlockElements()[i.name]&&r()){i.type=3,i.value=n,i.raw=!0,t.remove();continue}t.type=3,t.value=n,t.raw=!0}}))}))},o=function(e){e.addCommand("mcePageBreak",(function(){e.insertContent(t(a(e)))}))},c=function(e){e.on("ResolveName",(function(n){"IMG"===n.target.nodeName&&e.dom.hasClass(n.target,"mce-pagebreak")&&(n.name="pagebreak")}))},i=function(e){var n=function(){return e.execCommand("mcePageBreak")};e.ui.registry.addButton("pagebreak",{icon:"page-break",tooltip:"Page break",onAction:n}),e.ui.registry.addMenuItem("pagebreak",{text:"Page break",icon:"page-break",onAction:n})};e.add("pagebreak",(function(e){o(e),i(e),r(e),c(e)}))}();
