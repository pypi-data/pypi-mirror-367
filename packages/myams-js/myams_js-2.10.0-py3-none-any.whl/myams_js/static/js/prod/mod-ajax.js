!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var o={exports:{}};t(o.exports),e.modAjax=o.exports}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ajax=void 0;const t=MyAMS.$;function o(e){if(window.Cookies){const t=Cookies.get(MyAMS.config.csrfCookieName);t&&e.setRequestHeader(MyAMS.config.csrfHeaderName,t)}}const n=e.ajax={check:(e,o)=>new Promise(((n,s)=>{const a=[];if(void 0===e){o instanceof Array||(o=[o]);for(const e of o)a.push(MyAMS.core.getScript(e))}else e instanceof Array||(e=[e]),e.forEach(((e,t)=>{void 0===e&&a.push(MyAMS.core.getScript(o[t]))}));t.when.apply(t,a).then((()=>{n(a.length>0)}),s)})),getAddr:e=>{const o=e||t("html head base").attr("href")||window.location.href;return o.substring(0,o.lastIndexOf("/")+1)},start:()=>{t("#ajax-gear").show()},stop:()=>{t("#ajax-gear").hide()},progress:e=>{e.lengthComputable&&(e.loaded>=e.total||console&&console.debug&&console.debug(`${Math.round(e.loaded/e.total*100)}%`))},get:(e,n,s)=>new Promise(((a,r)=>{let i;i=e.startsWith(window.location.protocol)?e:MyAMS.ajax.getAddr()+e;const c={url:i,type:"get",cache:!1,data:t.param(n||null),dataType:"json",beforeSend:o},l=t.extend({},c,s);t.ajax(l).then(((e,t,o)=>{a(e,t,o)}),((e,t,o)=>{r(o)}))})),post:(e,n,s)=>new Promise(((a,r)=>{let i,c;i=e.startsWith(window.location.protocol)?e:MyAMS.ajax.getAddr()+e,c=n&&s&&s.contentType&&s.contentType.startsWith("application/json")?JSON.stringify(n):t.param(n||null);const l={url:i,type:"post",cache:!1,data:c,dataType:"json",beforeSend:o},d=t.extend({},l,s);t.ajax(d).then(((e,t,o)=>{a(e,t,o)}),((e,t,o)=>{r(o)}))})),getJSON:()=>(e,t)=>{const o=t.url;return delete t.url,MyAMS.ajax.post(o,t).then(MyAMS.ajax.handleJSON)},getResponse:e=>{let t,o="unknown";if(e){let n=e.getResponseHeader("content-type");if(!n)try{n=e.responseXML.contentType}catch(e){n=null}if(n)if(n.startsWith("application/javascript"))t=e.responseText,o="script";else if(n.startsWith("text/html"))t=e.responseText,o="html";else if(n.startsWith("text/xml"))t=e.responseText,o="xml";else if(t=e.responseJSON,t)o="json";else try{t=JSON.parse(e.responseText),o="json"}catch(n){t=e.responseText,o="binary"}else t={status:"alert",alert:{title:MyAMS.i18n.ERROR_OCCURED,content:MyAMS.i18n.NO_SERVER_RESPONSE}},o="json"}return{contentType:o,data:t}},handleJSON:(e,o,n)=>{function s(){return new Promise(((t,n)=>{void 0!==o?MyAMS.require("form").then((()=>{MyAMS.form.resetChanged(o)})).then((()=>{!1!==e.closeForm?MyAMS.require("modal").then((()=>{MyAMS.modal.close(o)})).then(t,n):t()})):t()}))}let a=null,r=null;const i=e.status,c=[];switch(n instanceof jQuery&&!n.length&&(n=null),i){case"alert":if(window.alert){const t=e.alert;window.alert(`${t.title}\n\n${t.content}`)}break;case"error":c.push(MyAMS.require("error").then((()=>{MyAMS.error.showErrors(o,e)})));break;case"message":case"messagebox":case"smallbox":break;case"info":case"success":case"notify":case"callback":case"callbacks":c.push(s());break;case"modal":c.push(MyAMS.require("modal").then((()=>{MyAMS.modal.open(e.location)})));break;case"reload":s(),a=e.location||window.location.hash,a.startsWith("#")&&(a=a.substring(1)),r=t(e.target||n||"#content"),c.push(MyAMS.require("skin").then((()=>{MyAMS.skin.loadURL(a,r,{preLoadCallback:MyAMS.core.getFunctionByName(e.preReload||function(){t("[data-ams-pre-reload]",r).each(((e,o)=>{MyAMS.core.executeFunctionByName(t(o).data("ams-pre-reload"))}))}),preLoadCallbackOptions:e.preReloadOptions,afterLoadCallback:MyAMS.core.getFunctionByName(e.postReload||function(){t("[data-ams-post-reload]",r).each(((e,o)=>{MyAMS.core.executeFunctionByName(t(o).data("ams-post-reload"))}))}),afterLoadCallbackOptions:e.postReloadOptions})})));break;case"redirect":s(),a=e.location||window.location.href,a.endsWith("##")&&(a=a.replace(/##/,window.location.hash)),e.window?window.open(a,e.window,e.options):(t(window).off("beforeunload"),window.location.href===a?window.location.reload():window.location.replace(a));break;default:e.code?c.push(MyAMS.require("error").then((()=>{MyAMS.error.showHTTPError(e)}))):window.console&&console.warn&&console.warn(`Unhandled JSON response status: ${i}`)}if(e.content){const o=e.content,s=t(o.target||n||"#content");"string"==typeof o?s.html(o):(o.text?s.text(o.text):s.html(o.html),c.push(MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,s).then((()=>{o.keepHidden||s.removeClass("hidden")}))))}if(e.contents)for(const o of e.contents){const e=t(o.target);o.text?e.text(o.text):e.html(o.html),c.push(MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,e).then((()=>{o.keepHidden||e.removeClass("hidden")})))}if(e.message&&!e.code&&c.push(MyAMS.require("alert").then((()=>{if("string"==typeof e.message)MyAMS.alert.smallBox({status:i,message:e.message,icon:"fa-info-circle",timeout:3e3});else{const t=e.message;MyAMS.alert.alert({parent:o,status:t.status||i,header:t.header,subtitle:t.subtitle,message:t.message})}}))),e.messagebox&&c.push(MyAMS.require("alert").then((()=>{if("string"==typeof e.messagebox)MyAMS.alert.messageBox({status:i,title:MyAMS.i18n.ERROR_OCCURED,icon:"fa-info-circle",message:e.messagebox,timeout:1e4});else{const t=e.messagebox;MyAMS.alert.messageBox({status:t.status||i,title:t.title||MyAMS.i18n.ERROR_OCCURED,icon:t.icon||"fa-info-circle",message:t.message,content:t.content,timeout:0===t.timeout?0:t.timeout||1e4})}}))),e.smallbox&&c.push(MyAMS.require("alert").then((()=>{if("string"==typeof e.smallbox)MyAMS.alert.smallBox({status:i,message:e.smallbox,icon:"fa-info-circle",timeout:3e3});else{const t=e.smallbox;MyAMS.alert.smallBox({status:t.status||i,message:t.message,content:t.content,icon:t.icon||"fa-info-circle",timeout:t.timeout})}}))),e.event&&o.trigger(e.event,e.eventOptions),e.events)for(const t of e.events)"string"==typeof t?o.trigger(t,e.eventOptions):o.trigger(t.event,t.options);if(e.callback&&c.push(MyAMS.core.executeFunctionByName(e.callback,document,o,e.options)),e.callbacks)for(const t of e.callbacks)"string"==typeof t?c.push(MyAMS.core.executeFunctionByName(t,document,o,e.options)):c.push(MyAMS.require(t.module||[]).then((()=>{MyAMS.core.executeFunctionByName(t.callback,document,o,t.options)})));return Promise.all(c)},error:(e,t,o,n)=>{if("abort"===n)return;if(t&&t.statusText&&"OK"===t.statusText.toUpperCase())return;if(!0===t.x_ams_handled)return;const s=MyAMS.ajax.getResponse(t);s?"json"===s.contentType?(MyAMS.ajax.handleJSON(s.data),t.x_ams_handled=!0):MyAMS.require("i18n","alert").then((()=>{const t=n||e.statusText||e.type,o=s.responseText;MyAMS.alert.messageBox({status:"error",title:MyAMS.i18n.ERROR_OCCURED,content:`<h4>${t}</h4><p>${o||""}</p>`,icon:"fa-exclamation-triangle",timeout:5e3})}),(()=>{window.console&&(console.error&&console.error(e),console.debug&&console.debug(s))})):window.console&&(console.error&&console.error("ERROR: Can't parse response!"),console.debug&&console.debug(t))}};"undefined"==typeof jest&&n.check(window.Cookies,`${MyAMS.env.baseURL}../ext/js-cookie${MyAMS.env.extext}.js`).then((()=>{const e=t.ajaxSettings.xhr;t.ajaxSetup({beforeSend:(e,t)=>{if(MyAMS.config.safeMethods.indexOf(t.type)<0&&void 0!==window.Cookies){const t=Cookies.get(MyAMS.config.csrfCookieName);t&&e.setRequestHeader(MyAMS.config.csrfHeaderName,t)}},progress:n.progress,progressUpload:n.progress,xhr:function(){const t=e();return t&&"function"==typeof t.addEventListener&&n.progress&&t.addEventListener("progress",(e=>{MyAMS.ajax.progress(e)}),!1),t}})})),t(document).ajaxStart(n.start),t(document).ajaxStop(n.stop),t(document).ajaxError(n.error),MyAMS.env.bundle?MyAMS.config.modules.push("ajax"):(MyAMS.ajax=n,console.debug("MyAMS: AJAX module loaded..."))}));