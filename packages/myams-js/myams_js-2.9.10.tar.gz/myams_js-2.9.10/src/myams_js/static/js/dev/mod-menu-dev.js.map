{"version":3,"file":"mod-menu-dev.js","names":["$","MyAMS","_contextMenuHandler","menu","source","get","tagName","parents","first","menuData","data","toggle","require","then","modal","open","href","attr","amsUrl","startsWith","hrefGetter","core","getFunctionByName","replace","target","form","confirmChangedForm","status","skin","loadURL","location","hash","dom","root","hasClass","removeClass","setTimeout","window","_initialized","_exports","init","fn","extend","contextMenu","settings","getMenuPosition","mouse","direction","win","menuSelector","position","each","idx","elt","on","evt","ctrlKey","dropdown","css","left","clientX","top","clientY","off","clickEvt","stopPropagation","preventDefault","document","click","currentTarget","ul","children","menuRect","getBoundingClientRect","buttonHeight","height","menuHeight","outerHeight","addClass","focus","clickEvent","env","bundle","config","modules","push","console","debug"],"sources":["mod-menu.js"],"sourcesContent":["/* global MyAMS */\n/**\n * MyAMS menus management\n */\n\nconst $ = MyAMS.$;\n\n\n/**\n * Context menu handler\n */\nfunction _contextMenuHandler(menu, source) {\n\tif (menu.get(0).tagName !== 'A') {\n\t\tmenu = menu.parents('a').first();\n\t}\n\tconst menuData = menu.data();\n\tif (menuData.toggle === 'modal') {\n\t\tMyAMS.require('modal').then(() => {\n\t\t\tMyAMS.modal.open(menu);\n\t\t});\n\t} else {\n\t\tlet href = menu.attr('href') || menuData.amsUrl;\n\t\tif (!href || href.startsWith('javascript:') || menu.attr('target')) {\n\t\t\treturn;\n\t\t}\n\t\tconst hrefGetter = MyAMS.core.getFunctionByName(href);\n\t\tif (typeof hrefGetter === 'function') {\n\t\t\thref = hrefGetter(menu, source);\n\t\t}\n\t\tif (typeof href === 'undefined') {\n\t\t\treturn;\n\t\t}\n\t\tif (typeof href === 'function') {\n\t\t\thref(menu);\n\t\t} else {\n\t\t\tMyAMS.require('form', 'skin').then(() => {\n\t\t\t\thref = href.replace(/%23/, '#');\n\t\t\t\tconst target = menu.data('ams-target');\n\t\t\t\tif (target) {\n\t\t\t\t\tMyAMS.form.confirmChangedForm(target).then((status) => {\n\t\t\t\t\t\tif (status !== 'success') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tMyAMS.skin.loadURL(href, target,\n\t\t\t\t\t\t\tmenu.data('ams-link-options'), menu.data('ams-link-callback'));\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tMyAMS.form.confirmChangedForm().then((status) => {\n\t\t\t\t\t\tif (status !== 'success') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (href.startsWith('#')) {\n\t\t\t\t\t\t\tif (href !== location.hash) {\n\t\t\t\t\t\t\t\tif (MyAMS.dom.root.hasClass('mobile-view-activated')) {\n\t\t\t\t\t\t\t\t\tMyAMS.dom.root.removeClass('hidden-menu');\n\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\twindow.location.hash = href;\n\t\t\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\twindow.location.hash = href;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.location = href;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\n\nlet _initialized = false;\n\n\n/**\n * MyAMS \"menu\" module\n */\nexport const menu = {\n\n\t/**\n\t * Global module initialization.\n\t * This function extends jQuery with a \"contextMenu()\" function, which\n\t * allows to create a new context menu.\n\t */\n\tinit: () => {\n\n\t\tif (_initialized) {\n\t\t\treturn;\n\t\t}\n\t\t_initialized = true;\n\n\t\t$.fn.extend({\n\n\t\t\t/**\n\t\t\t * JQuery context menu constructor\n\t\t\t */\n\t\t\tcontextMenu: function(settings) {\n\n\t\t\t\tfunction getMenuPosition(mouse, direction) {\n\t\t\t\t\tconst\n\t\t\t\t\t\twin = $(window)[direction](),\n\t\t\t\t\t\tmenu = $(settings.menuSelector)[direction]();\n\t\t\t\t\tlet position = mouse;\n\t\t\t\t\t// opening menu would pass the side of the page\n\t\t\t\t\tif (mouse + menu > win && menu < mouse) {\n\t\t\t\t\t\tposition -= menu;\n\t\t\t\t\t}\n\t\t\t\t\treturn position;\n\t\t\t\t}\n\n\t\t\t\treturn this.each((idx, elt) => {\n\n\t\t\t\t\tconst\n\t\t\t\t\t\tsource = $(elt),\n\t\t\t\t\t\tmenu = $(settings.menuSelector);\n\n\t\t\t\t\t// Set flag on menu items\n\t\t\t\t\t$('a', menu).each((idx, elt) => {\n\t\t\t\t\t\t$(elt).data('ams-context-menu', true);\n\t\t\t\t\t});\n\t\t\t\t\tsource.on(\"contextmenu\", function (evt) {\n\t\t\t\t\t\t// return native menu if pressing CTRL key\n\t\t\t\t\t\tif (evt.ctrlKey) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// open menu\n\t\t\t\t\t\tmenu.data('contextmenu-event-source', source)\n\t\t\t\t\t\t\t.dropdown('show')\n\t\t\t\t\t\t\t.css({\n\t\t\t\t\t\t\t\tposition: 'fixed',\n\t\t\t\t\t\t\t\tleft: getMenuPosition(evt.clientX, 'width') - 10,\n\t\t\t\t\t\t\t\ttop: getMenuPosition(evt.clientY, 'height') - 10\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.off('click')\n\t\t\t\t\t\t\t.on('click', (clickEvt) => {\n\t\t\t\t\t\t\t\tclickEvt.stopPropagation();\n\t\t\t\t\t\t\t\tclickEvt.preventDefault();\n\t\t\t\t\t\t\t\tmenu.dropdown('hide');\n\t\t\t\t\t\t\t\t_contextMenuHandler($(clickEvt.target), source);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t});\n\n\t\t\t\t\t// make sure menu closes on any click\n\t\t\t\t\t$(document).click(() => {\n\t\t\t\t\t\tmenu.dropdown('hide');\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// Automatically set orientation of dropdown menus\n\t\t$(document).on('show.bs.dropdown', '.btn-group', (evt) => {\n\t\t\t// check menu height\n\t\t\tconst\n\t\t\t\tmenu = $(evt.currentTarget),\n\t\t\t\tul = menu.children('.dropdown-menu'),\n\t\t\t\tmenuRect = menu.get(0).getBoundingClientRect(),\n\t\t\t\tposition = menuRect.top,\n\t\t\t\tbuttonHeight = menuRect.height,\n\t\t\t\tmenuHeight = ul.outerHeight();\n\t\t\tif (position > menuHeight && $(window).height() - position < buttonHeight + menuHeight) {\n\t\t\t\tmenu.addClass(\"dropup\");\n\t\t\t}\n\t\t\t// activate first input\n\t\t\t$('input, select, textarea', ul).first().focus();\n\t\t}).on('hidden.bs.dropdown', '.btn-group', (evt) => {\n\t\t\t// always reset after close\n\t\t\t$(evt.currentTarget).removeClass('dropup');\n\t\t});\n\n\t\t$(document).on('hide.bs.dropdown', (evt) => {\n\t\t\tif (evt.clickEvent) {\n\t\t\t\tconst dropdown = $(evt.clickEvent.target).parents('.dropdown-menu');\n\t\t\t\tif (dropdown.data('ams-click-dismiss') === false) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('menu');\n\t} else {\n\t\tMyAMS.menu = menu;\n\t\tconsole.debug(\"MyAMS: menu module loaded...\");\n\t}\n}\n"],"mappings":"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","ignoreList":[]}