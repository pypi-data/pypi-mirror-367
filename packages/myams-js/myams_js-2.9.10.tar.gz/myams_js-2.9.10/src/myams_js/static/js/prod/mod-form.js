!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var a={exports:{}};t(a.exports),e.modForm=a.exports}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.checkFormValidators=o,e.form=void 0,e.formSubmitCallback=S,e.getFormAction=f,e.getFormAjaxSettings=M,e.getFormData=m,e.getFormDownloadTarget=v,e.getFormProgressSettings=p,e.getFormProgressState=y,e.getFormTarget=d,e.getFormValidators=n,e.initFormData=c,e.initFormDownloadTarget=x,e.initFormSubmitButton=i,e.initFormTarget=g,e.resetFormAfterError=A,e.resetFormAfterSubmit=h,e.resetFormDownloadTarget=C,e.resetFormSubmitButton=l,e.showFormSubmitWarning=s,e.submitForm=b;const t=MyAMS.$;if(!t.templates){const e=require("jsrender");t.templates=e.templates}let a=!1;const r=e.form={init:()=>{a||(a=!0,t(document).on("click",'[type="submit"], .submit',(e=>{const a=t(e.currentTarget);a.exists()&&t(a).closest("form").data("ams-submit-button",a)})),t(document).on("click",'input[type="checkbox"][readonly]',(()=>!1)),t(document).on("reset",MyAMS.form.resetHandler),t(document).on("reset","[data-ams-reset-handler]",MyAMS.form.customResetHandler),t(document).on("keydown","textarea",(e=>{if((10===e.keyCode||13===e.keyCode)&&(e.ctrlKey||e.metaKey)){const a=t(e.currentTarget).closest("form");t('button[type="submit"]',a).first().click()}})),t(document).on("focus","input[readonly]",(e=>{t(e.currentTarget).blur()})),t(document).on("focusin",(e=>{t(e.target).closest(".mce-window").length>=0&&e.stopImmediatePropagation()})),t(window).on("beforeunload",MyAMS.form.checkBeforeUnload))},initElement:e=>{let a;"string"==typeof e&&(e=t(e)),a=MyAMS.config.warnOnFormChange?t('form[data-ams-warn-on-change!="false"]',e):t('form[data-ams-warn-on-change="true"]',e),a.each(((e,a)=>{const r=t(a),s=r.data().amsChangedCallback||MyAMS.config.formChangeCallback;t("input, select, textarea, [data-ams-changed-event]",r).each(((e,a)=>{const n=t(a),o=n.data();if(!0!==o.amsIgnoreChange){const e=o.amsChangedEvent||"change";n.on(e,(()=>{MyAMS.form.setChanged(r),MyAMS.core.executeFunctionByName(o.amsChangedCallback||s,document,r,n)}))}}))})),MyAMS.form.setFocus(e)},setFocus:e=>new Promise(((a,r)=>{setTimeout((()=>{let r=t("[data-ams-focus-target]",e).first();r.exists()||(r="test"===window?.process?.env?.NODE_ENV?t("input, select, textarea",e).first():t("input:enabled:visible, select:enabled:visible, textarea:enabled:visible",e).first()),r.exists()&&r.get(0).focus(),a(r)}),100)})),checkBeforeUnload:()=>{if(MyAMS.i18n){if(t('form[data-ams-form-changed="true"]').exists())return MyAMS.i18n.FORM_CHANGED_WARNING}},confirmChangedForm:e=>new Promise(((a,s)=>{const n=t('form[data-ams-form-changed="true"]',e);n.exists()?MyAMS.require("alert").then((()=>{MyAMS.alert.bigBox({status:"danger",title:MyAMS.i18n.WARNING,icon:"text-danger fa-bell",message:MyAMS.i18n.FORM_CHANGED_WARNING}).then((e=>{"success"===e&&MyAMS.form.resetChanged(n),a(e)}))}),(()=>{s("Missing 'alert' module!")})):(r.resetChanged(n),a("success"))})),setChanged:e=>{e.attr("data-ams-form-changed",!0)},resetHandler:e=>{const a=t(e.target);MyAMS.form.clearAlerts(a),MyAMS.form.handleDefaultReset(a)},clearAlerts:e=>{t(".alert-danger, SPAN.state-error",e).not(".persistent").remove(),t(".state-error",e).removeClassPrefix("state-"),t(".invalid-feedback",e).remove(),t(".is-invalid",e).removeClass("is-invalid")},handleDefaultReset:e=>{setTimeout((()=>{e.find(".select2").trigger("change"),t("[data-ams-reset-callback]",e).each(((a,r)=>{const s=t(r),n=s.data(),o=MyAMS.core.getFunctionByName(n.amsResetCallback);void 0!==o&&o.call(document,e,s,n.amsResetCallbackOptions)})),MyAMS.form.resetChanged(e)}),10)},resetChanged:e=>{void 0!==e&&t(e).removeAttr("data-ams-form-changed")},customResetHandler:e=>{const a=t(e.target),r=a.data();if(r.amsResetHandler){!0!==r.amsKeepDefault&&!0!==r.amsResetKeepDefault&&e.preventDefault();const t=MyAMS.core.getFunctionByName(r.amsResetHandler);void 0!==t&&t.call(document,e,a,r.amsResetHandlerOptions)}},setInvalid:(e,a,r)=>{if("string"==typeof a&&(a=t(`[name="${a}"]`,e)),a.exists()){const e=a.closest(".form-widget");t(".invalid-feedback",e).remove(),t("<span>").text(r).addClass("is-invalid invalid-feedback").appendTo(e),a.removeClass("valid").addClass("is-invalid")}},getSettings:(e,a,r,u,T)=>{const k={submitWarning:s,getValidators:n,checkValidators:o,clearAlerts:MyAMS.form.clearAlerts,initSubmitButton:i,resetSubmitButton:l,getData:m,initData:c,initDataCallback:null,getTarget:d,initTarget:g,getAction:f,getAjaxSettings:M,getProgressSettings:p,getProgressState:y,submit:b,datatype:null,submitOptions:null,submitHandler:(e.attr("action")||"").replace(/#/,""),submitTarget:e.attr("target")||null,submitMessage:null,submitCallback:S,progressHandler:null,progressFieldName:"progressId",progressInterval:1e3,progressTarget:null,progressCallback:null,progressEndCallback:null,resetBeforeSubmit:!1,keepModalOpen:!1,resetAfterSubmit:h,resetTimeout:1e3,resetAfterError:A,downloadTarget:null,getDownloadTarget:v,initDownloadTarget:x,resetDownloadTarget:C},F=t.extend({},k);return t.extendPrefix(F,"amsForm",(e=>MyAMS.core.getFunctionByName(e)||e),a,u),t.extendOnly(F,(e=>MyAMS.core.getFunctionByName(e)||e),T),F},submit:function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(e=t(e)).exists())return!1;"object"==typeof a&&(r=a,a=void 0);const s=e.data(),n=t(s.amsSubmitButton),o=n.data()||{},i=MyAMS.form.getSettings(e,s,n,o,r);return s.submitted?(i.submitWarning(e,i),!1):(i.checkValidators(e,i).then((l=>{"success"===l&&MyAMS.require("ajax","i18n").then((()=>{MyAMS.ajax.check(t.fn.ajaxSubmit,`${MyAMS.env.baseURL}../ext/jquery-form${MyAMS.env.extext}.js`).then((()=>{i.clearAlerts(e,i),i.initSubmitButton(e,i,n);const t=i.getData(e,i,s,n,o,r),l={veto:!1};if(i.initData(e,i,n,t,r,l),l.veto)return void i.resetSubmitButton(e,i,n);const m=i.getTarget(e,i,s,o);m&&m.exists()&&i.initTarget(e,i,m);const c=i.getAction(e,i,a),d=i.getAjaxSettings(e,i,n,t,c,m),u=i.getDownloadTarget(e,i);u&&i.initDownloadTarget(e,i,u,d),d.progress=i.getProgressSettings(e,i,n,t),i.submit(e,i,n,t,d,m),u&&i.resetDownloadTarget(e,i,n,u,d)}))}))})),!1)},submitForm:e=>{const a=t(e.currentTarget),r=a.parents("form");r.data("ams-submit-button",a),r.submit()}};function s(e){return new Promise(((t,a)=>{e.data("ams-form-hide-submitted")?t():MyAMS.require("i18n","alert").then((()=>{MyAMS.alert.messageBox({status:"warning",title:MyAMS.i18n.WAIT,message:MyAMS.i18n.FORM_SUBMITTED,icon:"fa-save",timeout:e.data("ams-form-alert-timeout")||5e3})})).then(t,a)}))}function n(e){const a=new Map,r=(e.data("ams-form-validator")||"").trim().split(/[\s,;]+/);let s=[];return t(r).each(((e,t)=>{t&&s.push(t)})),s.length>0&&a.set(e,s),t("[data-ams-form-validator]",e).each(((e,r)=>{const n=t(r),o=(n.data("ams-form-validator")||"").trim().split(/[\s,;]+/);s=[],t(o).each(((e,t)=>{t&&s.push(t)})),s.length>0&&a.set(n,s)})),a}function o(e,a){return new Promise(((r,s)=>{const n=a.getValidators(e,a);if(!n.size)return void r("success");const o=[];for(const[t,a]of n.entries())for(const r of a)o.push(MyAMS.core.executeFunctionByName(r,document,e,t));t.when.apply(t,o).then((function(){let a="success",s=[];for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];for(const e of o)!0!==e&&(a="error","string"==typeof e?s.push(e):t.isArray(e)&&e.length>0&&(s=s.concat(e)));s.length>0?MyAMS.require("i18n","alert").then((()=>{const t=1===s.length?MyAMS.i18n.ERROR_OCCURED:MyAMS.i18n.ERRORS_OCCURED;MyAMS.alert.alert({parent:e,status:"danger",header:t,message:s}),r(a)})):r(a)}),(()=>{s("error")}))}))}function i(e,a,r){const s=r.data("ams-loading-text")||r.text().trim();s?(r.data("original-text",r.text()).prop("disabled",!0).text(`${s}...`),t("<div>").addClass("progress").appendTo(r)):r.data("original-html",r.html()).prop("disabled",!0).html('<i class="fa fa-cog fa-spin"></i>')}function l(e,a,r){t(".progress",r).remove();const s=r.data("original-text");if(s)r.text(s);else{const e=r.data("original-html");e&&r.html(e)}r.prop("disabled",!1)}function m(e,a,r,s,n,o){const i=t.extend({},r.amsFormData,n.amsFormData,o.data),l=s.attr("name");return l&&(i[l]=s.val()),i}function c(e,a,r,s,n,o){const i=a.initDataCallback;i&&t.extend(s,i(e,a,r,s,n,o)),e.trigger("init-data.ams.form",[s,o])}function d(e,a){return t(a.submitTarget)}const u=t.templates({markup:'\n\t<div class="row m-3">\n\t\t<div class="text-center w-100">\n\t\t\t<i class="fa fa-3x fa-cog fa-spin"></i>\n\t\t\t{{if message}}\n\t\t\t<strong>{{:message}}</strong>\n\t\t\t{{/if}}\n\t\t</div>\n\t</div>'});function g(e,t,a){a.html(u.render({message:t.submitMessage})),a.parents(".hidden").removeClass("hidden")}function f(e,t,a){let r;const s=a||t.submitHandler;return r=s.startsWith(window.location.protocol)?s:MyAMS.ajax.getAddr()+s,r}function M(e,a,r,s,n,o){const i={url:n,type:"post",cache:!1,data:s,dataType:a.datatype,beforeSerialize:e=>{const t={veto:!1};if(e.trigger("before-serialize.ams.form",[t]),t.veto)return!1;void 0!==window.tinyMCE&&tinyMCE.triggerSave()},beforeSubmit:(e,t)=>{const s={veto:!1};if(t.trigger("before-submit.ams.form",[e,s]),s.veto)return!1;t.data("submitted",!0),a.resetBeforeSubmit&&setTimeout((()=>{a.resetSubmitButton(t,a,r)}),250)},uploadProgress:(e,a,s,n)=>{t(".progress",r).css("background-image",`linear-gradient(to right, white -45%, green ${n}%, red ${n}%, red)`)},complete:t=>{e.trigger("complete.ams.form",[t])},success:(e,t,s,n)=>{const i={veto:!1};if(n.trigger("submit-success.ams.form",[e,t,s,i]),!i.veto){if(e&&"error"!==e.status&&!1!==e.closeForm){const e=n.closest(".modal-dialog");e.exists()&&!a.keepModalOpen&&MyAMS.modal&&MyAMS.modal.close(e)}try{a.submitCallback(n,a,o,e,t,s)}finally{a.resetAfterSubmit(n,a,r),MyAMS.form.resetChanged(n)}}},error:(e,t,s,n)=>{n.trigger("submit-error.ams.form",[e,t,s,o]),o&&a.resetAfterError(n,a,r,o),a.resetAfterSubmit(n,a,r)},iframe:!1};return t.extend({},i,a.submitOptions)}function p(e,a,r,s){const n=a.progressHandler;if(n){const e=a.progressFieldName;s[e]=MyAMS.core.generateUUID();let o=r;return a.progressTarget&&(o=t(a.progressTarget)),{handler:n,interval:a.progressInterval,fieldname:e,target:o,callback:a.progressCallback,endCallback:a.progressEndCallback}}}function y(e,a,r,s,n){let o=setTimeout((function e(){const a={};a[s.fieldname]=r[s.fieldname],MyAMS.ajax.post(s.handler,a).then(MyAMS.core.getFunctionByName(s.callback||function(a){if(t.isArray(a)&&(a=a[0]),"running"===a.status){const r=t(s.target);if(a.message)r.text(a.message);else{let e=a.progress||r.data("ams-progress-text")||MyAMS.i18n.PROGRESS;a.current?e+=`: ${a.current} / ${a.length||100}`:e+="...",r.text(e)}o=setTimeout(e,s.interval)}else"finished"===a.status&&i()}),i)}),s.interval);function i(){clearTimeout(o),a.resetSubmitButton(e,a,n),MyAMS.core.executeFunctionByName(s.endCallback,document,e,a,n),MyAMS.form.resetChanged(e)}}function b(e,t,a,r,s,n){s.progress&&t.getProgressState(e,t,r,s.progress,n),e.ajaxSubmit(s)}function S(e,t,a,r,s,n){let o=t.datatype;if(!o){const e=MyAMS.ajax.getResponse(n);e&&(o=e.contentType,r=e.data)}switch(o){case"binary":case"script":case"xml":break;case"json":MyAMS.ajax.handleJSON(r,e,a);break;default:MyAMS.form.resetChanged(e),a.css({opacity:"0.0"}),a.removeClass("hidden").parents(".hidden").removeClass(".hidden"),a.html(r).delay(50).animate({opacity:"1.0"},250),MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,a).then((()=>{MyAMS.require("helpers").then((()=>{MyAMS.helpers.scrollTo("#main",a,{offset:-15})}))}))}const i=n.getResponseHeader("X-AMS-Callback");if(i){const a=n.getResponseHeader("X-AMS-Callback-Options")||"{}";MyAMS.core.executeFunctionByName(i,document,e,t,a,r,s,n)}e.trigger("after-submit.ams.form",[r])}function h(e,t,a){e.data("submitted")&&(t.resetSubmitButton(e,t,a),e.data("submitted",!1),e.removeData("ams-submit-button"),e.trigger("after-reset.ams.form"),e.data("ams-reset-after-submit")&&e.get(0).reset())}function A(e,a,r){t("i",r).removeClass("fa-spin").removeClass("fa-cog").addClass("fa-ambulance")}function v(e,t){return t.downloadTarget}function x(e,a,r,s){let n=t(`iframe[name="${r}"]`);n.exists()||(n=t("<iframe>").attr("name",r).hide().appendTo(MyAMS.dom.root)),t.extend(s,{iframe:!0,iframeTarget:n})}function C(e,t,a,r,s){const n=e.closest(".modal-dialog"),o=t.keepModalOpen;n.exists()&&!0!==o&&MyAMS.require("modal").then((()=>{MyAMS.modal.close(n)})),s.progress||setTimeout((()=>{t.resetAfterSubmit(e,t,a),MyAMS.ajax&&MyAMS.ajax.stop(),MyAMS.form.resetChanged(e)}),t.resetTimeout)}window.MyAMS&&(MyAMS.env.bundle?MyAMS.config.modules.push("form"):(MyAMS.form=r,console.debug("MyAMS: form module loaded...")))}));