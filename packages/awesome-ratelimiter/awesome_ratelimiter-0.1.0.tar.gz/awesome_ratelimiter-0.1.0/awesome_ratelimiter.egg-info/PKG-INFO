Metadata-Version: 2.4
Name: awesome_ratelimiter
Version: 0.1.0
Summary: A flexible token-bucket rate limiter decorator.
Author-email: Hang Wang <hangw9412@gmail.com>
Project-URL: Homepage, https://github.com/785172550/ratelimiter_project
Project-URL: Bug Tracker, https://github.com/785172550/ratelimiter_project/issues
Classifier: Programming Language :: Python :: 3
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Requires-Python: >=3.7
Description-Content-Type: text/markdown
License-File: LICENSE.md
Dynamic: license-file

# Awesome Rate Limiter

[](https://www.google.com/search?q=https://pypi.org/project/my-awesome-ratelimiter/)
[](https://opensource.org/licenses/MIT)


ä¸€ä¸ªçµæ´»ã€çº¿ç¨‹å®‰å…¨ã€åŸºäºè£…é¥°å™¨çš„ Python é€Ÿç‡é™åˆ¶å™¨ï¼Œä½¿ç”¨ä»¤ç‰Œæ¡¶ï¼ˆToken Bucketï¼‰ç®—æ³•å®ç°ã€‚

-----

## âœ¨ ä¸»è¦ç‰¹æ€§

  * **æ˜“äºä½¿ç”¨**: é€šè¿‡ç®€å•çš„ `@` è£…é¥°å™¨è¯­æ³•å³å¯ä¸ºä»»ä½•å‡½æ•°æ·»åŠ é€Ÿç‡é™åˆ¶ã€‚
  * **ä»¤ç‰Œæ¡¶ç®—æ³•**: é«˜æ•ˆåœ°å¤„ç†çªå‘æµé‡ï¼ŒåŒæ—¶ä¿è¯é•¿æœŸçš„å¹³å‡é€Ÿç‡ã€‚
  * **æŒ‰é”®åŒºåˆ†é™åˆ¶**: å¯ä»¥æ ¹æ®ç”¨æˆ·IDã€IPåœ°å€æˆ–ä»»ä½•å…¶ä»–å‡½æ•°å‚æ•°æ¥æ–½åŠ ç‹¬ç«‹çš„é€Ÿç‡é™åˆ¶ã€‚
  * **é«˜åº¦å¯å®šåˆ¶**: è½»æ¾è®¾ç½®è¯·æ±‚é€Ÿç‡å’Œæ—¶é—´å‘¨æœŸã€‚
  * **æ˜ç¡®çš„å¼‚å¸¸å¤„ç†**: å½“è¯·æ±‚è¢«é™åˆ¶æ—¶ï¼Œä¼šæŠ›å‡ºå¸¦æœ‰å»ºè®®é‡è¯•æ—¶é—´çš„è‡ªå®šä¹‰å¼‚å¸¸ã€‚

## ğŸ”§ å®‰è£…

ä½ å¯ä»¥é€šè¿‡å·²æ„å»ºçš„ Wheel æ–‡ä»¶æˆ–ä»æºç è¿›è¡Œå®‰è£…ã€‚

**1. ä» Wheel æ–‡ä»¶å®‰è£…:**

```bash
# TODO uplaod to PyPI
pip install awesome-ratelimiter

# use this command to workaround
pip install git+https://github.com/785172550/awesome_ratelimiter.git
```

**2. ä»æºç è¿›è¡Œå¼€å‘/å¯ç¼–è¾‘æ¨¡å¼å®‰è£…:**

```bash
git clone https://github.com/785172550/awesome_ratelimiter.git
cd awesome_ratelimiter
pip install -e .
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

ä½¿ç”¨ `RateLimiter` éå¸¸ç®€å•ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§ç”¨ä¾‹ã€‚

### ç¤ºä¾‹ 1: å…¨å±€é€Ÿç‡é™åˆ¶

é™åˆ¶ä¸€ä¸ªå‡½æ•°åœ¨æ‰€æœ‰è°ƒç”¨ä¸­å…±äº«åŒä¸€ä¸ªé€Ÿç‡é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œé™åˆ¶ä¸€ä¸ª API æ¯ 10 ç§’æœ€å¤šè¢«è°ƒç”¨ 5 æ¬¡ã€‚

```python
import time
from my_ratelimiter import RateLimiter, RateLimitException

# token_bucket=True ä½¿ç”¨ token bucket limiterï¼Œå¦åˆ™ä½¿ç”¨ sliding window
@RateLimiter(max_requests=5, period=10ï¼Œtoken_bucket=True)
def fetch_global_resource():
    print(f"[{time.strftime('%H:%M:%S')}] æ­£åœ¨è·å–å…¨å±€èµ„æº... æˆåŠŸ!")

# æ¨¡æ‹Ÿçªå‘è°ƒç”¨
for i in range(7):
    try:
        fetch_global_resource()
    except RateLimitException as e:
        print(f"[{time.strftime('%H:%M:%S')}] è¯·æ±‚è¢«é™åˆ¶ã€‚è¯·åœ¨ {e.delay:.2f} ç§’åé‡è¯•ã€‚")
    time.sleep(0.5)
```

### ç¤ºä¾‹ 2: æ ¹æ®ç”¨æˆ· ID è¿›è¡Œé™åˆ¶

è¿™æ˜¯æ›´å¼ºå¤§çš„ç”¨æ³•ã€‚æ¯ä¸ªç”¨æˆ·å°†æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„é€Ÿç‡é™åˆ¶ã€‚

```python
import time
from awosome_ratelimiter import RateLimiter, RateLimitException

# å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºä»å‡½æ•°å‚æ•°ä¸­æå– 'user_id'
def get_user_id(args, kwargs):
    # å‡è®¾ user_id æ˜¯ç¬¬ä¸€ä¸ªä½ç½®å‚æ•°
    if args:
        return args[0]
    # æˆ–è€…ä»å…³é”®å­—å‚æ•°ä¸­è·å–
    return kwargs.get('user_id')

# æ¯ä¸ªç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤šè¯·æ±‚10æ¬¡
@RateLimiter(max_requests=10, period=60, get_key_func=get_user_id, token_bucket=False)
def user_specific_api(user_id: str, action: str):
    print(f"[{time.strftime('%H:%M:%S')}] ç”¨æˆ· '{user_id}' æ­£åœ¨æ‰§è¡Œæ“ä½œ '{action}'... æˆåŠŸ!")

# æ¨¡æ‹Ÿæ¥è‡ªä¸åŒç”¨æˆ·çš„è¯·æ±‚
try:
    user_specific_api("user-Alice", "æŸ¥è¯¢ä½™é¢")
    user_specific_api("user-Bob", "æ›´æ–°èµ„æ–™")
    user_specific_api("user-Alice", "å‘èµ·è½¬è´¦") # Alice çš„ç¬¬2æ¬¡è¯·æ±‚ï¼ŒæˆåŠŸ
    
    # å¿«é€Ÿè€—å°½ Bob çš„é¢åº¦
    for i in range(9):
        user_specific_api("user-Bob", f"å‘é€æ¶ˆæ¯ #{i+1}")
        time.sleep(0.1)
        
except RateLimitException as e:
    print(f"[{time.strftime('%H:%M:%S')}] è¯·æ±‚è¢«é™åˆ¶ã€‚è¯·åœ¨ {e.delay:.2f} ç§’åé‡è¯•ã€‚")
```

### å¤„ç†é™åˆ¶å¼‚å¸¸

`RateLimitException` å¼‚å¸¸å¯¹è±¡åŒ…å«ä¸€ä¸ª `delay` å±æ€§ï¼Œå®ƒå‘Šè¯‰æ‚¨éœ€è¦ç­‰å¾…å¤šå°‘ç§’æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ¬¡å°è¯•ã€‚

```python
from my_ratelimiter import RateLimitException

try:
    some_limited_function()
except RateLimitException as e:
    print(f"é€Ÿç‡è¶…é™ï¼Œéœ€è¦ç­‰å¾… {e.delay:.2f} ç§’ã€‚")
    # è¿™é‡Œå¯ä»¥åŠ å…¥é‡è¯•é€»è¾‘ï¼Œä¾‹å¦‚:
    # time.sleep(e.delay)
    # some_limited_function()
```


### `RateLimitException`

å½“è¯·æ±‚è¢«æ‹’ç»æ—¶æŠ›å‡ºçš„å¼‚å¸¸ã€‚

  * `delay` (float): ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œè¡¨ç¤ºå»ºè®®çš„æœ€å°ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç›´åˆ°å¯ä»¥å†æ¬¡å‘èµ·è¯·æ±‚ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼å¦‚æœæ‚¨å‘ç° Bug æˆ–æœ‰åŠŸèƒ½å»ºè®®ï¼Œè¯·éšæ—¶æäº¤ [Issues](https://www.google.com/search?q=https://github.com/785172550/awesome_ratelimiter/issues)ã€‚

å¦‚æœæ‚¨å¸Œæœ›è´¡çŒ®ä»£ç ï¼š

1.  Fork æœ¬ä»“åº“ã€‚
2.  åˆ›å»ºä¸€ä¸ªæ–°çš„åŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)ã€‚
3.  æäº¤æ‚¨çš„æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)ã€‚
4.  Push åˆ°æ‚¨çš„åˆ†æ”¯ (`git push origin feature/AmazingFeature`)ã€‚
5.  æäº¤ä¸€ä¸ª Pull Requestã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä½¿ç”¨ MIT è®¸å¯è¯ã€‚è¯¦æƒ…è¯·è§ `LICENSE` æ–‡ä»¶ã€‚
