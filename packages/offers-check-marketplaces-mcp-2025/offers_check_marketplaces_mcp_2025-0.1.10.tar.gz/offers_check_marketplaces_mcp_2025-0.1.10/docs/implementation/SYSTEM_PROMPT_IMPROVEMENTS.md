# Улучшения системного промта MCP сервера

## Дата изменений

**Дата**: 8 января 2025  
**Файл**: `offers_check_marketplaces/server.py`  
**Функция**: `SYSTEM_PROMPT`

## Проблема

ИИ-агент получал цены из поисковой выдачи Google/Yandex, что приводило к неточным данным. Цены в поисковых результатах часто устаревшие или неточные.

## Решение

Добавлены критически важные инструкции для ИИ-агента о том, как правильно получать цены:

### Ключевые изменения:

1. **Добавлена секция "КРИТИЧЕСКИ ВАЖНО: ПРАВИЛА ПОЛУЧЕНИЯ ЦЕН"**

   - Четкие запреты на использование поисковых систем
   - Обязательные требования по переходу на страницы товаров

2. **Детальный алгоритм поиска цен**

   - Пошаговые инструкции для каждого этапа
   - Технические требования для веб-скрапинга

3. **Специфичные инструкции для каждого маркетплейса**

   - URL поиска для каждого сайта
   - CSS селекторы для извлечения цен
   - Особенности каждого маркетплейса

4. **Примеры правильного и неправильного поиска**

   - Конкретные примеры кода
   - Визуальные индикаторы (✅/❌)

5. **Контроль качества данных**
   - Обязательные проверки перед сохранением
   - Критерии валидации цен

## Технические детали

### Запрещенные действия:

- ❌ Поиск в Google: `"товар site:komus.ru"`
- ❌ Использование цен из поисковой выдачи
- ❌ Переход по ссылкам из Google без проверки
- ❌ Использование агрегаторов цен

### Обязательные действия:

- ✅ Переход на официальный сайт маркетплейса
- ✅ Использование внутреннего поиска сайта
- ✅ Клик на товар из результатов поиска
- ✅ Извлечение цены со страницы товара
- ✅ Сохранение URL страницы товара

## Результат

- Получение точных, актуальных цен с официальных страниц товаров
- Возможность верификации данных через сохраненные URL
- Соответствие найденных товаров искомым характеристикам
- Повышение качества данных в системе

## Маркетплейсы с детальными инструкциями

1. **komus.ru** - офисные товары
2. **vseinstrumenti.ru** - инструменты
3. **ozon.ru** - универсальный (с антибот-защитой)
4. **wildberries.ru** - товары широкого потребления
5. **officemag.ru** - офисные принадлежности

## Дополнительные улучшения

- Добавлены технические требования (User-Agent, задержки)
- Инструкции по обработке капчи и антибот-защиты
- Примеры валидации данных
- Резюме ключевых требований в конце промта
