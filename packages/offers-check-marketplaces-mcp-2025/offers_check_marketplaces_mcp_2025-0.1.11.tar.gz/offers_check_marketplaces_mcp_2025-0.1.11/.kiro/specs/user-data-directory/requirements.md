# Requirements Document

## Introduction

Необходимо настроить MCP сервер offers-check-marketplaces так, чтобы база данных и другие пользовательские данные по умолчанию сохранялись в стандартных директориях данных пользователя операционной системы. Это обеспечит корректную работу после установки пакета через pip и соответствие стандартам каждой ОС.

## Requirements

### Requirement 1

**User Story:** Как пользователь Windows, я хочу чтобы данные MCP сервера сохранялись в %APPDATA%/offers-check-marketplaces, чтобы они были доступны только мне и не требовали административных прав.

#### Acceptance Criteria

1. WHEN MCP сервер запускается на Windows THEN база данных создается в %APPDATA%/offers-check-marketplaces/
2. WHEN пользователь не имеет административных прав THEN сервер все равно может создать и использовать базу данных
3. WHEN несколько пользователей используют один компьютер THEN каждый имеет свою отдельную базу данных

### Requirement 2

**User Story:** Как пользователь macOS, я хочу чтобы данные MCP сервера сохранялись в ~/Library/Application Support/offers-check-marketplaces, чтобы они соответствовали стандартам macOS.

#### Acceptance Criteria

1. WHEN MCP сервер запускается на macOS THEN база данных создается в ~/Library/Application Support/offers-check-marketplaces/
2. WHEN директория не существует THEN она автоматически создается с правильными правами доступа
3. WHEN пользователь переустанавливает систему THEN данные сохраняются при восстановлении из Time Machine

### Requirement 3

**User Story:** Как пользователь Linux, я хочу чтобы данные MCP сервера сохранялись в ~/.local/share/offers-check-marketplaces, чтобы они соответствовали стандарту XDG Base Directory.

#### Acceptance Criteria

1. WHEN MCP сервер запускается на Linux THEN база данных создается в ~/.local/share/offers-check-marketplaces/
2. WHEN переменная XDG_DATA_HOME установлена THEN используется $XDG_DATA_HOME/offers-check-marketplaces/
3. WHEN директория не существует THEN она автоматически создается с правами 755

### Requirement 4

**User Story:** Как разработчик, я хочу иметь возможность переопределить путь к данным через переменную окружения, чтобы можно было настроить кастомное расположение для тестирования или специальных случаев.

#### Acceptance Criteria

1. WHEN переменная OFFERS_CHECK_DATA_DIR установлена THEN используется указанный путь вместо стандартного
2. WHEN указанный путь не существует THEN он автоматически создается
3. WHEN путь недоступен для записи THEN выводится понятное сообщение об ошибке

### Requirement 5

**User Story:** Как системный администратор, я хочу чтобы MCP сервер корректно обрабатывал ситуации с недоступными директориями, чтобы получать понятные сообщения об ошибках.

#### Acceptance Criteria

1. WHEN директория данных недоступна для записи THEN выводится сообщение с инструкциями по исправлению
2. WHEN диск заполнен THEN выводится сообщение о нехватке места
3. WHEN происходит ошибка создания директории THEN логируется подробная информация для диагностики

### Requirement 6

**User Story:** Как пользователь, я хочу чтобы при первом запуске автоматически создавались все необходимые поддиректории, чтобы не настраивать их вручную.

#### Acceptance Criteria

1. WHEN MCP сервер запускается первый раз THEN создается структура директорий: database/, cache/, logs/, temp/
2. WHEN создаются директории THEN устанавливаются правильные права доступа для каждой ОС
3. WHEN структура уже существует THEN проверяется доступность и права доступа

### Requirement 7

**User Story:** Как пользователь, я хочу чтобы существующие данные из старой директории ./data автоматически мигрировали в новое расположение, чтобы не потерять настройки и базу данных.

#### Acceptance Criteria

1. WHEN обнаружена старая директория ./data THEN данные автоматически копируются в новое расположение
2. WHEN миграция завершена успешно THEN старая директория переименовывается в ./data.migrated
3. WHEN происходит ошибка миграции THEN процесс останавливается с подробным сообщением об ошибке

### Requirement 8

**User Story:** Как пользователь, я хочу видеть в логах информацию о том, где сохраняются мои данные, чтобы знать расположение файлов для резервного копирования.

#### Acceptance Criteria

1. WHEN MCP сервер запускается THEN в лог выводится полный путь к директории данных
2. WHEN создаются новые файлы THEN логируется их расположение
3. WHEN происходит миграция THEN логируется процесс перемещения данных
