# Добавленные Excel MCP Tools

## Обзор

В проект `offers-check-marketplaces` успешно добавлены новые MCP Tools для работы с Excel файлами. Эти инструменты позволяют парсить, обрабатывать и экспортировать Excel таблицы через MCP протокол.

## Добавленные файлы

### 1. `offers_check_marketplaces/excel_tools.py`

Основной модуль с классом `ExcelTools`, содержащий:

- Асинхронные методы для работы с Excel
- Обработка ошибок и валидация данных
- Поддержка различных форматов данных
- Автоматическое форматирование Excel файлов

### 2. `test_excel_tools.py`

Комплексный тест для проверки всех функций Excel Tools:

- Тестирование экспорта данных
- Проверка парсинга файлов
- Валидация фильтрации и трансформации
- Создание тестовых Excel файлов

### 3. `example_excel_usage.py`

Примеры использования новых MCP Tools с детальными комментариями.

## Новые MCP Tools

### 1. `parse_excel_file`

**Назначение**: Парсинг Excel файлов в структурированные данные
**Параметры**:

- `file_path` (str) - путь к Excel файлу
- `sheet_name` (Optional[str]) - название листа
- `header_row` (int) - номер строки заголовков (по умолчанию 0)
- `max_rows` (Optional[int]) - максимальное количество строк

**Возвращает**: Структурированные данные с метаинформацией о файле

### 2. `get_excel_info`

**Назначение**: Получение информации о структуре Excel файла
**Параметры**:

- `file_path` (str) - путь к Excel файлу

**Возвращает**: Информацию о листах, заголовках, размерах без полного чтения

### 3. `export_to_excel`

**Назначение**: Экспорт данных в Excel с форматированием
**Параметры**:

- `data` (List[Dict]) - данные для экспорта
- `file_path` (str) - путь для сохранения
- `sheet_name` (str) - название листа (по умолчанию "Data")
- `include_index` (bool) - включать индекс строк
- `auto_adjust_columns` (bool) - автоподгонка ширины колонок
- `apply_formatting` (bool) - применение форматирования

**Возвращает**: Результат экспорта с метаданными

### 4. `filter_excel_data`

**Назначение**: Фильтрация данных по критериям
**Параметры**:

- `data` (List[Dict]) - исходные данные
- `filters` (Dict) - критерии фильтрации

**Поддерживаемые фильтры**:

- Простые: точное совпадение значений
- Текстовые: `contains`, `not_contains`, `starts_with`, `ends_with`
- Числовые: `greater_than`, `less_than`, `greater_equal`, `less_equal`

### 5. `transform_excel_data`

**Назначение**: Трансформация данных по правилам
**Параметры**:

- `data` (List[Dict]) - исходные данные
- `transformations` (Dict) - правила трансформации

**Поддерживаемые трансформации**:

- Строковые: `to_upper`, `to_lower`, `strip`, `replace`
- Числовые: `multiply`, `divide`, `add`, `subtract`
- Типы: `convert_to` (int, float, str)

## Интеграция с существующей системой

### Обновленные файлы

#### `offers_check_marketplaces/server.py`

- Добавлен импорт `ExcelTools`
- Инициализация `excel_tools` в `initialize_components()`
- 5 новых MCP Tools с полной обработкой ошибок
- Обновлен системный промпт с документацией по Excel Tools

#### `README.md`

- Добавлена секция "Excel Tools" в список MCP Tools
- Примеры использования новых инструментов
- Обновлена документация по возможностям системы

## Особенности реализации

### Асинхронность

Все операции с Excel выполняются асинхронно через `ThreadPoolExecutor` для предотвращения блокировки основного потока.

### Обработка ошибок

- Использование декораторов `@handle_errors` для единообразной обработки
- Валидация входных параметров
- Информативные сообщения об ошибках для пользователей
- Логирование всех операций

### Форматирование Excel

- Автоматическое применение стилей к заголовкам
- Подгонка ширины колонок
- Добавление границ к ячейкам
- Настраиваемые параметры форматирования

### Гибкость фильтрации

- Поддержка простых и сложных критериев
- Комбинирование множественных условий
- Работа с различными типами данных

## Примеры использования

### Базовый рабочий процесс

```python
# 1. Анализ структуры файла
info = await get_excel_info("data/input.xlsx")

# 2. Парсинг данных
data = await parse_excel_file("data/input.xlsx", sheet_name="Данные")

# 3. Фильтрация
filtered = await filter_excel_data(data['data'], {
    "Категория": "Хозтовары",
    "Цена": {"greater_than": 1000}
})

# 4. Трансформация
transformed = await transform_excel_data(filtered['data'], {
    "model_name": {"to_upper": True},
    "price": {"multiply": 1.2}
})

# 5. Экспорт результатов
result = await export_to_excel(
    transformed['data'],
    "data/output.xlsx",
    apply_formatting=True
)
```

### Интеграция с существующими инструментами

Новые Excel Tools отлично интегрируются с существующими MCP Tools:

- Парсинг входных файлов с товарами
- Обработка результатов поиска цен
- Экспорт итоговых отчетов с форматированием
- Фильтрация товаров по категориям и ценам

## Преимущества

1. **Полная интеграция** с существующей архитектурой MCP сервера
2. **Асинхронная обработка** для высокой производительности
3. **Гибкая фильтрация** и трансформация данных
4. **Автоматическое форматирование** Excel файлов
5. **Комплексная обработка ошибок** с информативными сообщениями
6. **Подробная документация** и примеры использования

## Заключение

Новые Excel MCP Tools значительно расширяют возможности системы `offers-check-marketplaces` по работе с табличными данными. Они обеспечивают полный цикл обработки Excel файлов: от парсинга входных данных до экспорта отформатированных результатов.

Инструменты готовы к использованию и полностью интегрированы в существующую архитектуру проекта.
