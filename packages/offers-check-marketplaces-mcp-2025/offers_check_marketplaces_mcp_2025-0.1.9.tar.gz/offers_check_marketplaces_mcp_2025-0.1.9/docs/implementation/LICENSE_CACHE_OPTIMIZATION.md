# Оптимизация кеша лицензий

## Проблема

При каждом запуске системы проверки лицензий создавались папки `data.migrated.*` с файлами `.license_cache.json`. Это происходило из-за логики миграции данных в `user_data_manager.py`, которая переименовывала старую папку `data` в `data.migrated` при каждом запуске.

## Решение

### 1. Изменение логики кеширования лицензий

Обновлен файл `offers_check_marketplaces/license_manager.py`:

- **Новый метод `_get_cache_file_path()`**: Определяет оптимальное место для кеша лицензий
- **Новый метод `_get_config_file_path()`**: Определяет оптимальное место для конфигурации лицензий

#### Приоритет размещения файлов:

1. **Системная временная директория**: `%TEMP%/offers-check-marketplaces/`
2. **Домашняя директория пользователя**: `~/.offers-check-cache/`
3. **Текущая директория** (fallback): скрытые файлы `.license_cache.json`, `.license_config.json`

### 2. Обновление .gitignore

Добавлены правила для игнорирования:

```gitignore
# License cache and migrated data directories
data.migrated*
.license_cache.json
.license_config.json
data/
```

### 3. Скрипт очистки

Создан `cleanup_migrated_data.py` для удаления существующих папок `data.migrated.*` и старых файлов кеша.

## Преимущества нового подхода

1. **Скрытое хранение**: Файлы кеша не засоряют рабочую директорию проекта
2. **Системная интеграция**: Использование стандартных системных директорий
3. **Отсутствие конфликтов**: Больше не создаются папки `data.migrated.*`
4. **Кроссплатформенность**: Работает на Windows, macOS и Linux
5. **Автоматическая очистка**: Системные временные файлы очищаются автоматически

## Пути к файлам кеша

### Windows

- Основной: `%TEMP%\offers-check-marketplaces\.license_cache.json`
- Fallback: `%USERPROFILE%\.offers-check-cache\.license_cache.json`

### macOS/Linux

- Основной: `/tmp/offers-check-marketplaces/.license_cache.json`
- Fallback: `~/.offers-check-cache/.license_cache.json`

## Миграция

Для существующих проектов:

1. Запустите `python cleanup_migrated_data.py` для удаления старых папок
2. Старые файлы кеша будут автоматически пересозданы в новом расположении
3. Никаких дополнительных действий не требуется

## Обратная совместимость

Система остается полностью совместимой с существующими лицензионными ключами и конфигурациями. Изменилось только место хранения кеша.
