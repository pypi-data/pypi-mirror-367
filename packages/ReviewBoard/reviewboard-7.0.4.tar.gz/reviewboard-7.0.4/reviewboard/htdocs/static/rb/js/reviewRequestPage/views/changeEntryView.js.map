{"version":3,"file":"changeEntryView.js","names":["ParentView","RB","ReviewRequestPage","BaseStatusUpdatesEntryView","ChangeEntryView","extend","initialize","options","prototype","apply","arguments","reviewRequestEditor","model","get","reviewRequest","reviewRequestEditorView","_commitListView","_$boxStatus","_$fixItLabel","render","call","$","hide","appendTo","formatText","bugTrackerURL","isHTMLEncoded","_updateLabels","_","each","rowEl","$row","iconView","DiffComplexityIconView","numInserts","data","numDeletes","numReplaces","totalLines","find","empty","append","$el","thumbnailEl","$thumbnail","$caption","draft","createFileAttachment","id","hasClass","set","text","buildFileAttachmentThumbnail","canEdit","commits","DiffCommitListView","el","DiffCommitList","diffHistory","CommitHistoryDiffEntryCollection","setupReviewView","view","listenTo","_reviewViews","some","hasOpenIssues","openIssueCount","reduce","sum","getOpenIssueCount","addClass","interpolate","gettext","document","createTextNode","show","css","opacity","left","removeClass"],"sources":["../../../../../../static/rb/js/reviewRequestPage/views/changeEntryView.es6.js"],"sourcesContent":["(function() {\n\n\nconst ParentView = RB.ReviewRequestPage.BaseStatusUpdatesEntryView;\n\n\n/**\n * Displays the \"Review request changed\" entry on the review request page.\n *\n * This handles any rendering needed for special contents in the box,\n * such as the diff complexity icons and the file attachment thumbnails.\n */\nRB.ReviewRequestPage.ChangeEntryView = ParentView.extend({\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *          Options for the view.\n     *\n     * Option Args:\n     *     reviewRequestEditorView (RB.ReviewRequestEditorView):\n     *         The review request editor.\n     */\n    initialize(options) {\n        ParentView.prototype.initialize.apply(this, arguments);\n\n        const reviewRequestEditor = this.model.get('reviewRequestEditor');\n\n        this.reviewRequest = reviewRequestEditor.get('reviewRequest');\n        this.reviewRequestEditorView = options.reviewRequestEditorView;\n\n        this._commitListView = null;\n\n        this._$boxStatus = null;\n        this._$fixItLabel = null;\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.ReviewRequestPage.ChangeEntryView:\n     *     This object, for chaining.\n     */\n    render() {\n        ParentView.prototype.render.call(this);\n\n        this._$boxStatus = this.$('.box-status');\n        this._$fixItLabel = $('<label class=\"fix-it-label\">')\n            .hide()\n            .appendTo(this.$('.labels-container'));\n\n        RB.formatText(this.$('.changedesc-text'), {\n            bugTrackerURL: this.reviewRequest.get('bugTrackerURL'),\n            isHTMLEncoded: true,\n        });\n\n        this._updateLabels();\n\n        _.each(this.$('.diff-index tr'), rowEl => {\n            const $row = $(rowEl);\n            const iconView = new RB.DiffComplexityIconView({\n                numInserts: $row.data('insert-count'),\n                numDeletes: $row.data('delete-count'),\n                numReplaces: $row.data('replace-count'),\n                totalLines: $row.data('total-line-count'),\n            });\n\n            $row.find('.diff-file-icon')\n                .empty()\n                .append(iconView.$el);\n\n            iconView.render();\n        });\n\n        _.each(this.$('.file-container'), thumbnailEl => {\n            const $thumbnail = $(thumbnailEl);\n            const $caption = $thumbnail.find('.file-caption .edit');\n            const model = this.reviewRequest.draft.createFileAttachment({\n                id: $thumbnail.data('file-id')\n            });\n\n            if (!$caption.hasClass('empty-caption')) {\n                model.set('caption', $caption.text());\n            }\n\n            this.reviewRequestEditorView.buildFileAttachmentThumbnail(\n                model, null,\n                {\n                    $el: $thumbnail,\n                    canEdit: false,\n                });\n        });\n\n        const commits = this.model.get('commits');\n\n        if (commits) {\n            this._commitListView = new RB.DiffCommitListView({\n                el: this.$('.commit-list-container'),\n                model: new RB.DiffCommitList({\n                    commits: commits,\n                    diffHistory: new RB.CommitHistoryDiffEntryCollection(),\n                }),\n            });\n        }\n\n        return this;\n    },\n\n    /**\n     * Set up a review view.\n     *\n     * This will begin listening for changes to the issue counts and\n     * update the labels on the box.\n     *\n     * Args:\n     *     view (RB.ReviewRequestPage.ReviewView):\n     *         The review view being set up.\n     */\n    setupReviewView(view) {\n        this.listenTo(view, 'openIssuesChanged', this._updateLabels);\n    },\n\n    /**\n     * Update the \"Fix It\" label based on the open issue counts.\n     *\n     * If there are open issues, there will be a \"Fix it!\" label.\n     */\n    _updateLabels() {\n        if (this._reviewViews.some(view => view.hasOpenIssues())) {\n            const openIssueCount = this._reviewViews.reduce(\n                (sum, view) => sum + view.getOpenIssueCount(),\n                0);\n\n            this._$boxStatus.addClass('has-issues');\n            this._$fixItLabel\n                .empty()\n                .append(\n                    $('<span class=\"open-issue-count\">')\n                        .text(interpolate(gettext('%s failed'),\n                                          [openIssueCount]))\n                )\n                .append(document.createTextNode(gettext('Fix it!')))\n                .show()\n                .css({\n                    opacity: 1,\n                    left: 0,\n                });\n        } else {\n            this._$fixItLabel.css({\n                opacity: 0,\n                left: '-100px',\n            });\n            this._$boxStatus.removeClass('has-issues');\n        }\n    }\n});\n\n\n})();\n"],"mappings":"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","ignoreList":[]}