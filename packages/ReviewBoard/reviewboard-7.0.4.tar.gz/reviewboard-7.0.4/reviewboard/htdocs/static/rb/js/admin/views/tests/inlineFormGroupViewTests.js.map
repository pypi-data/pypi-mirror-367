{"version":3,"file":"inlineFormGroupViewTests.js","names":["suite","inlineTemplate","_","template","$el","model","view","buildView","options","$","extend","initialForms","maxNumForms","minNumForms","numInlines","totalForms","appendTo","$testsScratch","RB","Admin","InlineFormGroupView","el","render","beforeEach","InlineFormGroup","prefix","describe","it","expect","find","length","toBe","_$inlineTemplate","hasClass","toBeFalse","get","inlines","_inlineViews","inline","at","toBeTrue","$totalForms","$addButton","val","click","destroy","$inlines","id","is","addInlineForm"],"sources":["../../../../../../../static/rb/js/admin/views/tests/inlineFormGroupViewTests.es6.js"],"sourcesContent":["suite('rb/admin/views/InlineFormGroupView', function() {\n    const inlineTemplate = _.template(dedent`\n        <div class=\"rb-c-admin-form-inline <%- classes || '' %>\">\n         <h3 class=\"rb-c-admin-form-inline__title\">\n          <span class=\"rb-c-admin-form-inline__title-prefix\"></span>\n          <span class=\"rb-c-admin-form-inline__title-object\"></span>\n          <span class=\"rb-c-admin-form-inline__title-index\"></span>\n          <span class=\"rb-c-admin-form-inline__actions\">\n           <span class=\"rb-c-admin-form-inline__delete-action\"></span>\n          </span>\n         </h3>\n         <fieldset>\n          <div>\n           <label for=\"myprefix-<%- index %>-foo\"></label>\n           <input id=\"myprefix-<%- index %>-foo\"\n                  name=\"myprefix-<%- index %>-foo\">\n          </div>\n          <div>\n           <label for=\"myprefix-<%- index %>-bar\"></label>\n           <input id=\"myprefix-<%- index %>-bar\"\n                  name=\"myprefix-<%- index %>-bar\">\n          </div>\n         </fieldset>\n        </div>\n    `);\n\n    const template = _.template(dedent`\n        <div class=\"rb-c-admin-form-inline-group\">\n         <h2 class=\"rb-c-admin-form-inline-group__title\"></h2>\n         <div class=\"rb-c-admin-form-inline-group__inlines\">\n          <input type=\"hidden\"\n                 id=\"id_myprefix-TOTAL_FORMS\"\n                 name=\"myprefix-TOTAL_FORMS\"\n                 value=\"<%- totalForms %>\">\n          <input type=\"hidden\"\n                 id=\"id_myprefix-INITIAL_FORMS\"\n                 name=\"myprefix-INITIAL_FORMS\"\n                 value=\"<%- initialForms %>\">\n          <input type=\"hidden\"\n                 id=\"id_myprefix-MIN_NUM_FORMS\"\n                 name=\"myprefix-MIN_NUM_FORMS\"\n                 value=\"<%- minNumForms %>\">\n          <input type=\"hidden\"\n                 id=\"id_myprefix-MAX_NUM_FORMS\"\n                 name=\"myprefix-MAX_NUM_FORMS\"\n                 value=\"<%- maxNumForms %>\">\n\n          <% for (let i = 0; i < numInlines; i++) { %>\n           <%= inlineTemplate({\n               classes: '',\n               index: i\n           }) %>\n          <% } %>\n          <%= inlineTemplate({\n              classes: '-is-template',\n              index: '__prefix__'\n          }) %>\n         </div>\n         <div class=\"rb-c-admin-form-inline-group__actions\">\n          <a href=\"#\" class=\"rb-c-admin-form-inline-group__add-action\"></a>\n         </div>\n        </div>\n    `);\n\n    let $el;\n    let model;\n    let view;\n\n    function buildView(options) {\n        $el =\n            $(template(_.extend({\n                initialForms: 0,\n                inlineTemplate: inlineTemplate,\n                maxNumForms: '',\n                minNumForms: 0,\n                numInlines: 0,\n                totalForms: 0,\n            }, options)))\n            .appendTo($testsScratch);\n\n        view = new RB.Admin.InlineFormGroupView({\n            el: $el,\n            model: model,\n        });\n        view.render();\n    }\n\n    beforeEach(function() {\n        model = new RB.Admin.InlineFormGroup({\n            prefix: 'myprefix',\n        });\n    });\n\n    describe('State', function() {\n        it('Populated on render', function() {\n            buildView({\n                numInlines: 2,\n                initialForms: 2,\n                minNumForms: 1,\n                maxNumForms: 5,\n                totalForms: 2,\n            });\n\n            expect($el.find('.rb-c-admin-form-inline').length).toBe(2);\n            expect(view._$inlineTemplate.length).toBe(1);\n            expect(view._$inlineTemplate.hasClass('-is-template')).toBeFalse();\n\n            expect(model.get('initialInlines')).toBe(2);\n            expect(model.get('maxInlines')).toBe(5);\n            expect(model.get('minInlines')).toBe(1);\n\n            expect(model.inlines.length).toBe(2);\n            expect(view._inlineViews.length).toBe(2);\n\n            let inline = model.inlines.at(0);\n            expect(inline.get('index')).toBe(0);\n            expect(inline.get('isInitial')).toBeTrue();\n            expect(view._inlineViews[0].model).toBe(inline);\n\n            inline = model.inlines.at(1);\n            expect(inline.get('index')).toBe(1);\n            expect(inline.get('isInitial')).toBeTrue();\n            expect(view._inlineViews[1].model).toBe(inline);\n        });\n\n        it('Updated when inlines added', function() {\n            buildView({\n                numInlines: 1,\n                initialForms: 1,\n                totalForms: 1,\n            });\n\n            const $totalForms = $el.find('#id_myprefix-TOTAL_FORMS');\n            const $addButton =\n                $el.find('.rb-c-admin-form-inline-group__add-action');\n\n            expect($el.find('.rb-c-admin-form-inline').length).toBe(1);\n            expect($totalForms.val()).toBe('1');\n\n            $addButton.click();\n            expect($el.find('.rb-c-admin-form-inline').length).toBe(2);\n            expect($totalForms.val()).toBe('2');\n\n            $addButton.click();\n            expect($el.find('.rb-c-admin-form-inline').length).toBe(3);\n            expect($totalForms.val()).toBe('3');\n        });\n\n        it('Updated when inlines added', function() {\n            buildView({\n                numInlines: 2,\n                initialForms: 2,\n                totalForms: 2,\n            });\n\n            const $totalForms = $el.find('#id_myprefix-TOTAL_FORMS');\n\n            expect(model.inlines.length).toBe(2);\n            expect($totalForms.val()).toBe('2');\n\n            model.inlines.at(0).destroy();\n\n            const $inlines = $el.find('.rb-c-admin-form-inline');\n            expect($inlines.length).toBe(1);\n            expect(model.inlines.length).toBe(1);\n            expect($totalForms.val()).toBe('1');\n            expect($inlines[0].id).toBe('myprefix-0');\n        });\n    });\n\n    describe('UI', function() {\n        describe('Add Button', function() {\n            let $addButton;\n\n            beforeEach(function() {\n                buildView({\n                    numInlines: 1,\n                    initialForms: 1,\n                    minNumForms: 0,\n                    maxNumForms: 3,\n                    totalForms: 1,\n                });\n\n                $addButton =\n                    $el.find('.rb-c-admin-form-inline-group__add-action');\n                expect($addButton.length).toBe(1);\n            });\n\n            it('When under limit', function() {\n                expect($addButton.is(':visible')).toBeTrue();\n\n                view.addInlineForm();\n                expect($addButton.is(':visible')).toBeTrue();\n            });\n\n            it('When limit hit', function() {\n                expect($addButton.is(':visible')).toBeTrue();\n\n                view.addInlineForm();\n                view.addInlineForm();\n                expect($addButton.is(':visible')).toBeFalse();\n            });\n        });\n    });\n});\n"],"mappings":"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","ignoreList":[]}