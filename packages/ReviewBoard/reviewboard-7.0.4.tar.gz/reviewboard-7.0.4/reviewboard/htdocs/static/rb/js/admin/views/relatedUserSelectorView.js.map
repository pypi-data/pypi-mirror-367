{"version":3,"file":"relatedUserSelectorView.js","names":["RB","RelatedUserSelectorView","Djblets","RelatedObjectSelectorView","extend","searchPlaceholderText","gettext","optionTagName","optionTemplate","_","template","selectedOptionTemplate","autoAddClose","initialize","options","prototype","call","defaults","selectizeOptions","searchField","sortField","field","valueField","_localSitePrefix","localSitePrefix","_useAvatars","useAvatars","renderOption","item","$","renderSelectedOption","$item","removeText","find","on","_onItemRemoved","loadOptions","query","callback","params","fullname","length","q","ajax","type","url","SITE_ROOT","data","success","results","users","map","u","avatarHTML","avatar_html","id","username","error","args","console"],"sources":["../../../../../../static/rb/js/admin/views/relatedUserSelectorView.es6.js"],"sourcesContent":["/**\n * A widget to select related users using search and autocomplete.\n */\nRB.RelatedUserSelectorView = Djblets.RelatedObjectSelectorView.extend({\n    searchPlaceholderText: gettext('Search for users...'),\n\n    optionTagName: 'tr',\n\n    optionTemplate: _.template(dedent`\n        <div>\n         <% if (useAvatars && avatarHTML) { %><%= avatarHTML %><% } %>\n         <% if (fullname) { %>\n          <span class=\"title\"><%- fullname %></span>\n          <span class=\"description\">(<%- username %>)</span>\n         <% } else { %>\n          <span class=\"title\"><%- username %></span>\n         <% } %>\n        </div>\n    `),\n\n    selectedOptionTemplate: _.template(dedent`\n        <% if (useAvatars) { %>\n         <td><%= avatarHTML %></td>\n        <% } %>\n        <% if (fullname) { %>\n         <td><%- fullname %></td>\n         <td>(<%- username %>)</td>\n        <% } else { %>\n         <td><%- username %></td>\n         <td></td>\n        <% } %>\n        <td>\n         <a href=\"#\" role=\"button\"\n            class=\"remove-item ink-i-delete-item\"\n            aria-label=\"<%- removeText %>\"\n            title=\"<%- removeText %>\"\n            ></a>\n        </td>\n    `),\n\n    template: _.template(dedent`\n        <select placeholder=\"\"\n                class=\"related-object-options\"></select>\n        <% if (multivalued) { %>\n        <table class=\"related-object-selected\"></table>\n        <% } %>\n    `),\n\n    autoAddClose: false,\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the view.\n     *\n     * Option Args:\n     *     localSitePrefix (string):\n     *         The URL prefix for the local site, if any.\n     *\n     *     multivalued (boolean):\n     *         Whether or not the widget should allow selecting multuple\n     *         values.\n     *\n     *     useAvatars (boolean):\n     *         Whether to show avatars. Off by default.\n     */\n    initialize(options) {\n        Djblets.RelatedObjectSelectorView.prototype.initialize.call(\n            this,\n            _.defaults({\n                selectizeOptions: {\n                    searchField: ['fullname', 'username'],\n                    sortField: [\n                        {field: 'fullname'},\n                        {field: 'username'},\n                    ],\n                    valueField: 'username',\n                },\n            }, options));\n\n        this._localSitePrefix = options.localSitePrefix || '';\n        this._useAvatars = !!options.useAvatars;\n    },\n\n    /**\n     * Render an option in the drop-down menu.\n     *\n     * Args:\n     *     item (object):\n     *         The item to render.\n     *\n     * Returns:\n     *     string:\n     *     HTML to insert into the drop-down menu.\n     */\n    renderOption(item) {\n        return $(this.optionTemplate(_.extend(\n            { useAvatars: this._useAvatars },\n            item)));\n    },\n\n    /**\n     * Render an option in the selected list.\n     *\n     * Args:\n     *     item (object):\n     *         The item to render.\n     *\n     * Returns:\n     *     string:\n     *     HTML to insert into the selected items list.\n     */\n    renderSelectedOption(item) {\n        const $item = $(this.selectedOptionTemplate(_.extend(\n            {\n                removeText: _`Remove user`,\n                useAvatars: this._useAvatars,\n            },\n            item\n        )));\n\n        $item.find('.remove-item')\n            .on('click', () => this._onItemRemoved($item, item));\n\n        return $item;\n    },\n\n    /**\n     * Load options from the server.\n     *\n     * Args:\n     *     query (string):\n     *         The string typed in by the user.\n     *\n     *     callback (function):\n     *         A callback to be called once data has been loaded. This should\n     *         be passed an array of objects, each representing an option in\n     *         the drop-down.\n     */\n    loadOptions(query, callback) {\n        const params = {\n            fullname: 1,\n            'only-fields': 'avatar_html,fullname,id,username',\n            'only-links': '',\n            'render-avatars-at': '20',\n        };\n\n        if (query.length !== 0) {\n            params.q = query;\n        }\n\n        $.ajax({\n            type: 'GET',\n            url: `${SITE_ROOT}${this._localSitePrefix}api/users/`,\n            data: params,\n            success(results) {\n                callback(results.users.map(u => ({\n                    avatarHTML: u.avatar_html[20],\n                    fullname: u.fullname,\n                    id: u.id,\n                    username: u.username,\n                })));\n            },\n            error(...args) {\n                console.error('User query failed', args);\n                callback();\n            },\n        });\n    },\n});\n"],"mappings":"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","ignoreList":[]}