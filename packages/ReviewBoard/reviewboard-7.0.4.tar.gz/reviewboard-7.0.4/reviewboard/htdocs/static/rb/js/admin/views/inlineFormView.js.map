{"version":3,"file":"inlineFormView.js","names":["RB","Admin","InlineFormView","Backbone","View","extend","events","initialize","_$removeButton","_$title","render","$","listenTo","model","_onIndexChanged","index","get","prefix","idRegex","RegExp","newPrefix","_updateElements","el","id","replace","name","htmlFor","node","firstChild","nextSibling","text","_onDeleteClicked","e","preventDefault","stopPropagation","confirm","gettext","destroy"],"sources":["../../../../../../static/rb/js/admin/views/inlineFormView.es6.js"],"sourcesContent":["/**\n * A view managing inline forms, for related objects for models.\n *\n * This allows for providing form data for a database object that relates to\n * some primary object, or deleting the object. It's managed by\n * :js:class:`RB.Admin.InlineFormGroupView`.\n */\nRB.Admin.InlineFormView = Backbone.View.extend({\n    events: {\n        'click .rb-c-admin-form-inline__delete-action': '_onDeleteClicked',\n    },\n\n    /**\n     * Initialize the view.\n     */\n    initialize() {\n        this._$removeButton = null;\n        this._$title = null;\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.Admin.InlineFormView:\n     *     This view, for chaining.\n     */\n    render() {\n        this._$removeButton = this.$('.rb-c-admin-form-inline__delete-action');\n        this._$title = this.$('.rb-c-admin-form-inline__title-index');\n\n        this.listenTo(this.model, 'change:index', this._onIndexChanged);\n\n        return this;\n    },\n\n    /**\n     * Handle a change to the inline's index in the group.\n     *\n     * This will update the ID and title for this view, and the IDs, names,\n     * and references across all elements in the form.\n     */\n    _onIndexChanged() {\n        const index = this.model.get('index');\n        const prefix = this.model.get('prefix');\n        const idRegex = new RegExp(`(${prefix}-(\\\\d+|__prefix__))`);\n        const newPrefix = `${prefix}-${index}`;\n\n        function _updateElements(el) {\n            if (el.id) {\n                el.id = el.id.replace(idRegex, newPrefix);\n            }\n\n            if (el.name) {\n                el.name = el.name.replace(idRegex, newPrefix);\n            }\n\n            if (el.htmlFor) {\n                el.htmlFor = el.htmlFor.replace(idRegex, newPrefix);\n            }\n\n            for (let node = el.firstChild;\n                 node !== null;\n                 node = node.nextSibling) {\n                _updateElements(node);\n            }\n        }\n\n        this.el.id = newPrefix;\n        this._$title.text(`#${index + 1}`);\n\n        _updateElements(this.el);\n    },\n\n    /**\n     * Handle a click event on the Delete button for the inline.\n     *\n     * This will trigger the ``deleteClicked`` event, allowing the parent\n     * :js:class:`RB.Admin.InlineFormGroupView` to handle it.\n     *\n     * Args:\n     *     e (jQuery.Event):\n     *         The click event.\n     */\n    _onDeleteClicked(e) {\n        if (this.model.get('isInitial')) {\n            return;\n        }\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (confirm(gettext('Are you sure you want to delete this? This cannot be undone.'))) {\n            this.model.destroy();\n        }\n    },\n});\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,EAAE,CAACC,KAAK,CAACC,cAAc,GAAGC,QAAQ,CAACC,IAAI,CAACC,MAAM,CAAC;EAC3CC,MAAM,EAAE;IACJ,8CAA8C,EAAE;EACpD,CAAC;EAED;AACJ;AACA;EACIC,UAAUA,CAAA,EAAG;IACT,IAAI,CAACC,cAAc,GAAG,IAAI;IAC1B,IAAI,CAACC,OAAO,GAAG,IAAI;EACvB,CAAC;EAED;AACJ;AACA;AACA;AACA;AACA;AACA;EACIC,MAAMA,CAAA,EAAG;IACL,IAAI,CAACF,cAAc,GAAG,IAAI,CAACG,CAAC,CAAC,wCAAwC,CAAC;IACtE,IAAI,CAACF,OAAO,GAAG,IAAI,CAACE,CAAC,CAAC,sCAAsC,CAAC;IAE7D,IAAI,CAACC,QAAQ,CAAC,IAAI,CAACC,KAAK,EAAE,cAAc,EAAE,IAAI,CAACC,eAAe,CAAC;IAE/D,OAAO,IAAI;EACf,CAAC;EAED;AACJ;AACA;AACA;AACA;AACA;EACIA,eAAeA,CAAA,EAAG;IACd,MAAMC,KAAK,GAAG,IAAI,CAACF,KAAK,CAACG,GAAG,CAAC,OAAO,CAAC;IACrC,MAAMC,MAAM,GAAG,IAAI,CAACJ,KAAK,CAACG,GAAG,CAAC,QAAQ,CAAC;IACvC,MAAME,OAAO,GAAG,IAAIC,MAAM,CAAC,IAAIF,MAAM,qBAAqB,CAAC;IAC3D,MAAMG,SAAS,GAAG,GAAGH,MAAM,IAAIF,KAAK,EAAE;IAEtC,SAASM,eAAeA,CAACC,EAAE,EAAE;MACzB,IAAIA,EAAE,CAACC,EAAE,EAAE;QACPD,EAAE,CAACC,EAAE,GAAGD,EAAE,CAACC,EAAE,CAACC,OAAO,CAACN,OAAO,EAAEE,SAAS,CAAC;MAC7C;MAEA,IAAIE,EAAE,CAACG,IAAI,EAAE;QACTH,EAAE,CAACG,IAAI,GAAGH,EAAE,CAACG,IAAI,CAACD,OAAO,CAACN,OAAO,EAAEE,SAAS,CAAC;MACjD;MAEA,IAAIE,EAAE,CAACI,OAAO,EAAE;QACZJ,EAAE,CAACI,OAAO,GAAGJ,EAAE,CAACI,OAAO,CAACF,OAAO,CAACN,OAAO,EAAEE,SAAS,CAAC;MACvD;MAEA,KAAK,IAAIO,IAAI,GAAGL,EAAE,CAACM,UAAU,EACxBD,IAAI,KAAK,IAAI,EACbA,IAAI,GAAGA,IAAI,CAACE,WAAW,EAAE;QAC1BR,eAAe,CAACM,IAAI,CAAC;MACzB;IACJ;IAEA,IAAI,CAACL,EAAE,CAACC,EAAE,GAAGH,SAAS;IACtB,IAAI,CAACX,OAAO,CAACqB,IAAI,CAAC,IAAIf,KAAK,GAAG,CAAC,EAAE,CAAC;IAElCM,eAAe,CAAC,IAAI,CAACC,EAAE,CAAC;EAC5B,CAAC;EAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIS,gBAAgBA,CAACC,CAAC,EAAE;IAChB,IAAI,IAAI,CAACnB,KAAK,CAACG,GAAG,CAAC,WAAW,CAAC,EAAE;MAC7B;IACJ;IAEAgB,CAAC,CAACC,cAAc,CAAC,CAAC;IAClBD,CAAC,CAACE,eAAe,CAAC,CAAC;IAEnB,IAAIC,OAAO,CAAAC,OAAA,gEAAwE,CAAC,EAAE;MAClF,IAAI,CAACvB,KAAK,CAACwB,OAAO,CAAC,CAAC;IACxB;EACJ;AACJ,CAAC,CAAC","ignoreList":[]}