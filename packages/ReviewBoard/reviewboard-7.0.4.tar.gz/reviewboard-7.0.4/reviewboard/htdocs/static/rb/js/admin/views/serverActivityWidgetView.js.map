{"version":3,"file":"serverActivityWidgetView.js","names":["RB","Admin","ServerActivityWidgetView","WidgetView","extend","renderWidget","previousHoverPoint","_$tooltip","$","_$chart","appendTo","$content","bind","ev","pos","item","dataIndex","remove","x","Date","datapoint","toLocaleDateString","y","text","series","label","css","left","pageX","top","pageY","fadeIn","_addClickAction","id","loadKey","_addToggleAction","_","toggleKey","listenTo","model","_update","loadData","options","$action","addFooterAction","html","click","preventDefault","stopPropagation","show","get","set","xaxis","mode","tickLength","min","moment","valueOf","max","yaxis","tickDecimals","grid","markings","axes","d","setUTCDate","getUTCDate","getUTCDay","setUTCSeconds","setUTCMinutes","setUTCHours","i","getTime","push","from","to","hoverable","points","radius","lines","legend","position","datasets","changeDescriptions","data","bars","color","comments","reviewRequests","reviews","length","plot"],"sources":["../../../../../../static/rb/js/admin/views/serverActivityWidgetView.es6.js"],"sourcesContent":["/**\n * Displays a graph of the activity on the server.\n */\nRB.Admin.ServerActivityWidgetView = RB.Admin.WidgetView.extend({\n    /**\n     * Render the widget.\n     */\n    renderWidget() {\n        let previousHoverPoint = null;\n\n        this._$tooltip = $();\n        this._$chart = $('<div class=\"rb-c-admin-server-activity-widget__chart\">')\n            .appendTo(this.$content)\n            .bind('plothover', (ev, pos, item) => {\n                if (item) {\n                    if (previousHoverPoint !== item.dataIndex) {\n                        if (this._$tooltip) {\n                            this._$tooltip.remove();\n                        }\n\n                        const x = new Date(item.datapoint[0]).toLocaleDateString();\n                        const y = item.datapoint[1];\n\n                        previousHoverPoint = item.dataIndex;\n\n                        this._$tooltip = $('<div class=\"rb-c-admin-server-activity-widget-tooltip\">')\n                            .text(`${item.series.label} on ${x}: ${y}`)\n                            .appendTo('body')\n                            .css({\n                                left: `${item.pageX + 5}px`,\n                                top: `${item.pageY + 5}px`,\n                            })\n                            .fadeIn(200);\n                    }\n                } else {\n                    this._$tooltip.remove();\n                    this._$tooltip = $();\n                    previousHoverPoint = null;\n                }\n            });\n\n        this._addClickAction({\n            id: 'prev',\n            text: '<',\n            loadKey: 'prev',\n        });\n\n        this._addClickAction({\n            id: 'next',\n            text: '>',\n            loadKey: 'next',\n        });\n\n        this._addToggleAction({\n            id: 'show-reviews',\n            text: _('Reviews'),\n            toggleKey: 'reviews',\n        });\n\n        this._addToggleAction({\n            id: 'show-comments',\n            text: _('Comments'),\n            toggleKey: 'comments',\n        });\n\n\n        this._addToggleAction({\n            id: 'show-review-requests',\n            text: _('Review Requests'),\n            toggleKey: 'reviewRequests',\n        });\n\n        this._addToggleAction({\n            id: 'show-changes',\n            text: _('Changes'),\n            toggleKey: 'changeDescriptions',\n        });\n\n        this._addToggleAction({\n            id: 'show-legend',\n            text: _('Legend'),\n            toggleKey: 'legend',\n        });\n\n        this.listenTo(this.model, 'updated', this._update);\n\n        this.model.loadData('none');\n    },\n\n\n    /**\n     * Add a click action to the footer.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the action.\n     *\n     * Option Args:\n     *     id (string):\n     *         The ID for the action.\n     *\n     *     text (string):\n     *         The text to display.\n     *\n     *     loadKey (string):\n     *         The key to use when loading new data from the server.\n     */\n    _addClickAction(options) {\n        const $action = this.addFooterAction({\n            id: options.id,\n            html: `<a href=\"#\">${options.text}</a>`,\n        });\n\n        $action.click(ev => {\n            ev.preventDefault();\n            ev.stopPropagation();\n\n            this.model.loadData(options.loadKey);\n        });\n    },\n\n    /**\n     * Add a toggle action to the footer.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the action.\n     *\n     * Option Args:\n     *     id (string):\n     *         The ID for the action.\n     *\n     *     text (string):\n     *         The text to display.\n     *\n     *     toggleKey (string):\n     *         The key to toggle in the ``show`` settings for the model.\n     */\n    _addToggleAction(options) {\n        const $action = this.addFooterAction({\n            id: options.id,\n            html: `<a href=\"#\">${options.text}</a>`,\n        });\n\n        $action.click(ev => {\n            ev.preventDefault();\n            ev.stopPropagation();\n\n            const show = this.model.get('show');\n            show[options.toggleKey] = !show[options.toggleKey];\n            this.model.set('show', show);\n            this.model.loadData('same');\n        });\n    },\n\n    /**\n     * Update the displayed graph.\n     */\n    _update() {\n        const options = {\n            xaxis: {\n                mode: 'time',\n                tickLength: 1,\n                min: moment(this.model.get('rangeStart')).valueOf(),\n                max: moment(this.model.get('rangeEnd')).valueOf(),\n            },\n            yaxis: {\n                min: 0,\n                tickDecimals: 0,\n            },\n            grid: {\n                markings: axes => {\n                    // This will shade weekends.\n                    const markings = [];\n                    const d = new Date(axes.xaxis.min);\n\n                    // Go to the first Saturday.\n                    d.setUTCDate(d.getUTCDate() - ((d.getUTCDay() + 1) % 7));\n                    d.setUTCSeconds(0);\n                    d.setUTCMinutes(0);\n                    d.setUTCHours(0);\n\n                    let i = d.getTime();\n\n                    do {\n                        /*\n                         * When we don't set yaxis, the rectangle automatically\n                         * extends to infinity upwards and downwards.\n                         */\n                        markings.push({\n                            xaxis: {from: i, to: i + 2 * 24 * 60 * 60 * 1000},\n                        });\n                        i += 7 * 24 * 60 * 60 * 1000;\n                    } while (i < axes.xaxis.max);\n\n                    return markings;\n                },\n                hoverable: true,\n            },\n            series: {\n                points: {\n                    show: true,\n                    radius: 3,\n                },\n                lines: {\n                    show: true,\n                },\n            },\n            legend: {\n                position: 'nw',\n                show: this.model.get('show').legend,\n            },\n        };\n\n        const datasets = [];\n\n        if (this.model.get('show').changeDescriptions) {\n            datasets.push({\n                label: _('Change Descriptions'),\n                data: this.model.get('data').changeDescriptions,\n                bars: { show: true, },\n                lines: { show: false, },\n                color: 0,\n            });\n        }\n\n        if (this.model.get('show').comments) {\n            datasets.push({\n                label: _('Comments'),\n                data: this.model.get('data').comments,\n                bars: { show: true, },\n                lines: { show: false, },\n                color: 1,\n            });\n        }\n\n        if (this.model.get('show').reviewRequests) {\n            datasets.push({\n                label: _('Review Requests'),\n                data: this.model.get('data').reviewRequests,\n                bars: { show: true, },\n                lines: { show: false, },\n                color: 2,\n            });\n        }\n\n        if (this.model.get('show').reviews) {\n            datasets.push({\n                label: _('Reviews'),\n                data: this.model.get('data').reviews,\n                bars: { show: true, },\n                lines: { show: false, },\n                color: 3,\n            });\n        }\n\n        if (datasets.length === 0) {\n            datasets.push({\n                bars: { show: true, },\n                lines: { show: false, },\n            });\n        }\n\n        $.plot(this._$chart, datasets, options);\n    },\n});\n"],"mappings":"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","ignoreList":[]}