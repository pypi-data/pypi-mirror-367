{"version":3,"file":"uploadDiffView.js","names":["RB","UploadDiffView","Backbone","View","extend","events","initialize","listenTo","model","_onStateChanged","_onErrorChanged","render","selectDiffText","selectParentDiffText","_canDragDrop","gettext","$el","html","template","pendingChangeHeader","tipHeader","tip","selectDiff","selectParentDiff","baseDir","changeNum","startOver","ok","_$fileInput","$","hide","appendTo","change","handleFiles","get","files","_$diffRevisionError","_$error","_$errorContents","_$processingDiff","_$promptForBasedir","_$promptForChangeNumber","_$promptForDiff","_$promptForParentDiff","_$uploading","el","navigator","userAgent","match","error","errorHTML","innerHeight","height","outerHeight","css","top","Math","floor","state","toggle","State","PROMPT_FOR_DIFF","PROMPT_FOR_PARENT_DIFF","PROMPT_FOR_BASEDIR","PROCESSING_DIFF","PROMPT_FOR_CHANGE_NUMBER","UPLOADING","ERROR","_onDragEnter","event","stopPropagation","preventDefault","addClass","_onDragOver","dt","originalEvent","dataTransfer","dropEffect","_onDragLeave","removeClass","_onDrop","_onBasedirSubmit","basedir","val","set","_onChangenumSubmit","changenum","_onStartOverClicked","$input","clone","replaceWith","_onSelectFileClicked","click"],"sources":["../../../../../static/rb/js/views/uploadDiffView.es6.js"],"sourcesContent":["/**\n * An abstract view for uploading diffs.\n *\n * This is extended by the PreCommitView (for creating new review requests)\n * and UpdateDiffView (for updating the diff on existing review requests).\n */\nRB.UploadDiffView = Backbone.View.extend({\n    events: {\n        'dragenter .dnd': '_onDragEnter',\n        'dragover .dnd': '_onDragOver',\n        'dragleave .dnd': '_onDragLeave',\n        'drop .dnd': '_onDrop',\n        'submit #basedir-form': '_onBasedirSubmit',\n        'submit #changenum-form': '_onChangenumSubmit',\n        'click .startover': '_onStartOverClicked',\n        'click #select-diff-file': '_onSelectFileClicked',\n        'click #select-parent-diff-file': '_onSelectFileClicked',\n    },\n\n    /**\n     * Initialize the view.\n     */\n    initialize() {\n        this.listenTo(this.model, 'change:state', this._onStateChanged);\n        this.listenTo(this.model, 'change:error', this._onErrorChanged);\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.UploadDiffView:\n     *     This object, for chaining.\n     */\n    render() {\n        let selectDiffText;\n        let selectParentDiffText;\n\n        if (this._canDragDrop()) {\n            selectDiffText = _`\n                <button class=\"ink-c-button\" type=\"button\"\n                id=\"select-diff-file\">Select</button>\n                or drag and drop a diff file to begin\n            `;\n            selectParentDiffText = _`\n                <button class=\"ink-c-button\" type=\"button\"\n                id=\"select-parent-diff-file\">Select</button>\n                or drag and drop a parent diff file if you have one\n            `;\n        } else {\n            selectDiffText = _`\n                <button class=\"ink-c-button\" type=\"button\"\n                id=\"select-diff-file\">Select</button>\n                a file to begin\n            `;\n            selectParentDiffText = _`\n                <button class=\"ink-c-button\" type=\"button\"\n                id=\"select-parent-diff-file\">Select</button>\n                a parent diff file if you have one\n            `;\n        }\n\n        this.$el.html(this.template({\n            pendingChangeHeader: gettext('Create from a local change'),\n            tipHeader: gettext('Tip:'),\n            tip: gettext('Use <tt>rbt post</tt> from <a href=\"https://www.reviewboard.org/downloads/rbtools/\">RBTools</a> to more easily create and update review requests.'),\n            selectDiff: selectDiffText,\n            selectParentDiff: selectParentDiffText,\n            baseDir: gettext('What is the base directory for this diff?'),\n            changeNum: gettext('What is the change number for this diff?'),\n            startOver: gettext('Start Over'),\n            ok: gettext('OK'),\n        }));\n\n        this._$fileInput = $('<input type=\"file\">')\n            .hide()\n            .appendTo(this.$el)\n            .change(() => this.model.handleFiles(this._$fileInput.get(0).files));\n        this._$diffRevisionError = this.$('#parent-diff-error-contents');\n        this._$error = this.$('#error-indicator')\n            .hide();\n        this._$errorContents = this.$('#error-contents');\n        this._$processingDiff = this.$('#processing-diff')\n            .hide();\n        this._$promptForBasedir = this.$('#prompt-for-basedir')\n            .hide();\n        this._$promptForChangeNumber = this.$('#prompt-for-change-number')\n            .hide();\n        this._$promptForDiff = this.$('#prompt-for-diff')\n            .hide();\n        this._$promptForParentDiff = this.$('#prompt-for-parent-diff')\n            .hide();\n        this._$uploading = this.$('#uploading-diffs')\n            .hide();\n\n        this._onStateChanged(this.model, this.model.get('state'));\n\n        return this;\n    },\n\n    /**\n     * Return whether drag-and-drop is supported on this browser.\n     *\n     * We check if the DOM has the appropriate support for file drag-and-drop,\n     * which will give us the right answer on most browsers. We also need to\n     * check iOS specifically, as Safari lies about the support.\n     *\n     * Returns:\n     *     boolean:\n     *     Whether the user's browser supports drag-and-drop of files.\n     */\n    _canDragDrop() {\n        return ('draggable' in this.el ||\n                ('ondragstart' in this.el && 'ondrop' in this.el)) &&\n               !navigator.userAgent.match('iPhone OS') &&\n               !navigator.userAgent.match('iPad');\n    },\n\n    /**\n     * Callback for when the model's error attribute changes.\n     *\n     * Updates the text and position of error indicators in the various pages.\n     *\n     * Args:\n     *     model (RB.UploadDiffModel):\n     *         The model which handles uploading the diff.\n     *\n     *     error (string):\n     *         The text of the error.\n     */\n    _onErrorChanged(model, error) {\n        const errorHTML = `<div class=\"rb-icon rb-icon-warning\"></div> ${error}`;\n\n        this._$errorContents.html(errorHTML);\n        this._$diffRevisionError.html(errorHTML);\n\n        const innerHeight = this._$errorContents.height();\n        const outerHeight = this._$error.height();\n\n        this._$errorContents.css({\n            top: Math.floor((outerHeight - innerHeight) / 2) + 'px',\n        });\n    },\n\n    /**\n     * Callback for when the model's state attribute changes.\n     *\n     * Sets the corresponding element visible and all others invisible.\n     *\n     * Args:\n     *     model (RB.UploadDiffModel):\n     *         The model which handles uploading the diff.\n     *\n     *     state (number):\n     *         The current state of the upload process.\n     */\n    _onStateChanged(model, state) {\n        this._$promptForDiff.toggle(\n            state === this.model.State.PROMPT_FOR_DIFF);\n        this._$promptForParentDiff.toggle(\n            state === this.model.State.PROMPT_FOR_PARENT_DIFF);\n        this._$promptForBasedir.toggle(\n            state === this.model.State.PROMPT_FOR_BASEDIR);\n        this._$processingDiff.toggle(\n            state === this.model.State.PROCESSING_DIFF);\n        this._$promptForChangeNumber.toggle(\n            state === this.model.State.PROMPT_FOR_CHANGE_NUMBER);\n        this._$uploading.toggle(state === this.model.State.UPLOADING);\n        this._$error.toggle(state === this.model.State.ERROR);\n    },\n\n    /**\n     * Event handler for a dragenter event.\n     *\n     * Args:\n     *     event (Event):\n     *         The dragenter event.\n     */\n    _onDragEnter(event) {\n        event.stopPropagation();\n        event.preventDefault();\n\n        this.$('.dnd').addClass('drag-hover');\n    },\n\n    /**\n     * Event handler for a dragover event.\n     *\n     * Args:\n     *     event (Event):\n     *         The dragover event.\n     */\n    _onDragOver(event) {\n        event.stopPropagation();\n        event.preventDefault();\n\n        const dt = event.originalEvent.dataTransfer;\n\n        if (dt) {\n            dt.dropEffect = 'copy';\n        }\n    },\n\n    /**\n     * Event handler for a dragleave event.\n     *\n     * Args:\n     *     event (Event):\n     *         The dragleave event.\n     */\n    _onDragLeave(event) {\n        event.stopPropagation();\n        event.preventDefault();\n\n        this.$('.dnd').removeClass('drag-hover');\n\n        const dt = event.originalEvent.dataTransfer;\n\n        if (dt) {\n            dt.dropEffect = \"none\";\n        }\n    },\n\n    /**\n     * Event handler for a drop event.\n     *\n     * Args:\n     *     event (Event):\n     *         The drop event.\n     */\n    _onDrop(event) {\n        event.stopPropagation();\n        event.preventDefault();\n\n        const  dt = event.originalEvent.dataTransfer;\n        const files = dt && dt.files;\n\n        if (files) {\n            this.model.handleFiles(files);\n        }\n    },\n\n    /**\n     * Handle when the user inputs a base directory.\n     *\n     * Args:\n     *     event (Event):\n     *         The form submit event.\n     */\n    _onBasedirSubmit(event) {\n        event.stopPropagation();\n        event.preventDefault();\n\n        const basedir = this.$('#basedir-input').val();\n\n        if (basedir) {\n            this.model.set('basedir', basedir);\n        }\n    },\n\n    /**\n     * Handle when the user inputs a change number.\n     */\n    _onChangenumSubmit() {\n        const changenum = this.$('#changenum-input').val();\n\n        if (changenum) {\n            this.model.set('changeNumber', changenum);\n        }\n    },\n\n    /**\n     * Callback when \"start over\" is clicked.\n     */\n    _onStartOverClicked() {\n        const $input = this._$fileInput.clone(true);\n\n        this._$fileInput.replaceWith($input);\n        this._$fileInput = $input;\n\n        this.model.startOver();\n    },\n\n    /**\n     * Callback when \"Select [diff file]\" is clicked.\n     */\n    _onSelectFileClicked() {\n        this._$fileInput.click();\n    },\n});\n"],"mappings":"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","ignoreList":[]}