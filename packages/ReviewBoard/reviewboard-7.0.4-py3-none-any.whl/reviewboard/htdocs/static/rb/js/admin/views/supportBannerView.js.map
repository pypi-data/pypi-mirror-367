{"version":3,"file":"supportBannerView.js","names":["RB","SupportBannerView","Backbone","View","extend","_loadingHTML","_","template","titleText","gettext","_errorHTML","bodyText","fileText","initialize","options","now","Date","console","assert","instance","bindAll","window","addEventListener","_onError","_script","$","attr","supportURL","param","supportData","callback","valueOf","get","document","body","appendChild","e","target","render","html","className","removeEventListener","$el","empty","receive","supportLevel"],"sources":["../../../../../../static/rb/js/admin/views/supportBannerView.es6.js"],"sourcesContent":["/**\n * Show the current support status for the Review Board install.\n */\nRB.SupportBannerView = Backbone.View.extend({\n    _loadingHTML: _.template(dedent`\n        <h2><%- titleText %></h2>\n        <p><span class=\"djblets-o-spinner\"></span></p>\n    `)({\n        titleText: gettext('Retrieving support information...'),\n    }),\n\n    _errorHTML: _.template(dedent`\n        <h2><%- titleText %></h2>\n        <p><%- bodyText %></p>\n        <p><%= fileText %></p>\n    `)({\n        titleText: gettext('Failed to retrieve support information'),\n        bodyText: gettext('We could not communicate with the Beanbag, Inc. server to retrieve your support information. You may be behind a firewall or have no Internet access.'),\n        fileText: gettext('You may file an issue on our <a href=\"https://reviewboard.googlegroups.com\">community support tracker.</a>'),\n    }),\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options passed to the view.\n     *\n     * Option Args:\n     *     supportData (string):\n     *         An encoded payload containing information used to look up\n     *         information on an active support contract for the server.\n     */\n    initialize(options) {\n        const now = new Date();\n\n        console.assert(RB.SupportBannerView.instance === null);\n        RB.SupportBannerView.instance = this;\n\n        _.bindAll(this, '_onError');\n\n        window.addEventListener('error', this._onError, true);\n\n        this._script = $('<script>')\n            .attr('src', RB.SupportBannerView.supportURL + '?' + $.param({\n                'support-data': options.supportData,\n                callback: 'RB.SupportBannerView.instance.receive',\n                _: now.valueOf(),  // Cache bust.\n            }))\n            .get(0);\n\n        /*\n         * If we use jQuery's appendTo, we end up with two <script> tags being\n         * added to the document.\n         */\n        document.body.appendChild(this._script);\n\n    },\n\n    /**\n     * Handle a DOM error.\n     *\n     * If the specified error targets the script tag (e.g., if it could not\n     * be loaded), then an error will be displayed in the banner\n     *\n     * Args:\n     *     e (Event):\n     *         The event that triggered this function.\n     */\n    _onError(e) {\n        if (e.target === this._script) {\n            this.render({\n                html: this._errorHTML,\n                className: 'error',\n            });\n\n            window.removeEventListener('error', this._onError, true);\n        }\n    },\n\n    /**\n     * Render the view\n     *\n     * Args:\n     *     options (object):\n     *         The rendering options.\n     *\n     * Option Args:\n     *     html (string)\n     *         The html to render in the banner.\n     *\n     *     className (string):\n     *         The name of the class to add to the banner.\n     */\n    render(options) {\n        options = _.extend({\n            className: 'loading',\n            html: this._loadingHTML,\n        }, options);\n\n        this.$el\n            .empty()\n            .html(options.html)\n            .attr('class', options.className);\n\n        return this;\n    },\n\n    /**\n     * Receive the data from the server.\n     *\n     * This is invoked via a JSONP callback.\n     *\n     * Args:\n     *     options (object):\n     *         The options received from the server.\n     *\n     * Option Args:\n     *     supportLevel (string):\n     *         The level of support the server has.\n     *\n     *     html (string):\n     *         The HTML to render in the banner.\n     */\n    receive(options) {\n        window.removeEventListener('error', this._onError, true);\n\n        this.render({\n            className: options.supportLevel + '-support',\n            html: options.html,\n        });\n    },\n}, {\n    instance: null,\n    supportURL: 'https://www.beanbaginc.com/support/reviewboard/_status/',\n});\n"],"mappings":"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","ignoreList":[]}