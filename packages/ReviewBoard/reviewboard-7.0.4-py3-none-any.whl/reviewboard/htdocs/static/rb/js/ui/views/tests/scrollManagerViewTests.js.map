{"version":3,"file":"scrollManagerViewTests.js","names":["suite","makeElement","dimensions","scratchOffset","$testsScratch","offset","$","css","position","left","top","width","height","appendTo","scrollManager","beforeEach","RB","ScrollManagerView","window","pageXOffset","pageYOffset","scrollTo","x","y","requestAnimationFrame","cb","describe","it","scrollToPosition","expect","Math","round","toBe","scrollYOffset","$el","scrollToElement","_oldScrollY","markForUpdate","pendingElement","_pendingElements","get","oldHeight","toEqual","oldOffset","spyOn","parseInt","markUpdated","el","undefined","element","_elements","newHeight","newOffset","toHaveBeenCalled","$el1","$el2","$el3","_updateScrollPos"],"sources":["../../../../../../../static/rb/js/ui/views/tests/scrollManagerViewTests.es6.js"],"sourcesContent":["suite('rb/ui/views/ScrollManagerView', function() {\n    function makeElement(dimensions={}) {\n        const scratchOffset = $testsScratch.offset();\n\n        return $('<div>')\n            .css({\n                position: 'absolute',\n                left: -scratchOffset.left + (dimensions.left || 0),\n                top: -scratchOffset.top + (dimensions.top || 0),\n                width: dimensions.width || 20,\n                height: dimensions.height || 20,\n            })\n            .appendTo($testsScratch);\n    }\n\n    let scrollManager;\n\n    beforeEach(function() {\n        scrollManager = new RB.ScrollManagerView();\n        scrollManager.window = {\n            pageXOffset: 0,\n            pageYOffset: 0,\n\n            scrollTo(x, y) {\n                this.pageXOffset = x;\n                this.pageYOffset = y;\n            },\n\n            requestAnimationFrame(cb) {\n                cb();\n            },\n        };\n    });\n\n    describe('scrollToPosition', function() {\n        it('Without scroll offset', function() {\n            scrollManager.scrollToPosition(100);\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(100);\n        });\n\n        it('With scroll offset', function() {\n            scrollManager.scrollYOffset = 40;\n            scrollManager.scrollToPosition(100);\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(60);\n        });\n    });\n\n    describe('scrollToElement', function() {\n        let $el;\n\n        beforeEach(function() {\n            $el = makeElement({top: 50});\n        });\n\n        it('Without scroll offset', function() {\n            scrollManager.scrollToElement($el);\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(50);\n        });\n\n        it('With scroll offset', function() {\n            scrollManager.scrollYOffset = 40;\n            scrollManager.scrollToElement($el);\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(10);\n        });\n    });\n\n    describe('markUpdated', function() {\n        let $el;\n\n        beforeEach(function() {\n            $el = makeElement({top: 50});\n        });\n\n        it('First in a batch', function() {\n            scrollManager.window.pageYOffset = 100;\n\n            expect(scrollManager._oldScrollY).toBe(null);\n\n            scrollManager.markForUpdate($el);\n\n            const pendingElement = scrollManager._pendingElements.get($el[0]);\n            expect(Math.round(pendingElement.oldHeight)).toEqual(20);\n            expect(Math.round(pendingElement.oldOffset.top)).toEqual(50);\n            expect(Math.round(pendingElement.oldOffset.left)).toEqual(0);\n            expect(scrollManager._oldScrollY).toBe(100);\n        });\n\n        it('Subsequent entries', function() {\n            scrollManager._oldScrollY = 100;\n            scrollManager.window.pageYOffset = 200;\n\n            scrollManager.markForUpdate($el);\n\n            const pendingElement = scrollManager._pendingElements.get($el[0]);\n            expect(Math.round(pendingElement.oldHeight)).toEqual(20);\n            expect(Math.round(pendingElement.oldOffset.top)).toEqual(50);\n            expect(Math.round(pendingElement.oldOffset.left)).toEqual(0);\n            expect(scrollManager._oldScrollY).toBe(100);\n        });\n    });\n\n    describe('markUpdated', function() {\n        let $el;\n\n        beforeEach(function() {\n            $el = makeElement({top: 50});\n        });\n\n        it('Stores correct state', function() {\n            /* Disable the actual updates for this test. */\n            spyOn(scrollManager.window, 'requestAnimationFrame');\n\n            scrollManager.markForUpdate($el);\n            $el.height(40);\n            $el.css('top', parseInt($el.css('top'), 10) - 10);\n            scrollManager.markUpdated($el);\n\n            const el = $el[0];\n\n            expect(scrollManager._pendingElements.get(el)).toBe(undefined);\n\n            const element = scrollManager._elements.get(el);\n            expect(Math.round(element.oldHeight)).toEqual(20);\n            expect(Math.round(element.oldOffset.top)).toEqual(50);\n            expect(Math.round(element.oldOffset.left)).toEqual(0);\n            expect(Math.round(element.newHeight)).toEqual(40);\n            expect(Math.round(element.newOffset.top)).toEqual(40);\n            expect(Math.round(element.newOffset.left)).toEqual(0);\n\n            expect(scrollManager.window.requestAnimationFrame)\n                .toHaveBeenCalled();\n        });\n    });\n\n    describe('Scroll updates', function() {\n        beforeEach(function() {\n            spyOn(scrollManager.window, 'requestAnimationFrame');\n\n            scrollManager.window.pageYOffset = 200;\n        });\n\n        it('Includes updates before scroll position', function() {\n            const $el1 = makeElement({top: 10});\n            const $el2 = makeElement({top: 60});\n            const $el3 = makeElement({top: 70});\n\n            /* Grow by 50px. */\n            scrollManager.markForUpdate($el1);\n            $el1.height(70);\n            scrollManager.markUpdated($el1);\n\n            /* Shrink by 10px. */\n            scrollManager.markForUpdate($el2);\n            $el2.height(10);\n            scrollManager.markUpdated($el2);\n\n            /* Move up 5px. */\n            scrollManager.markForUpdate($el3);\n            $el3.css('top', parseInt($el3.css('top'), 10) - 5);\n            scrollManager.markUpdated($el3);\n\n            scrollManager._updateScrollPos();\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(235);\n        });\n\n        it('Ignores updates after scroll position', function() {\n            const $el1 = makeElement({top: 10});\n            const $el2 = makeElement({top: scrollManager.window.pageYOffset});\n            const $el3 = makeElement({top: 500});\n\n            scrollManager.markForUpdate($el1);\n            $el1.height(30);\n            scrollManager.markUpdated($el1);\n\n            scrollManager.markForUpdate($el2);\n            $el2.height(90);\n            scrollManager.markUpdated($el2);\n\n            scrollManager.markForUpdate($el3);\n            $el3.height(1000);\n            scrollManager.markUpdated($el3);\n\n            scrollManager._updateScrollPos();\n\n            expect(scrollManager.window.pageYOffset).toBe(210);\n        });\n    });\n});\n"],"mappings":"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","ignoreList":[]}