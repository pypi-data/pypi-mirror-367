!function(){var t,e;t=this,e=function(t,r,e,l){"use strict";let s=e.spina(k=class extends e.BaseModel{static defaults(){return{$target:$(window),callback:_.noop,dropText:gettext("Drop to upload")}}})||k,n=e.spina(k=class extends e.BaseView{static className="dnd-overlay";static events={dragenter:"_onDragEnter",dragleave:"_onDragLeave",dragover:"_onDragOver",drop:"_onDrop"};onInitialRender(){this.$el.text(this.model.get("dropText"))}show(){const s=this.model.get("$target");return s.addClass("dnd-overlay-visible"),_.defer(()=>{var t=s.offset(),e=s.outerWidth()+"px",i=s.outerHeight()+"px";this.$el.css({height:i,left:t.left+"px","line-height":i,top:t.top+"px",width:e}).show()}),this}hide(){return this.model.get("$target").removeClass("dnd-overlay-visible"),this.$el.hide(),this}close(){this.$el.fadeOut(()=>{this.trigger("closed"),this.remove()})}_onDrop(t){t.stopPropagation(),t.preventDefault();t=t.originalEvent.dataTransfer,t=t&&t.files;if(t){var e=this.model.get("callback");for(const i of Array.from(t))e(i)}this.trigger("closing")}_onDragEnter(t){t.preventDefault();t=t.originalEvent.dataTransfer;t&&(t.dropEffect="copy",this.$el.addClass("dnd-overlay-highlight"))}_onDragOver(t){t.preventDefault()}_onDragLeave(t){t.preventDefault();t=t.originalEvent.dataTransfer;t&&(t.dropEffect="none",this.$el.removeClass("dnd-overlay-highlight"))}})||k,i=e.spina({prototypeAttrs:["instance"]})(k=class extends e.BaseView{static instance=null;static create(){return console.assert(null===this.instance,"DnDUploader.create may only be called once"),this.instance=new this,this.instance}#dropTargets;#dropOverlays=[];#hideOverlayTimeout=null;#overlaysVisible=!1;#overlaysHiding=!1;initialize(){this.#dropTargets=new e.Collection,_.bindAll(this,"_showOverlays","_hideOverlays"),$(window).on("dragstart dragenter dragover",this._showOverlays).on("dragend dragleave",this._hideOverlays)}registerDropTarget(t,e,i){void 0===this.#dropTargets.findWhere({$target:t})?(i=new s({$target:t,callback:i,dropText:e}),this.#dropTargets.add(i),(e=new n({model:i})).render().$el.hide().appendTo(document.body),this.listenTo(e,"closing",this._hideOverlays),this.#dropOverlays.push(e)):console.error("Drop target was already registered!",t)}unregisterDropTarget(t){const e=this.#dropTargets.findWhere({$target:t});t=this.#dropOverlays.findIndex(t=>t.model===e);-1!==t&&(this.#dropOverlays[t].remove(),this.#dropOverlays.splice(t,1)),void 0!==e&&this.#dropTargets.remove(e)}_showOverlays(t){void 0!==t.originalEvent.dataTransfer&&Array.from(t.originalEvent.dataTransfer.types).includes("Files")&&(this.#overlaysHiding=!1,this.#overlaysVisible||(this.#overlaysVisible=!0,this.#dropOverlays.forEach(t=>t.show())))}_hideOverlays(){this.#hideOverlayTimeout&&clearTimeout(this.#hideOverlayTimeout),this.#overlaysHiding=!0,this.#hideOverlayTimeout=setTimeout(()=>{this.#overlaysHiding&&(this.#overlaysVisible=!1,this.#dropOverlays.forEach(t=>t.hide()))},200)}})||k,a=(l.defineSimpleMode("rb-text-plain",{start:[{next:"start",regex:/.*/,token:"rb-cm-codeblock-plain"}]}),l.defineMIME("text/plain","rb-text-plain"),e.spina(k=class extends e.BaseView{static className="rb-c-text-editor__textarea -is-rich";initialize(t){var e={electricChars:!1,extraKeys:{End:"goLineRight",Enter:"newlineAndIndentContinueMarkdownList",Home:"goLineLeft","Shift-Tab":!1,Tab:!1},lineWrapping:!0,mode:{highlightFormatting:!0,name:"gfm",tokenTypeOverrides:{code:"rb-markdown-code",list1:"rb-markdown-list1",list2:"rb-markdown-list2",list3:"rb-markdown-list3"}},styleSelectedText:!0,theme:"rb default",viewportMargin:t.autoSize?1/0:10},e=(this._codeMirror=new l(t.parentEl,e),this._codeMirror.getWrapperElement());e.classList.add("rb-c-text-editor__textarea","-is-rich"),this.setElement(e),void 0!==t.minHeight&&this.$el.css("min-height",t.minHeight),this._codeMirror.on("viewportChange",()=>this.$el.triggerHandler("resize")),this._codeMirror.on("change",()=>this.trigger("change"))}isDirty(t){return(t||"")!==this.getText()}setCursorPosition(t,e){var i=this._codeMirror;i.setCursor(i.coordsChar({left:t,top:e},"window"))}setText(t){this._codeMirror.setValue(t)}getText(){return this._codeMirror.getValue()}insertLine(t){let e;var i,s;this._codeMirror.hasFocus()?(i=this._codeMirror.getCursor(),s=this._codeMirror.getLine(i.line),e=l.Pos(i.line,s.length-1),(t=0!==s.length?"\n"+t:t).endsWith("\n")||(t+="\n")):(e=l.Pos(this._codeMirror.lastLine()),t="\n"+t),this._codeMirror.replaceRange(t,e)}getClientHeight(){return this._codeMirror.getScrollInfo().clientHeight}setSize(t,e){this._codeMirror.setSize(t,e),this._codeMirror.refresh()}focus(){this._codeMirror.focus()}})||k),o=e.spina(k=class extends e.BaseView{static className="rb-c-text-editor__textarea -is-plain";static tagName="textarea";initialize(t){(this.options=t).autoSize&&this.$el.autoSizeTextArea(),this.$el.css("width","100%").appendTo(t.parentEl).on("change keydown keyup keypress",()=>this.trigger("change")),void 0!==t.minHeight&&(t.autoSize?this.$el.autoSizeTextArea("setMinHeight",t.minHeight):this.$el.css("min-height",this.options.minHeight))}isDirty(t){var e=this.el.value||"";return e.length!==t.length||e!==t}setCursorPosition(e,i){if(document.caretPositionFromPoint||document.caretRangeFromPoint){var s=this.$el,n=this.el,a=s.offset(),o=n.getBoundingClientRect(),a=$("<pre>").move(a.left,a.top,"absolute").css({border:0,font:s.css("font"),height:o.height+"px","line-height":s.css("line-height"),margin:0,opacity:0,padding:s.css("padding"),"white-space":"pre-wrap",width:o.width+"px","word-wrap":"break-word","z-index":1e4}).text(this.el.value).appendTo(document.body);let t=null;document.caretPositionFromPoint?(s=document.caretPositionFromPoint(e,i))&&(t=s.offset):document.caretRangeFromPoint&&(o=document.caretRangeFromPoint(e,i))&&(t=o.startOffset),a.remove(),null!==t&&n.setSelectionRange(t,t)}}setText(t){this.el.value=t,this.options.autoSize&&this.$el.autoSizeTextArea("autoSize")}getText(){return this.el.value}insertLine(t){var e,i;!this.$el.is(":focus")||(e=this.el.value,i=this.el.selectionEnd,-1===(i=e.indexOf("\n",i)))?this.el.value+="\n"+t:this.el.value=e.slice(0,i+1)+"\n"+t+"\n"+e.slice(i)}getClientHeight(){return this.el.clientHeight}setSize(t,e){null!==t&&this.$el.innerWidth(t),null!==e&&("auto"===e&&this.options.autoSize?this.$el.autoSizeTextArea("autoSize",!0):this.$el.innerHeight(e))}focus(){this.el.focus()}})||k,h=e.spina(k=class extends e.BaseView{static className="rb-c-formatting-toolbar";buttonGroups={};#codeMirror;#editorID;initialize(t){var t=t.editor,e=t.el.id;console.assert(!!e),this.#codeMirror=t._codeMirror,this.#editorID=e,this.addGroup({ariaLabel:gettext("Text formatting"),id:"text",items:[{ariaLabel:gettext("Bold"),className:"rb-c-formatting-toolbar__btn-bold",id:"bold",onClick:this.#onBoldBtnClick.bind(this)},{ariaLabel:gettext("Italic"),className:"rb-c-formatting-toolbar__btn-italic",id:"italic",onClick:this.#onItalicBtnClick.bind(this)},{ariaLabel:gettext("Strikethrough"),className:"rb-c-formatting-toolbar__btn-strikethrough",id:"strikethrough",onClick:this.#onStrikethroughBtnClick.bind(this)},{ariaLabel:gettext("Code literal"),className:"rb-c-formatting-toolbar__btn-code",id:"code",onClick:this.#onCodeBtnClick.bind(this)}]}),this.addGroup({ariaLabel:gettext("Special formatting and media"),id:"media",items:[{ariaLabel:gettext("Insert link"),className:"rb-c-formatting-toolbar__btn-link",id:"link",onClick:this.#onLinkBtnClick.bind(this)},{$el:$(`<label class="rb-c-formatting-toolbar__btn"
       role="button" tabindex="0">`).append($('<input type="file" style="display: none;">').on("change",this.#onImageUpload.bind(this))),ariaLabel:gettext("Upload image"),className:"rb-c-formatting-toolbar__btn-image",id:"upload-image"}]}),this.addGroup({ariaLabel:gettext("Lists"),id:"lists",items:[{ariaLabel:gettext("Insert unordered list"),className:"rb-c-formatting-toolbar__btn-list-ul",id:"list-ul",onClick:this.#onUListBtnClick.bind(this)},{ariaLabel:gettext("Insert ordered list"),className:"rb-c-formatting-toolbar__btn-list-ol",id:"list-ol",onClick:this.#onOListBtnClick.bind(this)}]})}onInitialRender(){this.$el.attr({"aria-controls":this.#editorID,"aria-label":gettext("Text formatting toolbar"),role:"toolbar"})}addGroup(t){var e=t.id,i=(console.assert(!this.buttonGroups.hasOwnProperty(e),`Toolbar group "${e}" was already registered.`),$("<div>").addClass("rb-c-formatting-toolbar__btn-group").attr("aria-label",t.ariaLabel));if(this.buttonGroups[e]={$el:i,id:e,items:{}},t.items)for(const s of t.items)this.addItem(e,s);i.appendTo(this.$el)}addItem(t,e){var i=this.buttonGroups[t];console.assert(!!i,`Toolbar group "${t}" does not exist.`);let s=e.$el;void 0===s&&(s=$(r.paintComponent("Ink.Button",{class:"rb-c-formatting-toolbar__btn","aria-pressed":"false",tabindex:"0"}))),e.ariaLabel&&s.attr({"aria-label":e.ariaLabel,title:e.ariaLabel}),e.className&&s.addClass(e.className),e.onClick&&s.on("click",e.onClick),s.appendTo(i.$el)}#onBoldBtnClick(t){t.stopPropagation(),t.preventDefault(),this.#toggleInlineTextFormat(["**"])}#onCodeBtnClick(t){t.stopPropagation(),t.preventDefault(),this.#toggleInlineTextFormat(["`"])}#onItalicBtnClick(t){t.stopPropagation(),t.preventDefault(),this.#toggleInlineTextFormat(["_","*"])}#onLinkBtnClick(t){t.stopPropagation(),t.preventDefault(),this.#toggleLinkSyntax()}#onImageUpload(t){var e=t.target.files,i=this.#getCurrentTokenGroup()[0];this.#codeMirror.focus(),this.#codeMirror.setCursor(i),e&&this.trigger("uploadImage",e[0]),t.stopPropagation(),t.preventDefault()}#onOListBtnClick(t){t.stopPropagation(),t.preventDefault(),this.#toggleListSyntax(!0)}#onStrikethroughBtnClick(t){t.stopPropagation(),t.preventDefault(),this.#toggleInlineTextFormat(["~~"])}#onUListBtnClick(t){t.stopPropagation(),t.preventDefault(),this.#toggleListSyntax(!1)}#toggleInlineTextFormat(e){var i=this.#codeMirror,s=i.getSelection();if(""===s){var[n,a]=this.#getCurrentTokenGroup(),o=i.getRange(n,a);let t=!1;for(const p of e)if(o.startsWith(p)&&o.endsWith(p)){var r=this.#removeSyntax(o,p);i.replaceRange(r,n,a),t=!0;break}t||(h=e[0],i.replaceRange(""+h+o+h,n,a),(d=i.getCursor()).ch-=h.length,i.setCursor(d))}else{let t=!1;for(const g of e)if(s.startsWith(g)&&s.endsWith(g)){var l=this.#removeSyntax(s,g);i.replaceSelection(l,"around"),t=!0;break}if(!t){var[h,d]=this.#getCurrentTokenGroup(),c=(i.setSelection(h,d),i.getSelection());for(const m of e)if(c.startsWith(m)&&c.endsWith(m)){var u=this.#removeSyntax(c,m);i.replaceSelection(u,"around"),t=!0;break}if(!t){const b=e[0];h=c.split("\n").map(t=>""===t?t:t.startsWith(b)&&t.endsWith(b)?this.#removeSyntax(t,b):""+b+t+b);i.replaceSelection(h.join("\n"),"around")}}}i.focus()}#getCurrentTokenGroup(){var e=this.#codeMirror,i=e.getCursor(!0),s=e.getCursor(!1),n=Object.assign({},i);for(let t=e.getTokenAt(i,!0);" "!==t.string&&0!==n.ch;t=e.getTokenAt(n,!0))--n.ch;var a=e.getLine(i.line).length,o=Object.assign({},s);for(let t=e.getTokenAt(s,!0);" "!==t.string&&o.ch<a;t=e.getTokenAt(o,!0))o.ch+=1;return o.ch!==a&&n.line===o.line&&--o.ch,[n,o]}#removeSyntax(t,e){let i;i="*"===e?"\\*":"**"===e?"\\*\\*":e;e=new RegExp(`^(${i})(.*)\\1$`,"gm");return t.replace(e,"$2")}#toggleListSyntax(t){var e=t?/^[0-9]+\.\s/:/^[\*|\+|-]\s/,t=t?"1.":"-",i=this.#codeMirror,s=i.getCursor(),n=i.getLine(s.line),a=i.getSelection();if(""===a)e.test(n)?(o=n.replace(e,""),i.replaceRange(o,{ch:0,line:s.line},{line:s.line}),n&&(s.ch-=t.length+1,i.setCursor(s))):(i.replaceRange(t+" "+n,{ch:0,line:s.line},{line:s.line}),n&&(s.ch+=t.length+1,i.setCursor(s)));else if(e.test(a)){var o=a.replace(e,"");i.replaceSelection(o,"around")}else{const r=i.getCursor(!0);var n=i.getCursor(!1),o=i.getLineTokens(s.line).filter(t=>t.start<r.ch).reduce((t,e)=>t+e.string,"");e.test(o)?(o=a.replace(e,""),i.setSelection({ch:0,line:s.line},n),i.replaceSelection(o,"around")):i.replaceSelection(t+" "+a,"around")}i.focus()}#toggleLinkSyntax(){var t,e,i,s,n=/\[(?<text>.*)\]\(.*\)/,a=this.#codeMirror,o=a.getSelection();let r=a.getCursor();""===o?([i,t]=this.#getCurrentTokenGroup(),""===(e=a.getRange(i,t))?(a.replaceSelection("[](url)"),a.setCursor(l.Pos(r.line,r.ch+1))):(s=e.match(n))&&s.groups?(s=s.groups.text,a.replaceRange(s,i,t)):(a.replaceRange(`[${e}](url)`,i,t),r=a.getCursor(),a.setSelection(l.Pos(r.line,r.ch-4),l.Pos(r.line,r.ch-1)))):(s=o.match(n))&&s.groups?a.replaceSelection(s.groups.text):([e,i]=this.#getCurrentTokenGroup(),(s=a.getRange(e,i).match(n))&&s.groups?a.replaceRange(s.groups.text,e,i):(a.replaceSelection(`[${o}](url)`),r=a.getCursor(),a.setSelection(l.Pos(r.line,r.ch-4),l.Pos(r.line,r.ch-1))))}})||k,d=e.spina(k=class d extends e.BaseView{static className="rb-c-text-editor";static defaultOptions={autoSize:!0,minHeight:70};static events={focus:"focus",remove:"_onRemove"};#formattingToolbar=null;#prevClientHeight=null;#richTextDirty=!1;#startCursorPos=null;#value;initialize(t={}){this._editor=null,this.#prevClientHeight=null,this.options=_.defaults(t,d.defaultOptions),this.richText=!!this.options.richText,this.#value=this.options.text||"",this.#richTextDirty=!1,this.options.bindRichText&&this.bindRichTextAttr(this.options.bindRichText.model,this.options.bindRichText.attrName),RB.UserSession.instance.get("defaultUseRichText")&&this.setRichText(!0)}onInitialRender(){this.$el.addClass(this.className)}setRichText(t){t!==this.richText&&(this._editor?(this.hideEditor(),this.richText=t,this.showEditor(),this.#richTextDirty=!0,this.$el.triggerHandler("resize")):this.richText=t,this.trigger("change:richText",t),this.trigger("change"))}bindRichTextAttr(t,e){this.setRichText(t.get(e)),this.listenTo(t,"change:"+e,(t,e)=>this.setRichText(e))}bindRichTextCheckbox(t){t.prop("checked",this.richText).on("change",()=>this.setRichText(t.prop("checked"))),this.on("change:richText",()=>t.prop("checked",this.richText))}bindRichTextVisibility(t){t.toggle(this.richText),this.on("change:richText",()=>t.toggle(this.richText))}isDirty(t){return null!==this._editor&&(this.#richTextDirty||this._editor.isDirty(t||""))}setCursorPosition(t,e){this._editor?this._editor.setCursorPosition(t,e):this.#startCursorPos=[t,e]}setText(t){t!==this.getText()&&(this._editor?this._editor.setText(t):this.#value=t),this.trigger("change")}getText(){return this._editor?this._editor.getText():this.#value}insertLine(t){this._editor?this._editor.insertLine(t):this.#value.endsWith("\n")?this.#value+=t+"\n":this.#value+="\n"+t,this.trigger("change")}setSize(t,e){this._editor&&(null!==this.#formattingToolbar&&(e-=this.#formattingToolbar.$el.outerHeight(!0)),this._editor.setSize(t,e))}show(){return this.$el.show(),this.showEditor(),this}hide(){return this.hideEditor(),this.$el.hide(),this}focus(){this._editor&&this._editor.focus()}_onRemove(){null!==i.instance&&i.instance.unregisterDropTarget(this.$el)}showEditor(){this.richText?(i.instance.registerDropTarget(this.$el,gettext("Drop to add an image"),this._uploadImage.bind(this)),this._editor=new a({autoSize:this.options.autoSize,minHeight:this.options.minHeight,parentEl:this.el}),this._editor.el.id=_.uniqueId("rb-c-text-editor_"),this.#formattingToolbar=new h({_uploadImage:this._uploadImage.bind(this),editor:this._editor}),this.#formattingToolbar.renderInto(this.$el),this.listenTo(this.#formattingToolbar,"uploadImage",this._uploadImage)):this._editor=new o({autoSize:this.options.autoSize,minHeight:this.options.minHeight,parentEl:this.el}),this._editor.setText(this.#value);var t=this.#startCursorPos;null!==t&&this._editor.setCursorPosition(t[0],t[1]),this.#value="",this.#richTextDirty=!1,this.#prevClientHeight=null,this._editor.$el.on("resize",_.throttle(()=>this.$el.triggerHandler("resize"),250)),this.listenTo(this._editor,"change",_.throttle(()=>{var t;null!==this._editor&&((t=this._editor.getClientHeight())!==this.#prevClientHeight&&(this.#prevClientHeight=t,this.$el.triggerHandler("resize")),this.trigger("change"))},500)),this.focus()}hideEditor(){i.instance.unregisterDropTarget(this.$el),this._editor&&(this.#value=this._editor.getText(),this.#richTextDirty=!1,this._editor.remove(),this._editor=null,this.$el.empty()),this.#formattingToolbar&&(this.#formattingToolbar.remove(),this.#formattingToolbar=null)}_isImage(t){if(t.type)return"image"===t.type.split("/")[0];const e=t.name.toLowerCase();return[".jpeg",".jpg",".png",".gif",".bmp",".tiff",".svg"].some(t=>e.endsWith(t))}_uploadImage(t){if(this._isImage(t)){const e=new RB.UserFileAttachment({caption:t.name});e.save().then(()=>{this.insertLine(`![Image](${e.get("downloadURL")})`),e.set("file",t),e.save().catch(t=>alert(t.message))}).catch(t=>alert(t.message))}}})||k,c=e.spina({prototypeAttrs:["defaultOptions"]})(k=class extends e.BaseView{static defaultOptions={animationSpeedMS:200,deferEventSetup:!1,editDragThreshold:3,editIconClass:null,editIconPath:null,enabled:!0,extraHeight:100,fieldLabel:null,focusOnOpen:!0,formClass:"",formatResult:t=>_.escape(t),getFieldValue:t=>t.$field.val(),hasRawValue:!1,isFieldDirty:(t,e)=>{var i=t.getValue()||"",i=(t.options.hasRawValue?i:_.escape(i))||"";return e=t.normalizeText(e),i.length!==e.length||i!==e},matchHeight:!0,multiline:!1,notifyUnchangedCompletion:!1,promptOnCancel:!0,rawValue:null,setFieldValue:(t,e)=>t.$field.val(e),showButtons:!0,showEditIcon:!0,showRequiredFlag:!1,startOpen:!1};_dirty=!1;_dirtyCalcTimeout=null;_editing=!1;_initialValue=null;initialize(t){this.options=_.defaults(t,this.defaultOptions)}onInitialRender(){var t=this.options,e=t.multiline,i=t.fieldLabel,s=t.hasShortButtons,n=_.uniqueId("rb-c-inline-editor"),a=(this.$el.data("inline-editor",this),$("<form>").addClass("rb-c-inline-editor").addClass(e?"-is-multi-line":"-is-single-line").attr({"aria-label":i?interpolate(gettext("Edit the %(fieldLabel)s field"),{fieldLabel:i},!0):gettext("Edit the field"),id:n})),o=(t.formClass&&a.addClass(t.formClass),s&&a.addClass("-has-short-buttons"),this._$form=a,$('<div class="rb-c-inline-editor__field">').appendTo(a));this._$fieldWrapper=o,this.$field=this.createField().appendTo(o),this._isTextArea="TEXTAREA"===this.$field[0].tagName,this.$buttons=$(),t.showButtons&&(this.$buttons=$(r.paintComponent("div",{class:"rb-c-inline-editor__actions"},r.paintComponent("Ink.Button",{"aria-label":i?interpolate(gettext("Save %(fieldLabel)s"),{fieldLabel:i},!0):gettext("Save the field"),"data-action":"save",iconName:"ink-i-check",onClick:()=>this.submit()},!s&&gettext("Save")),r.paintComponent("Ink.Button",{"aria-label":i?interpolate(gettext("Cancel editing %(fieldLabel)s and discard changes"),{fieldLabel:i},!0):gettext("Cancel editing and discard changes"),"data-action":"cancel",iconName:"ink-i-close",onClick:()=>this.cancel()},!s&&gettext("Cancel")))).hide().appendTo(a)),this._$editIcon=$(),t.showEditIcon&&(o=i?interpolate(gettext("Edit the %(fieldLabel)s field"),{fieldLabel:i},!0):gettext("Edit this field"),this._$editIcon=$('<a href="#" role="button">').addClass("rb-c-inline-editor-edit-icon").attr({"aria-controls":n,"aria-label":o,tabindex:0,title:o}).on("click",t=>{t.preventDefault(),t.stopPropagation(),this.startEdit()}),t.editIconPath?this._$editIcon.append(`<img src="${t.editIconPath}">`):t.editIconClass&&this._$editIcon.append(`<div class="${t.editIconClass}" aria-hidden="true">`),t.showRequiredFlag&&(s=gettext("This field is required"),$('<span class="required-flag">*</span>').attr({"aria-label":s,title:s}).appendTo(this._$editIcon)),e&&this.$el[0].id?$(`label[for="${this.$el[0].id}"]`).append(this._$editIcon):this._$editIcon.insertAfter(this.$el)),a.hide().insertBefore(this.$el),t.deferEventSetup||this.setupEvents(),t.startOpen&&this.startEdit({preventAnimation:!0}),t.enabled?this.enable():this.disable()}createField(){return this.options.multiline?$("<textarea>").autoSizeTextArea():$('<input type="text">')}remove(){return super.remove(),$(window).off(this.cid),this}setupEvents(){const a=this.options;if(this.$field.keydown(t=>{t.stopPropagation(),"Enter"===t.key?(a.multiline&&!t.ctrlKey||this.submit(),a.multiline||t.preventDefault()):"Escape"===t.key?this.cancel():"s"!==t.key&&"S"!==t.key||t.ctrlKey&&(this.submit(),t.preventDefault())}).keypress(t=>t.stopPropagation()).keyup(t=>{t.stopPropagation(),t.preventDefault(),this._scheduleUpdateDirtyState()}).on("cut paste",()=>this._scheduleUpdateDirtyState()),!a.useEditIconOnly){let i=null,s=null,n=!0;this.$el.on("click","a",t=>t.stopPropagation()).on("click",t=>{t.stopPropagation(),t.preventDefault(),n||this.startEdit({clickX:t.clientX,clickY:t.clientY}),n=!0}).on("mousedown",t=>{n=!1,i=t.clientX,s=t.clientY,this.$el.on("mousemove",t=>{var e=a.editDragThreshold;n=n||Math.abs(t.clientX-i)>e||Math.abs(t.clientY-s)>e})}).on("mouseup",()=>{this.$el.off("mousemove"),i=null,s=null})}}startEdit(e={}){if(!this._editing&&this.options.enabled&&this.el.dispatchEvent(new Event("startEdit",{cancelable:!0}))){let t;t=this.options.hasRawValue?(this._initialValue=this.options.rawValue,this._initialValue):(this._initialValue=this.$el.text(),_.unescape(this.normalizeText(this._initialValue))),this._editing=!0,this.options.setFieldValue(this,t),this.trigger("beginEditPreShow",e),this.showEditor(e),this.trigger("beginEdit",e)}}showEditor(t={}){const e=this._$editIcon;var i,s;this.options.multiline&&!t.preventAnimation?e.fadeOut(this.options.animationSpeedMS,()=>e.css({display:"",visibility:"hidden"})):e.css("display","none"),this.$el.hide(),this._$form.show(),this.options.multiline&&(s=(i=this.$el.outerHeight())+this.options.extraHeight,this._isTextArea)&&(this.options.matchHeight?(this.$field.autoSizeTextArea("setMinHeight",s).css("overflow","hidden"),t.preventAnimation?this.$field.height(s):this.$field.height(i).animate({height:s},this.options.animationSpeedMS)):this.$field.autoSizeTextArea("autoSize",!0,!1,i)),this.$buttons.show(),this.$field.queue(()=>{this.options.multiline&&this._isTextArea&&this.$field.css("overflow","auto"),this.options.focusOnOpen&&this.$field.focus(),this.options.multiline||"INPUT"!==this.$field[0].tagName||this.$field[0].select(),this.$field.dequeue()})}hideEditor(){const t=this._$editIcon;this.$field.blur(),this.$buttons.hide(),this.options.multiline?t.fadeIn(this.options.animationSpeedMS,()=>t.css("visibility","visible")):t.css("display",""),this.options.multiline&&this.options.matchHeight&&this._editing&&this._isTextArea&&this.$field.css("overflow","hidden").animate({height:this.$el.outerHeight()},this.options.animationSpeedMS),this.$field.queue(()=>{this.$el.show(),this._$form.hide(),this.$field.dequeue()}),this._editing=!1,this._updateDirtyState()}save(t={}){var e=this.getValue(),i=this._initialValue,s=this.isDirty();if(s&&(this.$el.html(this.options.formatResult(e)),this._initialValue=this.$el.text()),s||this.options.notifyUnchangedCompletion)return t.preventEvents||this.trigger("complete",e,i),this.options.hasRawValue&&(this.options.rawValue=e),e;t.preventEvents||this.trigger("cancel",this._initialValue)}submit(t={}){t=this.save(t);return this.hideEditor(),t}cancel(){this.isDirty()&&this.options.promptOnCancel&&!confirm(gettext("You have unsaved changes. Are you sure you want to discard them?"))||(this.hideEditor(),this.trigger("cancel",this._initialValue))}isDirty(){return null!==this._dirtyCalcTimeout&&(clearTimeout(this._dirtyCalcTimeout),this._updateDirtyState()),this._dirty}getValue(){return this.options.getFieldValue(this)}setValue(t){this.options.setFieldValue(this,t),this._updateDirtyState()}enable(){this._editing&&this.showEditor(),this._$editIcon.css("visibility","visible"),this.options.enabled=!0}disable(){this._editing&&this.hideEditor(),this._$editIcon.css("visibility","hidden"),this.options.enabled=!1}editing(){return this._editing}normalizeText(t){return this.options.stripTags&&(t=(t=(t=t.replace(/<br>/g,"\n")).replace(/<\/?[^>]+>/gi,"")).trim()),t=this.options.multiline?t:t.replace(/\s{2,}/g," ")}_scheduleUpdateDirtyState(){null===this._dirtyCalcTimeout&&(this._dirtyCalcTimeout=setTimeout(this._updateDirtyState.bind(this),200))}_updateDirtyState(){var t=this._editing&&this.options.isFieldDirty(this,this._initialValue);this._dirty!==t&&(this._dirty=t,this.trigger("dirtyStateChanged",this._dirty)),this._dirtyCalcTimeout=null}})||k,u=e.spina(k=class extends c{static defaultOptions=_.defaults({getFieldValue:t=>t.textEditor.getText(),isFieldDirty:(t,e)=>(e=t.normalizeText(e),t.textEditor.isDirty(e)),matchHeight:!1,multiline:!0,setFieldValue:(t,e)=>t.textEditor.setText(e||"")},c.prototype.defaultOptions);createField(){let e;return this.textEditor=new d(this.options.textEditorOptions),this.textEditor.$el.on("resize",()=>this.trigger("resize")),this.$el.data("text-editor",this.textEditor),this.once("beginEdit",()=>{var t=$('<span class="enable-markdown">'),e=$('<input type="checkbox">').attr("id",_.uniqueId("markdown_check")).change(()=>_.defer(()=>this._updateDirtyState())).appendTo(t),e=(this.textEditor.bindRichTextCheckbox(e),$("<label>").attr("for",e[0].id).text(gettext("Enable Markdown")).appendTo(t),this.$buttons.append(t),$('<a class="markdown-info" target="_blank">').attr("href",MANUAL_URL+"users/markdown/").text(gettext("Markdown Reference")).toggle(this.textEditor.richText).appendTo(this.$buttons));this.textEditor.bindRichTextVisibility(e)}),this.listenTo(this,"beginEdit",t=>{void 0!==t.clickX&&void 0!==t.clickY&&this.textEditor.setCursorPosition(t.clickX,t.clickY),this.textEditor.showEditor(),e=this.textEditor.richText}),this.listenTo(this,"cancel",()=>{this.textEditor.hideEditor(),this.textEditor.setRichText(e)}),this.listenTo(this,"complete",()=>this.textEditor.hideEditor()),this.textEditor.render().$el}setupEvents(){super.setupEvents(),this.listenTo(this.textEditor,"change",this._scheduleUpdateDirtyState)}})||k,p=e.spina(k=class extends c{static defaultOptions=_.defaults({descriptorText:null,editIconClass:"rb-icon rb-icon-edit",getFieldValue:t=>t._$datePickerInput.val(),hasRawValue:!0,isFieldDirty:(t,e)=>t.getValue()!==e,maxDate:null,minDate:null,multiline:!1,setFieldValue:(t,e)=>t._$datePickerInput.val(e),useEditIconOnly:!0},c.prototype.defaultOptions);createField(){return this._$datePickerInput=$('<input type="date">').attr({max:this.options.maxDate,min:this.options.minDate}),this._$datePicker=$('<span class="rb-c-date-inline-editor__picker">').append(this.options.descriptorText,this._$datePickerInput),this._$datePicker}setupEvents(){super.setupEvents(),this.$field.change(t=>{t.stopPropagation(),t.preventDefault(),this._scheduleUpdateDirtyState()})}})||k,g=e.spina(k=class extends p{createField(){return this._$datePickerInput=$('<input type="datetime-local">').attr({max:this.options.maxDate,min:this.options.minDate}),this._$datePicker=$('<span class="rb-c-date-time-inline-editor__picker">').append(this.options.descriptorText,this._$datePickerInput),this._$datePicker}})||k,m=e.spina(k=class extends e.BaseView{#updatePositionThrottled;initialize(t={}){this.#updatePositionThrottled=()=>{requestAnimationFrame(()=>this.updatePosition())},this.setElements(t.elements||new Map)}remove(){return super.remove(),this.setElements(new Map),this}setElements(t){0<(this._elements=t).size?$(window).on("resize scroll",this.#updatePositionThrottled):$(window).off("resize scroll",this.#updatePositionThrottled)}updatePosition(){if(0!==this._elements.size){const u=RB.contentViewport.get("top"),p=RB.contentViewport.get("bottom");let c=window.scrollY;const g=window.innerHeight,m=c+g-p;c+=u,this._elements.forEach((i,s)=>{var n=$(s),a=i.$top,o=i.$parent||a,i=i.$bottom||o,r=a.offset().top,i=i.height()+(i===a?r:i.offset().top),a=o===a?0:o.offset().top-r;if(!(r>=m&&i<=c)){var l,o=getComputedStyle(s),h=s.offsetHeight,d=o.position;let t=null,e=null;c>=r&&m<=i?(e=u+(g-u-p-h)/2,"fixed"!==d&&(t={left:n.offset().left,position:"fixed",right:"auto",transform:"none"})):(l=Math.max(c,r),i=Math.min(m,i)-l-h,e=Math.max(0,l-r+Math.min(i,i/2))-a,"fixed"===d&&(t={position:"absolute",left:"",right:"",transform:""})),t&&n.css(t),Math.round(parseInt(o.top))!==Math.round(e)&&(s.style.top=e+"px")}})}}})||k,b=function(t){return t.DRAFT="draft",t.DELETED="deleted",t}({}),f=e.spina(k=class extends e.BaseView{static className="rb-c-field-state-label";#state;#inline;#theme;initialize(t){this.#state=t.state,this.#inline=t.inline||!1,this.#theme=t.theme||b.DRAFT}onInitialRender(){this.$el.addClass(this.className).addClass("-is-"+this.#theme).text(this.#state),this.#inline&&this.$el.addClass("-is-inline")}})||k,v=e.spina(k=class extends e.BaseView{#$floatContainer=null;#$floatSpacer=null;#noFloatContainerClass=null;initialize(t){super.initialize(t),this.#$floatContainer=t.$floatContainer,this.#noFloatContainerClass=t.noFloatContainerClass}onInitialRender(){$(window).scroll(()=>this.#updateFloatPosition()).resize(()=>this.#updateSize()),_.defer(()=>this.#updateFloatPosition())}remove(){return null!==this.#$floatSpacer&&(this.#$floatSpacer.remove(),this.#$floatSpacer=null),super.remove(),this}#updateSize(){var t;null!==this.#$floatSpacer&&(this.$el.hasClass("floating")?(t=this.#$floatSpacer.parent()[0].getBoundingClientRect(),this.$el.width(Math.ceil(t.width)-Math.max(this.$el.getExtents("bpm","lr"),0))):this.$el.width("auto"))}#updateFloatPosition(){var t,e,i,s,n,a;0!==this.$el.parent().length&&(null===this.#$floatSpacer&&(this.#$floatSpacer=this.$el.wrap($("<div>")).parent(),this.#updateSize()),e=(t=this.#$floatContainer.offset().top)+this.#$floatContainer.outerHeight(),i=$(window).scrollTop(),s=this.#$floatSpacer.offset().top-i,n=this.$el.outerHeight(!0),a=this.$el.hasClass("floating"),!this.#$floatContainer.hasClass(this.#noFloatContainerClass)&&s<0&&t<i&&i<e?(a||(this.#$floatSpacer.height(this.$el.outerHeight()).css({"margin-bottom":this.$el.css("margin-bottom"),"margin-top":this.$el.css("margin-top")}),this.$el.addClass("floating").css({"margin-top":0,position:"fixed"})),this.$el.css("top",e-n<i?e-n-i:0),this.#updateSize()):a&&(this.$el.removeClass("floating").css({"margin-top":"",position:"",top:""}),this.#$floatSpacer.height("auto").css("margin",0)))}})||k,x=function(t){return t[t.Standard=1]="Standard",t[t.Button=2]="Button",t}({}),y=e.spina(k=class extends e.BaseView{static TYPE_STANDARD_MENU=x.Standard;static TYPE_BUTTON_MENU=x.Button;static className="rb-c-menu";static events={keydown:"_onKeyDown",touchstart:"_onTouchStart"};$controller=null;isOpen=!1;#ariaLabelledBy;#ariaLabel;#activeItemIndex=null;#activeItemEl=null;initialize(t={}){super.initialize(t),void 0===t.type||t.type===x.Standard?this.type=x.Standard:t.type===x.Button?this.type=x.Button:(console.error("The provided RB.MenuView type (%s) is not supported. Defaulting to a standard menu.",t.type),this.type=x.Standard),this.id||(this.id=_.uniqueId("__rb-menu")),this.$controller=t.$controller,this.#ariaLabelledBy=t.ariaLabelledBy,this.#ariaLabel=t.ariaLabel}onInitialRender(){this.$el.attr({id:this.id,tabindex:"-1"}),this.type===x.Button&&this.$el.addClass("rb-c-button-group -is-vertical"),this.$el.attr("role","menu"),this.#ariaLabelledBy?this.$el.attr("aria-labelledby",this.#ariaLabelledBy):this.#ariaLabel&&this.$el.attr("aria-label",this.#ariaLabel),this.$controller&&this.$controller.attr({"aria-controls":this.id,"aria-expanded":"false","aria-haspopup":"true"})}addItem(t={}){let e;return this.type===x.Button?e=$('<button class="rb-c-menu__item rb-c-button" type="button">'):this.type===x.Standard?e=$('<div class="rb-c-menu__item">'):console.assert(!1,"RB.MenuView type is not a supported type."),void 0!==t.$child?t.$child.appendTo(e):void 0!==t.text&&e.text(t.text),void 0!==t.onClick&&e.on("click",t.onClick),void 0!==t.id&&e.attr("id",t.id),e.attr({role:"menuitem",tabindex:"-1"}).on("mousemove",t=>this.#onMenuItemMouseMove(t)),t.prepend?e.prependTo(this.el):e.appendTo(this.el),e}addSeparator(t={}){var e=$('<div class="rb-c-menu__separator" role="separator">');return t.prepend?e.prependTo(this.el):e.appendTo(this.el),e}clearItems(){this.$(".rb-c-menu__item").remove()}open(t={}){this.#setOpened(!0,t)}close(t={}){this.#setOpened(!1,t)}focusFirstItem(){0<this.el.children.length&&this.focusItem(0)}focusLastItem(){var t=this.el.children.length;0<t&&this.focusItem(t-1)}#setOpened(t,e={}){this.isOpen!==t&&(this.#activeItemIndex=null,this.#activeItemEl=null,!1===e.animate&&(this.$el.addClass("js-no-animation"),_.defer(()=>this.$el.removeClass("js-no-animation"))),this.isOpen=t,(e=!1!==e.triggerEvents)&&this.trigger(t?"opening":"closing"),this.$el.toggleClass("-is-open",t),this.$controller&&this.$controller.toggleClass("-is-open",t).attr("aria-expanded",t?"true":"false"),e)&&this.trigger(t?"opened":"closed")}focusItem(t){this.#activeItemIndex=t,this.#activeItemEl=this.el.children[t],this.#activeItemEl.focus()}#focusPreviousItem(){if(null===this.#activeItemIndex)this.focusFirstItem();else{let t=this.#activeItemIndex-1;t<0&&(t=this.el.children.length-1),this.focusItem(t)}}#focusNextItem(){if(null===this.#activeItemIndex)this.focusFirstItem();else{let t=this.#activeItemIndex+1;t>=this.el.children.length&&(t=0),this.focusItem(t)}}_onKeyDown(t){let e=!0;"Enter"===t.key?$(this.#activeItemEl).triggerHandler("click"):"Escape"===t.key||"Tab"===t.key?(this.$controller&&this.$controller.focus(),this.close({animate:!1})):"ArrowUp"===t.key?this.#focusPreviousItem():"ArrowDown"===t.key?this.#focusNextItem():"Home"===t.key||"PageUp"===t.key?this.focusFirstItem():"End"===t.key||"PageDown"===t.key?this.focusLastItem():e=!1,e&&(t.stopPropagation(),t.preventDefault())}#onMenuItemMouseMove(t){var e,t=t.currentTarget;t!==this.#activeItemEl&&(e=this.el.children,-1!==(e=_.indexOf(e,t)))&&this.focusItem(e)}get _activeItemIndex(){return this.#activeItemIndex}})||k,T=e.spina(k=class T extends e.BaseView{static className="rb-c-menu-button";static events={"click .rb-c-menu-button__toggle":"_onToggleClick",focusout:"_onFocusOut","keydown .rb-c-menu-button__toggle":"_onToggleButtonKeyDown","mouseenter .rb-c-menu-button__toggle":"_openMenu",mouseleave:"_closeMenu"};static template=_.template(`<% if (hasPrimaryButton) { %>
 <div class="rb-c-button-group" role="group">
  <button class="rb-c-menu-button__primary rb-c-button"
          type="button"><%- buttonText %></button>
  <button class="rb-c-menu-button__toggle rb-c-button"
          id="<%- labelID %>"
          type="button"
          aria-label="<%- menuLabel %>">
   <span class="<%- menuIconClass %>"></span>
  </button>
 </div>
<% } else { %>
 <button class="rb-c-button rb-c-menu-button__toggle"
         id="<%- labelID %>"
         type="button">
  <%- buttonText %>
  <span class="<%- menuIconClass %>"></span>
 </button>
<% } %>`);$primaryButton=null;menu=null;openDirection="down";#$dropDownButton=null;#ariaMenuLabel;#buttonText;#hasPrimaryButton;#menuIconClass;#menuItems;#menuType;#onPrimaryButtonClick;initialize(t){this.#ariaMenuLabel=t.ariaMenuLabel||gettext("More options"),this.#menuItems=t.menuItems||[],this.#menuType=t.menuType||x.Standard,this.#menuIconClass=t.menuIconClass||"rb-icon rb-icon-dropdown-arrow",this.#buttonText=t.text,this.#onPrimaryButtonClick=t.onPrimaryButtonClick,this.#hasPrimaryButton=!!this.#onPrimaryButtonClick||t.hasPrimaryButton}remove(){return this.menu.remove(),super.remove(),this}onInitialRender(){var t=_.uniqueId("__rb-menubuttonview__label"),e=(this.$el.addClass(this.className).attr("role","group").html(T.template({buttonText:this.#buttonText,hasPrimaryButton:this.#hasPrimaryButton,labelID:t,menuIconClass:this.#menuIconClass,menuLabel:this.#ariaMenuLabel})),this.#hasPrimaryButton&&(this.$primaryButton=this.$(".rb-c-menu-button__primary").on("click",this.#onPrimaryButtonClick.bind(this)),console.assert(1===this.$primaryButton.length)),this.#$dropDownButton=this.$(".rb-c-menu-button__toggle"),console.assert(1===this.#$dropDownButton.length),new y({$controller:this.#$dropDownButton,ariaLabelledBy:t,type:this.#menuType}));e.render(),this.listenTo(e,"opening",()=>{this.#$dropDownButton.addClass("js-hover"),this.updateMenuPosition()}),this.listenTo(e,"closing",()=>{this.#$dropDownButton.removeClass("js-hover")});for(const i of this.#menuItems)e.addItem(i);e.$el.appendTo(this.$el),this.menu=e}updateMenuPosition(){var t=this.#$dropDownButton,e=t.offset().top,i=e+t.innerHeight(),s=window.pageYOffset,n=window.pageYOffset+window.innerHeight;let a;a=e<=s||!(n<=i)&&i+this.menu.$el.outerHeight()<=n?"down":"up",this.openDirection=a,this.$el.toggleClass("-opens-up","up"===a),this.menu.$el.css("down"===a?"top":"bottom",t.innerHeight())}_openMenu(t){this.menu.open(t)}_closeMenu(t){this.menu.close(t)}_onFocusOut(t){t.stopPropagation(),t.currentTarget.contains(t.relatedTarget)||this._closeMenu({animate:!1})}_onToggleButtonKeyDown(t){"ArrowDown"===t.key||"ArrowUp"===t.key||"Enter"===t.key||" "===t.key?(this._openMenu({animate:!1}),"up"===this.openDirection?this.menu.focusLastItem():"down"===this.openDirection&&this.menu.focusFirstItem(),t.stopPropagation(),t.preventDefault()):"Escape"===t.key&&(this._closeMenu({animate:!1}),t.stopPropagation(),t.preventDefault())}_onToggleClick(t){t.stopPropagation(),t.preventDefault()}})||k,C=e.spina(k=class extends e.BaseView{static className="rb-c-event-overlay";static events={click:"_onClick",touchstart:"_onClick"};_onClick(t){t.stopPropagation(),t.preventDefault(),this.trigger("click")}})||k,w=e.spina(k=class w extends e.BaseView{static events={"click .rb-c-slideshow__nav-item":"_onNavItemClick","click .rb-c-slideshow__nav-next":"_onNextClick","click .rb-c-slideshow__nav-prev":"_onPrevClick",keydown:"_onKeyDown","mouseenter .rb-c-slideshow__slide-content":"_onSlideMouseEnter","mouseleave .rb-c-slideshow__slide-content":"_onSlideMouseLeave"};static TABINDEX_SEL='a[href], button, input, select, textarea, [tabindex="0"]';#$curNavItem=null;#$curSlide=null;#$navItems=null;#$slides=null;#$slidesContainer=null;#autoCycleTimeMS;#curIndex=0;#cycleAutomaticallyEnabled=!1;#cycleAutomaticallyPaused=!1;#cycleTimeout;#maxFullAutoCycles;#numFullAutoCycles=0;#numSlides=0;#restartCycleTimeMS;initialize(t={}){this.#autoCycleTimeMS=t.autoCycleTimeMS||parseInt(this.$el.data("auto-cycle-time-ms"),10)||2e3,this.#restartCycleTimeMS=t.restartCycleTimeMS||6e3,this.#maxFullAutoCycles=t.maxAutoCycles||5,this.#numFullAutoCycles=0}onInitialRender(){var t=this.$(".rb-c-slideshow__nav");this.#$navItems=t.children(".rb-c-slideshow__nav-item"),this.#$slidesContainer=this.$(".rb-c-slideshow__slides"),this.#$slides=this.#$slidesContainer.children(".rb-c-slideshow__slide"),this.#numSlides=this.#$slides.length,this.#$slides.each((t,e)=>{e=$(e);e.data("slide-index",t),this.#disableSlide(e)});let e=0;window.location.hash&&this.#$navItems.length&&0<(t=this.#$navItems.filter(`[href="${window.location.hash}"]`)).length&&(e=this.#$navItems.index(t[0])),this.setSlide(e),this.setAutomaticCyclingEnabled(this.$el.hasClass("-is-auto-cycled"))}queueNextSlide(){if(this.unqueueNextSlide(),this.#cycleAutomaticallyEnabled&&!this.#cycleAutomaticallyPaused){var t=this.#$curSlide;const i=t.data("last-animation");if(i){const s=this.#curIndex;t.on("animationend.slideshow-queue-slide",t=>{t.originalEvent.animationName===i&&this.#curIndex===s&&e.call(this)})}else e.call(this);function e(){this.#cycleTimeout=setTimeout(this.#autoCycleNext.bind(this),this.#curIndex+1>=this.#numSlides?this.#restartCycleTimeMS:this.#autoCycleTimeMS)}}}unqueueNextSlide(){this.#cycleTimeout&&(clearTimeout(this.#cycleTimeout),this.#cycleTimeout=null)}prevSlide(){this.setSlide(0===this.#curIndex?this.#numSlides-1:this.#curIndex-1)}nextSlide(){this.setSlide(this.#curIndex+1>=this.#numSlides?0:this.#curIndex+1)}setSlide(t){var e=this.#$curSlide;let i=null,s=null;(s=this.#$navItems.length?(i=this.#$navItems.eq(t),(n=this.#$curNavItem)&&n.attr("aria-selected","false"),i.attr("aria-selected","true"),this.#$slides.filter(i[0].hash)):this.#$slides.eq(t)).css("display","block");var n=s[0].clientLeft;e&&this.#disableSlide(e),this.#enableSlide(s),s.css("transform",`translate3d(-${n}px, 0, 0)`),this.#$slidesContainer.data("selected-index",t).css("transform",`translate3d(-${100*t}%, 0, 0)`),i&&(this.#$curNavItem=i),this.#$curSlide=s,this.#curIndex=t,this.queueNextSlide()}setAutomaticCyclingEnabled(t){this.#cycleAutomaticallyEnabled!==t&&(this.#cycleAutomaticallyEnabled=t,this.#$slidesContainer.attr("aria-live",t?"off":"polite"),this.#$curSlide.off("animationend.slideshow-queue-slide"),this.unqueueNextSlide(),t)&&this.queueNextSlide()}#autoCycleNext(){this.nextSlide(),0===this.#curIndex&&(this.#numFullAutoCycles++,this.#numFullAutoCycles>=this.#maxFullAutoCycles)&&this.setAutomaticCyclingEnabled(!1)}#disableSlide(t){t.off("animationend.slideshow-queue-slide").attr({"aria-hidden":"true",hidden:"",tabindex:"-1"}).find(w.TABINDEX_SEL).attr("tabindex","-1")}#enableSlide(t){t.attr({"aria-hidden":"false",tabindex:"0"}).removeAttr("hidden").find(w.TABINDEX_SEL).removeAttr("tabindex")}_onNavItemClick(t){t.preventDefault(),t.stopPropagation();t=this.#$navItems.index(t.target);-1!==t&&(this.setAutomaticCyclingEnabled(!1),this.setSlide(t))}_onNextClick(t){t.preventDefault(),t.stopPropagation(),this.setAutomaticCyclingEnabled(!1),this.nextSlide()}_onPrevClick(t){t.preventDefault(),t.stopPropagation(),this.setAutomaticCyclingEnabled(!1),this.prevSlide()}_onKeyDown(t){let e=!0;switch(t.key){case"ArrowLeft":this.prevSlide(),this.#$curNavItem.focus();break;case"ArrowRight":this.nextSlide(),this.#$curNavItem.focus();break;default:e=!1}if(e)return!1}_onSlideMouseEnter(){this.unqueueNextSlide(),this.#cycleAutomaticallyPaused=!0}_onSlideMouseLeave(){this.#cycleAutomaticallyPaused=!1,this.#cycleAutomaticallyEnabled&&this.queueNextSlide()}})||k,S=e.spina(k=class extends e.BaseModel{static defaults={bottom:0,left:0,right:0,top:0};#tracked=null;#_resizeObserver=null;clearTracking(){this.#tracked&&(this.set({bottom:0,left:0,right:0,top:0}),this.#tracked=null),this.#_resizeObserver&&(this.#_resizeObserver.disconnect(),this.#_resizeObserver=null)}trackElement(t){let e=this.#tracked;var i=t.el,t=t.side;if(null===e)e=new WeakMap,this.#tracked=e;else if(e.has(i))return;var s=this.#getElementSize(i,t);e.set(i,{lastSize:s,side:t}),this.attributes[t]+=s,this.#resizeObserver.observe(i)}untrackElement(t){var e;null!==this.#tracked&&void 0!==(e=this.#tracked.get(t))&&(this.attributes[e.side]-=e.lastSize,this.#tracked.delete(t),this.#resizeObserver.unobserve(t))}get#resizeObserver(){let t=this.#_resizeObserver;return null===t&&(t=new ResizeObserver(this.#onObserveResize.bind(this)),this.#_resizeObserver=t),t}#getElementSize(t,e,i){return void 0===i&&(i=t.getBoundingClientRect()),"top"===e||"bottom"===e?i.height:i.width}#onObserveResize(t){var e=this.#tracked;if(null!==e){var i=this.attributes,s={};for(const r of t){var n=r.target,a=e.get(n),o=(console.assert(void 0!==a),a.side),n=this.#getElementSize(n,o,r.contentRect);s[o]=(s[o]??i[o])-a.lastSize+n,a.lastSize=n}s&&this.set(s),this.trigger("handledResize")}}})||k;var k=new S;t.CenteredElementManager=m,t.ContentViewport=S,t.DateInlineEditorView=p,t.DateTimeInlineEditorView=g,t.DnDUploader=i,t.FieldStateLabelThemes=b,t.FieldStateLabelView=f,t.FloatingBannerView=v,t.InlineEditorView=c,t.MenuButtonView=T,t.MenuType=x,t.MenuView=y,t.OverlayView=C,t.RichTextInlineEditorView=u,t.SlideshowView=w,t.TextEditorView=d,t.contentViewport=k,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})},"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@beanbag/ink"),require("@beanbag/spina"),require("codemirror")):"function"==typeof define&&define.amd?define(["exports","@beanbag/ink","@beanbag/spina","codemirror"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).RB=t.RB||{},t.Ink,t.Spina,t.CodeMirror)}.call(this);
