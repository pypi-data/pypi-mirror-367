{"version":3,"file":"reviewRequestPageViewTests.js","names":["suite","template","page","pageView","entry1","entry2","beforeEach","$el","$","html","appendTo","$testsScratch","RB","DnDUploader","instance","spyOn","HeaderView","prototype","ReviewRequestPage","checkForUpdates","reviewRequestData","editorData","fileAttachments","mutableByUser","showSendEmail","parse","ReviewRequestPageView","el","model","IssueSummaryTableView","reviewRequest","get","addEntryView","ReviewEntryView","ReviewEntry","review","createReview","shipIt","public","bodyTop","bodyBottom","reviewRequestEditor","find","and","resolveTo","draft","render","expect","_entryViews","length","toBe","afterEach","EnabledFeatures","unifiedBanner","UnifiedBannerView","resetInstance","describe","it","$el1","$el2","hasClass","click","addClass","ReviewReplyEditorView","callThrough","openCommentEditor","getReviewReplyEditorView","toHaveBeenCalled","not"],"sources":["../../../../../../../static/rb/js/reviewRequestPage/views/tests/reviewRequestPageViewTests.es6.js"],"sourcesContent":["suite('rb/reviewRequestPage/views/ReviewRequestPageView', function() {\n    const template = dedent`\n        <div id=\"review-banner\"></div>\n        <div id=\"unified-banner\">\n         <div class=\"rb-c-unified-banner__mode-selector\"></div>\n        </div>\n        <a id=\"collapse-all\"></a>\n        <a id=\"expand-all\"></a>\n        <div>\n         <div class=\"review review-request-page-entry\" id=\"review123\">\n          <div class=\"review-request-page-entry-contents\">\n           <div class=\"body\">\n            <pre class=\"body_top\">Body Top</pre>\n            <div class=\"comment-section\" data-context-type=\"body_top\">\n            </div>\n            <div class=\"comment-section\" data-context-id=\"123\"\n                 data-context-type=\"diff_comments\">\n            </div>\n            <pre class=\"body_bottom\">Body Bottom</pre>\n            <div class=\"comment-section\" data-context-type=\"body_bottom\">\n            </div>\n           </div>\n         </div>\n         <div class=\"review review-request-page-entry\" id=\"review124\">\n          <div class=\"review-request-page-entry-contents\">\n           <div class=\"body\">\n            <pre class=\"body_top\">Body Top</pre>\n            <div class=\"comment-section\" data-context-type=\"body_top\">\n            </div>\n            <pre class=\"body_bottom\">Body Bottom</pre>\n            <div class=\"comment-section\" data-context-type=\"body_bottom\">\n            </div>\n           </div>\n          </div>\n         </div>\n        </div>\n    `;\n\n    let page;\n    let pageView;\n    let entry1;\n    let entry2;\n\n    beforeEach(function() {\n        const $el = $('<div>')\n            .html(template)\n            .appendTo($testsScratch);\n\n        RB.DnDUploader.instance = null;\n        spyOn(RB.HeaderView.prototype, '_ensureSingleton');\n\n        page = new RB.ReviewRequestPage.ReviewRequestPage({\n            checkForUpdates: false,\n            reviewRequestData: {},\n            editorData: {\n                fileAttachments: [],\n                mutableByUser: true,\n                showSendEmail: false,\n            },\n        }, {\n            parse: true,\n        });\n\n        pageView = new RB.ReviewRequestPage.ReviewRequestPageView({\n            el: $el,\n            model: page,\n        });\n\n        // Stub this out.\n        spyOn(RB.ReviewRequestPage.IssueSummaryTableView.prototype,\n              'render');\n\n        const reviewRequest = page.get('reviewRequest');\n\n        pageView.addEntryView(new RB.ReviewRequestPage.ReviewEntryView({\n            model: new RB.ReviewRequestPage.ReviewEntry({\n                review: reviewRequest.createReview(123, {\n                    shipIt: true,\n                    public: true,\n                    bodyTop: 'Body Top',\n                    bodyBottom: 'Body Bottom',\n                }),\n                reviewRequestEditor: pageView.reviewRequestEditor,\n            }),\n            el: $el.find('#review123'),\n        }));\n\n        pageView.addEntryView(new RB.ReviewRequestPage.ReviewEntryView({\n            model: new RB.ReviewRequestPage.ReviewEntry({\n                review: reviewRequest.createReview(124, {\n                    shipIt: false,\n                    public: true,\n                    bodyTop: 'Body Top',\n                    bodyBottom: 'Body Bottom',\n                }),\n                reviewRequestEditor: pageView.reviewRequestEditor,\n            }),\n            el: $el.find('#review124'),\n        }));\n\n        /* Don't communicate with the server for page updates. */\n        spyOn(reviewRequest, 'ready').and.resolveTo();\n        spyOn(reviewRequest.draft, 'ready').and.resolveTo();\n        spyOn(page.get('pendingReview'), 'ready').and.resolveTo();\n\n        pageView.render();\n\n        expect(pageView._entryViews.length).toBe(2);\n        entry1 = pageView._entryViews[0];\n        entry2 = pageView._entryViews[1];\n    });\n\n    afterEach(function() {\n        RB.DnDUploader.instance = null;\n\n        if (RB.EnabledFeatures.unifiedBanner) {\n            RB.UnifiedBannerView.resetInstance();\n        }\n    });\n\n    describe('Actions', function() {\n        it('Collapse all', function() {\n            const $el1 = entry1.$el.find('.review-request-page-entry-contents');\n            const $el2 = entry2.$el.find('.review-request-page-entry-contents');\n\n            expect($el1.hasClass('collapsed')).toBe(false);\n            expect($el2.hasClass('collapsed')).toBe(false);\n\n            pageView.$('#collapse-all').click();\n\n            expect($el1.hasClass('collapsed')).toBe(true);\n            expect($el2.hasClass('collapsed')).toBe(true);\n        });\n\n        it('Expand all', function() {\n            const $el1 = entry1.$el.find('.review-request-page-entry-contents');\n            const $el2 = entry2.$el.find('.review-request-page-entry-contents');\n\n            $el1.addClass('collapsed');\n            $el2.addClass('collapsed');\n\n            pageView.$('#expand-all').click();\n\n            expect($el1.hasClass('collapsed')).toBe(false);\n            expect($el2.hasClass('collapsed')).toBe(false);\n        });\n    });\n\n    describe('Methods', function() {\n        describe('openCommentEditor', function() {\n            beforeEach(function() {\n                spyOn(RB.ReviewRequestPage.ReviewReplyEditorView.prototype,\n                      'openCommentEditor');\n                spyOn(entry1, 'getReviewReplyEditorView').and.callThrough();\n                spyOn(entry2, 'getReviewReplyEditorView').and.callThrough();\n            });\n\n            it('With body_top', function() {\n                pageView.openCommentEditor('body_top');\n\n                expect(entry1.getReviewReplyEditorView).toHaveBeenCalled();\n                expect(RB.ReviewRequestPage.ReviewReplyEditorView\n                       .prototype.openCommentEditor).toHaveBeenCalled();\n\n                /* We should have matched the first one. */\n                expect(entry2.getReviewReplyEditorView).not.toHaveBeenCalled();\n            });\n\n            it('With body_bottom', function() {\n                pageView.openCommentEditor('body_bottom');\n\n                expect(entry1.getReviewReplyEditorView).toHaveBeenCalled();\n                expect(RB.ReviewRequestPage.ReviewReplyEditorView\n                       .prototype.openCommentEditor).toHaveBeenCalled();\n\n                /* We should have matched the first one. */\n                expect(entry2.getReviewReplyEditorView).not.toHaveBeenCalled();\n            });\n\n            it('With comments', function() {\n                pageView.openCommentEditor('diff_comments', 123);\n\n                expect(entry1.getReviewReplyEditorView).toHaveBeenCalled();\n                expect(RB.ReviewRequestPage.ReviewReplyEditorView\n                       .prototype.openCommentEditor).toHaveBeenCalled();\n\n                /* We should have matched the first one. */\n                expect(entry2.getReviewReplyEditorView).not.toHaveBeenCalled();\n            });\n        });\n    });\n});\n"],"mappings":"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","ignoreList":[]}