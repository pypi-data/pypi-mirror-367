{"version":3,"file":"chunkHighlighterView.js","names":["RB","ChunkHighlighterView","Backbone","View","extend","className","initialize","_chunkEl","_chunkContainerEl","_$pageContainer","_$window","$","window","_prevWindowWidth","_prevTop","_prevHeight","_","bindAll","render","on","cid","windowWidth","width","updateLayout","remove","prototype","call","off","highlight","$chunk","parents","chunkEl","changed","css","top","Math","floor","offsetTop","height","clientHeight","padding","getExtents","left","right","$el"],"sources":["../../../../../../static/rb/js/diffviewer/views/chunkHighlighterView.es6.js"],"sourcesContent":["/**\n * Highlights a chunk of the diff.\n *\n * This will create and move four border elements around the chunk. We use\n * these border elements instead of setting a border since few browsers\n * render borders on <tbody> tags the same, and give us few options for\n * styling.\n *\n * In practice, there's only ever one highlighter on a page at a time.\n */\nRB.ChunkHighlighterView = Backbone.View.extend({\n    className: 'diff-highlight',\n\n    /**\n     * Initialize the highlighter.\n     */\n    initialize() {\n        this._chunkEl = null;\n        this._chunkContainerEl = null;\n        this._$pageContainer = null;\n        this._$window = $(window);\n        this._prevWindowWidth = null;\n        this._prevTop = null;\n        this._prevHeight = null;\n\n        _.bindAll(this, 'updateLayout');\n    },\n\n    /**\n     * Render the highlighter to the page.\n     *\n     * This will create all the border elements and compute any variables\n     * we want to keep around for further rendering.\n     *\n     * Returns:\n     *     RB.ChunkHighlighterView:\n     *     This object, for chaining.\n     */\n    render() {\n        this._$window.on('resize.' + this.cid, () => {\n            const windowWidth = this._$window.width();\n\n            if (windowWidth !== this._prevWindowWidth) {\n                this._prevWindowWidth = windowWidth;\n\n                this.updateLayout();\n            }\n        });\n\n        this._$pageContainer = $('#page-container');\n\n        this.updateLayout();\n\n        return this;\n    },\n\n    /**\n     * Remove the highlighter from the page and disconnects all events.\n     */\n    remove() {\n        Backbone.View.prototype.remove.call(this);\n\n        this._$window.off(this.cid);\n    },\n\n    /**\n     * Highlight a new chunk element.\n     *\n     * The borders will surround the chunk element and track its position\n     * and size as the page updates.\n     *\n     * Args:\n     *     $chunk (jQuery):\n     *         The chunk element to highlight.\n     */\n    highlight($chunk) {\n        this._chunkEl = $chunk[0];\n        this._chunkContainerEl = $chunk.parents('.diff-container')[0];\n\n        this.updateLayout();\n    },\n\n    /**\n     * Update of the position of the highlighter.\n     */\n    updateLayout() {\n        const chunkEl = this._chunkEl;\n\n        if (!chunkEl) {\n            return;\n        }\n\n        let changed = false;\n        const css = {};\n\n        /*\n         * NOTE: We're hard-coding the border widths (1px) so we don't have to\n         *       look them up. The borders aren't directly on the chunk (and\n         *       may not even be on a child of this chunk), and it's a bit\n         *       slow to look these up.\n         */\n        const top = Math.floor(chunkEl.offsetTop +\n                               this._chunkContainerEl.offsetTop + 1);\n        const height = chunkEl.clientHeight + 1;\n\n        if (top !== this._prevTop) {\n            css.top = top;\n            this._prevTop = top;\n            changed = true;\n        }\n\n        if (height !== this._prevHeight) {\n            css.height = height;\n            this._prevHeight = height;\n            changed = true;\n        }\n\n        if (changed) {\n            /*\n             * If the positions of the chunk changed, then it's possible the\n             * page container's padding has also changed (zooming in/out), so\n             * be safe and recompute.\n             *\n             * Technically we should compute separately for the left and right\n             * sides, but in practice we apply even spacing. Save a\n             * calculation, since this happens in resize events.\n             */\n            const padding = this._$pageContainer.getExtents('p', 'l');\n            css.left = -padding;\n            css.right = -padding;\n\n            this.$el.css(css);\n        }\n    },\n});\n"],"mappings":"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","ignoreList":[]}