{"version":3,"file":"changeListPageView.js","names":["ActionsDrawerView","RB","DrawerView","extend","template","_","events","initialize","options","actions","render","prototype","call","$content","html","$summary","$","_onActionClicked","e","stopPropagation","preventDefault","trigger","currentTarget","data","Admin","ChangeListPageView","PageView","apply","arguments","drawerShown","renderPage","model","_$changelist","$pageContent","children","_$form","_$datagrid","_datagrid","_$actions","find","drawer","get","setDrawer","listenTo","action","prop","submit","modelNameLower","toLowerCase","modelNameLowerPlural","count","text","interpolate","ngettext","showDrawer","_drawerShown","show","hide","onResize","resizeElementForFullHeight","resizeToFit","_onToggleAllCheckboxesChanged","$toggleCheckbox","target","change","_onRowSelected","$checkbox","objectID","val","select","unselect"],"sources":["../../../../../../static/rb/js/admin/views/changeListPageView.es6.js"],"sourcesContent":["(function() {\n\n\n/**\n * A drawer containing actions that can be performed on selected objects.\n *\n * This displays any actions provided by the Django\n * :py:class:`~django.contrib.admin.ModelAdmin` class that can apply to\n * selected rows in the change list.\n */\nconst ActionsDrawerView = RB.DrawerView.extend({\n    template: _.template(dedent`\n        <p class=\"rb-c-drawer__summary\"></p>\n        <div class=\"rb-c-drawer__actions\">\n         <ul class=\"rb-c-drawer__action-group\">\n          <% _.each(actions, function(actionInfo) { %>\n           <li class=\"rb-c-drawer__action\"\n               data-action-id=\"<%- actionInfo.id %>\">\n            <strong><%- actionInfo.label %></strong>\n           </li>\n          <% }) %>\n         </ul>\n        </div>\n    `),\n\n    events: {\n        'click .rb-c-drawer__action': '_onActionClicked',\n    },\n\n    /**\n     * Initialize the drawer.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the drawer.\n     *\n     * Option Args:\n     *     actions (Array of object):\n     *         The actions to show in the drawer. Each is an object with the\n     *         following keys:\n     *\n     *         ``id`` (:js:class:`string`):\n     *             The action's identifier.\n     *\n     *         ``label`` (:js:class:`string`):\n     *             The human-readable label.\n     */\n    initialize(options) {\n        this.actions = options.actions;\n    },\n\n    /**\n     * Render the drawer.\n     *\n     * Returns:\n     *     ActionsDrawerView:\n     *     This instance, for chaining.\n     */\n    render() {\n        RB.DrawerView.prototype.render.call(this);\n\n        this.$content.html(this.template({\n            actions: this.actions,\n        }));\n\n        this.$summary = this.$('.rb-c-drawer__summary');\n\n        return this;\n    },\n\n    /**\n     * Handle a click on one of the action items.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event.\n     */\n    _onActionClicked(e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        this.trigger('actionClicked', $(e.currentTarget).data('action-id'));\n    },\n});\n\n\n/**\n * The view for the Administration UI's Change List page.\n *\n * This manages the dynamic state of the Change List page, which is used for\n * showing all entries for a model.\n *\n * This includes a drawer for the actions that can be performed on selected\n * entries (defined in :py:class:`~django.contrib.admin.ModelAdmin`), and\n * managing the selection state in general.\n */\nRB.Admin.ChangeListPageView = RB.Admin.PageView.extend({\n    events: {\n        'change #action-toggle': '_onToggleAllCheckboxesChanged',\n        'change .action-select': '_onRowSelected',\n    },\n\n    /**\n     * Initialize the page view.\n     */\n    initialize() {\n        RB.Admin.PageView.prototype.initialize.apply(this, arguments);\n\n        this.drawerShown = false;\n    },\n\n    /**\n     * Render the page contents.\n     *\n     * This should be implemented by subclasses that need to render any\n     * UI elements.\n     */\n    renderPage() {\n        RB.Admin.PageView.prototype.renderPage.call(this);\n\n        const model = this.model;\n\n        this._$changelist = this.$pageContent.children(\n            '.rb-c-admin-change-list');\n        this._$form = this._$changelist.children(\n            '.rb-c-admin-change-list__form');\n        this._$datagrid = this._$form.children(\n            '.rb-c-admin-change-list__results');\n        this._datagrid = this._$datagrid.data('datagrid');\n        this._$actions = this._$form.find(\n            'select[name=\"action\"]');\n\n        const drawer = new ActionsDrawerView({\n            actions: model.get('actions'),\n        });\n        this.setDrawer(drawer);\n        this.listenTo(drawer, 'actionClicked', action => {\n            this._$actions.children(`option[value=\"${action}\"]`)\n                .prop('selected', true);\n            this._$form.submit();\n        });\n\n        const modelNameLower = model.get('modelName').toLowerCase();\n        const modelNameLowerPlural =\n            model.get('modelNamePlural').toLowerCase();\n\n        this.listenTo(model, 'change:selectionCount', (model, count) => {\n            this.drawer.$summary.text(\n                N_(`${count} ${modelNameLower} selected`,\n                   `${count} ${modelNameLowerPlural} selected`,\n                   count));\n\n            const showDrawer = (count > 0);\n\n            if (showDrawer !== this._drawerShown) {\n                if (showDrawer) {\n                    this.drawer.show();\n                } else {\n                    this.drawer.hide();\n                }\n\n                this._drawerShown = showDrawer;\n            }\n        });\n    },\n\n    /**\n     * Handle a page resize.\n     *\n     * This will lay out the elements to take the full height of the\n     * page.\n     */\n    onResize() {\n        this.resizeElementForFullHeight(this._$changelist);\n        this.resizeElementForFullHeight(this._$form);\n        this._datagrid.resizeToFit();\n    },\n\n    /**\n     * Handle a toggle on the checkbox in the datagrid header.\n     *\n     * This will toggle all rows' checkboxes to match the state of the\n     * one in the header.\n     *\n     * Args:\n     *     e (Event):\n     *         The change event.\n     */\n    _onToggleAllCheckboxesChanged(e) {\n        const $toggleCheckbox = $(e.target);\n\n        this._$datagrid.find('.action-select')\n            .prop('checked', $toggleCheckbox.prop('checked'))\n            .change();\n    },\n\n    /**\n     * Handle a toggle on a checkbox in a row.\n     *\n     * This will mark the row as selected or unselected, depending on the\n     * state of the checkbox.\n     *\n     * Args:\n     *     e (Event):\n     *         The change event.\n     */\n    _onRowSelected(e) {\n        const $checkbox = $(e.target);\n        const objectID = $checkbox.val();\n\n        if ($checkbox.prop('checked')) {\n            this.model.select(objectID);\n        } else {\n            this.model.unselect(objectID);\n        }\n    },\n});\n\n\n})();\n"],"mappings":"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","ignoreList":[]}