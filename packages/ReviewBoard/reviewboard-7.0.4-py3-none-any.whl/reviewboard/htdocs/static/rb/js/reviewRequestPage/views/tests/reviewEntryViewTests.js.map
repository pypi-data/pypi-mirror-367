{"version":3,"file":"reviewEntryViewTests.js","names":["suite","template","view","reviewView","reviewReply","beforeEach","reviewRequest","RB","ReviewRequest","editor","ReviewRequestEditor","review","createReview","loaded","links","replies","href","model","ReviewRequestPage","ReviewEntry","reviewRequestEditor","$el","$","appendTo","$testsScratch","createReply","ReviewEntryView","el","render","_reviewView","spyOn","and","callThrough","_setupNewReply","describe","it","$box","$collapseButton","click","expect","hasClass","toBe","_replyEditorViews","_showReplyDraftBanner","calls","reset","get","not","toHaveBeenCalled","set","collapse","addClass","expand","editorView","getReviewReplyEditorView","undefined"],"sources":["../../../../../../../static/rb/js/reviewRequestPage/views/tests/reviewEntryViewTests.es6.js"],"sourcesContent":["suite('rb/reviewRequestPage/views/ReviewEntryView', function() {\n    const template = dedent`\n        <div class=\"review review-request-page-entry\">\n         <div class=\"review-request-page-entry-contents\">\n          <div class=\"collapse-button\"></div>\n          <div class=\"banners\">\n           <input type=\"button\" value=\"Publish\">\n           <input type=\"button\" value=\"Discard\">\n          </div>\n          <div class=\"comment-section\" data-context-type=\"body_top\">\n           <a class=\"add_comment_link\"></a>\n           <ul class=\"reply-comments\">\n            <li class=\"draft\" data-comment-id=\"456\">\n             <pre class=\"reviewtext\"></pre>\n            </li>\n           </ul>\n          </div>\n          <div class=\"comment-section\" data-context-id=\"123\"\n               data-context-type=\"diff_comments\">\n           <a class=\"add_comment_link\"></a>\n           <ul class=\"reply-comments\"></ul>\n          </div>\n          <div class=\"comment-section\" data-context-type=\"body_bottom\">\n           <a class=\"add_comment_link\"></a>\n           <ul class=\"reply-comments\"></ul>\n          </div>\n         </div>\n        </div>\n    `;\n    let view;\n    let reviewView;\n    let reviewReply;\n\n    beforeEach(function() {\n        const reviewRequest = new RB.ReviewRequest();\n        const editor = new RB.ReviewRequestEditor({\n            reviewRequest: reviewRequest\n        });\n        const review = reviewRequest.createReview({\n            loaded: true,\n            links: {\n                replies: {\n                    href: '/api/review/123/replies/',\n                },\n            },\n        });\n        const model = new RB.ReviewRequestPage.ReviewEntry({\n            review: review,\n            reviewRequest: reviewRequest,\n            reviewRequestEditor: editor,\n        });\n        const $el = $(template).appendTo($testsScratch);\n\n        reviewReply = review.createReply();\n\n        view = new RB.ReviewRequestPage.ReviewEntryView({\n            el: $el,\n            model: model,\n        });\n\n        view.render();\n\n        reviewView = view._reviewView;\n\n        /* Don't allow the draft banner to show. */\n        spyOn(reviewView, '_showReplyDraftBanner');\n        spyOn(reviewView, 'trigger').and.callThrough();\n\n        reviewView._setupNewReply(reviewReply);\n    });\n\n    describe('Actions', function() {\n        it('Toggle collapse', function() {\n            const $box = view.$('.review-request-page-entry-contents');\n            const $collapseButton = view.$('.collapse-button');\n\n            $collapseButton.click();\n            expect($box.hasClass('collapsed')).toBe(true);\n            $collapseButton.click();\n            expect($box.hasClass('collapsed')).toBe(false);\n        });\n    });\n\n    describe('Draft banner', function() {\n        describe('Visibility', function() {\n            it('Shown on hasDraft', function() {\n                const editor = reviewView._replyEditorViews[1].model;\n\n                reviewView._showReplyDraftBanner.calls.reset();\n\n                expect(editor.get('hasDraft')).toBe(false);\n                expect(reviewView._showReplyDraftBanner).not.toHaveBeenCalled();\n\n                editor.set('hasDraft', true);\n                expect(reviewView._showReplyDraftBanner).toHaveBeenCalled();\n            });\n        });\n    });\n\n    describe('Methods', function() {\n        it('collapse', function() {\n            view.collapse();\n            expect(\n                view.$('.review-request-page-entry-contents')\n                    .hasClass('collapsed'))\n                .toBe(true);\n        });\n\n        it('expand', function() {\n            const $box = view.$('.review-request-page-entry-contents')\n                .addClass('collapsed');\n            view.expand();\n            expect($box.hasClass('collapsed')).toBe(false);\n        });\n\n        describe('getReviewReplyEditorView', function() {\n            it('With body_top', function() {\n                const editorView = view.getReviewReplyEditorView('body_top');\n\n                expect(editorView).not.toBe(undefined);\n                expect(editorView).toBe(reviewView._replyEditorViews[0]);\n            });\n\n            it('With body_bottom', function() {\n                const editorView = view.getReviewReplyEditorView('body_bottom');\n\n                expect(editorView).not.toBe(undefined);\n                expect(editorView).toBe(reviewView._replyEditorViews[2]);\n            });\n\n            it('With comments', function() {\n                const editorView = view.getReviewReplyEditorView('diff_comments',\n                                                                 123);\n\n                expect(editorView).not.toBe(undefined);\n                expect(editorView).toBe(reviewView._replyEditorViews[1]);\n            });\n        });\n    });\n});\n"],"mappings":";;AAAAA,KAAK,CAAC,4CAA4C,EAAE,YAAW;EAC3D,MAAMC,QAAQ,GAAS;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAEK;EACD,IAAIC,IAAI;EACR,IAAIC,UAAU;EACd,IAAIC,WAAW;EAEfC,UAAU,CAAC,YAAW;IAClB,MAAMC,aAAa,GAAG,IAAIC,EAAE,CAACC,aAAa,CAAC,CAAC;IAC5C,MAAMC,MAAM,GAAG,IAAIF,EAAE,CAACG,mBAAmB,CAAC;MACtCJ,aAAa,EAAEA;IACnB,CAAC,CAAC;IACF,MAAMK,MAAM,GAAGL,aAAa,CAACM,YAAY,CAAC;MACtCC,MAAM,EAAE,IAAI;MACZC,KAAK,EAAE;QACHC,OAAO,EAAE;UACLC,IAAI,EAAE;QACV;MACJ;IACJ,CAAC,CAAC;IACF,MAAMC,KAAK,GAAG,IAAIV,EAAE,CAACW,iBAAiB,CAACC,WAAW,CAAC;MAC/CR,MAAM,EAAEA,MAAM;MACdL,aAAa,EAAEA,aAAa;MAC5Bc,mBAAmB,EAAEX;IACzB,CAAC,CAAC;IACF,MAAMY,GAAG,GAAGC,CAAC,CAACrB,QAAQ,CAAC,CAACsB,QAAQ,CAACC,aAAa,CAAC;IAE/CpB,WAAW,GAAGO,MAAM,CAACc,WAAW,CAAC,CAAC;IAElCvB,IAAI,GAAG,IAAIK,EAAE,CAACW,iBAAiB,CAACQ,eAAe,CAAC;MAC5CC,EAAE,EAAEN,GAAG;MACPJ,KAAK,EAAEA;IACX,CAAC,CAAC;IAEFf,IAAI,CAAC0B,MAAM,CAAC,CAAC;IAEbzB,UAAU,GAAGD,IAAI,CAAC2B,WAAW;;IAE7B;IACAC,KAAK,CAAC3B,UAAU,EAAE,uBAAuB,CAAC;IAC1C2B,KAAK,CAAC3B,UAAU,EAAE,SAAS,CAAC,CAAC4B,GAAG,CAACC,WAAW,CAAC,CAAC;IAE9C7B,UAAU,CAAC8B,cAAc,CAAC7B,WAAW,CAAC;EAC1C,CAAC,CAAC;EAEF8B,QAAQ,CAAC,SAAS,EAAE,YAAW;IAC3BC,EAAE,CAAC,iBAAiB,EAAE,YAAW;MAC7B,MAAMC,IAAI,GAAGlC,IAAI,CAACoB,CAAC,CAAC,qCAAqC,CAAC;MAC1D,MAAMe,eAAe,GAAGnC,IAAI,CAACoB,CAAC,CAAC,kBAAkB,CAAC;MAElDe,eAAe,CAACC,KAAK,CAAC,CAAC;MACvBC,MAAM,CAACH,IAAI,CAACI,QAAQ,CAAC,WAAW,CAAC,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;MAC7CJ,eAAe,CAACC,KAAK,CAAC,CAAC;MACvBC,MAAM,CAACH,IAAI,CAACI,QAAQ,CAAC,WAAW,CAAC,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC;IAClD,CAAC,CAAC;EACN,CAAC,CAAC;EAEFP,QAAQ,CAAC,cAAc,EAAE,YAAW;IAChCA,QAAQ,CAAC,YAAY,EAAE,YAAW;MAC9BC,EAAE,CAAC,mBAAmB,EAAE,YAAW;QAC/B,MAAM1B,MAAM,GAAGN,UAAU,CAACuC,iBAAiB,CAAC,CAAC,CAAC,CAACzB,KAAK;QAEpDd,UAAU,CAACwC,qBAAqB,CAACC,KAAK,CAACC,KAAK,CAAC,CAAC;QAE9CN,MAAM,CAAC9B,MAAM,CAACqC,GAAG,CAAC,UAAU,CAAC,CAAC,CAACL,IAAI,CAAC,KAAK,CAAC;QAC1CF,MAAM,CAACpC,UAAU,CAACwC,qBAAqB,CAAC,CAACI,GAAG,CAACC,gBAAgB,CAAC,CAAC;QAE/DvC,MAAM,CAACwC,GAAG,CAAC,UAAU,EAAE,IAAI,CAAC;QAC5BV,MAAM,CAACpC,UAAU,CAACwC,qBAAqB,CAAC,CAACK,gBAAgB,CAAC,CAAC;MAC/D,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC,CAAC;EAEFd,QAAQ,CAAC,SAAS,EAAE,YAAW;IAC3BC,EAAE,CAAC,UAAU,EAAE,YAAW;MACtBjC,IAAI,CAACgD,QAAQ,CAAC,CAAC;MACfX,MAAM,CACFrC,IAAI,CAACoB,CAAC,CAAC,qCAAqC,CAAC,CACxCkB,QAAQ,CAAC,WAAW,CAAC,CAAC,CAC1BC,IAAI,CAAC,IAAI,CAAC;IACnB,CAAC,CAAC;IAEFN,EAAE,CAAC,QAAQ,EAAE,YAAW;MACpB,MAAMC,IAAI,GAAGlC,IAAI,CAACoB,CAAC,CAAC,qCAAqC,CAAC,CACrD6B,QAAQ,CAAC,WAAW,CAAC;MAC1BjD,IAAI,CAACkD,MAAM,CAAC,CAAC;MACbb,MAAM,CAACH,IAAI,CAACI,QAAQ,CAAC,WAAW,CAAC,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC;IAClD,CAAC,CAAC;IAEFP,QAAQ,CAAC,0BAA0B,EAAE,YAAW;MAC5CC,EAAE,CAAC,eAAe,EAAE,YAAW;QAC3B,MAAMkB,UAAU,GAAGnD,IAAI,CAACoD,wBAAwB,CAAC,UAAU,CAAC;QAE5Df,MAAM,CAACc,UAAU,CAAC,CAACN,GAAG,CAACN,IAAI,CAACc,SAAS,CAAC;QACtChB,MAAM,CAACc,UAAU,CAAC,CAACZ,IAAI,CAACtC,UAAU,CAACuC,iBAAiB,CAAC,CAAC,CAAC,CAAC;MAC5D,CAAC,CAAC;MAEFP,EAAE,CAAC,kBAAkB,EAAE,YAAW;QAC9B,MAAMkB,UAAU,GAAGnD,IAAI,CAACoD,wBAAwB,CAAC,aAAa,CAAC;QAE/Df,MAAM,CAACc,UAAU,CAAC,CAACN,GAAG,CAACN,IAAI,CAACc,SAAS,CAAC;QACtChB,MAAM,CAACc,UAAU,CAAC,CAACZ,IAAI,CAACtC,UAAU,CAACuC,iBAAiB,CAAC,CAAC,CAAC,CAAC;MAC5D,CAAC,CAAC;MAEFP,EAAE,CAAC,eAAe,EAAE,YAAW;QAC3B,MAAMkB,UAAU,GAAGnD,IAAI,CAACoD,wBAAwB,CAAC,eAAe,EACf,GAAG,CAAC;QAErDf,MAAM,CAACc,UAAU,CAAC,CAACN,GAAG,CAACN,IAAI,CAACc,SAAS,CAAC;QACtChB,MAAM,CAACc,UAAU,CAAC,CAACZ,IAAI,CAACtC,UAAU,CAACuC,iBAAiB,CAAC,CAAC,CAAC,CAAC;MAC5D,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC,CAAC;AACN,CAAC,CAAC","ignoreList":[]}