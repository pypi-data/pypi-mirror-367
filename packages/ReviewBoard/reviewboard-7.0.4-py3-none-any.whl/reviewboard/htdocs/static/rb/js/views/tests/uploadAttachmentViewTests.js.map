{"version":3,"file":"uploadAttachmentViewTests.js","names":["suite","reviewRequest","beforeEach","RB","ReviewRequest","summary","reviewURL","describe","dialog","afterEach","hide","UploadAttachmentView","$button","show","$buttonsMap","cancel","expect","length","toBe","it","is","spyOn","$","fn","and","callThrough","delegateEvents","click","modalBox","toHaveBeenCalledWith","$path","upload","_$path","attr","val","trigger","updateUploadButtonEnabledState","toHaveBeenCalledTimes","toHaveBeenCalled","send","attachmentHistoryID","presetCaption","$caption","$attachmentHistory"],"sources":["../../../../../../static/rb/js/views/tests/uploadAttachmentViewTests.es6.js"],"sourcesContent":["suite('rb/views/UploadAttachmentView', function() {\n    let reviewRequest;\n\n    beforeEach(function() {\n        reviewRequest = new RB.ReviewRequest({\n            summary: 'My Review Request',\n            reviewURL: '/r/1/',\n        });\n    });\n\n    describe('Instances', function() {\n        let dialog;\n\n        afterEach(function() {\n            if (dialog) {\n                dialog.hide();\n                dialog = null;\n            }\n        });\n\n        describe('Buttons', function() {\n            beforeEach(function() {\n                dialog = new RB.UploadAttachmentView({\n                    reviewRequest: reviewRequest,\n                });\n            });\n\n            describe('Cancel', function() {\n                let $button;\n\n                beforeEach(function() {\n                    dialog.show();\n                    $button = dialog.$buttonsMap.cancel;\n\n                    expect($button.length).toBe(1);\n                });\n\n                it('Enabled by default', function() {\n                    expect($button.is(':disabled')).toBe(false);\n                });\n\n                it('Closes dialog when clicked', function() {\n                    spyOn($.fn, 'modalBox').and.callThrough();\n                    dialog.delegateEvents();\n\n                    $button.click();\n                    expect($.fn.modalBox).toHaveBeenCalledWith('destroy');\n                });\n            });\n\n            describe('Upload', function() {\n                let $button;\n                let $path;\n\n                beforeEach(function() {\n                    spyOn(dialog, 'send');\n\n                    dialog.show();\n                    $button = dialog.$buttonsMap.upload;\n                    $path = dialog._$path;\n\n                    /*\n                     * Allows the value of the input to be changed\n                     * programmatically without security issues.\n                     */\n                    $path.attr('type', 'text');\n\n                    spyOn(dialog, 'updateUploadButtonEnabledState')\n                        .and.callThrough();\n                    dialog.delegateEvents();\n\n                    expect($button.length).toBe(1);\n                });\n\n                it('Disabled by default until a file is uploaded', function() {\n                    expect($button.is(':disabled')).toBe(true);\n                });\n\n                it('Enabled when a file is uploaded', function() {\n                    expect($button.is(':disabled')).toBe(true);\n\n                    $path\n                        .val('fakefile')\n                        .trigger('change');\n\n                    expect(dialog.updateUploadButtonEnabledState)\n                        .toHaveBeenCalledTimes(1);\n                    expect($button.is(':disabled')).toBe(false);\n                });\n\n                it('Disabled when an uploaded file is removed', function() {\n                    $path\n                        .val('fakefile')\n                        .trigger('change')\n                        .val('')\n                        .trigger('change');\n\n                    expect(dialog.updateUploadButtonEnabledState)\n                        .toHaveBeenCalledTimes(2);\n                    expect($button.is(':disabled')).toBe(true);\n                });\n\n                it('Uploads the file attachment', function() {\n                    expect($button.is(':disabled')).toBe(true);\n\n                    $path\n                        .val('fakefile')\n                        .trigger('change');\n\n                    expect(dialog.updateUploadButtonEnabledState).toHaveBeenCalled();\n                    expect($button.is(':disabled')).toBe(false);\n\n                    $button.click();\n                    expect(dialog.send).toHaveBeenCalled();\n                });\n            });\n        });\n\n        it('Dialog for updating an existing file attachment', function() {\n            dialog = new RB.UploadAttachmentView({\n                attachmentHistoryID: 14,\n                presetCaption: 'fakecaption',\n                reviewRequest: reviewRequest,\n            });\n\n            dialog.show();\n            const $caption = dialog.$('[name=\"caption\"]');\n            const $attachmentHistory = dialog.$('[name=\"attachment_history\"]');\n\n            expect($caption.length).toBe(1);\n            expect($caption.val()).toBe('fakecaption');\n\n            expect($attachmentHistory.length).toBe(1);\n            expect($attachmentHistory.val()).toBe('14');\n        });\n    });\n});\n"],"mappings":"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","ignoreList":[]}