{"version":3,"file":"newsWidgetModel.js","names":["RB","Admin","NewsWidget","Widget","extend","defaults","_","maxItems","newsItems","newsURL","rssURL","subscribeURL","prototype","loadNews","trigger","$","ajax","get","accepts","xml","dataType","success","data","$items","find","set","map","item","$item","date","moment","text","title","url","error"],"sources":["../../../../../../static/rb/js/admin/models/newsWidgetModel.es6.js"],"sourcesContent":["/**\n * State and operations for the administration UI's news widget.\n *\n * Model Attributes:\n *     maxItems (number):\n *         The maximum number of items to parse from the feed.\n *\n *     newsItems (Array of object):\n *         The list of news items to render. Each entry represents a news item,\n *         and is an object with the following keys:\n *\n *         ``date`` (:js:class:`Moment`):\n *             The parsed date.\n *\n *          ``title`` (string):\n *              The title of the news entry.\n *\n *          ``url`` (string):\n *              The URL to the news page for the item.\n *\n *     newsURL (string):\n *         The URL to the news page, for linking in the browser.\n *\n *     rssURL (string):\n *         The URL to the news RSS feed.\n *\n *     subscribeURL (string):\n *         The URL to a subscription page for the news feed or newsletter.\n */\nRB.Admin.NewsWidget = RB.Admin.Widget.extend({\n    defaults: _.defaults({\n        maxItems: 5,\n        newsItems: null,\n        newsURL: null,\n        rssURL: null,\n        subscribeURL: null,\n    }, RB.Admin.Widget.prototype.defaults),\n\n    /**\n     * Load the latest news from the server.\n     *\n     * This will attempt to load the news feed and populate the ``newsItems``\n     * attribute with the results. If there's an error when loading,\n     * ``newsItems`` will be set to an empty array.\n     *\n     * Before attempting to load the news, this will trigger the\n     * ``loadingNews`` event.\n     */\n    loadNews() {\n        this.trigger('loadingNews');\n\n        $.ajax(this.get('rssURL'), {\n            accepts: {\n                xml: 'application/rss+xml',\n            },\n            dataType: 'xml',\n            success: data => {\n                const maxItems = this.get('maxItems');\n                const $items = $(data).find(`item:lt(${maxItems})`);\n\n                this.set('newsItems', _.map($items, item => {\n                    const $item = $(item);\n\n                    return {\n                        date: moment($item.find('pubDate').text(),\n                                     'ddd, DD MMM YYYY HH:mm:ss ZZ'),\n                        title: $item.find('title').text(),\n                        url: $item.find('link').text(),\n                    };\n                }));\n            },\n            error: () => {\n                this.set('newsItems', []);\n            },\n        });\n    },\n});\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,EAAE,CAACC,KAAK,CAACC,UAAU,GAAGF,EAAE,CAACC,KAAK,CAACE,MAAM,CAACC,MAAM,CAAC;EACzCC,QAAQ,EAAEC,CAAC,CAACD,QAAQ,CAAC;IACjBE,QAAQ,EAAE,CAAC;IACXC,SAAS,EAAE,IAAI;IACfC,OAAO,EAAE,IAAI;IACbC,MAAM,EAAE,IAAI;IACZC,YAAY,EAAE;EAClB,CAAC,EAAEX,EAAE,CAACC,KAAK,CAACE,MAAM,CAACS,SAAS,CAACP,QAAQ,CAAC;EAEtC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIQ,QAAQA,CAAA,EAAG;IACP,IAAI,CAACC,OAAO,CAAC,aAAa,CAAC;IAE3BC,CAAC,CAACC,IAAI,CAAC,IAAI,CAACC,GAAG,CAAC,QAAQ,CAAC,EAAE;MACvBC,OAAO,EAAE;QACLC,GAAG,EAAE;MACT,CAAC;MACDC,QAAQ,EAAE,KAAK;MACfC,OAAO,EAAEC,IAAI,IAAI;QACb,MAAMf,QAAQ,GAAG,IAAI,CAACU,GAAG,CAAC,UAAU,CAAC;QACrC,MAAMM,MAAM,GAAGR,CAAC,CAACO,IAAI,CAAC,CAACE,IAAI,CAAC,WAAWjB,QAAQ,GAAG,CAAC;QAEnD,IAAI,CAACkB,GAAG,CAAC,WAAW,EAAEnB,CAAC,CAACoB,GAAG,CAACH,MAAM,EAAEI,IAAI,IAAI;UACxC,MAAMC,KAAK,GAAGb,CAAC,CAACY,IAAI,CAAC;UAErB,OAAO;YACHE,IAAI,EAAEC,MAAM,CAACF,KAAK,CAACJ,IAAI,CAAC,SAAS,CAAC,CAACO,IAAI,CAAC,CAAC,EAC5B,8BAA8B,CAAC;YAC5CC,KAAK,EAAEJ,KAAK,CAACJ,IAAI,CAAC,OAAO,CAAC,CAACO,IAAI,CAAC,CAAC;YACjCE,GAAG,EAAEL,KAAK,CAACJ,IAAI,CAAC,MAAM,CAAC,CAACO,IAAI,CAAC;UACjC,CAAC;QACL,CAAC,CAAC,CAAC;MACP,CAAC;MACDG,KAAK,EAAEA,CAAA,KAAM;QACT,IAAI,CAACT,GAAG,CAAC,WAAW,EAAE,EAAE,CAAC;MAC7B;IACJ,CAAC,CAAC;EACN;AACJ,CAAC,CAAC","ignoreList":[]}