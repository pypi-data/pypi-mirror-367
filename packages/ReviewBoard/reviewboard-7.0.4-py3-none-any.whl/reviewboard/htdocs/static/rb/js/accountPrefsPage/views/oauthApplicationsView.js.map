{"version":3,"file":"oauthApplicationsView.js","names":["addApplicationText","gettext","disabledForSecurityText","disabledWarningTemplate","emptyText","localSiteEmptyText","OAuthAppItem","Djblets","Config","ListItem","extend","defaults","_","apiURL","editURL","enabled","isDisabledForSecurity","localSiteName","name","originalUser","showRemove","prototype","parse","rsp","options","baseEditURL","baseURL","id","OAuthAppItemView","ListItemView","template","actionHandlers","getRenderContext","disabledWarning","interpolate","model","get","_onDeleteClicked","RB","apiCall","url","method","success","trigger","OAuthApplicationsView","Backbone","View","listTemplate","initialize","collections","Map","Object","entries","apps","map","Collection","_editURL","window","view","_renderAppList","collection","$entry","$","listView","ListView","ItemView","List","render","$el","prependTo","find","html","$lists","forEach","append","prepend"],"sources":["../../../../../../static/rb/js/accountPrefsPage/views/oauthApplicationsView.es6.js"],"sourcesContent":["(function() {\n\n\nconst addApplicationText = gettext('Add application');\nconst disabledForSecurityText = gettext('Disabled for security.');\nconst disabledWarningTemplate = gettext('This application has been disabled because the user \"%s\" has been removed from the Local Site.');\nconst emptyText = gettext('You have not registered any OAuth2 applications.');\nconst localSiteEmptyText = gettext('You have not registered any OAuth2 applications on %s.');\n\n\n/**\n * A model representing an OAuth application.\n *\n * Model Attributes:\n *     apiURL (string):\n *         The URL to the application list resource.\n *\n *     enabled (boolean):\n *         Whether or not the application is enabled.\n *\n *     editURL (string):\n *         The URL to edit this application.\n *\n *     isDisabledForSecurity (boolean):\n *         When true, this attribute indicates that the application was\n *         re-assigned to the current user because the original user was\n *         removed from the Local Site associated with this.\n *\n *     localSiteName (string):\n *         The name of the LocalSite the application is restricted to.\n\n *     name (string):\n *         The name of the application.\n *\n *     originalUser (string):\n *         The username of the user who originally owned this application. This\n *         will only be set if :js:attr:`enabled` is ``false``.\n *\n *     showRemove (boolean):\n *         Whether or not the \"Remove Item\" link should be shown.\n *\n *         This is always true.\n */\nconst OAuthAppItem = Djblets.Config.ListItem.extend({\n    defaults: _.defaults({\n        apiURL: '',\n        editURL: '',\n        enabled: true,\n        isDisabledForSecurity: false,\n        localSiteName: '',\n        name: '',\n        originalUser: null,\n        showRemove: true,\n    }, Djblets.Config.ListItem.prototype.defaults),\n\n    /**\n     * Parse a raw object into the properties of an OAuthAppItem.\n     *\n     * Args:\n     *     rsp (object):\n     *         The raw properties of the item.\n     *\n     *     options (object):\n     *         Options for generating properties.\n     *\n     *         The values in this object will be used to generate the ``apiUrl``\n     *         and ``editURL`` properties.\n     *\n     * Option Args:\n     *     baseURL (string):\n     *         The base API URL for the object.\n     *\n     *     baseEditURL (string):\n     *         The base URL for the edit view.\n     *\n     * Returns:\n     *     object:\n     *     An object containing the properties of an OAuthAppItem.\n     */\n    parse(rsp, options) {\n        const {baseEditURL, baseURL} = options;\n        const {localSiteName} = rsp;\n\n        return _.defaults(rsp, {\n            apiURL: (localSiteName\n                     ? `/s/${localSiteName}${baseURL}${rsp.id}/`\n                     : `${baseURL}${rsp.id}/`),\n            editURL: `${baseEditURL}/${rsp.id}/`,\n        });\n    },\n});\n\n\n/**\n * A view corresponding to a single OAuth2 application.\n */\nconst OAuthAppItemView = Djblets.Config.ListItemView.extend({\n    template: _.template(dedent`\n        <div class=\"app-entry-wrapper\">\n         <span class=\"config-app-name<% if (!enabled) {%> disabled<% } %>\">\n          <% if (isDisabledForSecurity) { %>\n            <span class=\"rb-icon rb-icon-warning\"\n                  title=\"${disabledForSecurityText}\"></span>\n          <% } %>\n          <a href=\"<%- editURL %>\"><%- name %></a>\n         </span>\n         <% if (isDisabledForSecurity) { %>\n           <p class=\"disabled-warning\"><%- disabledWarning %></p>\n          <% } %>\n         </div>\n    `),\n\n    actionHandlers: {\n        'delete': '_onDeleteClicked',\n    },\n\n    /**\n     * Return additional rendering context.\n     *\n     * Returns:\n     *     object:\n     *     Additional rendering context.\n     */\n    getRenderContext() {\n        return {\n            disabledWarning: interpolate(disabledWarningTemplate,\n                                         [this.model.get('originalUser')])\n        };\n    },\n\n    /**\n     * Delete the OAuth2 application.\n     */\n    _onDeleteClicked() {\n        RB.apiCall({\n            url: this.model.get('apiURL'),\n            method: 'DELETE',\n            success: () => this.model.trigger('destroy'),\n        });\n    },\n});\n\n\n/**\n * A view for managing the user's OAuth2 applications.\n */\nRB.OAuthApplicationsView = Backbone.View.extend({\n    template: _.template(dedent`\n        <div class=\"app-lists\"></div>\n        <div class=\"oauth-form-buttons djblets-l-config-forms-container\">\n         <a class=\"btn oauth-add-app\" href=\"<%- editURL %>\">\n          ${addApplicationText}\n         </a>\n        </div>\n    `),\n\n    listTemplate: _.template(dedent`\n        <div>\n         <% if (localSiteName) { %>\n          <div class=\"djblets-l-config-forms-container\">\n           <h2><%- localSiteName %></h2>\n          </div>\n         <% } %>\n         <div class=\"app-list\">\n          <div class=\"djblets-l-config-forms-container\">\n           <%- emptyText %>\n          </div>\n         </div>\n        </div>\n    `),\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         View options.\n     *\n     * Option Args:\n     *     apps (array):\n     *         The array of serialized application information.\n     *\n     *     addText (string):\n     *         The localized text for adding an option.\n     *\n     *     editURL (string):\n     *         The URL of the \"edit-oauth-app\" view.\n     *\n     *     emptyText (string):\n     *         The localized text for indicating there are no applications.\n     */\n    initialize(options) {\n        this.collections = new Map(\n            Object.entries(options.apps)\n                .map(([localSiteName, apps]) => ([\n                    localSiteName || null,\n                    new Backbone.Collection(apps, {\n                        model: OAuthAppItem,\n                        parse: true,\n                        baseEditURL: options.editURL,\n                        baseURL: options.baseURL,\n                     }),\n                ]))\n        );\n\n        this._editURL = options.editURL;\n\n        window.view = this;\n    },\n\n    /**\n     * Render an application list for the given LocalSite.\n     *\n     * Args:\n     *     localSiteName (string):\n     *         The name of the LocalSite or ``null``.\n     *\n     *     collection (Backbone.Collection):\n     *         The collection of models.\n     *\n     * Returns:\n     *     jQuery:\n     *     The rendered list.\n     */\n    _renderAppList(localSiteName, collection) {\n        const $entry = $(this.listTemplate({\n            emptyText: (localSiteName\n                        ? interpolate(localSiteEmptyText, [localSiteName])\n                        : emptyText),\n            localSiteName,\n        }));\n\n        const listView = new Djblets.Config.ListView({\n            ItemView: OAuthAppItemView,\n            model: new Djblets.Config.List({}, {collection}),\n        });\n\n        listView\n            .render().$el\n            .prependTo($entry.find('.app-list'));\n\n        return $entry;\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.OAuthApplicationsView:\n     *     This view.\n     */\n    render() {\n        this.$el.html(this.template({\n            editURL: this._editURL,\n        }));\n\n        const $lists = this.$('.app-lists');\n\n        this.collections.forEach((collection, localSiteName) => {\n            const $entry = this._renderAppList(localSiteName, collection);\n\n            if (localSiteName) {\n                $lists.append($entry);\n            } else {\n                $lists.prepend($entry);\n            }\n        });\n\n        return this;\n    },\n});\n\n\n})();\n"],"mappings":"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","ignoreList":[]}