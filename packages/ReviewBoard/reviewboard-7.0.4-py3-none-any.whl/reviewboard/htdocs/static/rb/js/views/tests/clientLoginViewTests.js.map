{"version":3,"file":"clientLoginViewTests.js","names":["suite","view","pageTemplate","beforeEach","RB","ClientLoginView","el","$","clientName","clientURL","payload","api_token","redirectTo","username","describe","it","spyOn","window","and","throwError","render","expect","text","toBe","join","response","Response","JSON","stringify","status","resolveTo","setInterval","toHaveBeenCalled","_$counter","_redirectCounter","_redirectCountdown","navigateTo","toHaveBeenCalledWith"],"sources":["../../../../../../static/rb/js/views/tests/clientLoginViewTests.es6.js"],"sourcesContent":["suite('rb/views/ClientLoginView', function() {\n    let view;\n    const pageTemplate = dedent`\n        <div id=\"auth_container\">\n         <div class=\"auth-header\">\n         </div>\n        </div>\n    `;\n\n    beforeEach(function() {\n        view = new RB.ClientLoginView({\n            el: $(pageTemplate),\n            clientName: 'Client',\n            clientURL: 'http%3A//localhost%3A1234',\n            payload: {\n                api_token: 'token',\n            },\n            redirectTo: '',\n            username: 'User',\n        });\n    });\n\n    describe('Rendering', function() {\n        it('With failing to connect to the client server', async function() {\n            spyOn(window, 'fetch').and.throwError('Test Error');\n            await view.render();\n\n            expect(view.$('h1').text()).toBe('Failed to log in for Client');\n            expect(view.$('p').text()).toBe([\n                'Could not connect to Client. Please contact your ',\n                'administrator.'\n            ].join(''));\n            expect(view.$('#redirect-counter').text()).toBe('');\n\n        });\n\n        it('With successfully sending data to the client', async function() {\n            const response = new Response(JSON.stringify({}), { status: 200 });\n            spyOn(window, 'fetch').and.resolveTo(response);\n            await view.render();\n\n            expect(view.$('h1').text()).toBe('Logged in to Client');\n            expect(view.$('p').text()).toBe([\n                'You have successfully logged in to Client as User. ',\n                'You can now close this page.'\n            ].join(''));\n            expect(view.$('#redirect-counter').text()).toBe('');\n        });\n\n        it('With sending data to the client and a redirect', async function() {\n            view = new RB.ClientLoginView({\n                el: $(pageTemplate),\n                clientName: 'Client',\n                clientURL: 'http%3A//localhost%3A1234',\n                payload: {\n                    api_token: 'token',\n                },\n                redirectTo: 'http%3A//localhost%3A1234/test/',\n                username: 'User',\n            });\n            const response = new Response(JSON.stringify({}), { status: 200 });\n            spyOn(window, 'fetch').and.resolveTo(response);\n            spyOn(window, 'setInterval');\n            await view.render();\n\n            expect(view.$('h1').text()).toBe('Logged in to Client');\n            expect(view.$('p').text()).toBe([\n                'You have successfully logged in to Client as User. ',\n                'Redirecting in 3...'\n            ].join(''));\n            expect(view.$('#redirect-counter').text()).toBe(' 3...');\n            expect(setInterval).toHaveBeenCalled();\n        });\n\n        it('With failing to send data to the client', async function() {\n            const response = new Response(JSON.stringify({}), { status: 400 });\n            spyOn(window, 'fetch').and.resolveTo(response);\n            await view.render();\n\n            expect(view.$('h1').text())\n                .toBe('Failed to log in for Client');\n            expect(view.$('p').text()).toBe([\n                'Failed to log in for Client as User. Please contact ',\n                'your administrator.'\n            ].join(''));\n            expect(view.$('#redirect-counter').text()).toBe('');\n        });\n    });\n\n    describe('_redirectCountDown', function() {\n        beforeEach(function() {\n            view = new RB.ClientLoginView({\n                el: $(`<div><span id=\"redirect-counter\"></span></div>`),\n                clientName: 'Client',\n                clientURL: 'http%3A//localhost%3A1234',\n                payload: {\n                    api_token: 'token',\n                },\n                redirectTo: 'http%3A//localhost%3A1234/test/',\n                username: 'User',\n            });\n        });\n\n        it('With a counter greater than 1', function() {\n            view._$counter = view.$('#redirect-counter');\n\n            expect(view._redirectCounter).toBe(3);\n\n            view._redirectCountdown();\n\n            expect(view._redirectCounter).toBe(2);\n            expect(view._$counter.text()).toBe(' 2...');\n        });\n\n        it('With a counter at 1', function() {\n            view._$counter = view.$('#redirect-counter');\n            view._redirectCounter = 1;\n            spyOn(RB, 'navigateTo');\n            spyOn(window, 'clearInterval');\n\n            view._redirectCountdown();\n\n            expect(view._redirectCounter).toBe(0);\n            expect(view._$counter.text()).toBe(' 0...');\n            expect(RB.navigateTo).toHaveBeenCalledWith(\n                'http://localhost:1234/test/'\n            );\n        });\n    });\n});\n"],"mappings":"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","ignoreList":[]}