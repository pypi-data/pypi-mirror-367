# -------------------- build-system --------------------- #
[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

# -------------------- project-config -------------------- #
[project]
name = "cctp"
version = "1.2.4"
description = "Cookiecutter Template for Python."
readme = "README.rst"
authors = [{name = "gooker_young", email = "gooker_young@qq.com"}]
maintainers = [{name = "gooker_young", email = "gooker_young@qq.com"}]
requires-python = ">=3.8"
dependencies = [
  "rich>=13.9.4",
  "typer>=0.15.1",
]
classifiers = []
license = {text = "MIT license"}

[project.scripts]
cctp = "cctp.cli:app"

[project.urls]
Repository = "https://gitee.com/gooker_young/cctp"
Documentation = "https://cctp.readthedocs.io/zh-cn/stable/"
Issues = "https://gitee.com/gooker_young/cctp/issues"

# ---------------------- coverage ----------------------- #
[tool.coverage]
[tool.coverage.report]
exclude_lines = ["coverage: ignore", "def main", "if __name__ == .__main__.:"]

[tool.coverage.run]
source = ["src/cctp"]
omit = ["*/tests/*", "*/examples/*"]

# -------------------- hatch-version -------------------- #
[tool.hatch]
[tool.hatch.version]
path = "src/cctp/__init__.py"

# ------------------------ mypy ------------------------- #
[tool.mypy]
files = "."
strict = true
pretty = true
show_error_codes = true
warn_unreachable = true
warn_no_return = true

[[tool.mypy.overrides]]
module = [
  "tests.*",
  "asgiref.*",
  "dotenv.*",
  "cryptography.*",
  "importlib_metadata"
]
allow_untyped_defs = true
disable_error_code = "attr-defined"
ignore_missing_imports = true

# ----------------------- pytest ------------------------ #
[tool.pytest]
[tool.pytest.ini_options]
testpaths = ["tests"]
filterwarnings = ["error"]
markers = [
   "slow: marks tests as slow (deselect with '-m \"not slow\"')",
]

# ------------------------ ruff ------------------------- #
[tool.ruff]
line-length = 80
fix = true
unsafe-fixes = true
show-fixes = true
output-format = "full"
exclude = ["**/ui_*.py", "**/*_rc.py", "docs/*.py"]
target-version = "py38"
preview = true

[tool.ruff.lint]
select = [
  "A",      # flake8-builtins
  "ANN",    # flake8-annotations
  "ARG",    # flake8-arguments
  "ASYNC",  # flake8-async
  "B",      # flake8-bugbear
  "BLE",    # flake8-blind-except
  "C",      # flake8-comprehensions
  "C4",     # flake8-comprehensions
  "COM",    # flake8-commas
  #"CPY",    # flake8-copyright
  "DJ",     # flake8-django
  "DTZ",    # flake8-datetimez
  "EM",     # flake8-errmsg
  "EXE",    # flake8-executable
  "FA",     # flake8-future-annotations
  "FBT",    # flake8-boolean-trap
  "FIX",    # flake8-fixme
  #"G",      # flake8-logging-format
  "ICN",    # flake8-import-conventions
  "INT",    # flake8-gettext
  "INP",    # flake8-no-pep420
  "ISC",    # flake8-implicit-str-concat
  "LOG",    # flake8-logging
  "PIE",    # flake8-pie
  "PT",     # flake8-pytest-style
  "PTH",    # flake8-use-pathlib
  "PYI",    # flake8-pyi
  "Q",      # flake8-quotes
  "RET",    # flake8-return
  "RSE",    # flake8-raise
  #"S",      # flake8-bandit
  "SIM",    # flake8-simplify
  "SLF",    # flake8-self
  "SLOT",   # flake8-slots
  "T10",    # flake8-debugger
  "T20",    # flake8-print
  "TC",     # flake8-type-checking
  "TD",     # flake8-todo
  "TID",    # flake8-tidy-imports
  "YTT",    # flake8-2020

  "AIR",    # Airflow
  "C90",    # mccabe
  "D",      # pydocstyle (文档字符串)
  "DOC",    # docstrings
  "E",      # Pycodestyle 错误
  "ERA",    # Eradicate
  "F",      # Pyflakes
  "FAST",   # FastAPI
  "FLY",    # flynt
  "FURB",   # refurb
  "I",      # isort (导入排序)
  "N",      # pep8-naming
  "NPY",    # numpy-specific
  "PD",     # pandas-set
  "PERF",   # perflint
  "PGH",    # pygrep-hooks
  "PL",     # Pylint
  "RUF",    # Ruff 特有规则
  "TRY",    # tryceratops
  "UP",     # pyupgrade (现代化语法)
  "W",      # Pycodestyle 警告
]

# 忽略的规则
ignore = [
  "D100",
  "D103",
  "D104",
  "D107",
  "D203", # D 规则中与 Black 冲突的部分
  "N802",
  "PGH003", # 支持`type ignore`
  "PLR0915",
]

# 格式化配置 (Ruff 的格式化器)
[tool.ruff.format]
quote-style = "double"
docstring-code-format = true
docstring-code-line-length = "dynamic"

# 导入排序配置
[tool.ruff.lint.isort]
force-single-line = true
order-by-type = false

[tool.ruff.lint.pydocstyle]
convention = "google"  # 可选: "pep257", "numpy", "google"

# ----------------------- uv-dependencies ------------------------ #
[tool.uv]
default-groups = "all"

[dependency-groups]
build = ["hatch>=1.14.1", "pip>=25.0.1", "wheel>=0.45.1"]
dev = [
  "pre-commit>=3.5.0",
  "pycmd2",
  { include-group = "build" },
  { include-group = "doc" },
  { include-group = "lint" },
  { include-group = "test" },
]
doc = ["sphinx-autobuild>=2021.3.14", "sphinx-rtd-theme>=3.0.2"]
lint = ["ruff>=0.12.7"]
test = [
  "pillow>=10.4.0",
  "pypdf>=5.9.0",
  "pyside2>=5.15.2.1",
  "pytest-benchmark>=4.0.0",
  "pytest-cov>=5.0.0",
  "pytest-html>=4.1.1",
  "pytest-mock>=3.14.1",
  "pytest-xdist>=3.6.1",
  "pytest>=8.3.4",
  "reportlab>=4.4.3",
  "tox-uv>=1.13.1",
  "tox>=4.25.0",
]

[tool.uv.sources]
cctp = {workspace = true}
