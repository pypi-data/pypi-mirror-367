$(document).ready(()=>{const n=$("select#id_announcement_target"),s=$("select#id_announcement_channel"),t=$('input[name="csrfmiddlewaretoken"]'),o=$('textarea[name="announcement_text"]'),a=$("#aa-discord-announcements-form"),e=async e=>{const n=await fetch(e);if(n.ok)return n.text();{const s=`Error ${n.status}: ${n.statusText}`;throw new Error(s)}},r=()=>{e(discordAnnouncementsSettings.url.getAnnouncementTargets).then(e=>{""!==e&&$(n).html(e)}).catch(e=>{console.error("Error fetching announcement targets:",e)})},c=()=>{e(discordAnnouncementsSettings.url.getAnnouncementWebhooks).then(e=>{""!==e&&$(s).html(e)}).catch(e=>{console.error("Error fetching announcement webhooks:",e)})},i=(e,n=10)=>{$(e).fadeTo(1e3*n,500).slideUp(500,()=>{$(e).remove()})},m=(e,n)=>{$(n).html(`<div class="alert alert-success alert-dismissible alert-message-success d-flex align-items-center fade show">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),i(".alert-message-success")},d=(e,n)=>{$(n).html(`<div class="alert alert-danger alert-dismissible alert-message-error d-flex align-items-center fade show">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),i(".alert-message-error",9999)},l=()=>{const n=new ClipboardJS("button#copyDiscordAnnouncement");n.on("success",e=>{m(discordAnnouncementsTranslations.copyToClipboard.success,".aa-discord-announcements-announcement-copyresult"),e.clearSelection(),n.destroy()}),n.on("error",()=>{d(discordAnnouncementsTranslations.copyToClipboard.error,".aa-discord-announcements-announcement-copyresult"),n.destroy()})};a.submit(e=>{e.preventDefault(),$(".aa-discord-announcements-form-message div").remove();const n=[o.val()];if(n.includes(""))return d(discordAnnouncementsTranslations.error.missingFields,".aa-discord-announcements-form-message"),!1;const s=a.serializeArray().reduce((e,n)=>(e[n.name]=n.value,e),{});fetch(discordAnnouncementsSettings.url.createAnnouncement,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t.val()},body:JSON.stringify(s)}).then(e=>e.json()).then(e=>{!0===e.success?($(".aa-discord-announcements-no-announcement").hide("fast"),$(".aa-discord-announcements-announcement").show("fast"),$(".aa-discord-announcements-announcement-text").html(e.announcement_context),e.message&&m(e.message,".aa-discord-announcements-form-message")):e.message?d(e.message,".aa-discord-announcements-form-message"):d("Something went wrong, no details given.",".aa-discord-announcements-form-message")}).catch(()=>{d("Something went wrong, no details given.",".aa-discord-announcements-form-message")})}),$("button#copyDiscordAnnouncement").on("click",()=>{l()}),r(),c()});
//# sourceMappingURL=aa-discord-announcements.min.js.map