#!/bin/bash

COURSE="$1"
ASSIGNMENT="$2"
shift 2

results=$(mktemp)
canvaslms submissions -c $COURSE -a "$ASSIGNMENT" $@ | cut -f 4- > $results

function get_results() {
  cat $results
}

function print_stats() {
  total=$(get_results | wc -l)
  echo "Total:     $total (100%)"
  As=$(get_results | grep ^A | wc -l)
  echo "As:        $As ($(((100 * $As / $total)))%)"
  Bs=$(get_results | grep ^B | wc -l)
  echo "Bs:        $Bs ($(((100 * $Bs / $total)))%)"
  Cs=$(get_results | grep ^C | wc -l)
  echo "Cs:        $Cs ($(((100 * $Cs / $total)))%)"
  Ds=$(get_results | grep ^D | wc -l)
  echo "Ds:        $Ds ($(((100 * $Ds / $total)))%)"
  Es=$(get_results | grep ^E | wc -l)
  echo "Es:        $Es ($(((100 * $Es / $total)))%)"
  Fs=$(get_results | grep ^F | wc -l)
  echo "Fs:        $Fs ($(((100 * $Fs / $total)))%)"
  remaining=$(get_results | egrep "^[^A-F].*[0-9]{4}-[0-9]{2}-[0-9]{2}" | wc -l)
  echo "Remaining: $remaining ($(((100 * $remaining / $total)))%)"
  nothing=$(get_results | grep "^[^a-fA-F0-9]*$" | wc -l)
  echo "Nothing:   $nothing ($(((100 * $nothing / $total)))%)"
}

print_stats
