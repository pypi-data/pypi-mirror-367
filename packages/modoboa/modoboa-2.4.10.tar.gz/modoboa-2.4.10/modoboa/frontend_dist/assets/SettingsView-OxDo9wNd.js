import{_ as Ke,b as j,n as se,u as ce,h as J,g as _,d as pe,L as _e,c as O,o as P,w as c,a as u,l as S,t as g,f as m,p as me,e as k,an as Ce,ao as H,a5 as Ue,F as B,v as Ge,x as Ye,T as We,y as Je,Y as Xe,ad as re,a6 as Ze,am as je,a7 as et,B as Re,Z as tt,J as at,ap as Pe,m as D,q as W,G as xe,ak as G,S as ot,aq as nt,k as rt,i as Me}from"./index-DV9Li2cg.js";import{_ as lt}from"./AccountPasswordSubForm-g3IEGrgM.js";import{V as ae,r as oe}from"./VForm-CpoZf60D.js";import{V as Ne,c as Fe,a as Te,b as st}from"./VExpansionPanels-B5D6GOa3.js";import{V as K,u as it,c as ut,d as dt,e as ct}from"./VTextField-CLwRV0Cb.js";import{V as ft}from"./VAutocomplete-Cc4_tcl1.js";import{V as Q,d as be}from"./VAvatar-BAgTUIvX.js";import{c as ge,V as X,b as Z,a as Ee}from"./VCard-DFWiFORP.js";import{V as ve,a as de}from"./VRow-C_Ydf6yr.js";import{V as ee}from"./VAlert-B7mzOJIO.js";import{a as vt}from"./VMenu-B_dVqOmo.js";import{V as mt}from"./VProgressCircular-CrEXxs7k.js";import{b as ht,u as pt,c as gt}from"./tag-CFK9dzMJ.js";import{V as De}from"./VTable-KsiZ3cBz.js";import{V as yt}from"./VSpacer-C6PZ3X24.js";import{V as $e}from"./VDialog-CZqM2Ofu.js";import{V as Oe}from"./VTextarea-Di8jbl8m.js";import{V as Le}from"./VCheckbox-CKsH_vq3.js";import{_ as we}from"./ConfirmDialog-BvqxQsD1.js";import{V as _t}from"./VDataTableVirtual-BwVmkt4u.js";import{V as bt,a as wt}from"./VToolbar-CGwhgdmI.js";import{V as Ct,a as Et,b as ie,c as ue}from"./VTabs-tNrJIYO0.js";import"./VSwitch-Chg5o-Cp.js";import"./VSelectionControl-DiOqtY38.js";import"./forwardRefs-Cpc3YYl6.js";import"./ssrBoot-BsxW6uW4.js";import"./VSelect-CS51PDEt.js";import"./VCheckboxBtn-j7di4leN.js";import"./VChip-nZ0uhY7t.js";import"./filter-D7NrAf6a.js";/* empty css              */import"./VDataTable-D_0_xJTl.js";import"./VWindowItem-wWSFAGI-.js";const kt="languages",At={getAll(){return Ke.get(`/${kt}/`)}},Vt={class:"m-label"},St={class:"m-label"},Rt={class:"m-label"},Pt={class:"text-disabled"},Mt={href:"https://explore.transifex.com/tonio/modoboa/",target:"_blank"},Nt={href:"https://github.com/modoboa/modoboa/issues/new/choose",target:"_blank"},Ft={class:"m-label"},Tt={class:"m-label"},It={__name:"ProfileForm",setup(n){const{$gettext:l,available:i}=j(),s=se(),f=ce(),h=J(()=>f.authUser),o=_({}),e=_(),t=_(),a=_({}),r=_([]),d=_(0),v=_(!1),p=_(!1),w=_("");function A(R){o.value={first_name:R.first_name,last_name:R.last_name,language:R.language,phone_number:R.phone_number,secondary_email:R.secondary_email}}async function N(){const{valid:R}=await e.value.validate();R&&(v.value=!0,f.updateAccount(o.value).then(()=>{s.displayNotification({msg:l("Profile updated")}),f.accountLanguage in i||(w.value=l("Language does no exist"))}).finally(()=>v.value=!1))}async function F(){const{valid:R}=await t.value.validate();if(R){p.value=!0;try{await f.updatePassword({password:o.value.password,new_password:o.value.new_password}),s.displayNotification({msg:l("Password updated")}),t.value.reset()}catch(C){C.status===400&&(a.value=C.response.data)}finally{p.value=!1}}}return pe(()=>{A(h.value),At.getAll().then(R=>{r.value=R.data})}),_e(()=>h,R=>{R?A(R):o.value={}}),(R,C)=>(P(),O(st,{modelValue:d.value,"onUpdate:modelValue":C[6]||(C[6]=y=>d.value=y),flat:""},{default:c(()=>[u(Ne,null,{default:c(()=>[u(Fe,null,{default:c(()=>[S(g(m(l)("General settings")),1)]),_:1}),u(Te,null,{default:c(()=>[u(ae,{ref_key:"profileForm",ref:e,onSubmit:me(N,["prevent"])},{default:c(()=>[k("label",Vt,g(m(l)("First name")),1),u(K,{modelValue:o.value.first_name,"onUpdate:modelValue":C[0]||(C[0]=y=>o.value.first_name=y),variant:"outlined",density:"compact"},null,8,["modelValue"]),k("label",St,g(m(l)("Last name")),1),u(K,{modelValue:o.value.last_name,"onUpdate:modelValue":C[1]||(C[1]=y=>o.value.last_name=y),variant:"outlined",density:"compact"},null,8,["modelValue"]),k("label",Rt,[S(g(m(l)("Language"))+" ",1),k("p",Pt,[S(g(m(l)("Feel free to improve the translations"))+" ",1),k("a",Mt,g(m(l)("here")),1),S(" "+g(m(l)("or suggest a new language"))+" ",1),k("a",Nt,g(m(l)("there")),1)])]),u(ft,{modelValue:o.value.language,"onUpdate:modelValue":C[2]||(C[2]=y=>o.value.language=y),items:r.value,"item-title":"label","item-value":"code",variant:"outlined",density:"compact","error-messages":w.value},null,8,["modelValue","items","error-messages"]),k("label",Ft,g(m(l)("Phone number")),1),u(K,{modelValue:o.value.phone_number,"onUpdate:modelValue":C[3]||(C[3]=y=>o.value.phone_number=y),label:m(l)("Phone number"),variant:"outlined",density:"compact"},null,8,["modelValue","label"]),k("label",Tt,g(m(l)("Secondary email")),1),u(K,{modelValue:o.value.secondary_email,"onUpdate:modelValue":C[4]||(C[4]=y=>o.value.secondary_email=y),variant:"outlined",density:"compact",rules:[m(oe).emailOrNull]},null,8,["modelValue","rules"]),u(Q,{color:"success",type:"submit",loading:v.value},{default:c(()=>[S(g(m(l)("Update settings")),1)]),_:1},8,["loading"])]),_:1},512)]),_:1})]),_:1}),u(Ne,null,{default:c(()=>[u(Fe,null,{default:c(()=>[S(g(m(l)("Password")),1)]),_:1}),u(Te,null,{default:c(()=>[u(ae,{ref_key:"passwordForm",ref:t,onSubmit:me(F,["prevent"])},{default:c(()=>[u(lt,{modelValue:o.value,"onUpdate:modelValue":C[5]||(C[5]=y=>o.value=y),"form-errors":a.value,"with-password-check":""},null,8,["modelValue","form-errors"]),u(Q,{color:"success",type:"submit",loading:p.value},{default:c(()=>[S(g(m(l)("Update Password")),1)]),_:1},8,["loading"])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};/*!
 * qrcode.vue v3.6.0
 * A Vue.js component to generate QRCode. Both support Vue 2 and Vue 3
 * Â© 2017-PRESENT @scopewu(https://github.com/scopewu)
 * MIT License.
 */var Y=function(){return Y=Object.assign||function(l){for(var i,s=1,f=arguments.length;s<f;s++){i=arguments[s];for(var h in i)Object.prototype.hasOwnProperty.call(i,h)&&(l[h]=i[h])}return l},Y.apply(this,arguments)};var ne;(function(n){var l=function(){function o(e,t,a,r){if(this.version=e,this.errorCorrectionLevel=t,this.modules=[],this.isFunction=[],e<o.MIN_VERSION||e>o.MAX_VERSION)throw new RangeError("Version value out of range");if(r<-1||r>7)throw new RangeError("Mask value out of range");this.size=e*4+17;for(var d=[],v=0;v<this.size;v++)d.push(!1);for(var v=0;v<this.size;v++)this.modules.push(d.slice()),this.isFunction.push(d.slice());this.drawFunctionPatterns();var p=this.addEccAndInterleave(a);if(this.drawCodewords(p),r==-1)for(var w=1e9,v=0;v<8;v++){this.applyMask(v),this.drawFormatBits(v);var A=this.getPenaltyScore();A<w&&(r=v,w=A),this.applyMask(v)}f(0<=r&&r<=7),this.mask=r,this.applyMask(r),this.drawFormatBits(r),this.isFunction=[]}return o.encodeText=function(e,t){var a=n.QrSegment.makeSegments(e);return o.encodeSegments(a,t)},o.encodeBinary=function(e,t){var a=n.QrSegment.makeBytes(e);return o.encodeSegments([a],t)},o.encodeSegments=function(e,t,a,r,d,v){if(a===void 0&&(a=1),r===void 0&&(r=40),d===void 0&&(d=-1),v===void 0&&(v=!0),!(o.MIN_VERSION<=a&&a<=r&&r<=o.MAX_VERSION)||d<-1||d>7)throw new RangeError("Invalid value");var p,w;for(p=a;;p++){var A=o.getNumDataCodewords(p,t)*8,N=h.getTotalBits(e,p);if(N<=A){w=N;break}if(p>=r)throw new RangeError("Data too long")}for(var F=0,R=[o.Ecc.MEDIUM,o.Ecc.QUARTILE,o.Ecc.HIGH];F<R.length;F++){var C=R[F];v&&w<=o.getNumDataCodewords(p,C)*8&&(t=C)}for(var y=[],b=0,V=e;b<V.length;b++){var T=V[b];i(T.mode.modeBits,4,y),i(T.numChars,T.mode.numCharCountBits(p),y);for(var E=0,M=T.getData();E<M.length;E++){var $=M[E];y.push($)}}f(y.length==w);var x=o.getNumDataCodewords(p,t)*8;f(y.length<=x),i(0,Math.min(4,x-y.length),y),i(0,(8-y.length%8)%8,y),f(y.length%8==0);for(var I=236;y.length<x;I^=253)i(I,8,y);for(var q=[];q.length*8<y.length;)q.push(0);return y.forEach(function(ye,fe){return q[fe>>>3]|=ye<<7-(fe&7)}),new o(p,t,q,d)},o.prototype.getModule=function(e,t){return 0<=e&&e<this.size&&0<=t&&t<this.size&&this.modules[t][e]},o.prototype.getModules=function(){return this.modules},o.prototype.drawFunctionPatterns=function(){for(var e=0;e<this.size;e++)this.setFunctionModule(6,e,e%2==0),this.setFunctionModule(e,6,e%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);for(var t=this.getAlignmentPatternPositions(),a=t.length,e=0;e<a;e++)for(var r=0;r<a;r++)e==0&&r==0||e==0&&r==a-1||e==a-1&&r==0||this.drawAlignmentPattern(t[e],t[r]);this.drawFormatBits(0),this.drawVersion()},o.prototype.drawFormatBits=function(e){for(var t=this.errorCorrectionLevel.formatBits<<3|e,a=t,r=0;r<10;r++)a=a<<1^(a>>>9)*1335;var d=(t<<10|a)^21522;f(d>>>15==0);for(var r=0;r<=5;r++)this.setFunctionModule(8,r,s(d,r));this.setFunctionModule(8,7,s(d,6)),this.setFunctionModule(8,8,s(d,7)),this.setFunctionModule(7,8,s(d,8));for(var r=9;r<15;r++)this.setFunctionModule(14-r,8,s(d,r));for(var r=0;r<8;r++)this.setFunctionModule(this.size-1-r,8,s(d,r));for(var r=8;r<15;r++)this.setFunctionModule(8,this.size-15+r,s(d,r));this.setFunctionModule(8,this.size-8,!0)},o.prototype.drawVersion=function(){if(!(this.version<7)){for(var e=this.version,t=0;t<12;t++)e=e<<1^(e>>>11)*7973;var a=this.version<<12|e;f(a>>>18==0);for(var t=0;t<18;t++){var r=s(a,t),d=this.size-11+t%3,v=Math.floor(t/3);this.setFunctionModule(d,v,r),this.setFunctionModule(v,d,r)}}},o.prototype.drawFinderPattern=function(e,t){for(var a=-4;a<=4;a++)for(var r=-4;r<=4;r++){var d=Math.max(Math.abs(r),Math.abs(a)),v=e+r,p=t+a;0<=v&&v<this.size&&0<=p&&p<this.size&&this.setFunctionModule(v,p,d!=2&&d!=4)}},o.prototype.drawAlignmentPattern=function(e,t){for(var a=-2;a<=2;a++)for(var r=-2;r<=2;r++)this.setFunctionModule(e+r,t+a,Math.max(Math.abs(r),Math.abs(a))!=1)},o.prototype.setFunctionModule=function(e,t,a){this.modules[t][e]=a,this.isFunction[t][e]=!0},o.prototype.addEccAndInterleave=function(e){var t=this.version,a=this.errorCorrectionLevel;if(e.length!=o.getNumDataCodewords(t,a))throw new RangeError("Invalid argument");for(var r=o.NUM_ERROR_CORRECTION_BLOCKS[a.ordinal][t],d=o.ECC_CODEWORDS_PER_BLOCK[a.ordinal][t],v=Math.floor(o.getNumRawDataModules(t)/8),p=r-v%r,w=Math.floor(v/r),A=[],N=o.reedSolomonComputeDivisor(d),F=0,R=0;F<r;F++){var C=e.slice(R,R+w-d+(F<p?0:1));R+=C.length;var y=o.reedSolomonComputeRemainder(C,N);F<p&&C.push(0),A.push(C.concat(y))}for(var b=[],V=function(T){A.forEach(function(E,M){(T!=w-d||M>=p)&&b.push(E[T])})},F=0;F<A[0].length;F++)V(F);return f(b.length==v),b},o.prototype.drawCodewords=function(e){if(e.length!=Math.floor(o.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");for(var t=0,a=this.size-1;a>=1;a-=2){a==6&&(a=5);for(var r=0;r<this.size;r++)for(var d=0;d<2;d++){var v=a-d,p=(a+1&2)==0,w=p?this.size-1-r:r;!this.isFunction[w][v]&&t<e.length*8&&(this.modules[w][v]=s(e[t>>>3],7-(t&7)),t++)}}f(t==e.length*8)},o.prototype.applyMask=function(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(var t=0;t<this.size;t++)for(var a=0;a<this.size;a++){var r=void 0;switch(e){case 0:r=(a+t)%2==0;break;case 1:r=t%2==0;break;case 2:r=a%3==0;break;case 3:r=(a+t)%3==0;break;case 4:r=(Math.floor(a/3)+Math.floor(t/2))%2==0;break;case 5:r=a*t%2+a*t%3==0;break;case 6:r=(a*t%2+a*t%3)%2==0;break;case 7:r=((a+t)%2+a*t%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[t][a]&&r&&(this.modules[t][a]=!this.modules[t][a])}},o.prototype.getPenaltyScore=function(){for(var e=0,t=0;t<this.size;t++){for(var a=!1,r=0,d=[0,0,0,0,0,0,0],v=0;v<this.size;v++)this.modules[t][v]==a?(r++,r==5?e+=o.PENALTY_N1:r>5&&e++):(this.finderPenaltyAddHistory(r,d),a||(e+=this.finderPenaltyCountPatterns(d)*o.PENALTY_N3),a=this.modules[t][v],r=1);e+=this.finderPenaltyTerminateAndCount(a,r,d)*o.PENALTY_N3}for(var v=0;v<this.size;v++){for(var a=!1,p=0,d=[0,0,0,0,0,0,0],t=0;t<this.size;t++)this.modules[t][v]==a?(p++,p==5?e+=o.PENALTY_N1:p>5&&e++):(this.finderPenaltyAddHistory(p,d),a||(e+=this.finderPenaltyCountPatterns(d)*o.PENALTY_N3),a=this.modules[t][v],p=1);e+=this.finderPenaltyTerminateAndCount(a,p,d)*o.PENALTY_N3}for(var t=0;t<this.size-1;t++)for(var v=0;v<this.size-1;v++){var w=this.modules[t][v];w==this.modules[t][v+1]&&w==this.modules[t+1][v]&&w==this.modules[t+1][v+1]&&(e+=o.PENALTY_N2)}for(var A=0,N=0,F=this.modules;N<F.length;N++){var R=F[N];A=R.reduce(function(b,V){return b+(V?1:0)},A)}var C=this.size*this.size,y=Math.ceil(Math.abs(A*20-C*10)/C)-1;return f(0<=y&&y<=9),e+=y*o.PENALTY_N4,f(0<=e&&e<=2568888),e},o.prototype.getAlignmentPatternPositions=function(){if(this.version==1)return[];for(var e=Math.floor(this.version/7)+2,t=Math.floor((this.version*8+e*3+5)/(e*4-4))*2,a=[6],r=this.size-7;a.length<e;r-=t)a.splice(1,0,r);return a},o.getNumRawDataModules=function(e){if(e<o.MIN_VERSION||e>o.MAX_VERSION)throw new RangeError("Version number out of range");var t=(16*e+128)*e+64;if(e>=2){var a=Math.floor(e/7)+2;t-=(25*a-10)*a-55,e>=7&&(t-=36)}return f(208<=t&&t<=29648),t},o.getNumDataCodewords=function(e,t){return Math.floor(o.getNumRawDataModules(e)/8)-o.ECC_CODEWORDS_PER_BLOCK[t.ordinal][e]*o.NUM_ERROR_CORRECTION_BLOCKS[t.ordinal][e]},o.reedSolomonComputeDivisor=function(e){if(e<1||e>255)throw new RangeError("Degree out of range");for(var t=[],a=0;a<e-1;a++)t.push(0);t.push(1);for(var r=1,a=0;a<e;a++){for(var d=0;d<t.length;d++)t[d]=o.reedSolomonMultiply(t[d],r),d+1<t.length&&(t[d]^=t[d+1]);r=o.reedSolomonMultiply(r,2)}return t},o.reedSolomonComputeRemainder=function(e,t){for(var a=t.map(function(w){return 0}),r=function(w){var A=w^a.shift();a.push(0),t.forEach(function(N,F){return a[F]^=o.reedSolomonMultiply(N,A)})},d=0,v=e;d<v.length;d++){var p=v[d];r(p)}return a},o.reedSolomonMultiply=function(e,t){if(e>>>8||t>>>8)throw new RangeError("Byte out of range");for(var a=0,r=7;r>=0;r--)a=a<<1^(a>>>7)*285,a^=(t>>>r&1)*e;return f(a>>>8==0),a},o.prototype.finderPenaltyCountPatterns=function(e){var t=e[1];f(t<=this.size*3);var a=t>0&&e[2]==t&&e[3]==t*3&&e[4]==t&&e[5]==t;return(a&&e[0]>=t*4&&e[6]>=t?1:0)+(a&&e[6]>=t*4&&e[0]>=t?1:0)},o.prototype.finderPenaltyTerminateAndCount=function(e,t,a){return e&&(this.finderPenaltyAddHistory(t,a),t=0),t+=this.size,this.finderPenaltyAddHistory(t,a),this.finderPenaltyCountPatterns(a)},o.prototype.finderPenaltyAddHistory=function(e,t){t[0]==0&&(e+=this.size),t.pop(),t.unshift(e)},o.MIN_VERSION=1,o.MAX_VERSION=40,o.PENALTY_N1=3,o.PENALTY_N2=3,o.PENALTY_N3=40,o.PENALTY_N4=10,o.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],o.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],o}();n.QrCode=l;function i(o,e,t){if(e<0||e>31||o>>>e)throw new RangeError("Value out of range");for(var a=e-1;a>=0;a--)t.push(o>>>a&1)}function s(o,e){return(o>>>e&1)!=0}function f(o){if(!o)throw new Error("Assertion error")}var h=function(){function o(e,t,a){if(this.mode=e,this.numChars=t,this.bitData=a,t<0)throw new RangeError("Invalid argument");this.bitData=a.slice()}return o.makeBytes=function(e){for(var t=[],a=0,r=e;a<r.length;a++){var d=r[a];i(d,8,t)}return new o(o.Mode.BYTE,e.length,t)},o.makeNumeric=function(e){if(!o.isNumeric(e))throw new RangeError("String contains non-numeric characters");for(var t=[],a=0;a<e.length;){var r=Math.min(e.length-a,3);i(parseInt(e.substring(a,a+r),10),r*3+1,t),a+=r}return new o(o.Mode.NUMERIC,e.length,t)},o.makeAlphanumeric=function(e){if(!o.isAlphanumeric(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");var t=[],a;for(a=0;a+2<=e.length;a+=2){var r=o.ALPHANUMERIC_CHARSET.indexOf(e.charAt(a))*45;r+=o.ALPHANUMERIC_CHARSET.indexOf(e.charAt(a+1)),i(r,11,t)}return a<e.length&&i(o.ALPHANUMERIC_CHARSET.indexOf(e.charAt(a)),6,t),new o(o.Mode.ALPHANUMERIC,e.length,t)},o.makeSegments=function(e){return e==""?[]:o.isNumeric(e)?[o.makeNumeric(e)]:o.isAlphanumeric(e)?[o.makeAlphanumeric(e)]:[o.makeBytes(o.toUtf8ByteArray(e))]},o.makeEci=function(e){var t=[];if(e<0)throw new RangeError("ECI assignment value out of range");if(e<128)i(e,8,t);else if(e<16384)i(2,2,t),i(e,14,t);else if(e<1e6)i(6,3,t),i(e,21,t);else throw new RangeError("ECI assignment value out of range");return new o(o.Mode.ECI,0,t)},o.isNumeric=function(e){return o.NUMERIC_REGEX.test(e)},o.isAlphanumeric=function(e){return o.ALPHANUMERIC_REGEX.test(e)},o.prototype.getData=function(){return this.bitData.slice()},o.getTotalBits=function(e,t){for(var a=0,r=0,d=e;r<d.length;r++){var v=d[r],p=v.mode.numCharCountBits(t);if(v.numChars>=1<<p)return 1/0;a+=4+p+v.bitData.length}return a},o.toUtf8ByteArray=function(e){e=encodeURI(e);for(var t=[],a=0;a<e.length;a++)e.charAt(a)!="%"?t.push(e.charCodeAt(a)):(t.push(parseInt(e.substring(a+1,a+3),16)),a+=2);return t},o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",o}();n.QrSegment=h})(ne||(ne={}));(function(n){(function(l){var i=function(){function s(f,h){this.ordinal=f,this.formatBits=h}return s.LOW=new s(0,1),s.MEDIUM=new s(1,0),s.QUARTILE=new s(2,3),s.HIGH=new s(3,2),s}();l.Ecc=i})(n.QrCode||(n.QrCode={}))})(ne||(ne={}));(function(n){(function(l){var i=function(){function s(f,h){this.modeBits=f,this.numBitsCharCount=h}return s.prototype.numCharCountBits=function(f){return this.numBitsCharCount[Math.floor((f+7)/17)]},s.NUMERIC=new s(1,[10,12,14]),s.ALPHANUMERIC=new s(2,[9,11,13]),s.BYTE=new s(4,[8,16,16]),s.KANJI=new s(8,[8,10,12]),s.ECI=new s(7,[0,0,0]),s}();l.Mode=i})(n.QrSegment||(n.QrSegment={}))})(ne||(ne={}));var le=ne,ke="L",Ae={L:le.QrCode.Ecc.LOW,M:le.QrCode.Ecc.MEDIUM,Q:le.QrCode.Ecc.QUARTILE,H:le.QrCode.Ecc.HIGH},Ut=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}();function Ve(n){return n in Ae}function Be(n,l){l===void 0&&(l=0);var i=[];return n.forEach(function(s,f){var h=null;s.forEach(function(o,e){if(!o&&h!==null){i.push("M".concat(h+l," ").concat(f+l,"h").concat(e-h,"v1H").concat(h+l,"z")),h=null;return}if(e===s.length-1){if(!o)return;h===null?i.push("M".concat(e+l,",").concat(f+l," h1v1H").concat(e+l,"z")):i.push("M".concat(h+l,",").concat(f+l," h").concat(e+1-h,"v1H").concat(h+l,"z"));return}o&&h===null&&(h=e)})}),i.join("")}function ze(n,l,i,s){var f=s.width,h=s.height,o=s.x,e=s.y,t=n.length+i*2,a=Math.floor(l*.1),r=t/l,d=(f||a)*r,v=(h||a)*r,p=o==null?n.length/2-d/2:o*r,w=e==null?n.length/2-v/2:e*r,A=null;if(s.excavate){var N=Math.floor(p),F=Math.floor(w),R=Math.ceil(d+p-N),C=Math.ceil(v+w-F);A={x:N,y:F,w:R,h:C}}return{x:p,y:w,h:v,w:d,excavation:A}}function Qe(n,l){return n.slice().map(function(i,s){return s<l.y||s>=l.y+l.h?i:i.map(function(f,h){return h<l.x||h>=l.x+l.w?f:!1})})}var Se={value:{type:String,required:!0,default:""},size:{type:Number,default:100},level:{type:String,default:ke,validator:function(n){return Ve(n)}},background:{type:String,default:"#fff"},foreground:{type:String,default:"#000"},margin:{type:Number,required:!1,default:0},imageSettings:{type:Object,required:!1,default:function(){return{}}},gradient:{type:Boolean,required:!1,default:!1},gradientType:{type:String,required:!1,default:"linear",validator:function(n){return["linear","radial"].indexOf(n)>-1}},gradientStartColor:{type:String,required:!1,default:"#000"},gradientEndColor:{type:String,required:!1,default:"#fff"}},xt=Y(Y({},Se),{renderAs:{type:String,required:!1,default:"canvas",validator:function(n){return["canvas","svg"].indexOf(n)>-1}}}),Dt=Ce({name:"QRCodeSvg",props:Se,setup:function(n){var l=_(0),i=_(""),s,f=function(){var o=n.value,e=n.level,t=n.margin,a=t>>>0,r=Ve(e)?e:ke,d=le.QrCode.encodeText(o,Ae[r]).getModules();if(l.value=d.length+a*2,n.imageSettings.src){var v=ze(d,n.size,a,n.imageSettings);s={x:v.x+a,y:v.y+a,width:v.w,height:v.h},v.excavation&&(d=Qe(d,v.excavation))}i.value=Be(d,a)},h=function(){if(!n.gradient)return null;var o=n.gradientType==="linear"?{x1:"0%",y1:"0%",x2:"100%",y2:"100%"}:{cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"};return H(n.gradientType==="linear"?"linearGradient":"radialGradient",Y({id:"qr-gradient"},o),[H("stop",{offset:"0%",style:{stopColor:n.gradientStartColor}}),H("stop",{offset:"100%",style:{stopColor:n.gradientEndColor}})])};return f(),Ue(f),function(){return H("svg",{width:n.size,height:n.size,"shape-rendering":"crispEdges",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(l.value," ").concat(l.value)},[H("defs",{},[h()]),H("rect",{width:"100%",height:"100%",fill:n.background}),H("path",{fill:n.gradient?"url(#qr-gradient)":n.foreground,d:i.value}),n.imageSettings.src&&H("image",Y({href:n.imageSettings.src},s))])}}}),$t=Ce({name:"QRCodeCanvas",props:Se,setup:function(n,l){var i=_(null),s=_(null),f=function(){var o=n.value,e=n.level,t=n.size,a=n.margin,r=n.background,d=n.foreground,v=n.gradient,p=n.gradientType,w=n.gradientStartColor,A=n.gradientEndColor,N=a>>>0,F=Ve(e)?e:ke,R=i.value;if(R){var C=R.getContext("2d");if(C){var y=le.QrCode.encodeText(o,Ae[F]).getModules(),b=y.length+N*2,V=s.value,T={x:0,y:0,width:0,height:0},E=n.imageSettings.src&&V!=null&&V.naturalWidth!==0&&V.naturalHeight!==0;if(E){var M=ze(y,n.size,N,n.imageSettings);T={x:M.x+N,y:M.y+N,width:M.w,height:M.h},M.excavation&&(y=Qe(y,M.excavation))}var $=window.devicePixelRatio||1,x=t/b*$;if(R.height=R.width=t*$,C.scale(x,x),C.fillStyle=r,C.fillRect(0,0,b,b),v){var I=void 0;p==="linear"?I=C.createLinearGradient(0,0,b,b):I=C.createRadialGradient(b/2,b/2,0,b/2,b/2,b/2),I.addColorStop(0,w),I.addColorStop(1,A),C.fillStyle=I}else C.fillStyle=d;Ut?C.fill(new Path2D(Be(y,N))):y.forEach(function(q,ye){q.forEach(function(fe,He){fe&&C.fillRect(He+N,ye+N,1,1)})}),E&&C.drawImage(V,T.x,T.y,T.width,T.height)}}};pe(f),Ue(f);var h=l.attrs.style;return function(){return H(B,[H("canvas",Y(Y({},l.attrs),{ref:i,style:Y(Y({},h),{width:"".concat(n.size,"px"),height:"".concat(n.size,"px")})})),n.imageSettings.src&&H("img",{ref:s,src:n.imageSettings.src,style:{display:"none"},onLoad:f})])}}}),Ot=Ce({name:"Qrcode",render:function(){var n=this.$props,l=n.renderAs,i=n.value,s=n.size,f=n.margin,h=n.level,o=n.background,e=n.foreground,t=n.imageSettings,a=n.gradient,r=n.gradientType,d=n.gradientStartColor,v=n.gradientEndColor;return H(l==="svg"?Dt:$t,{value:i,size:s,margin:f,level:h,background:o,foreground:e,imageSettings:t,gradient:a,gradientType:r,gradientStartColor:d,gradientEndColor:v})},props:xt});const Lt=Ye({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"number"},...gt(),...dt(),...tt(ct({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),Bt=Ge()({name:"VOtpInput",props:Lt(),emits:{finish:n=>!0,"update:focused":n=>!0,"update:modelValue":n=>!0},setup(n,l){let{attrs:i,emit:s,slots:f}=l;const{dimensionStyles:h}=ht(n),{isFocused:o,focus:e,blur:t}=it(n),a=We(n,"modelValue","",E=>E==null?[]:String(E).split(""),E=>E.join("")),{t:r}=Je(),d=J(()=>Number(n.length)),v=J(()=>Array(d.value).fill(0)),p=_(-1),w=_(),A=_([]),N=J(()=>A.value[p.value]);function F(){if(T(N.value.value)){N.value.value="";return}const E=a.value.slice(),M=N.value.value;E[p.value]=M;let $=null;p.value>a.value.length?$=a.value.length+1:p.value+1!==d.value&&($="next"),a.value=E,$&&Pe(w.value,$)}function R(E){const M=a.value.slice(),$=p.value;let x=null;["ArrowLeft","ArrowRight","Backspace","Delete"].includes(E.key)&&(E.preventDefault(),E.key==="ArrowLeft"?x="prev":E.key==="ArrowRight"?x="next":["Backspace","Delete"].includes(E.key)&&(M[p.value]="",a.value=M,p.value>0&&E.key==="Backspace"?x="prev":requestAnimationFrame(()=>{var I;(I=A.value[$])==null||I.select()})),requestAnimationFrame(()=>{x!=null&&Pe(w.value,x)}))}function C(E,M){var x,I;M.preventDefault(),M.stopPropagation();const $=((x=M==null?void 0:M.clipboardData)==null?void 0:x.getData("Text").trim().slice(0,d.value))??"";T($)||(a.value=$.split(""),(I=A.value)==null||I[E].blur())}function y(){a.value=[]}function b(E,M){e(),p.value=M}function V(){t(),p.value=-1}function T(E){return n.type==="number"&&/[^0-9]/g.test(E)}return Xe({VField:{color:re(()=>n.color),bgColor:re(()=>n.color),baseColor:re(()=>n.baseColor),disabled:re(()=>n.disabled),error:re(()=>n.error),variant:re(()=>n.variant)}},{scoped:!0}),_e(a,E=>{E.length===d.value&&(p.value=d.value-1,s("finish",E.join("")))},{deep:!0}),_e(p,E=>{E<0||Ze(()=>{var M;(M=A.value[E])==null||M.select()})}),pt(()=>{var $;const[E,M]=je(i);return k("div",Re({class:["v-otp-input",{"v-otp-input--divided":!!n.divider},n.class],style:[n.style]},E),[k("div",{ref:w,class:"v-otp-input__content",style:et([h.value])},[v.value.map((x,I)=>k(B,null,[n.divider&&I!==0&&k("span",{class:"v-otp-input__divider"},[n.divider]),u(ut,{focused:o.value&&n.focusAll||p.value===I,key:I},{...f,loader:void 0,default:()=>k("input",{ref:q=>A.value[I]=q,"aria-label":r(n.label,I+1),autofocus:I===0&&n.autofocus,autocomplete:"one-time-code",class:at(["v-otp-input__field"]),disabled:n.disabled,inputmode:n.type==="number"?"numeric":"text",min:n.type==="number"?0:void 0,maxlength:I===0?d.value:"1",placeholder:n.placeholder,type:n.type==="number"?"text":n.type,value:a.value[I],onInput:F,onFocus:q=>b(q,I),onBlur:V,onKeydown:R,onPaste:q=>C(I,q)},null)})])),k("input",Re({class:"v-otp-input-input",type:"hidden"},M,{value:a.value.join("")}),null),u(vt,{contained:!0,"content-class":"v-otp-input__loader","model-value":!!n.loading,persistent:!0},{default:()=>{var x;return[((x=f.loader)==null?void 0:x.call(f))??u(mt,{color:typeof n.loading=="boolean"?void 0:n.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),($=f.default)==null?void 0:$.call(f)])])}),{blur:()=>{var E;(E=A.value)==null||E.some(M=>M.blur())},focus:()=>{var E;(E=A.value)==null||E[0].focus()},reset:y,isFocused:o}}}),zt={class:"text-h6"},Qt={class:"m-label"},qt={class:"mt-4"},Ht={class:"m-label"},Kt={class:"mt-5"},Gt={tag:"p",class:"my-4"},Yt={__name:"TotpAuthForm",setup(n){const{$gettext:l}=j(),i=se(),s=ce(),f=_(),h=_(""),o=_([]),e=_(null),t=_(null),a=_(!1),r=_(!1),d=_(""),v=_([]),p=_([]),w=_(!1),A=J(()=>s.authUser.totp_enabled);function N(){G.getKeyForTFASetup().then(b=>{e.value=b.data.key,t.value=b.data.url})}function F(){navigator.clipboard.writeText(e.value),a.value=!0}function R(){G.startTFASetup().then(()=>{N()})}function C(){s.finalizeTFASetup(h.value).then(b=>{e.value=null,t.value=null,b.status===200&&(p.value=b.data.tokens),w.value=!0}).catch(b=>{b.response.status===400&&(o.value=b.response.data.pin_code)})}async function y(){if(!await f.value.validate())return;const V={password:d.value};r.value=!0,G.disableTFA(V).then(()=>{s.fetchUser()}).catch(T=>{T.response.status===400?v.value=T.response.data.password:i.displayNotification({msg:l(T.response.data),type:"error"})}).finally(()=>{r.value=!1,f.value.reset()})}return(b,V)=>(P(),D("div",null,[u(Z,{flat:""},{default:c(()=>[u(ge,null,{default:c(()=>[k("span",zt,g(m(l)("One-time passwords")),1)]),_:1}),u(X,null,{default:c(()=>[t.value?(P(),O(ve,{key:0},{default:c(()=>[u(de,{cols:"4"},{default:c(()=>[u(ve,{rows:"2"},{default:c(()=>[u(Ot,{value:t.value,size:250,"render-as":"svg",level:"H",class:"qrcode"},null,8,["value"])]),_:1}),u(ve,null,{default:c(()=>[u(Q,{color:"primary",class:"key",onClick:F},{default:c(()=>[S(g(m(l)("Click here to copy the key"))+" ",1),a.value?(P(),O(be,{key:0,color:"success"},{default:c(()=>V[2]||(V[2]=[S(" mdi-check-all ")])),_:1,__:[2]})):W("",!0)]),_:1})]),_:1})]),_:1}),u(de,{cols:"6"},{default:c(()=>[u(ee,{type:"info",class:"ma-4"},{default:c(()=>[S(g(m(l)("Install a soft token authenticator like FreeOTP or Google Authenticator from your application repository and use that app to scan this QR code.")),1)]),_:1}),k("label",Qt,g(m(l)("Pin code")),1),u(Bt,{modelValue:h.value,"onUpdate:modelValue":V[0]||(V[0]=T=>h.value=T),error:o.value.length!==0},null,8,["modelValue","error"]),u(Q,{color:"primary",onClick:C},{default:c(()=>[S(g(m(l)("Register")),1)]),_:1})]),_:1})]),_:1})):w.value?(P(),D(B,{key:1},[u(ee,{type:"success"},{default:c(()=>[S(g(m(l)("Congratulations! Two-factor authentication using one-time passwords is now enabled for your account.")),1)]),_:1}),p.value.length?(P(),D(B,{key:0},[k("p",qt,g(m(l)("The following recovery codes can be used one time each to let you regain access to your account, in case you lose your phone for example. Make sure to save them in a safe place, otherwise you won't be able to access your account anymore.")),1),u(De,{density:"compact"},{default:c(()=>[k("tbody",null,[(P(!0),D(B,null,xe(p.value,T=>(P(),D("tr",{key:T},[k("td",null,g(T),1)]))),128))])]),_:1})],64)):W("",!0)],64)):A.value?(P(),D(B,{key:2},[u(ee,{type:"info",class:"mb-2"},{default:c(()=>[S(g(m(l)("Two-factor authentication using one-time passwords is enabled for your account.")),1)]),_:1}),u(ae,{ref_key:"editTFAForm",ref:f},{default:c(()=>[k("label",Ht,g(m(l)("Password")),1),u(K,{modelValue:d.value,"onUpdate:modelValue":V[1]||(V[1]=T=>d.value=T),autocomplete:"new-password",type:"password",variant:"outlined",density:"compact",rules:[m(oe).required],"error-messages":v.value},null,8,["modelValue","rules","error-messages"]),k("div",Kt,[u(Q,{color:"error",class:"mr-2",loading:r.value,onClick:y},{default:c(()=>[S(g(m(l)("Disable 2FA")),1)]),_:1},8,["loading"])])]),_:1},512)],64)):(P(),D(B,{key:3},[k("div",Gt,g(m(l)("Two-factor authentication (2FA) using one-time passwords is not yet activated for your account.")),1),u(Q,{color:"success",onClick:R},{default:c(()=>[S(g(m(l)("Register authenticator")),1)]),_:1})],64))]),_:1})]),_:1})]))}},Wt={class:"headline"},qe={__name:"RecoveryCodesResetDialog",props:{tokens:{type:Array,default:null}},emits:["close"],setup(n,{emit:l}){const{$gettext:i}=j(),s=l;function f(){s("close")}return(h,o)=>(P(),O(Z,null,{default:c(()=>[u(ge,null,{default:c(()=>[k("span",Wt,g(m(i)("New recovery codes")),1)]),_:1}),u(X,null,{default:c(()=>[u(ee,{type:"info"},{default:c(()=>[S(g(m(i)("The following recovery codes can be used one time each to let you regain access to your account, in case you lose your phone for example. Make sure to save them in a safe place, otherwise you won't be able to access your account anymore.")),1)]),_:1}),u(De,{class:"mt-4",density:"compact"},{default:c(()=>[k("tbody",null,[(P(!0),D(B,null,xe(n.tokens,e=>(P(),D("tr",{key:e},[k("td",null,g(e),1)]))),128))])]),_:1})]),_:1}),u(Ee,null,{default:c(()=>[u(yt),u(Q,{color:"grey darken-1",text:"",onClick:f},{default:c(()=>[S(g(m(i)("Close")),1)]),_:1})]),_:1})]),_:1}))}},Jt={class:"text-h6"},Xt={class:"m-label"},Zt={class:"mt-5"},jt={key:1,tag:"p",class:"my-4"},ea={__name:"BackupCodeAuthForm",setup(n){const{$gettext:l}=j(),i=se(),s=ce(),f=J(()=>s.authUser.tfa_enabled),h=_(!1),o=_(),e=_(""),t=_([]),a=_(),r=_(!1);async function d(){if(!await o.value.validate())return;const w={password:e.value};h.value=!0,G.resetRecoveryCodes(w).then(A=>{t.value=A.data.tokens,r.value=!0}).catch(A=>{A.response.status===400?a.value=A.response.data.password:i.displayNotification({msg:l(A.response.data),type:"error"})}).finally(()=>{h.value=!1,o.value.reset()})}function v(){t.value=[],r.value=!1}return(p,w)=>(P(),D("div",null,[u(Z,{flat:""},{default:c(()=>[u(ge,null,{default:c(()=>[k("span",Jt,g(m(l)("Backup codes")),1)]),_:1}),u(X,null,{default:c(()=>[f.value?(P(),D(B,{key:0},[u(ee,{type:"info",class:"mb-2"},{default:c(()=>[S(g(m(l)("You already have generated backup codes for this account. If you don't remember them or have used them all, you can generate new ones.")),1)]),_:1}),u(ae,{ref_key:"editTFAForm",ref:o},{default:c(()=>[k("label",Xt,g(m(l)("Password")),1),u(K,{modelValue:e.value,"onUpdate:modelValue":w[0]||(w[0]=A=>e.value=A),autocomplete:"new-password",type:"password",variant:"outlined",density:"compact",rules:[m(oe).required],"error-messages":a.value},null,8,["modelValue","rules","error-messages"]),k("div",Zt,[u(Q,{loading:h.value,color:"success",onClick:d},{default:c(()=>[S(g(m(l)("Reset recovery codes")),1)]),_:1},8,["loading"])])]),_:1},512)],64)):(P(),D("div",jt,g(m(l)("No two-factor authentificator is yet set for your account.")),1)),u($e,{modelValue:r.value,"onUpdate:modelValue":w[1]||(w[1]=A=>r.value=A),"max-width":"800px",persistent:""},{default:c(()=>[u(m(qe),{tokens:t.value,onClose:v},null,8,["tokens"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]))}},ta={class:"m-label"},aa={__name:"ForwardForm",setup(n){const{$gettext:l}=j(),i=se(),s=_({}),f=_(!1);function h(){f.value=!0,G.setForward(s.value).then(()=>{f.value=!1,i.displayNotification({type:"success",msg:l("Forward updated")})})}return G.getForward().then(o=>{s.value=o.data}),(o,e)=>(P(),O(Z,{flat:""},{default:c(()=>[u(X,null,{default:c(()=>[k("label",ta,g(m(l)("Recipient(s)")),1),u(Oe,{modelValue:s.value.recipients,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.recipients=t),hint:m(l)("Indicate one or more recipients separated by a comma (,)"),"persistent-hint":"",rows:"3",variant:"outlined"},null,8,["modelValue","hint"]),u(Le,{modelValue:s.value.keepcopies,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.keepcopies=t),label:m(l)("Keep local copies"),hint:m(l)("Forward messages and store copies into your local mailbox"),"persistent-hint":""},null,8,["modelValue","label","hint"])]),_:1}),u(Ee,{class:"pa-4"},{default:c(()=>[u(Q,{color:"success",variant:"flat",loading:f.value,onClick:h},{default:c(()=>[S(g(m(l)("Update")),1)]),_:1},8,["loading"])]),_:1})]),_:1}))}},oa={class:"m-label"},na={class:"mb-4"},ra={class:"m-label"},la={class:"mb-4"},sa={class:"m-label"},ia={class:"mb-4"},ua={class:"m-label"},da={__name:"AutoReplyForm",setup(n){const l=se(),{$gettext:i}=j(),s=_({}),f=_(),h=_(!1);async function o(){const{valid:e}=await f.value.validate();e&&(h.value=!0,s.value.fromdate===""&&(s.value.fromdate=null),s.value.untildate===""&&(s.value.untildate=null),G.setARMessage(s.value).then(()=>{l.displayNotification({msg:i("Auto-reply message updated")}),h.value=!1}).catch(()=>{h.value=!1}))}return G.getARMessage().then(e=>{s.value=e.data,s.value.fromdate&&(s.value.fromdate=s.value.fromdate.slice(0,-4)),s.value.untildate&&(s.value.untildate=s.value.untildate.slice(0,-4))}),(e,t)=>(P(),O(Z,{flat:""},{default:c(()=>[u(X,null,{default:c(()=>[u(ae,{ref_key:"formRef",ref:f,onSubmit:me(o,["prevent"])},{default:c(()=>[u(Le,{modelValue:s.value.enabled,"onUpdate:modelValue":t[0]||(t[0]=a=>s.value.enabled=a),label:m(i)("Enabled"),color:"primary","hide-details":"",class:"mb-4"},null,8,["modelValue","label"]),k("label",oa,g(m(i)("Subject")),1),u(K,{modelValue:s.value.subject,"onUpdate:modelValue":t[1]||(t[1]=a=>s.value.subject=a),variant:"outlined",density:"compact",rules:[m(oe).required]},null,8,["modelValue","rules"]),k("div",na,[k("label",ra,g(m(i)("Content")),1),u(Oe,{modelValue:s.value.content,"onUpdate:modelValue":t[2]||(t[2]=a=>s.value.content=a),hint:m(i)("The content of your answer. You can use the following variables, which will be automatically replaced by the appropriate value: %(name)s, %(fromdate)s, %(untildate)s"),"persistent-hint":"",variant:"outlined",rows:"3",density:"compact",rules:[m(oe).required]},null,8,["modelValue","hint","rules"])]),k("div",la,[k("label",sa,g(m(i)("From")),1),u(K,{modelValue:s.value.fromdate,"onUpdate:modelValue":t[3]||(t[3]=a=>s.value.fromdate=a),hint:m(i)("Activate your auto reply from this date"),variant:"outlined","persistent-hint":"",type:"datetime-local",density:"compact"},null,8,["modelValue","hint"])]),k("div",ia,[k("label",ua,g(m(i)("Until")),1),u(K,{modelValue:s.value.untildate,"onUpdate:modelValue":t[4]||(t[4]=a=>s.value.untildate=a),hint:m(i)("Activate your auto reply until this date"),variant:"outlined","persistent-hint":"",type:"datetime-local",density:"compact"},null,8,["modelValue","hint"])]),u(Q,{color:"success",type:"submit",loading:h.value},{default:c(()=>[S(g(m(i)("Update auto-reply")),1)]),_:1},8,["loading"])]),_:1},512)]),_:1})]),_:1}))}},ca={class:"m-label"},fa={class:"ml-5 mr-5"},va=["href"],ma={__name:"APISetupForm",setup(n){const{$gettext:l}=j(),i=se(),s=ot("$config"),f=J(()=>s.API_DOC_URL),h=_(!1),o=_(null),e=_();function t(){navigator.clipboard.writeText(o.value),i.displayNotification({msg:l("API token copied to your clipboard"),type:"success"})}function a(){h.value=!0,G.createAPIToken().then(v=>{o.value=v.data.token,i.displayNotification({msg:l("API token created"),type:"success"})}).finally(()=>h.value=!1)}function r(){e.value.open(l("Warning"),l("You are about to delete your API access token"),{color:"error",cancelLabel:l("Cancel"),agreeLabel:l("Proceed")})}async function d(){await G.deleteAPIToken(),i.displayNotification({msg:l("API token deleted"),type:"success"}),o.value=null}return pe(()=>{G.getAPIToken().then(v=>{o.value=v.data.token})}),(v,p)=>(P(),D(B,null,[o.value?(P(),O(Z,{key:1,flat:""},{default:c(()=>[u(X,null,{default:c(()=>[k("label",ca,g(m(l)("Your API token is:")),1),k("code",fa,g(o.value),1),u(Q,{icon:"mdi-clipboard-plus",density:"compact",title:m(l)("Copy token to clipboard"),variant:"text",onClick:p[0]||(p[0]=w=>t())},null,8,["title"]),u(Q,{icon:"mdi-delete",density:"compact",color:"error",variant:"text",title:m(l)("Delete token"),onClick:r},null,8,["title"])]),_:1})]),_:1})):(P(),O(Z,{key:0,flat:""},{default:c(()=>[u(X,null,{default:c(()=>[S(g(m(l)("Your API token has not been generated yet.")),1)]),_:1}),u(Ee,null,{default:c(()=>[u(Q,{color:"success",variant:"flat",loading:h.value,onClick:a},{default:c(()=>[S(g(m(l)("Generate")),1)]),_:1},8,["loading"])]),_:1})]),_:1})),u(ee,{type:"info",variant:"tonal",border:"start",class:"mt-4"},{default:c(()=>[S(g(m(l)("A documentation of the API is available"))+" ",1),k("a",{href:f.value,target:"_blank"},g(m(l)("here")),9,va),p[1]||(p[1]=S(". "))]),_:1,__:[1]}),u(we,{ref_key:"confirm",ref:e,onAgree:d},null,512)],64))}};function ha(n){const l="==".slice(0,(4-n.length%4)%4),i=n.replace(/-/g,"+").replace(/_/g,"/")+l,s=atob(i),f=new ArrayBuffer(s.length),h=new Uint8Array(f);for(let o=0;o<s.length;o++)h[o]=s.charCodeAt(o);return f}function pa(n){const l=new Uint8Array(n);let i="";for(const h of l)i+=String.fromCharCode(h);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var U="copy",te="convert";function he(n,l,i){if(l===U)return i;if(l===te)return n(i);if(l instanceof Array)return i.map(s=>he(n,l[0],s));if(l instanceof Object){const s={};for(const[f,h]of Object.entries(l)){if(h.derive){const o=h.derive(i);o!==void 0&&(i[f]=o)}if(!(f in i)){if(h.required)throw new Error(`Missing key: ${f}`);continue}if(i[f]==null){s[f]=null;continue}s[f]=he(n,h.schema,i[f])}return s}}function Ie(n,l){return{required:!0,schema:n,derive:l}}function L(n){return{required:!0,schema:n}}function z(n){return{required:!1,schema:n}}var ga={type:L(U),id:L(te),transports:z(U)},ya={appid:z(U),appidExclude:z(U),credProps:z(U)},_a={appid:z(U),appidExclude:z(U),credProps:z(U)},ba={publicKey:L({rp:L(U),user:L({id:L(te),name:L(U),displayName:L(U)}),challenge:L(te),pubKeyCredParams:L(U),timeout:z(U),excludeCredentials:z([ga]),authenticatorSelection:z(U),attestation:z(U),extensions:z(ya)}),signal:z(U)},wa={type:L(U),id:L(U),rawId:L(te),authenticatorAttachment:z(U),response:L({clientDataJSON:L(te),attestationObject:L(te),transports:Ie(U,n=>{var l;return((l=n.getTransports)==null?void 0:l.call(n))||[]})}),clientExtensionResults:Ie(_a,n=>n.getClientExtensionResults())};function Ca(n){return he(ha,ba,n)}function Ea(n){return he(pa,wa,n)}async function ka(n){const l=await navigator.credentials.create(n);return l.toJSON=()=>Ea(l),l}const Aa={class:"text-h6"},Va={tag:"p",class:"my-4"},Sa={__name:"FidoAuthForm",setup(n){const l=ce(),{$gettext:i}=j(),s=_(),f=_(!1),h=!!(navigator.credentials&&navigator.credentials.create&&navigator.credentials.get&&window.PublicKeyCredential),o=_(),e=J(()=>l.fidoCreds),t=[{title:i("Name"),key:"name"},{title:i("Added On"),key:"added_on"},{title:i("Last Used"),key:"last_used"},{title:i("Use count"),key:"use_count"},{title:i("Actions"),key:"actions"}],a=_(),r=_(),d=_(),v=_(""),p=_(),w=_(!1);async function A(){const{valid:y}=await o.value.validate();if(!y)return;f.value=!0;const b=await nt.beginFidoRegistration();if(b){const V=Ca(b.data),E=(await ka(V)).toJSON();E.name=s.value,l.addFidoCred(E).then(M=>{M.status===200&&(p.value=M.data.tokens,w.value=!0)}),o.value.reset(),f.value=!1;return}f.value=!1}function N(){p.value=[],w.value=!1}async function F(y){await a.value.open(i("Warning"),i("Do you really want to delete this WebAuthn device?"),{color:"warning",cancelLabel:i("No"),agreeLabel:i("Yes")})&&l.deleteFidoCreds(y.id)}async function R(){return(await d.value.validate()).valid}async function C(y){if(v.value=y.name,!await r.value.open(i("Edition"),i("Edit your device"),{color:"warning",cancelLabel:i("Cancel"),agreeLabel:i("Save")}))return;const V={name:v.value};await l.editFidoCred(y.id,V)}return pe(()=>{l.getFidoCreds()}),(y,b)=>(P(),D(B,null,[k("div",null,[u(Z,{flat:""},{default:c(()=>[u(ge,null,{default:c(()=>[k("span",Aa,g(m(i)("WebAuthn")),1)]),_:1}),u(X,null,{default:c(()=>[u(ve,null,{default:c(()=>[e.value.length===0?(P(),O(de,{key:0,cols:"4"},{default:c(()=>[k("div",Va,g(m(i)("You don't have any WebAuthN device registered as a second authentication method.")),1)]),_:1})):(P(),O(de,{key:1,cols:"8"},{default:c(()=>[k("h3",null,g(m(i)("Registered Webauthn devices")),1),u(_t,{headers:t,items:e.value,"item-value":"id"},{"item.added_on":c(({item:V})=>[S(g(y.$date(V.added_on)),1)]),"item.last_used":c(({item:V})=>[V.last_used===null?(P(),D(B,{key:0},[S(g(m(i)("Never")),1)],64)):(P(),D(B,{key:1},[S(g(y.$date(V.last_used)),1)],64))]),"item.enabled":c(({item:V})=>[S(g(y.$yesno(V.enabled)),1)]),"item.actions":c(({item:V})=>[u(be,{class:"me-2",size:"small",onClick:T=>C(V)},{default:c(()=>b[3]||(b[3]=[S(" mdi-pencil ")])),_:2,__:[3]},1032,["onClick"]),u(be,{size:"small",onClick:T=>F(V)},{default:c(()=>b[4]||(b[4]=[S(" mdi-delete ")])),_:2,__:[4]},1032,["onClick"])]),_:2},1032,["items"])]),_:1})),u(de,{cols:"4"},{default:c(()=>[h?(P(),D(B,{key:0},[k("h3",null,g(m(i)("Enter a name to register a new webauthn device.")),1),u(ae,{ref_key:"fidoForm",ref:o,onSubmit:me(A,["prevent"])},{default:c(()=>[u(K,{modelValue:s.value,"onUpdate:modelValue":b[0]||(b[0]=V=>s.value=V),label:m(i)("New device name"),rules:[m(oe).required]},null,8,["modelValue","label","rules"]),u(Q,{color:"success",type:"submit",loading:f.value},{default:c(()=>[S(g(m(i)("Setup device")),1)]),_:1},8,["loading"])]),_:1},512)],64)):(P(),O(ee,{key:1,type:"error"},{default:c(()=>[S(g(m(i)("Your browser does not seem compatible with WebAuthN")),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1})]),u(we,{ref_key:"confirmDeletion",ref:a},null,512),u(we,{ref_key:"confirmEdition",ref:r,callback_agree:R},{default:c(()=>[u(ae,{ref_key:"editForm",ref:d},{default:c(()=>[u(K,{modelValue:v.value,"onUpdate:modelValue":b[1]||(b[1]=V=>v.value=V),label:m(i)("name"),rules:[m(oe).required]},null,8,["modelValue","label","rules"])]),_:1},512)]),_:1},512),u($e,{modelValue:w.value,"onUpdate:modelValue":b[2]||(b[2]=V=>w.value=V),"max-width":"800px",persistent:""},{default:c(()=>[u(qe,{tokens:p.value,onClose:N},null,8,["tokens"])]),_:1},8,["modelValue"])],64))}},Ra={class:"pa-4"},Pa={__name:"SettingsView",setup(n){const l=ce(),i=_();return(s,f)=>(P(),D(B,null,[u(bt,{flat:""},{default:c(()=>[u(wt,null,{default:c(()=>[S(g(s.$gettext("Account settings")),1)]),_:1})]),_:1}),k("div",Ra,[u(Ct,{modelValue:i.value,"onUpdate:modelValue":f[0]||(f[0]=h=>i.value=h),color:"primary",class:"mb-4"},{default:c(()=>[u(ie,{value:"profile"},{default:c(()=>[S(g(s.$gettext("Profile")),1)]),_:1}),u(ie,{value:"security"},{default:c(()=>[S(g(s.$gettext("Two-factor auth")),1)]),_:1}),m(l).userHasMailbox?(P(),O(ie,{key:0,value:"forward"},{default:c(()=>[S(g(s.$gettext("Forward")),1)]),_:1})):W("",!0),m(l).userHasMailbox?(P(),O(ie,{key:1,value:"autoreply"},{default:c(()=>[S(g(s.$gettext("Auto-reply message")),1)]),_:1})):W("",!0),m(l).authUser.role===m(Me).SUPER_ADMIN?(P(),O(ie,{key:2,value:"api"},{default:c(()=>[S(g(s.$gettext("API access")),1)]),_:1})):W("",!0)]),_:1},8,["modelValue"]),u(Et,{modelValue:i.value,"onUpdate:modelValue":f[1]||(f[1]=h=>i.value=h)},{default:c(()=>[u(ue,{value:"profile"},{default:c(()=>[u(It)]),_:1}),u(ue,{value:"security"},{default:c(()=>[u(Yt),u(Sa),u(ea)]),_:1}),m(l).userHasMailbox?(P(),O(ue,{key:0,value:"forward"},{default:c(()=>[u(aa)]),_:1})):W("",!0),m(l).userHasMailbox?(P(),O(ue,{key:1,value:"autoreply"},{default:c(()=>[u(da)]),_:1})):W("",!0),m(l).authUser.role===m(Me).SUPER_ADMIN?(P(),O(ue,{key:2,value:"api"},{default:c(()=>[u(ma)]),_:1})):W("",!0)]),_:1},8,["modelValue"])])],64))}},uo=rt(Pa,[["__scopeId","data-v-fc9b36ca"]]);export{uo as default};
