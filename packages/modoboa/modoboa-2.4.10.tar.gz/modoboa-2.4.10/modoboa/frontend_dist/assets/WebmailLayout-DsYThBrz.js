import{k as oe,Q as j,R as ne,M as K,n as Q,g as r,L as T,r as se,m as V,o as m,F as A,G as ie,J as z,e as N,c as O,q as E,a,f as _,t as B,p as P,b as W,h as F,w as f,j as G,s as re}from"./index-DV9Li2cg.js";import{_ as ue}from"./ConfirmDialog-BvqxQsD1.js";import{_ as me,V as de}from"./ConnectedLayout-BQ3ug6Jh.js";import{a as C}from"./webmail-KrD8ZhNM.js";import{d as H,V as L,e as ce,p as pe}from"./VAvatar-BAgTUIvX.js";import{V as J}from"./VSpacer-C6PZ3X24.js";import{V as ve,r as fe}from"./VForm-CpoZf60D.js";import{V as be,a as xe,b as ge}from"./VCard-DFWiFORP.js";import{V as ye}from"./VTextField-CLwRV0Cb.js";import{V as Me}from"./VDialog-CZqM2Ofu.js";import{V as Ve}from"./VMenu-B_dVqOmo.js";import{V as _e,a as R}from"./forwardRefs-Cpc3YYl6.js";import"./VToolbar-CGwhgdmI.js";import"./tag-CFK9dzMJ.js";import"./VProgressCircular-CrEXxs7k.js";import"./VContainer-Btam4lk2.js";/* empty css              */import"./VApp-BKxnjOoi.js";import"./layout-CHO37cA6.js";import"./ssrBoot-BsxW6uW4.js";import"./global.store-DUP26-A5.js";import"./admin-CJVLMHh9.js";import"./layout.store-BxBoBlgf.js";import"./VRow-C_Ydf6yr.js";import"./VSheet-5VVWtHvs.js";const he="/assets/Modoboa_RVB-BLANC-SANS-BBGoASES.png",Ce=["onClick","onMouseover","onMouseleave"],we={key:0,class:"font-weight-bold"},ke={key:1},Ue={key:0,class:"font-weight-bold"},$e={key:1},Be={__name:"MailboxList",props:j({mailboxes:{type:Array,default:null},lightMode:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},unseenCounters:{type:Boolean,default:!0},allowUnselect:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:j(["update:modelValue"],["update:modelValue"]),setup(S,{emit:x}){const t=S,n=ne(S,"modelValue"),s=x,h=K(),i=Q(),k={inbox:"mdi-inbox",draft:"mdi-file",junk:"mdi-fire",sent:"mdi-email-fast-outline",trash:"mdi-trash-can-outline",normal:"mdi-folder-outline"},d=r(null),g=r({}),p=r({});function y(e){return e.label.split("/").pop()}function c(e){return d.value===null&&(d.value=e.unseen),d.value}function u(e,w){g.value[e.name]=w}function o(e){return n.value===e.name?"bg-primary-lighten-1":t.lightMode?g.value[e.name]?"bg-primary":"bg-white":g.value[e.name]?"bg-primary-lighten-1":"bg-primary"}function M(e){return p.value[e.name]}function I(e){p.value[e.name]||(p.value[e.name]=!1),p.value[e.name]=!p.value[e.name],p.value[e.name]&&!e.sub.length&&C.getUserMailboxes(e.name).then(w=>{e.sub=w.data.mailboxes})}function D(e){t.allowUnselect&&e===n.value?s("update:modelValue",null):s("update:modelValue",e)}return T(()=>i.mbCounterKey,()=>{C.getUserMailboxUnseen(h.query.mailbox).then(e=>{d.value=e.data.counter})}),(e,w)=>{const q=se("MailboxList",!0);return m(),V("div",null,[(m(!0),V(A,null,ie(t.mailboxes,l=>(m(),V("div",{key:l.name,class:z(["pl-3 text-body-2",{"py-1":!t.compact}])},[N("div",{class:z([o(l),"d-flex mailbox pa-1 align-center"]),onClick:U=>D(l.name),onMouseover:U=>u(l,!0),onMouseleave:U=>u(l,!1)},[a(H,{icon:k[l.type],class:"mr-4"},null,8,["icon"]),l.name===_(h).query.mailbox?(m(),V(A,{key:0},[d.value>0?(m(),V("span",we,B(y(l))+" ("+B(c(l))+") ",1)):(m(),V("span",ke,B(y(l)),1))],64)):(m(),V(A,{key:1},[l.unseen>0?(m(),V("span",Ue,B(y(l))+" ("+B(l.unseen)+") ",1)):(m(),V("span",$e,B(y(l)),1))],64)),a(J),l.sub?(m(),O(L,{key:2,icon:M(l)?"mdi-minus":"mdi-plus",size:"xsmall",variant:"flat",color:"transparent",onClick:P(U=>I(l),["stop"])},null,8,["icon","onClick"])):E("",!0)],42,Ce),M(l)&&l.sub&&l.sub.length?(m(),O(q,{key:0,modelValue:n.value,"onUpdate:modelValue":w[0]||(w[0]=U=>n.value=U),mailboxes:l.sub,class:"mt-1","light-mode":t.lightMode,compact:t.compact},null,8,["modelValue","mailboxes","light-mode","compact"])):E("",!0)],2))),128))])}}},Y=oe(Be,[["__scopeId","data-v-62d5beb0"]]),Ne={class:"mb-2 rounded-lg"},Le={__name:"MailboxForm",props:{userMailboxes:Array,mailbox:{type:String,default:null},hdelimiter:{type:String,default:null}},emits:["close","mailboxRenamed"],setup(S,{emit:x}){const t=S,n=x,{$gettext:s}=W(),{displayNotification:h}=Q(),i=r({}),k=r(),d=r(!1),g=F(()=>t.mailbox?s("Edit mailbox"):s("Create new mailbox")),p=F(()=>t.mailbox?s("Update"):s("Create")),y=()=>{i.value={},n("close")},c=async()=>{const{valid:u}=await k.value.validate();if(u){d.value=!0;try{const o={...i.value};t.mailbox?(o.oldname=t.mailbox,await C.renameUserMailbox(o),h({msg:s("Mailbox renamed")}),n("mailboxRenamed",`${o.parent_mailbox}${t.hdelimiter}${o.name}`)):(await C.createUserMailbox(o),h({msg:s("Mailbox created")})),y()}finally{d.value=!1}}};return T(()=>t.mailbox,u=>{if(u){const o=t.mailbox.split(t.hdelimiter);i.value.name=o.slice(-1)[0],i.value.parent_mailbox=o.slice(0,-1).join(t.hdelimiter)}else i.value={}},{immediate:!0}),(u,o)=>(m(),O(ge,{title:g.value},{default:f(()=>[a(be,null,{default:f(()=>[a(ve,{ref_key:"formRef",ref:k},{default:f(()=>[a(ye,{modelValue:i.value.name,"onUpdate:modelValue":o[0]||(o[0]=M=>i.value.name=M),label:_(s)("Name"),variant:"outlined",density:"compact",rules:[_(fe).required]},null,8,["modelValue","label","rules"]),N("div",Ne,[N("h4",null,B(_(s)("Parent mailbox")),1),a(Y,{modelValue:i.value.parent_mailbox,"onUpdate:modelValue":o[1]||(o[1]=M=>i.value.parent_mailbox=M),"active-mailbox":t.parent,mailboxes:t.userMailboxes,"light-mode":"",compact:"","unseen-counters":!1,"allow-unselect":""},null,8,["modelValue","active-mailbox","mailboxes"])])]),_:1},512)]),_:1}),a(xe,null,{default:f(()=>[a(J),a(L,{text:_(s)("Close"),variant:"flat",loading:d.value,onClick:y},null,8,["text","loading"]),a(L,{text:p.value,variant:"tonal",color:"primary",loading:d.value,onClick:c},null,8,["text","loading"])]),_:1})]),_:1},8,["title"]))}},Se={class:"d-flex align-center"},qe={class:"d-flex justify-center mb-4"},Fe={class:"border-t-sm d-flex align-center bg-grey"},sa={__name:"WebmailLayout",async setup(S){let x,t;const{$gettext:n}=W(),s=K(),h=re(),i=Q(),k=r(),d=r(!0),g=r(!1),p=r(null),y=r(null),c=r(null),u=r(s.query.mailbox||"INBOX"),o=r(!1),M=r([]),I=F(()=>["INBOX"].includes(s.query.mailbox||"INBOX")),D=F(()=>c.value.usage<50?"info":c.value.usage<80?"warning":"error"),e=F(()=>`${c.value.current} / ${c.value.limit} (${c.value.usage}%)`);function w(b){h.push({name:"MailboxView",query:{mailbox:b}}),C.getUserMailboxQuota(b).then(v=>{c.value=v.data})}const q=async()=>{const b=await C.getUserMailboxes();M.value=b.data.mailboxes,y.value=b.data.hdelimiter},l=()=>{h.push({name:"ComposeEmailView"})},U=()=>{o.value=!1,p.value=null,q()},Z=()=>{o.value=!0},ee=()=>{p.value=u.value,o.value=!0},X=b=>{u.value=b,h.push({name:"MailboxView",query:{mailbox:b}})},ae=async()=>{await C.compressUserMailbox({name:u.value}),i.displayNotification({msg:n("Mailbox compressed")})},te=async()=>{await k.value.open(n("Warning"),n("Delete this mailbox?"),{color:"warning",agreeLabel:n("Yes"),cancelLabel:n("No")})&&(await C.deleteUserMailbox({name:u.value}),i.displayNotification({msg:n("Mailbox deleted")}),X("INBOX"))};T(()=>i.dataKey,()=>{q()}),[x,t]=G(()=>q()),await x,t();const le=([x,t]=G(()=>C.getUserMailboxQuota(s.query.mailbox||"INBOX")),x=await x,t(),x);return c.value=le.data,(b,v)=>(m(),V(A,null,[a(me,null,{navbar:f(()=>[a(de,{modelValue:d.value,"onUpdate:modelValue":v[2]||(v[2]=$=>d.value=$),rail:g.value,permanent:"",color:"primary",app:""},{prepend:f(()=>[N("div",Se,[a(pe,{src:he,"max-width":"190",class:"logo"}),a(L,{icon:g.value?"mdi-chevron-right":"mdi-chevron-left",variant:"text",onClick:v[0]||(v[0]=P($=>g.value=!g.value,["stop"]))},null,8,["icon"])]),N("div",qe,[a(L,{text:_(n)("Compose"),color:"secondary",variant:"flat","prepend-icon":"mdi-pencil",onClick:l},null,8,["text"])])]),append:f(()=>[N("div",Fe,[a(L,{class:"ml-2",variant:"text",icon:"",size:"small"},{default:f(()=>[a(H,{icon:"mdi-cog"}),a(Ve,{activator:"parent"},{default:f(()=>[a(_e,{density:"compact"},{default:f(()=>[a(R,{title:_(n)("Create a new mailbox"),"prepend-icon":"mdi-plus",onClick:Z},null,8,["title"]),a(R,{title:_(n)("Edit this mailbox"),"prepend-icon":"mdi-pencil",disabled:I.value,onClick:ee},null,8,["title","disabled"]),a(R,{title:_(n)("Delete this mailbox"),"prepend-icon":"mdi-trash-can",disabled:I.value,onClick:te},null,8,["title","disabled"]),a(R,{title:_(n)("Compress this mailbox"),"prepend-icon":"mdi-folder-zip-outline",onClick:ae},null,8,["title"])]),_:1})]),_:1})]),_:1}),c.value?(m(),O(ce,{key:0,color:D.value,"model-value":c.value.usage,title:e.value},null,8,["color","model-value","title"])):E("",!0)])]),default:f(()=>[a(Y,{modelValue:u.value,"onUpdate:modelValue":[v[1]||(v[1]=$=>u.value=$),w],mailboxes:M.value,class:"mr-2"},null,8,["modelValue","mailboxes"])]),_:1},8,["modelValue","rail"])]),_:1}),a(Me,{modelValue:o.value,"onUpdate:modelValue":v[4]||(v[4]=$=>o.value=$),"max-width":"800"},{default:f(()=>[a(Le,{"user-mailboxes":M.value,mailbox:p.value,hdelimiter:y.value,onMailboxRenamed:X,onClose:v[3]||(v[3]=$=>U())},null,8,["user-mailboxes","mailbox","hdelimiter"])]),_:1},8,["modelValue"]),a(ue,{ref_key:"confirm",ref:k},null,512)],64))}};export{sa as default};
