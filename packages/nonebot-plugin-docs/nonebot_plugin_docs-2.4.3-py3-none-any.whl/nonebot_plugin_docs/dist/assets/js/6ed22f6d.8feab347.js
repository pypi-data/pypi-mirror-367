"use strict";(self.webpackChunknonebot=self.webpackChunknonebot||[]).push([["2239"],{41394:function(e,n,s){s.r(n),s.d(n,{default:()=>g,frontMatter:()=>c,metadata:()=>t,assets:()=>o,toc:()=>h,contentTitle:()=>d});var t=JSON.parse('{"id":"best-practice/alconna/uniseg/message","title":"\u901A\u7528\u6D88\u606F\u5E8F\u5217","description":"\u6D88\u606F\u5E8F\u5217","source":"@site/docs/best-practice/alconna/uniseg/message.mdx","sourceDirName":"best-practice/alconna/uniseg","slug":"/best-practice/alconna/uniseg/message","permalink":"/website/docs/next/best-practice/alconna/uniseg/message","draft":false,"unlisted":false,"editUrl":"https://github.com/nonebot/nonebot2/edit/master/website/docs/best-practice/alconna/uniseg/message.mdx","tags":[],"version":"current","lastUpdatedBy":"noneflow[bot]","lastUpdatedAt":1754561629000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"description":"\u6D88\u606F\u5E8F\u5217"},"sidebar":"tutorial","previous":{"title":"\u901A\u7528\u6D88\u606F\u6BB5","permalink":"/website/docs/next/best-practice/alconna/uniseg/segment"},"next":{"title":"\u8F85\u52A9\u529F\u80FD","permalink":"/website/docs/next/best-practice/alconna/uniseg/utils"}}'),r=s("24246"),a=s("80980"),l=s("75037"),i=s("80981");let c={sidebar_position:3,description:"\u6D88\u606F\u5E8F\u5217"},d="\u901A\u7528\u6D88\u606F\u5E8F\u5217",o={},h=[{value:"\u53D1\u9001\u6D88\u606F",id:"\u53D1\u9001\u6D88\u606F",level:2},{value:"\u56DE\u9000\u7B56\u7565",id:"\u56DE\u9000\u7B56\u7565",level:3},{value:"\u4E3B\u52A8\u53D1\u9001\u6D88\u606F",id:"\u4E3B\u52A8\u53D1\u9001\u6D88\u606F",level:3},{value:"Receipt \u5BF9\u8C61",id:"receipt-\u5BF9\u8C61",level:3},{value:"\u6784\u9020",id:"\u6784\u9020",level:2},{value:"\u4F7F\u7528\u6D88\u606F\u6A21\u677F",id:"\u4F7F\u7528\u6D88\u606F\u6A21\u677F",level:3},{value:"\u62FC\u63A5\u6D88\u606F",id:"\u62FC\u63A5\u6D88\u606F",level:3},{value:"\u64CD\u4F5C",id:"\u64CD\u4F5C",level:2},{value:"\u68C0\u67E5\u6D88\u606F\u6BB5",id:"\u68C0\u67E5\u6D88\u606F\u6BB5",level:3},{value:"\u83B7\u53D6\u6D88\u606F\u7EAF\u6587\u672C",id:"\u83B7\u53D6\u6D88\u606F\u7EAF\u6587\u672C",level:3},{value:"\u904D\u5386",id:"\u904D\u5386",level:3},{value:"\u8FC7\u6EE4\u3001\u7D22\u5F15\u4E0E\u5207\u7247",id:"\u8FC7\u6EE4\u7D22\u5F15\u4E0E\u5207\u7247",level:3},{value:"\u5D4C\u5957\u63D0\u53D6",id:"\u5D4C\u5957\u63D0\u53D6",level:3},{value:"\u8F6C\u6362",id:"\u8F6C\u6362",level:3},{value:"\u5B57\u7B26\u4E32\u64CD\u4F5C",id:"\u5B57\u7B26\u4E32\u64CD\u4F5C",level:3},{value:"\u6301\u4E45\u5316",id:"\u6301\u4E45\u5316",level:2},{value:"dump",id:"dump",level:3},{value:"load",id:"load",level:3}];function x(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\u901A\u7528\u6D88\u606F\u5E8F\u5217",children:"\u901A\u7528\u6D88\u606F\u5E8F\u5217"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"uniseg"})," \u63D0\u4F9B\u4E86\u4E00\u4E2A\u7C7B\u4F3C\u4E8E ",(0,r.jsx)(n.code,{children:"Message"})," \u7684 ",(0,r.jsx)(n.code,{children:"UniMessage"})," \u7C7B\u578B\uFF0C\u5176\u5143\u7D20\u4E3A",(0,r.jsx)(n.a,{href:"/website/docs/next/best-practice/alconna/uniseg/segment",children:"\u901A\u7528\u6D88\u606F\u6BB5"}),"\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4F60\u53EF\u4EE5\u7528\u5982\u4E0B\u65B9\u5F0F\u83B7\u53D6 ",(0,r.jsx)(n.code,{children:"UniMessage"}),"\uFF1A"]}),"\n",(0,r.jsxs)(l.Z,{groupId:"get_unimsg",children:[(0,r.jsxs)(i.Z,{value:"depend",label:"\u4F7F\u7528\u4F9D\u8D56\u6CE8\u5165",children:[(0,r.jsxs)(n.p,{children:["\u901A\u8FC7\u63D0\u4F9B\u7684 ",(0,r.jsx)(n.code,{children:"UniversalMessage"})," \u6216\u57FA\u4E8E ",(0,r.jsxs)(n.a,{href:"https://github.com/nonebot/nonebot2/pull/1832",children:[(0,r.jsx)(n.code,{children:"Annotated"})," \u652F\u6301"]}),"\u7684 ",(0,r.jsx)(n.code,{children:"UniMsg"})," \u4F9D\u8D56\u6CE8\u5165\u5668\u6765\u83B7\u53D6 ",(0,r.jsx)(n.code,{children:"UniMessage"}),"\u3002"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from nonebot_plugin_alconna.uniseg import UniMsg, At, Text\n\n\nmatcher = on_xxx(...)\n\n@matcher.handle()\nasync def _(msg: UniMsg):\n    text = msg[Text, 0]\n    print(text.text)\n    if msg.has(At):\n        ats = msg.get(At)\n        print(ats)\n    ...\n"})})]}),(0,r.jsxs)(i.Z,{value:"method",label:"\u4F7F\u7528 UniMessage.generate",children:[(0,r.jsxs)(n.p,{children:["\u6CE8\u610F\uFF0C",(0,r.jsx)(n.code,{children:"generate"})," \u65B9\u6CD5\u5728\u54CD\u5E94\u5668\u4EE5\u5916\u7684\u5730\u65B9\u5982\u679C\u4E0D\u4F20\u5165 ",(0,r.jsx)(n.code,{children:"event"})," \u4E0E ",(0,r.jsx)(n.code,{children:"bot"})," \u5219\u65E0\u6CD5\u5904\u7406 reply\u3002"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from nonebot import Message, EventMessage\nfrom nonebot_plugin_alconna.uniseg import UniMessage\n\n\nmatcher = on_xxx(...)\n\n@matcher.handle()\nasync def _(message: Message = EventMessage()):\n    msg = await UniMessage.generate(message=message)\n    msg1 = UniMessage.generate_without_reply(message=message)\n"})})]})]}),"\n",(0,r.jsx)(n.h2,{id:"\u53D1\u9001\u6D88\u606F",children:"\u53D1\u9001\u6D88\u606F"}),"\n",(0,r.jsxs)(n.p,{children:["\u4F60\u8FD8\u53EF\u4EE5\u901A\u8FC7 ",(0,r.jsx)(n.code,{children:"UniMessage"})," \u7684 ",(0,r.jsx)(n.code,{children:"export"})," \u4E0E ",(0,r.jsx)(n.code,{children:"send"})," \u65B9\u6CD5\u6765",(0,r.jsx)(n.strong,{children:"\u8DE8\u5E73\u53F0\u53D1\u9001\u6D88\u606F"}),"\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"UniMessage.export"})," \u4F1A\u901A\u8FC7\u4F20\u5165\u7684 ",(0,r.jsx)(n.code,{children:"bot: Bot"})," \u53C2\u6570\uFF0C\u6216\u4E0A\u4E0B\u6587\u4E2D\u7684 ",(0,r.jsx)(n.code,{children:"Bot"})," \u5BF9\u8C61\u8BFB\u53D6\u9002\u914D\u5668\u4FE1\u606F\uFF0C\u5E76\u4F7F\u7528\u5BF9\u5E94\u7684\u751F\u6210\u65B9\u6CD5\u628A\u901A\u7528\u6D88\u606F\u8F6C\u4E3A\u9002\u914D\u5668\u5BF9\u5E94\u7684\u6D88\u606F\u5E8F\u5217\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from nonebot import Bot, on_command\nfrom nonebot_plugin_alconna.uniseg import Image, UniMessage\n\n\ntest = on_command("test")\n\n@test.handle()\nasync def handle_test():\n    await test.send(await UniMessage(Image(path="path/to/img")).export())\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u9664\u6B64\u4E4B\u5916 ",(0,r.jsx)(n.code,{children:"UniMessage.send"}),", ",(0,r.jsx)(n.code,{children:".finish"})," \u65B9\u6CD5\u57FA\u4E8E ",(0,r.jsx)(n.code,{children:"UniMessage.export"})," \u5E76\u8C03\u7528\u5404\u9002\u914D\u5668\u4E0B\u7684\u53D1\u9001\u6D88\u606F\u65B9\u6CD5\uFF0C\u8FD4\u56DE\u4E00\u4E2A ",(0,r.jsx)(n.code,{children:"Receipt"})," \u5BF9\u8C61\uFF0C\u7528\u4E8E\u4FEE\u6539/\u64A4\u56DE/\u8868\u6001\u6D88\u606F\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from nonebot import Bot, on_command\nfrom nonebot_plugin_alconna.uniseg import UniMessage\n\n\ntest = on_command("test")\n\n@test.handle()\nasync def handle():\n    receipt = await UniMessage.text("hello!").send(at_sender=True, reply_to=True)\n    await receipt.recall(delay=1)\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"UniMessage.send"})," \u7684\u5B9A\u4E49\u5982\u4E0B\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"async def send(\n    self,\n    target: Event | Target | None = None,\n    bot: Bot | None = None,\n    fallback: bool | FallbackStrategy = FallbackStrategy.rollback,\n    at_sender: str | bool = False,\n    reply_to: str | bool | Reply | None = False,\n    **kwargs: Any,\n) -> Receipt:\n    ...\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"target"}),": \u53D1\u9001\u76EE\u6807\uFF0C\u652F\u6301\u4E8B\u4EF6\u548C",(0,r.jsx)(n.a,{href:"/website/docs/next/best-practice/alconna/uniseg/utils#%E5%8F%91%E9%80%81%E5%AF%B9%E8%B1%A1",children:"\u53D1\u9001\u5BF9\u8C61"}),"\uFF0C\u4E0D\u4F20\u5165\u65F6\u4F1A\u5C1D\u8BD5\u4ECE\u54CD\u5E94\u5668\u4E0A\u4E0B\u6587\u4E2D\u83B7\u53D6\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"bot"}),": \u53D1\u9001\u6D88\u606F\u4F7F\u7528\u7684 Bot \u5BF9\u8C61\uFF0C\u82E5\u4E0D\u4F20\u5165\u5219\u4F1A\u5C1D\u8BD5\u4ECE\u54CD\u5E94\u5668\u4E0A\u4E0B\u6587\u4E2D\u83B7\u53D6\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"fallback"}),": ",(0,r.jsx)(n.a,{href:"#%E5%9B%9E%E9%80%80%E7%AD%96%E7%95%A5",children:"\u56DE\u9000\u7B56\u7565"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"at_sender"}),": \u662F\u5426\u63D0\u9192\u53D1\u9001\u8005\uFF0C\u9ED8\u8BA4\u4E3A ",(0,r.jsx)(n.code,{children:"False"}),"\u3002\u5F53\u7C7B\u578B\u4E3A ",(0,r.jsx)(n.code,{children:"str"})," \u65F6\uFF0C\u8868\u793A\u6307\u5B9A\u7528\u6237\u7684 id\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"reply_to"}),": \u662F\u5426\u56DE\u590D\u6D88\u606F\uFF0C\u9ED8\u8BA4\u4E3A ",(0,r.jsx)(n.code,{children:"False"}),"\u3002","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"str"})," \u8868\u793A\u6D88\u606F id\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"bool"})," \u8868\u793A\u662F\u5426\u56DE\u590D\u5F53\u524D\u6D88\u606F\u3002\u6B64\u65F6 ",(0,r.jsx)(n.code,{children:"target"})," \u4E0D\u80FD\u662F",(0,r.jsx)(n.a,{href:"/website/docs/next/best-practice/alconna/uniseg/utils#%E5%8F%91%E9%80%81%E5%AF%B9%E8%B1%A1",children:"\u53D1\u9001\u5BF9\u8C61"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Reply"})," \u8868\u793A\u76F4\u63A5\u4F7F\u7528\u56DE\u590D\u5143\u7D20\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"**kwargs"}),": \u5404 ",(0,r.jsx)(n.code,{children:"Bot.send"})," \u7684\u7279\u5B9A\u53C2\u6570\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u800C\u5728 ",(0,r.jsx)(n.code,{children:"AlconnaMatcher"})," \u4E0B\uFF0C",(0,r.jsx)(n.code,{children:"got"}),", ",(0,r.jsx)(n.code,{children:"send"}),", ",(0,r.jsx)(n.code,{children:"reject"})," \u7B49\u53EF\u4EE5\u53D1\u9001\u6D88\u606F\u7684\u65B9\u6CD5\u7686\u652F\u6301\u4F7F\u7528 ",(0,r.jsx)(n.code,{children:"UniMessage"}),"\uFF0C\u4E0D\u9700\u8981\u624B\u52A8\u8C03\u7528 export \u65B9\u6CD5\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from arclet.alconna import Alconna, Args\nfrom nonebot_plugin_alconna import Match, AlconnaMatcher, on_alconna\nfrom nonebot_plugin_alconna.uniseg import At,  UniMessage\n\n\ntest_cmd = on_alconna(Alconna("test", Args["target?", At]))\n\n@test_cmd.handle()\nasync def tt_h(matcher: AlconnaMatcher, target: Match[At]):\n    if target.available:\n        matcher.set_path_arg("target", target.result)\n\n@test_cmd.got_path("target", prompt="\u8BF7\u8F93\u5165\u76EE\u6807")\nasync def tt(target: At):\n    await test_cmd.send(UniMessage([target, "\\ndone."]))\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u56DE\u9000\u7B56\u7565",children:"\u56DE\u9000\u7B56\u7565"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"send"})," \u65B9\u6CD5\u7684 ",(0,r.jsx)(n.code,{children:"fallback"})," \u53C2\u6570\u7528\u4E8E\u6307\u5B9A\u56DE\u9000\u7B56\u7565\uFF08\u5373\u5F53\u524D\u9002\u914D\u5668\u4E0D\u652F\u6301\u7684\u6D88\u606F\u6BB5\u5982\u4F55\u5904\u7406\uFF09\uFF1A"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FallbackStrategy.ignore"}),": \u5FFD\u7565\u672A\u8F6C\u6362\u7684\u6D88\u606F\u6BB5"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FallbackStrategy.to_text"}),": \u5C06\u672A\u8F6C\u6362\u7684\u6D88\u606F\u6BB5\u8F6C\u4E3A\u6587\u672C\u5143\u7D20"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FallbackStrategy.rollback"}),": \u4ECE\u672A\u8F6C\u6362\u6D88\u606F\u6BB5\u7684\u5B50\u5143\u7D20\u4E2D\u63D0\u53D6\u53EF\u80FD\u7684\u53EF\u53D1\u9001\u6D88\u606F\u6BB5"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FallbackStrategy.forbid"}),": \u629B\u51FA\u5F02\u5E38"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FallbackStrategy.auto"}),": \u63D2\u4EF6\u81EA\u52A8\u9009\u62E9\u7B56\u7565"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u53E6\u5916 ",(0,r.jsx)(n.code,{children:"fallback"})," \u4F20\u5165 ",(0,r.jsx)(n.code,{children:"bool"})," \u65F6\uFF0C",(0,r.jsx)(n.code,{children:"True"})," \u7B49\u4EF7\u4E8E ",(0,r.jsx)(n.code,{children:"FallbackStrategy.auto"}),"\uFF0C",(0,r.jsx)(n.code,{children:"False"})," \u7B49\u4EF7\u4E8E ",(0,r.jsx)(n.code,{children:"FallbackStrategy.forbid"}),"\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"\u4E3B\u52A8\u53D1\u9001\u6D88\u606F",children:"\u4E3B\u52A8\u53D1\u9001\u6D88\u606F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"UniMessage.send"})," \u4E5F\u53EF\u4EE5\u7528\u4E8E\u4E3B\u52A8\u53D1\u9001\u6D88\u606F\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from nonebot_plugin_alconna.uniseg import UniMessage, Target, SupportScope\nfrom nonebot import get_driver\n\n\ndriver = get_driver()\n\n@driver.on_startup\nasync def on_startup():\n    target = Target("xxxx", scope=SupportScope.qq_client)\n    await UniMessage("Hello!").send(target=target)\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["\u5728\u54CD\u5E94\u5668\u4EE5\u5916\u7684\u5730\u65B9\uFF0C\u9664\u975E\u542F\u7528\u4E86 ",(0,r.jsx)(n.code,{children:"alconna_apply_fetch_targets"})," \u914D\u7F6E\u9879\uFF0C\u5426\u5219 ",(0,r.jsx)(n.code,{children:"bot"})," \u53C2\u6570\u5FC5\u987B\u624B\u52A8\u4F20\u5165\u3002"]})}),"\n",(0,r.jsx)(n.h3,{id:"receipt-\u5BF9\u8C61",children:"Receipt \u5BF9\u8C61"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"send"})," \u65B9\u6CD5\u8FD4\u56DE\u7684 ",(0,r.jsx)(n.code,{children:"Receipt"})," \u5BF9\u8C61\u53EF\u4EE5\u7528\u4E8E\u4FEE\u6539/\u64A4\u56DE/\u8868\u6001\u6D88\u606F\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'async def handle():\n    receipt = await UniMessage.text("hello!").send(at_sender=True, reply_to=True)\n    await receipt.recall(delay=1)\n    recept1 = await UniMessage.text("hello!").send(at_sender=True, reply_to=True)\n    await recept1.edit("world!")\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Receipt"})," \u5BF9\u8C61\u62E5\u6709\u4EE5\u4E0B\u65B9\u6CD5\uFF1A"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"recallable"}),": \u8868\u660E\u662F\u5426\u53EF\u4EE5\u64A4\u56DE"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"recall"}),": \u64A4\u56DE\u6D88\u606F"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"editable"}),": \u8868\u660E\u662F\u5426\u53EF\u4EE5\u4FEE\u6539"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"edit"}),": \u4FEE\u6539\u6D88\u606F"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"reactionable"}),": \u8868\u660E\u662F\u5426\u53EF\u4EE5\u8868\u6001"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"reaction"}),": \u8868\u6001\u6D88\u606F"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"get_reply"}),": \u751F\u6210\u5BF9\u5DF2\u7ECF\u53D1\u9001\u7684\u6D88\u606F\u7684\u56DE\u590D\u5143\u7D20"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"send"}),", ",(0,r.jsx)(n.code,{children:"finish"}),": \u53D1\u9001\u6D88\u606F"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"reply"}),": \u56DE\u590D\u5DF2\u7ECF\u53D1\u9001\u7684\u6D88\u606F"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u6784\u9020",children:"\u6784\u9020"}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u540C ",(0,r.jsx)(n.code,{children:"Message"}),", ",(0,r.jsx)(n.code,{children:"UniMessage"})," \u53EF\u4EE5\u4F20\u5165\u5355\u4E2A\u5B57\u7B26\u4E32/\u6D88\u606F\u6BB5\uFF0C\u6216\u53EF\u8FED\u4EE3\u7684\u5B57\u7B26\u4E32/\u6D88\u606F\u6BB5\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from nonebot_plugin_alconna.uniseg import UniMessage, At\n\n\nmsg = UniMessage("Hello")\nmsg1 = UniMessage(At("user", "124"))\nmsg2 = UniMessage(["Hello", At("user", "124")])\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"UniMessage"})," \u4E0A\u540C\u65F6\u5B58\u5728\u4FBF\u6377\u65B9\u6CD5\uFF0C\u4EE4\u5176\u53EF\u4EE5\u94FE\u5F0F\u5730\u6DFB\u52A0\u6D88\u606F\u6BB5\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from nonebot_plugin_alconna.uniseg import UniMessage, At, Image\n\n\nmsg = UniMessage.text("Hello").at("124").image(path="/path/to/img")\nassert msg == UniMessage(\n    ["Hello", At("user", "124"), Image(path="/path/to/img")]\n)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u4F7F\u7528\u6D88\u606F\u6A21\u677F",children:"\u4F7F\u7528\u6D88\u606F\u6A21\u677F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"UniMessage.template"})," \u540C\u6837\u7C7B\u4F3C\u4E8E ",(0,r.jsx)(n.code,{children:"Message.template"}),"\uFF0C\u53EF\u4EE5\u7528\u4E8E\u683C\u5F0F\u5316\u6D88\u606F\uFF0C\u5927\u4F53\u7528\u6CD5\u53C2\u8003 ",(0,r.jsx)(n.a,{href:"../../../tutorial/message#%E4%BD%BF%E7%94%A8%E6%B6%88%E6%81%AF%E6%A8%A1%E6%9D%BF",children:"\u6D88\u606F\u6A21\u677F"}),"\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u8FD9\u91CC\u989D\u5916\u8BF4\u660E ",(0,r.jsx)(n.code,{children:"UniMessage.template"})," \u7684\u62D3\u5C55\u63A7\u5236\u7B26"]}),"\n",(0,r.jsxs)(n.p,{children:["\u76F8\u6BD4 ",(0,r.jsx)(n.code,{children:"Message"}),"\uFF0CUniMessage \u5BF9\u4E8E ",(0,r.jsx)(n.code,{children:"{:XXX}"})," \u505A\u4E86\u53E6\u4E00\u7C7B\u62D3\u5C55\u3002\u5176\u80FD\u591F\u8BC6\u522B\u4F8B\u5982 At(xxx, yyy) \u6216 Emoji(aaa, bbb)\u7684\u5B57\u7B26\u4E32\u5E76\u6267\u884C"]}),"\n",(0,r.jsx)(n.p,{children:"\u4EE5 At(...) \u4E3A\u4F8B\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:"title=\u4F7F\u7528\u901A\u7528\u6D88\u606F\u6BB5\u7684\u62D3\u5C55\u63A7\u5236\u7B26",children:'>>> from nonebot_plugin_alconna.uniseg import UniMessage\n>>>  UniMessage.template("{:At(user, target)}").format(target="123")\nUniMessage(At("user", "123"))\n>>> UniMessage.template("{:At(type=user, target=id)}").format(id="123")\nUniMessage(At("user", "123"))\n>>> UniMessage.template("{:At(type=user, target=123)}").format()\nUniMessage(At("user", "123"))\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u800C\u5728 ",(0,r.jsx)(n.code,{children:"AlconnaMatcher"})," \u4E2D\uFF0C",(0,r.jsx)(n.code,{children:"{:XXX}"})," \u66F4\u8FDB\u4E00\u6B65\u5730\u63D0\u4F9B\u4E86\u83B7\u53D6 ",(0,r.jsx)(n.code,{children:"event"})," \u548C ",(0,r.jsx)(n.code,{children:"bot"})," \u4E2D\u7684\u5C5E\u6027\u7684\u529F\u80FD\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:"title=\u5728AlconnaMatcher\u4E2D\u4F7F\u7528\u901A\u7528\u6D88\u606F\u6BB5\u7684\u62D3\u5C55\u63A7\u5236\u7B26",children:'from arclet.alconna import Alconna, Args\nfrom nonebot_plugin_alconna import At, Match, UniMessage, AlconnaMatcher, on_alconna\n\n\ntest_cmd = on_alconna(Alconna("test", Args["target?", At]))\n\n@test_cmd.handle()\nasync def tt_h(matcher: AlconnaMatcher, target: Match[At]):\n    if target.available:\n        matcher.set_path_arg("target", target.result)\n\n@test_cmd.got_path(\n    "target",\n    prompt=UniMessage.template("{:At(user, $event.get_user_id())} \u8BF7\u786E\u8BA4\u76EE\u6807")\n)\nasync def tt():\n    await test_cmd.send(\n      UniMessage.template("{:At(user, $event.get_user_id())} \u5DF2\u786E\u8BA4\u76EE\u6807\u4E3A {target}")\n    )\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u53E6\u5916\u4E5F\u6709 ",(0,r.jsx)(n.code,{children:"$message_id"})," \u4E0E ",(0,r.jsx)(n.code,{children:"$target"})," \u4E24\u4E2A\u7279\u6B8A\u503C\u3002"]}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsxs)(n.p,{children:["\u6CE8\u610F\u5230\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u7684 ",(0,r.jsx)(n.code,{children:"{target}"})," \u4E86\u5417\uFF1F"]}),(0,r.jsxs)(n.p,{children:["\u5728 ",(0,r.jsx)(n.code,{children:"AlconnaMatcher"})," \u4E2D\uFF0C",(0,r.jsx)(n.code,{children:"UniMessage.template"})," \u7684\u683C\u5F0F\u5316\u65B9\u6CD5\u4F1A\u81EA\u52A8\u5C06 ",(0,r.jsx)(n.code,{children:"Arparma.all_matched_args"}),"\u3001 ",(0,r.jsx)(n.code,{children:"state"})," \u4E2D\u7684\u53D8\u91CF\u4F20\u5165\u5230 ",(0,r.jsx)(n.code,{children:"format"})," \u65B9\u6CD5\u4E2D\uFF0C\u56E0\u6B64\u4F60\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528\u4E0A\u8FF0\u53D8\u91CF\u3002"]})]}),"\n",(0,r.jsx)(n.h3,{id:"\u62FC\u63A5\u6D88\u606F",children:"\u62FC\u63A5\u6D88\u606F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"str"}),"\u3001",(0,r.jsx)(n.code,{children:"UniMessage"}),"\u3001",(0,r.jsx)(n.code,{children:"Segment"})," \u5BF9\u8C61\u4E4B\u95F4\u53EF\u4EE5\u76F4\u63A5\u76F8\u52A0\uFF0C\u76F8\u52A0\u5747\u4F1A\u8FD4\u56DE\u4E00\u4E2A\u65B0\u7684 ",(0,r.jsx)(n.code,{children:"UniMessage"})," \u5BF9\u8C61\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# \u6D88\u606F\u5E8F\u5217\u4E0E\u6D88\u606F\u6BB5\u76F8\u52A0\nUniMessage("text") + Text("text")\n# \u6D88\u606F\u5E8F\u5217\u4E0E\u5B57\u7B26\u4E32\u76F8\u52A0\nUniMessage([Text("text")]) + "text"\n# \u6D88\u606F\u5E8F\u5217\u4E0E\u6D88\u606F\u5E8F\u5217\u76F8\u52A0\nUniMessage("text") + UniMessage([Text("text")])\n# \u5B57\u7B26\u4E32\u4E0E\u6D88\u606F\u5E8F\u5217\u76F8\u52A0\n"text" + UniMessage([Text("text")])\n# \u6D88\u606F\u6BB5\u4E0E\u6D88\u606F\u6BB5\u76F8\u52A0\nText("text") + Text("text")\n# \u6D88\u606F\u6BB5\u4E0E\u5B57\u7B26\u4E32\u76F8\u52A0\nText("text") + "text"\n# \u6D88\u606F\u6BB5\u4E0E\u6D88\u606F\u5E8F\u5217\u76F8\u52A0\nText("text") + UniMessage([Text("text")])\n# \u5B57\u7B26\u4E32\u4E0E\u6D88\u606F\u6BB5\u76F8\u52A0\n"text" + Text("text")\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679C\u9700\u8981\u5728\u5F53\u524D\u6D88\u606F\u5E8F\u5217\u540E\u76F4\u63A5\u62FC\u63A5\u65B0\u7684\u6D88\u606F\u6BB5\uFF0C\u53EF\u4EE5\u4F7F\u7528 ",(0,r.jsx)(n.code,{children:"Message.append"}),"\u3001",(0,r.jsx)(n.code,{children:"Message.extend"})," \u65B9\u6CD5\uFF0C\u6216\u8005\u4F7F\u7528\u81EA\u52A0\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'msg = UniMessage([Text("text")])\n# \u81EA\u52A0\nmsg += "text"\nmsg += Text("text")\nmsg += UniMessage([Text("text")])\n# \u9644\u52A0\nmsg.append(Text("text"))\n# \u6269\u5C55\nmsg.extend([Text("text")])\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u64CD\u4F5C",children:"\u64CD\u4F5C"}),"\n",(0,r.jsx)(n.h3,{id:"\u68C0\u67E5\u6D88\u606F\u6BB5",children:"\u68C0\u67E5\u6D88\u606F\u6BB5"}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7 ",(0,r.jsx)(n.code,{children:"in"})," \u8FD0\u7B97\u7B26\u6216\u6D88\u606F\u5E8F\u5217\u7684 ",(0,r.jsx)(n.code,{children:"has"})," \u65B9\u6CD5\u6765\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# \u662F\u5426\u5B58\u5728\u6D88\u606F\u6BB5\nAt("user", "1234") in message\n# \u662F\u5426\u5B58\u5728\u6307\u5B9A\u7C7B\u578B\u7684\u6D88\u606F\u6BB5\nAt in message\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u4EEC\u8FD8\u53EF\u4EE5\u4F7F\u7528 ",(0,r.jsx)(n.code,{children:"only"})," \u65B9\u6CD5\u6765\u68C0\u67E5\u6D88\u606F\u4E2D\u662F\u5426\u4EC5\u5305\u542B\u6307\u5B9A\u7684\u6D88\u606F\u6BB5\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# \u662F\u5426\u90FD\u4E3A "test"\nmessage.only("test")\n# \u662F\u5426\u4EC5\u5305\u542B\u6307\u5B9A\u7C7B\u578B\u7684\u6D88\u606F\u6BB5\nmessage.only(Text)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u83B7\u53D6\u6D88\u606F\u7EAF\u6587\u672C",children:"\u83B7\u53D6\u6D88\u606F\u7EAF\u6587\u672C"}),"\n",(0,r.jsxs)(n.p,{children:["\u7C7B\u4F3C\u4E8E ",(0,r.jsx)(n.code,{children:"Message.extract_plain_text()"}),"\uFF0C\u7528\u4E8E\u83B7\u53D6\u901A\u7528\u6D88\u606F\u7684\u7EAF\u6587\u672C\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# \u63D0\u53D6\u6D88\u606F\u7EAF\u6587\u672C\u5B57\u7B26\u4E32\nassert UniMessage(\n    [At("user", "1234"), "text"]\n).extract_plain_text() == "text"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u904D\u5386",children:"\u904D\u5386"}),"\n",(0,r.jsxs)(n.p,{children:["\u901A\u7528\u6D88\u606F\u5E8F\u5217\u7EE7\u627F\u81EA ",(0,r.jsx)(n.code,{children:"List[Segment]"})," \uFF0C\u56E0\u6B64\u53EF\u4EE5\u4F7F\u7528 ",(0,r.jsx)(n.code,{children:"for"})," \u5FAA\u73AF\u904D\u5386\u6D88\u606F\u6BB5\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"for segment in message:  # type: Segment\n    ...\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u8FC7\u6EE4\u7D22\u5F15\u4E0E\u5207\u7247",children:"\u8FC7\u6EE4\u3001\u7D22\u5F15\u4E0E\u5207\u7247"}),"\n",(0,r.jsxs)(n.p,{children:["\u6D88\u606F\u5E8F\u5217\u5BF9\u5217\u8868\u7684\u7D22\u5F15\u4E0E\u5207\u7247\u8FDB\u884C\u4E86\u589E\u5F3A\uFF0C\u5728\u539F\u6709\u5217\u8868 ",(0,r.jsx)(n.code,{children:"int"})," \u7D22\u5F15\u4E0E ",(0,r.jsx)(n.code,{children:"slice"})," \u5207\u7247\u7684\u57FA\u7840\u4E0A\uFF0C\u652F\u6301 ",(0,r.jsx)(n.code,{children:"type"})," \u8FC7\u6EE4\u7D22\u5F15\u4E0E\u5207\u7247\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'message = UniMessage(\n    [\n        Reply(...),\n        "text1",\n        At("user", "1234"),\n        "text2"\n    ]\n)\n# \u7D22\u5F15\nmessage[0] == Reply(...)\n# \u5207\u7247\nmessage[0:2] == UniMessage([Reply(...), Text("text1")])\n# \u7C7B\u578B\u8FC7\u6EE4\nmessage[At] == Message([At("user", "1234")])\n# \u7C7B\u578B\u7D22\u5F15\nmessage[At, 0] == At("user", "1234")\n# \u7C7B\u578B\u5207\u7247\nmessage[Text, 0:2] == UniMessage([Text("text1"), Text("text2")])\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u4EEC\u4E5F\u53EF\u4EE5\u901A\u8FC7\u6D88\u606F\u5E8F\u5217\u7684 ",(0,r.jsx)(n.code,{children:"include"}),"\u3001",(0,r.jsx)(n.code,{children:"exclude"})," \u65B9\u6CD5\u8FDB\u884C\u7C7B\u578B\u8FC7\u6EE4\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"message.include(Text, At)\nmessage.exclude(Reply)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6216\u8005\u4F7F\u7528 ",(0,r.jsx)(n.code,{children:"filter"})," \u65B9\u6CD5\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'message.filter(lambda x: isinstance(x, At) and x.flag == "user")  # \u4EC5\u4FDD\u7559 At("user", xxx) \u7684\u6D88\u606F\u6BB5\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u540C\u6837\u7684\uFF0C\u6D88\u606F\u5E8F\u5217\u5BF9\u5217\u8868\u7684 ",(0,r.jsx)(n.code,{children:"index"}),"\u3001",(0,r.jsx)(n.code,{children:"count"})," \u65B9\u6CD5\u4E5F\u8FDB\u884C\u4E86\u589E\u5F3A\uFF0C\u53EF\u4EE5\u7528\u4E8E\u7D22\u5F15\u6307\u5B9A\u7C7B\u578B\u7684\u6D88\u606F\u6BB5\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# \u6307\u5B9A\u7C7B\u578B\u9996\u4E2A\u6D88\u606F\u6BB5\u7D22\u5F15\nmessage.index(Text) == 1\n# \u6307\u5B9A\u7C7B\u578B\u6D88\u606F\u6BB5\u6570\u91CF\nmessage.count(Text) == 2\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6B64\u5916\uFF0C\u6D88\u606F\u5E8F\u5217\u6DFB\u52A0\u4E86\u4E00\u4E2A ",(0,r.jsx)(n.code,{children:"get"})," \u65B9\u6CD5\uFF0C\u53EF\u4EE5\u7528\u4E8E\u83B7\u53D6\u6307\u5B9A\u7C7B\u578B\u6307\u5B9A\u4E2A\u6570\u7684\u6D88\u606F\u6BB5\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# \u83B7\u53D6\u6307\u5B9A\u7C7B\u578B\u6307\u5B9A\u4E2A\u6570\u7684\u6D88\u606F\u6BB5\nmessage.get(Text, 1) == UniMessage([Text("test1")])\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u5D4C\u5957\u63D0\u53D6",children:"\u5D4C\u5957\u63D0\u53D6"}),"\n",(0,r.jsxs)(n.p,{children:["\u6D88\u606F\u5E8F\u5217\u7684 ",(0,r.jsx)(n.code,{children:"select"})," \u65B9\u6CD5\u53EF\u4EE5\u9012\u5F52\u5730\u4ECE\u6D88\u606F\u4E2D\u9009\u62E9\u6307\u5B9A\u7C7B\u578B\u7684\u6D88\u606F\u6BB5\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'message = UniMessage(\n    [\n        Text("text1"),\n        Image(url="url1")(\n            Text("text2"),\n        )\n    ]\n)\nassert message.select(Text) == UniMessage(\n    [\n        Text("text1"),\n        Text("text2")\n    ]\n)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u8F6C\u6362",children:"\u8F6C\u6362"}),"\n",(0,r.jsxs)(n.p,{children:["\u6D88\u606F\u5E8F\u5217\u7684 ",(0,r.jsx)(n.code,{children:"map"})," \u65B9\u6CD5\u53EF\u4EE5\u7B80\u5355\u5730\u5C06\u6D88\u606F\u6BB5\u8F6C\u6362\u4E3A\u6307\u5B9A\u7C7B\u578B\u7684\u6570\u636E\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# \u8F6C\u6362\u6D88\u606F\u6BB5\u4E3A\u53E6\u4E00\u7C7B\u578B\u7684\u6D88\u606F\u6BB5\uFF0C\u6B64\u65F6\u8FD4\u56DE\u7ED3\u679C\u4ECD\u662F UniMessage\nmessage.map(lambda x: Text(x.target))  # \u8F6C\u6362\u4E3A Text \u6D88\u606F\u6BB5\n# \u8F6C\u6362\u6D88\u606F\u6BB5\u4E3A\u53E6\u4E00\u7C7B\u578B\u7684\u6570\u636E\uFF0C\u6B64\u65F6\u8FD4\u56DE\u7ED3\u679C\u4E3A list[T]\nmessage.map(lambda x: x.target)  # \u8F6C\u6362\u4E3A list[str]\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u6B64\u4E4B\u4E0A\uFF0C\u6D88\u606F\u5E8F\u5217\u8FD8\u63D0\u4F9B\u4E86 ",(0,r.jsx)(n.code,{children:"transform"})," \u548C ",(0,r.jsx)(n.code,{children:"transform_async"})," \u65B9\u6CD5\uFF0C\u5141\u8BB8\u4F60\u4F20\u5165\u8F6C\u6362\u89C4\u5219\uFF0C\u5C06\u6D88\u606F\u6BB5\u8F6C\u6362\u4E3A\u53E6\u4E00\u7C7B\u578B\u7684\u6D88\u606F\u6BB5\uFF0C\u5E76\u8FD4\u56DE\u4E00\u4E2A\u65B0\u7684\u6D88\u606F\u5E8F\u5217\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'rule = {\n    "text": True,\n    "at": lambda attrs, children: Text(attrs["target"])\n}\nmessage.transform(rule)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u8F6C\u6362\u89C4\u5219\u7684\u7C7B\u578B\u4E00\u822C\u4E3A ",(0,r.jsx)(n.code,{children:"dict[str, Transformer]"}),"\uFF0C\u4EE5\u6D88\u606F\u5143\u7D20\u7C7B\u578B\u7684\u540D\u79F0\u4E3A\u952E\uFF0C\u5B9A\u4E49\u65B9\u5F0F\u5982\u4E0B\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"type Fragment = Segment | Segment[];\ntype Render<T> = (attrs: dict, children: Segment[]) => T;\ntype Transformer = boolean | Fragment | Render<boolean | Fragment>;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5B57\u7B26\u4E32\u64CD\u4F5C",children:"\u5B57\u7B26\u4E32\u64CD\u4F5C"}),"\n",(0,r.jsxs)(n.p,{children:["\u7C7B\u4F3C\u4E8E ",(0,r.jsx)(n.code,{children:"str"}),"\uFF0C\u6D88\u606F\u5E8F\u5217\u53EF\u4EE5\u901A\u8FC7\u5982\u4E0B\u65B9\u6CD5\u6765\u64CD\u4F5C\u6D88\u606F\u5185\u7684\u6587\u672C\u90E8\u5206\uFF1A"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"split"}),","]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"replace"}),","]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"startwith"}),", ",(0,r.jsx)(n.code,{children:"endswith"}),","]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"removeprefix"}),", ",(0,r.jsx)(n.code,{children:"removesuffix"}),","]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"strip"}),", ",(0,r.jsx)(n.code,{children:"lstrip"}),", ",(0,r.jsx)(n.code,{children:"rstrip"}),","]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'msg = UniMessage.text("foo bar").at("1234").text("baz qux")\n# \u5206\u5272\uFF0C\u8FD4\u56DE\u5206\u5272\u7ED3\u679C\uFF0C\u7C7B\u578B\u4E3A list[UniMessage]\nparts = msg.split(" ")\n# \u66FF\u6362\uFF0C\u8FD4\u56DE\u66FF\u6362\u7ED3\u679C\uFF0C\u7C7B\u578B\u4E3A UniMessage\u3002\u65B0\u6587\u672C\u53EF\u4EE5\u7528 str \u6216 Text \u6765\u66FF\u6362\nnew_msg = msg.replace("ba", "baaa")\n# \u524D\u7F00/\u540E\u7F00\u68C0\u67E5\nmsg.startswith("foo")  # True\nmsg.endswith("qux")  # True\n# \u53BB\u9664\u524D\u7F00/\u540E\u7F00\nmsg1 = msg.removeprefix("foo")  # UniMessage([Text(" bar"), At("user", "1234"), Text("baz qux")])\nmsg2 = msg.removesuffix("qux")  # UniMessage([Text("foo bar"), At("user", "1234"), Text("baz ")])\n# \u53BB\u9664\u7A7A\u683C\nmsg1 = msg1.lstrip()  # UniMessage([Text("bar"), At("user", "1234"), Text("baz qux")])\nmsg2 = msg2.rstrip()  # UniMessage([Text("foo bar"), At("user", "1234"), Text("baz")])\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u6301\u4E45\u5316",children:"\u6301\u4E45\u5316"}),"\n",(0,r.jsxs)(n.p,{children:["\u7279\u522B\u7684\uFF0C",(0,r.jsx)(n.code,{children:"UniMessage"})," \u8FD8\u652F\u6301\u6D88\u606F\u6301\u4E45\u5316\uFF0C\u5177\u4F53\u6765\u8BF4\u4E3A ",(0,r.jsx)(n.code,{children:"dump"})," \u4E0E ",(0,r.jsx)(n.code,{children:"load"})," \u65B9\u6CD5\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'msg = UniMessage.text("Hello").image(url="url")\ndata = msg.dump()  # [{"type": "text", "text": "Hello"}, {"type": "image", "url": "url"}]\n\nassert UniMessage.load(data) == msg\n'})}),"\n",(0,r.jsx)(n.h3,{id:"dump",children:"dump"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"dump"})," \u65B9\u6CD5\u7684\u5B9A\u4E49\u5982\u4E0B\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"def dump(self, media_save_dir: str | Path | bool | None = None, json: bool = False) -> str | list[dict[str, Any]]: ...\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5176\u4E2D\uFF0C",(0,r.jsx)(n.code,{children:"media_save_dir"})," \u7528\u4E8E\u6307\u5B9A\u6301\u4E45\u5316\u7684\u5A92\u4F53\u6587\u4EF6\u5B58\u50A8\u76EE\u5F55:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u82E5 ",(0,r.jsx)(n.code,{children:"media_save_dir"})," \u4E3A str \u6216 Path\uFF0C\u5219\u4F1A\u5C06\u5A92\u4F53\u6587\u4EF6\u4FDD\u5B58\u5230\u6307\u5B9A\u76EE\u5F55\u4E0B\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u82E5 ",(0,r.jsx)(n.code,{children:"media_save_dir"})," \u4E3A False\uFF0C\u5219\u4E0D\u4F1A\u4FDD\u5B58\u5A92\u4F53\u6587\u4EF6\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u82E5 ",(0,r.jsx)(n.code,{children:"media_save_dir"})," \u4E3A True\uFF0C\u5219\u4F1A\u5C06\u6587\u4EF6\u6570\u636E\u8F6C\u4E3A base64 \u7F16\u7801\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u82E5\u4E0D\u6307\u5B9A ",(0,r.jsx)(n.code,{children:"media_save_dir"}),"\uFF0C\u5219\u4F1A\u5C1D\u8BD5\u5BFC\u5165 ",(0,r.jsx)(n.a,{href:"/website/docs/next/best-practice/data-storing",children:(0,r.jsx)(n.code,{children:"nonebot_plugin_localstore"})})," \u5E76\u4F7F\u7528\u5176\u63D0\u4F9B\u7684\u8DEF\u5F84\u3002\u5426\u5219 (\u5373 ",(0,r.jsx)(n.code,{children:"localstore"})," \u672A\u5B89\u88C5)\uFF0C\u5C06\u4F1A\u5C1D\u8BD5\u4F7F\u7528\u5F53\u524D\u5DE5\u4F5C\u76EE\u5F55\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"load",children:"load"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"load"})," \u65B9\u6CD5\u7684\u5B9A\u4E49\u5982\u4E0B\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"@classmethod\ndef load(cls, data: str | list[dict[str, Any]]) -> UniMessage: ...\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5176\u4E2D ",(0,r.jsx)(n.code,{children:"data"})," \u5E94\u7B26\u5408 JSON \u683C\u5F0F\u3002"]})]})}function g(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(x,{...e})}):x(e)}},80981:function(e,n,s){s.d(n,{Z:function(){return a}});var t=s(24246);s(27378);var r=s(90496);function a(e){let{children:n,hidden:s,className:a}=e;return(0,t.jsx)("div",{role:"tabpanel",className:(0,r.Z)("tab-panel",a),hidden:s,children:n})}},75037:function(e,n,s){s.d(n,{Z:()=>m});var t=s("24246"),r=s("27378"),a=s("90496"),l=s("85403"),i=s("3620"),c=s("77090"),d=s("76180"),o=s("23418"),h=s("19073");function x(e){let{value:n,tabValues:s}=e;return s.some(e=>e.value===n)}var g=s("3344");function j(e){let{className:n,selectedValue:s,selectValue:r,tabValues:i}=e,c=[],{blockElementScrollPositionUntilNextRender:d}=(0,l.o5)(),o=e=>{let n=e.currentTarget,t=i[c.indexOf(n)].value;t!==s&&(d(n),r(t))},h=e=>{let n=null;switch(e.key){case"Enter":o(e);break;case"ArrowRight":{let s=c.indexOf(e.currentTarget)+1;n=c[s]??c[0];break}case"ArrowLeft":{let s=c.indexOf(e.currentTarget)-1;n=c[s]??c[c.length-1]}}n?.focus()};return(0,t.jsx)("div",{className:"not-prose",children:(0,t.jsxs)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs tabs-list",n),children:[i.map(e=>{let{value:n,label:r,attributes:l}=e;return(0,t.jsx)("li",{role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,ref:e=>{c.push(e)},onKeyDown:h,onClick:o,...l,className:(0,a.Z)("tab tab-lifted tab-item",l?.className,s===n&&"tab-active tab-item-active"),children:r??n},n)}),(0,t.jsx)("div",{className:"tab tab-lifted tab-item tab-spacer"})]})})}function u(e){let{lazy:n,children:s,selectedValue:a}=e,l=(Array.isArray(s)?s:[s]).filter(Boolean);if(n){let e=l.find(e=>e.props.value===a);return e?(0,t.jsx)("div",{children:(0,r.cloneElement)(e)}):null}return(0,t.jsx)("div",{children:l.map((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==a}))})}function p(e){let n=function(e){let{defaultValue:n,queryString:s=!1,groupId:t}=e,a=function(e){let{values:n,children:s}=e;return(0,r.useMemo)(()=>{let e=n??(r.Children.toArray(s).filter(e=>"\n"!==e).map(e=>{if(!e||r.isValidElement(e)&&function(e){let{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]).map(e=>{let{props:{value:n,label:s,attributes:t,default:r}}=e;return{value:n,label:s,attributes:t,default:r}});return!function(e){let n=(0,o.lx)(e,(e,n)=>e.value===n.value);if(n.length>0)throw Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,s])}(e),[l,g]=(0,r.useState)(()=>(function(e){let{defaultValue:n,tabValues:s}=e;if(0===s.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!x({value:n,tabValues:s}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${s.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}let t=s.find(e=>e.default)??s[0];if(!t)throw Error("Unexpected error: 0 tabValues");return t.value})({defaultValue:n,tabValues:a})),[j,u]=function(e){let{queryString:n=!1,groupId:s}=e,t=(0,i.k6)(),a=function(e){let{queryString:n=!1,groupId:s}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!s)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return s??null}({queryString:n,groupId:s});return[(0,d._X)(a),(0,r.useCallback)(e=>{if(!a)return;let n=new URLSearchParams(t.location.search);n.set(a,e),t.replace({...t.location,search:n.toString()})},[a,t])]}({queryString:s,groupId:t}),[p,m]=function(e){let{groupId:n}=e,s=n?`docusaurus.tab.${n}`:null,[t,a]=(0,h.Nk)(s);return[t,(0,r.useCallback)(e=>{s&&a.set(e)},[s,a])]}({groupId:t}),f=(()=>{let e=j??p;return x({value:e,tabValues:a})?e:null})();return(0,c.Z)(()=>{f&&g(f)},[f]),{selectedValue:l,selectValue:(0,r.useCallback)(e=>{if(!x({value:e,tabValues:a}))throw Error(`Can't select invalid tab value=${e}`);g(e),u(e),m(e)},[u,m,a]),tabValues:a}}(e);return(0,t.jsxs)("div",{className:"tabs-container",children:[(0,t.jsx)(j,{...e,...n}),(0,t.jsx)(u,{...e,...n})]})}function m(e){let n=(0,g.Z)();return(0,t.jsx)(p,{...e},String(n))}},80980:function(e,n,s){s.d(n,{Z:function(){return i},a:function(){return l}});var t=s(27378);let r={},a=t.createContext(r);function l(e){let n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);