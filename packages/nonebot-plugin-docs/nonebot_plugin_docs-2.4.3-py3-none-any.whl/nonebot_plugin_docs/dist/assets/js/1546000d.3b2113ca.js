"use strict";(self.webpackChunknonebot=self.webpackChunknonebot||[]).push([["7905"],{97964:function(e,n,s){s.r(n),s.d(n,{default:()=>h,frontMatter:()=>t,metadata:()=>a,assets:()=>r,toc:()=>o,contentTitle:()=>c});var a=JSON.parse('{"id":"best-practice/alconna/uniseg/README","title":"\u901A\u7528\u6D88\u606F\u7EC4\u4EF6","description":"uniseg \u6A21\u5757\u5C5E\u4E8E nonebot-plugin-alconna \u7684\u5B50\u63D2\u4EF6\u3002","source":"@site/docs/best-practice/alconna/uniseg/README.md","sourceDirName":"best-practice/alconna/uniseg","slug":"/best-practice/alconna/uniseg/","permalink":"/website/docs/next/best-practice/alconna/uniseg/","draft":false,"unlisted":false,"editUrl":"https://github.com/nonebot/nonebot2/edit/master/website/docs/best-practice/alconna/uniseg/README.md","tags":[],"version":"current","lastUpdatedBy":"noneflow[bot]","lastUpdatedAt":1754561629000,"frontMatter":{},"sidebar":"tutorial","previous":{"title":"\u914D\u7F6E\u9879","permalink":"/website/docs/next/best-practice/alconna/config"},"next":{"title":"\u901A\u7528\u6D88\u606F\u6BB5","permalink":"/website/docs/next/best-practice/alconna/uniseg/segment"}}'),l=s("24246"),i=s("80980");let t={},c="\u901A\u7528\u6D88\u606F\u7EC4\u4EF6",r={},o=[{value:"\u793A\u4F8B",id:"\u793A\u4F8B",level:2},{value:"\u5BFC\u5165",id:"\u5BFC\u5165",level:3},{value:"\u6784\u5EFA",id:"\u6784\u5EFA",level:3},{value:"\u53D1\u9001",id:"\u53D1\u9001",level:3},{value:"\u64A4\u56DE\uFF0C\u7F16\u8F91\uFF0C\u8868\u6001",id:"\u64A4\u56DE\u7F16\u8F91\u8868\u6001",level:3},{value:"\u5904\u7406\u6D88\u606F",id:"\u5904\u7406\u6D88\u606F",level:3},{value:"\u6301\u4E45\u5316",id:"\u6301\u4E45\u5316",level:3}];function d(e){let n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"\u901A\u7528\u6D88\u606F\u7EC4\u4EF6",children:"\u901A\u7528\u6D88\u606F\u7EC4\u4EF6"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"uniseg"})," \u6A21\u5757\u5C5E\u4E8E ",(0,l.jsx)(n.code,{children:"nonebot-plugin-alconna"})," \u7684\u5B50\u63D2\u4EF6\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"\u901A\u7528\u6D88\u606F\u7EC4\u4EF6\u5185\u5BB9\u8F83\u591A\uFF0C\u6545\u5206\u4E3A\u4E86\u4E00\u4E2A\u793A\u4F8B\u4EE5\u53CA\u6570\u4E2A\u4E13\u9898\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"\u793A\u4F8B",children:"\u793A\u4F8B"}),"\n",(0,l.jsx)(n.h3,{id:"\u5BFC\u5165",children:"\u5BFC\u5165"}),"\n",(0,l.jsxs)(n.p,{children:["\u4E00\u822C\u60C5\u51B5\u4E0B\uFF0C\u4F60\u53EA\u9700\u8981\u4ECE ",(0,l.jsx)(n.code,{children:"nonebot_plugin_alconna.uniseg"})," \u4E2D\u5BFC\u5165 ",(0,l.jsx)(n.code,{children:"UniMessage"})," \u5373\u53EF:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"from nonebot_plugin_alconna.uniseg import UniMessage\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u6784\u5EFA",children:"\u6784\u5EFA"}),"\n",(0,l.jsxs)(n.p,{children:["\u4F60\u53EF\u4EE5\u901A\u8FC7 ",(0,l.jsx)(n.code,{children:"UniMessage"})," \u4E0A\u7684\u5FEB\u6377\u65B9\u6CD5\u6765\u94FE\u5F0F\u6784\u9020\u6D88\u606F:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'message = (\n    UniMessage.text("hello world")\n    .at("1234567890")\n    .image(url="https://example.com/image.png")\n)\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u4E5F\u53EF\u4EE5\u901A\u8FC7\u5BFC\u5165\u901A\u7528\u6D88\u606F\u6BB5\u6765\u6784\u5EFA\u6D88\u606F:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from nonebot_plugin_alconna import Text, At, Image, UniMessage\n\nmessage = UniMessage(\n    [\n        Text("hello world"),\n        At("user", "1234567890"),\n        Image(url="https://example.com/image.png"),\n    ]\n)\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u66F4\u6DF1\u5165\u4E00\u70B9\uFF0C\u6BD4\u5982\u4F60\u60F3\u8981\u53D1\u9001\u4E00\u6761\u5305\u542B\u591A\u4E2A\u6309\u94AE\u7684\u6D88\u606F\uFF0C\u4F60\u53EF\u4EE5\u8FD9\u6837\u505A:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from nonebot_plugin_alconna import Button, UniMessage\n\nmessage = (\n    UniMessage.text("hello world")\n    .keyboard(\n        Button("link1", url="https://example.com/1"),\n        Button("link2", url="https://example.com/2"),\n        Button("link3", url="https://example.com/3"),\n        row=3,\n    )\n)\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u53D1\u9001",children:"\u53D1\u9001"}),"\n",(0,l.jsxs)(n.p,{children:["\u4F60\u53EF\u4EE5\u901A\u8FC7 ",(0,l.jsx)(n.code,{children:".send"})," \u65B9\u6CD5\u6765\u53D1\u9001\u6D88\u606F:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'@matcher.handle()\nasync def _():\n    message = UniMessage.text("hello world").image(url="https://example.com/image.png")\n    await message.send()\n    # \u7C7B\u4F3C\u4E8E `matcher.finish`\n    await message.finish()\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u4F60\u53EF\u4EE5\u901A\u8FC7\u53C2\u6570\u6765\u8BA9\u6D88\u606F @ \u53D1\u9001\u8005:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'@matcher.handle()\nasync def _():\n    message = UniMessage.text("hello world").image(url="https://example.com/image.png")\n    await message.send(at_sender=True)\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u6216\u8005\u56DE\u590D\u6D88\u606F:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'@matcher.handle()\nasync def _():\n    message = UniMessage.text("hello world").image(url="https://example.com/image.png")\n    await message.send(reply_to=True)\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u64A4\u56DE\u7F16\u8F91\u8868\u6001",children:"\u64A4\u56DE\uFF0C\u7F16\u8F91\uFF0C\u8868\u6001"}),"\n",(0,l.jsxs)(n.p,{children:["\u4F60\u53EF\u4EE5\u901A\u8FC7 ",(0,l.jsx)(n.code,{children:"message_recall"}),", ",(0,l.jsx)(n.code,{children:"message_edit"})," \u548C ",(0,l.jsx)(n.code,{children:"message_reaction"})," \u65B9\u6CD5\u6765\u64A4\u56DE\uFF0C\u7F16\u8F91\u548C\u8868\u6001\u6D88\u606F\u4E8B\u4EF6\u3002"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from nonebot_plugin_alconna import message_recall, message_edit, message_reaction\n\n@matcher.handle()\nasync def _():\n    await message_edit(UniMessage.text("hello world"))\n    await message_reaction("\uD83D\uDC4D")\n    await message_recall()\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u4F60\u4E5F\u53EF\u4EE5\u5BF9\u4F60\u81EA\u5DF1\u53D1\u9001\u7684\u6D88\u606F\u8FDB\u884C\u64A4\u56DE\uFF0C\u7F16\u8F91\u548C\u8868\u6001:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'@matcher.handle()\nasync def _():\n    message = UniMessage.text("hello world").image(url="https://example.com/image.png")\n    receipt = await message.send()\n    await receipt.edit(UniMessage.text("hello world!"))\n    await receipt.reaction("\uD83D\uDC4D")\n    await receipt.recall(delay=5)  # 5\u79D2\u540E\u64A4\u56DE\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u5904\u7406\u6D88\u606F",children:"\u5904\u7406\u6D88\u606F"}),"\n",(0,l.jsx)(n.p,{children:"\u901A\u8FC7\u4F9D\u8D56\u6CE8\u5165\uFF0C\u4F60\u53EF\u4EE5\u5728\u4E8B\u4EF6\u5904\u7406\u5668\u4E2D\u83B7\u53D6\u901A\u7528\u6D88\u606F:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"from nonebot_plugin_alconna import UniMsg\n\n@matcher.handle()\nasync def _(msg: UniMsg):\n    ...\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u7136\u540E\u4F60\u53EF\u4EE5\u901A\u8FC7 ",(0,l.jsx)(n.code,{children:"UniMessage"})," \u7684\u65B9\u6CD5\u6765\u5904\u7406\u6D88\u606F."]}),"\n",(0,l.jsx)(n.p,{children:"\u4F8B\u5982\uFF0C\u4F60\u60F3\u77E5\u9053\u6D88\u606F\u4E2D\u662F\u5426\u5305\u542B\u56FE\u7247\uFF0C\u4F60\u53EF\u4EE5\u8FD9\u6837\u505A:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"ans1 = Image in message\nans2 = message.has(Image)\nans3 = message.only(Image)\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6216\u8005\uFF0C\u63D0\u53D6\u6240\u6709\u7684\u56FE\u7247\uFF1A"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'imgs_1 = message[Image]\nimgs_2 = message.get(Image)\nimgs_3 = message.include(Image)\nimgs_4 = message.select(Image)\nimgs_5 = message.filter(lambda x: x.type == "image")\nimgs_6 = message.tranform({"image": True})\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u800C\u540E\uFF0C\u5982\u679C\u4F60\u60F3\u63D0\u53D6\u51FA\u6240\u6709\u7684\u56FE\u7247\u94FE\u63A5\uFF0C\u4F60\u53EF\u4EE5\u8FD9\u6837\u505A:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"urls = imgs.map(lambda x: x.url)\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5982\u679C\u4F60\u60F3\u77E5\u9053\u6D88\u606F\u662F\u5426\u7B26\u5408\u67D0\u4E2A\u524D\u7F00\uFF0C\u4F60\u53EF\u4EE5\u8FD9\u6837\u505A:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'@matcher.handle()\nasync def _(msg: UniMsg):\n    if msg.startswith("hello"):\n        await matcher.finish("hello world")\n    else:\n        await matcher.finish("not hello world")\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u6216\u8005\u4F60\u60F3\u63A5\u7740\u53BB\u9664\u6389\u524D\u7F00:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'@matcher.handle()\nasync def _(msg: UniMsg):\n    if msg.startswith("hello"):\n        msg = msg.removeprefix("hello")\n        await matcher.finish(msg)\n    else:\n        await matcher.finish("not hello world")\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u6301\u4E45\u5316",children:"\u6301\u4E45\u5316"}),"\n",(0,l.jsxs)(n.p,{children:["\u5047\u8BBE\u4F60\u5728\u7F16\u5199\u4E00\u4E2A\u8BCD\u5E93\u67E5\u8BE2\u63D2\u4EF6\uFF0C\u4F60\u53EF\u4EE5\u901A\u8FC7 ",(0,l.jsx)(n.code,{children:"UniMessage.dump"})," \u65B9\u6CD5\u6765\u5C06\u6D88\u606F\u5E8F\u5217\u5316\u4E3A JSON \u683C\u5F0F:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"from nonebot_plugin_alconna import UniMsg\n\n@matcher.handle()\nasync def _(msg: UniMsg):\n    data: list[dict] = msg.dump()\n    # \u4F60\u53EF\u4EE5\u5C06 data \u5B58\u50A8\u5230\u6570\u636E\u5E93\u6216\u8005 JSON \u6587\u4EF6\u4E2D\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u800C\u540E\u4F60\u53EF\u4EE5\u901A\u8FC7 ",(0,l.jsx)(n.code,{children:"UniMessage.load"})," \u65B9\u6CD5\u6765\u5C06 JSON \u683C\u5F0F\u7684\u6D88\u606F\u53CD\u5E8F\u5217\u5316\u4E3A ",(0,l.jsx)(n.code,{children:"UniMessage"})," \u5BF9\u8C61:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from nonebot_plugin_alconna import UniMessage\n\n@matcher.handle()\nasync def _():\n    data = [\n        {"type": "text", "text": "hello world"},\n        {"type": "image", "url": "https://example.com/image.png"},\n    ]\n    message = UniMessage.load(data)\n'})})]})}function h(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},80980:function(e,n,s){s.d(n,{Z:function(){return c},a:function(){return t}});var a=s(27378);let l={},i=a.createContext(l);function t(e){let n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);