"use strict";(self.webpackChunknonebot=self.webpackChunknonebot||[]).push([["1964"],{70288:function(e,n,l){l.r(n),l.d(n,{default:()=>p,frontMatter:()=>o,metadata:()=>r,assets:()=>d,toc:()=>u,contentTitle:()=>c});var r=JSON.parse('{"id":"best-practice/database/README","title":"\u6570\u636E\u5E93","description":"nonebot-plugin-orm \u662F NoneBot \u7684\u6570\u636E\u5E93\u652F\u6301\u63D2\u4EF6\u3002","source":"@site/versioned_docs/version-2.4.2/best-practice/database/README.mdx","sourceDirName":"best-practice/database","slug":"/best-practice/database/","permalink":"/website/docs/2.4.2/best-practice/database/","draft":false,"unlisted":false,"editUrl":"https://github.com/nonebot/nonebot2/edit/master/website/versioned_docs/version-2.4.2/best-practice/database/README.mdx","tags":[],"version":"2.4.2","lastUpdatedBy":"noneflow[bot]","lastUpdatedAt":1754561629000,"frontMatter":{},"sidebar":"tutorial","previous":{"title":"\u901A\u7528\u6D88\u606F\u7EC4\u4EF6","permalink":"/website/docs/2.4.2/best-practice/alconna/uniseg"},"next":{"title":"\u7528\u6237\u6307\u5357","permalink":"/website/docs/2.4.2/best-practice/database/user"}}'),t=l("24246"),a=l("80980"),s=l("80981"),i=l("75037");let o={},c="\u6570\u636E\u5E93",d={},u=[{value:"\u5B89\u88C5",id:"\u5B89\u88C5",level:2},{value:"\u6570\u636E\u5E93\u9A71\u52A8\u548C\u540E\u7AEF",id:"\u6570\u636E\u5E93\u9A71\u52A8\u548C\u540E\u7AEF",level:2},{value:"SQLite",id:"sqlite",level:3},{value:"PostgreSQL",id:"postgresql",level:3},{value:"MySQL / MariaDB",id:"mysql--mariadb",level:3},{value:"\u4F7F\u7528",id:"\u4F7F\u7528",level:2}];function h(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"\u6570\u636E\u5E93",children:"\u6570\u636E\u5E93"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://github.com/nonebot/plugin-orm",children:(0,t.jsx)(n.code,{children:"nonebot-plugin-orm"})})," \u662F NoneBot \u7684\u6570\u636E\u5E93\u652F\u6301\u63D2\u4EF6\u3002\n\u672C\u63D2\u4EF6\u57FA\u4E8E ",(0,t.jsx)(n.a,{href:"https://www.sqlalchemy.org/",children:"SQLAlchemy"})," \u548C ",(0,t.jsx)(n.a,{href:"https://alembic.sqlalchemy.org/",children:"Alembic"}),"\uFF0C\u63D0\u4F9B\u4E86\u8BB8\u591A\u4E0E NoneBot \u7D27\u5BC6\u96C6\u6210\u7684\u529F\u80FD\uFF1A"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u591A Engine / Connection \u652F\u6301"}),"\n",(0,t.jsx)(n.li,{children:"Session \u7BA1\u7406"}),"\n",(0,t.jsx)(n.li,{children:"\u5173\u7CFB\u6A21\u578B\u7BA1\u7406\u3001\u4F9D\u8D56\u6CE8\u5165\u652F\u6301"}),"\n",(0,t.jsx)(n.li,{children:"\u6570\u636E\u5E93\u8FC1\u79FB"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u5B89\u88C5",children:"\u5B89\u88C5"}),"\n",(0,t.jsxs)(i.Z,{groupId:"install",children:[(0,t.jsx)(s.Z,{value:"cli",label:"\u4F7F\u7528 nb-cli",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"nb plugin install nonebot-plugin-orm\n"})})}),(0,t.jsx)(s.Z,{value:"pip",label:"\u4F7F\u7528 pip",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"pip install nonebot-plugin-orm\n"})})}),(0,t.jsx)(s.Z,{value:"pdm",label:"\u4F7F\u7528 pdm",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"pdm add nonebot-plugin-orm\n"})})})]}),"\n",(0,t.jsx)(n.h2,{id:"\u6570\u636E\u5E93\u9A71\u52A8\u548C\u540E\u7AEF",children:"\u6570\u636E\u5E93\u9A71\u52A8\u548C\u540E\u7AEF"}),"\n",(0,t.jsx)(n.p,{children:"\u672C\u63D2\u4EF6\u53EA\u63D0\u4F9B\u4E86 ORM \u529F\u80FD\uFF0C\u6CA1\u6709\u6570\u636E\u5E93\u540E\u7AEF\uFF0C\u4E5F\u6CA1\u6709\u76F4\u63A5\u8FDE\u63A5\u6570\u636E\u5E93\u540E\u7AEF\u7684\u80FD\u529B\u3002\n\u6240\u4EE5\u4F60\u9700\u8981\u53E6\u884C\u5B89\u88C5\u6570\u636E\u5E93\u9A71\u52A8\u548C\u6570\u636E\u5E93\u540E\u7AEF\uFF0C\u5E76\u4E14\u914D\u7F6E\u6570\u636E\u5E93\u8FDE\u63A5\u4FE1\u606F\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"sqlite",children:"SQLite"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://www.sqlite.org/",children:"SQLite"})," \u662F\u4E00\u4E2A\u8F7B\u91CF\u7EA7\u7684\u5D4C\u5165\u5F0F\u6570\u636E\u5E93\uFF0C\u5B83\u7684\u6570\u636E\u4EE5\u5355\u6587\u4EF6\u7684\u5F62\u5F0F\u5B58\u50A8\u5728\u672C\u5730\uFF0C\u4E0D\u9700\u8981\u5355\u72EC\u7684\u6570\u636E\u5E93\u540E\u7AEF\u3002\nSQLite \u975E\u5E38\u9002\u5408\u7528\u4E8E\u5F00\u53D1\u73AF\u5883\u548C\u5C0F\u578B\u5E94\u7528\uFF0C\u4F46\u662F\u4E0D\u9002\u5408\u7528\u4E8E\u5927\u578B\u5E94\u7528\u7684\u751F\u4EA7\u73AF\u5883\u3002"]}),"\n",(0,t.jsx)(n.p,{children:"\u867D\u7136\u4E0D\u9700\u8981\u53E6\u884C\u5B89\u88C5\u6570\u636E\u5E93\u540E\u7AEF\uFF0C\u4F46\u4F60\u4ECD\u7136\u9700\u8981\u5B89\u88C5\u6570\u636E\u5E93\u9A71\u52A8\uFF1A"}),"\n",(0,t.jsxs)(i.Z,{groupId:"install",children:[(0,t.jsx)(s.Z,{value:"pip",label:"\u4F7F\u7528 pip",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'pip install "nonebot-plugin-orm[sqlite]"\n'})})}),(0,t.jsx)(s.Z,{value:"pdm",label:"\u4F7F\u7528 pdm",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'pdm add "nonebot-plugin-orm[sqlite]"\n'})})})]}),"\n",(0,t.jsxs)(n.p,{children:["\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u6570\u636E\u5E93\u6587\u4EF6\u4E3A ",(0,t.jsx)(n.code,{children:"<data path>/nonebot-plugin-orm/db.sqlite3"}),"\uFF08\u6570\u636E\u76EE\u5F55\u7531 ",(0,t.jsx)(n.a,{href:"../data-storing",children:"nonebot-plugin-localstore"})," \u63D0\u4F9B\uFF09\u3002\n\u6216\u8005\uFF0C\u4F60\u53EF\u4EE5\u901A\u8FC7\u914D\u7F6E ",(0,t.jsx)(n.code,{children:"SQLALCHEMY_DATABASE_URL"})," \u6765\u6307\u5B9A\u6570\u636E\u5E93\u6587\u4EF6\u8DEF\u5F84\uFF1A"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"SQLALCHEMY_DATABASE_URL=sqlite+aiosqlite:///file_path\n"})}),"\n",(0,t.jsx)(n.h3,{id:"postgresql",children:"PostgreSQL"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://www.postgresql.org/",children:"PostgreSQL"})," \u662F\u4E16\u754C\u4E0A\u6700\u5148\u8FDB\u7684\u5F00\u6E90\u5173\u7CFB\u6570\u636E\u5E93\u4E4B\u4E00\uFF0C\u5BF9\u5404\u79CD\u9AD8\u7EA7\u4E14\u5E7F\u6CDB\u5E94\u7528\u7684\u529F\u80FD\u6709\u6700\u597D\u7684\u652F\u6301\uFF0C\u662F\u4E2D\u5C0F\u578B\u5E94\u7528\u7684\u9996\u9009\u6570\u636E\u5E93\u3002"]}),"\n",(0,t.jsxs)(i.Z,{groupId:"install",children:[(0,t.jsx)(s.Z,{value:"pip",label:"\u4F7F\u7528 pip",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"pip install nonebot-plugin-orm[postgresql]\n"})})}),(0,t.jsx)(s.Z,{value:"pdm",label:"\u4F7F\u7528 pdm",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"pdm add nonebot-plugin-orm[postgresql]\n"})})})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"SQLALCHEMY_DATABASE_URL=postgresql+psycopg://user:password@host:port/dbname[?key=value&key=value...]\n"})}),"\n",(0,t.jsx)(n.h3,{id:"mysql--mariadb",children:"MySQL / MariaDB"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://www.mysql.com/",children:"MySQL"})," \u548C ",(0,t.jsx)(n.a,{href:"https://mariadb.com/",children:"MariaDB"})," \u662F\u7ECF\u5178\u7684\u5F00\u6E90\u5173\u7CFB\u6570\u636E\u5E93\uFF0C\u9002\u5408\u7528\u4E8E\u4E2D\u5C0F\u578B\u5E94\u7528\u3002"]}),"\n",(0,t.jsxs)(i.Z,{groupId:"install",children:[(0,t.jsx)(s.Z,{value:"pip",label:"\u4F7F\u7528 pip",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"pip install nonebot-plugin-orm[mysql]\n"})})}),(0,t.jsx)(s.Z,{value:"pdm",label:"\u4F7F\u7528 pdm",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"pdm add nonebot-plugin-orm[mysql]\n"})})})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"SQLALCHEMY_DATABASE_URL=mysql+aiomysql://user:password@host:port/dbname[?key=value&key=value...]\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u4F7F\u7528",children:"\u4F7F\u7528"}),"\n",(0,t.jsxs)(n.p,{children:["\u672C\u63D2\u4EF6\u63D0\u4F9B\u4E86\u6570\u636E\u5E93\u8FC1\u79FB\u529F\u80FD\uFF08\u6B64\u529F\u80FD\u4F9D\u8D56\u4E8E ",(0,t.jsx)(n.a,{href:"../../quick-start#%E5%AE%89%E8%A3%85%E8%84%9A%E6%89%8B%E6%9E%B6",children:"nb-cli \u811A\u624B\u67B6"}),"\uFF09\u3002\n\u5728\u5B89\u88C5\u4E86\u65B0\u7684\u63D2\u4EF6\u6216\u673A\u5668\u4EBA\u4E4B\u540E\uFF0C\u4F60\u9700\u8981\u6267\u884C\u4E00\u6B21\u6570\u636E\u5E93\u8FC1\u79FB\u64CD\u4F5C\uFF0C\u5C06\u6570\u636E\u5E93\u540C\u6B65\u81F3\u4E0E\u673A\u5668\u4EBA\u4E00\u81F4\u7684\u72B6\u6001\uFF1A"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"nb orm upgrade\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u8FD0\u884C\u5B8C\u6BD5\u540E\uFF0C\u53EF\u4EE5\u68C0\u67E5\u4E00\u4E0B\uFF1A"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"nb orm check\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5982\u679C\u8F93\u51FA\u662F ",(0,t.jsx)(n.code,{children:"\u6CA1\u6709\u68C0\u6D4B\u5230\u65B0\u7684\u5347\u7EA7\u64CD\u4F5C"}),"\uFF0C\u90A3\u4E48\u606D\u559C\u4F60\uFF0C\u6570\u636E\u5E93\u5DF2\u7ECF\u8FC1\u79FB\u5B8C\u6210\u4E86\uFF0C\u4F60\u53EF\u4EE5\u542F\u52A8\u673A\u5668\u4EBA\u4E86\u3002"]})]})}function p(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},80981:function(e,n,l){l.d(n,{Z:function(){return a}});var r=l(24246);l(27378);var t=l(90496);function a(e){let{children:n,hidden:l,className:a}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,t.Z)("tab-panel",a),hidden:l,children:n})}},75037:function(e,n,l){l.d(n,{Z:()=>j});var r=l("24246"),t=l("27378"),a=l("90496"),s=l("85403"),i=l("3620"),o=l("77090"),c=l("76180"),d=l("23418"),u=l("19073");function h(e){let{value:n,tabValues:l}=e;return l.some(e=>e.value===n)}var p=l("3344");function m(e){let{className:n,selectedValue:l,selectValue:t,tabValues:i}=e,o=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.o5)(),d=e=>{let n=e.currentTarget,r=i[o.indexOf(n)].value;r!==l&&(c(n),t(r))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{let l=o.indexOf(e.currentTarget)+1;n=o[l]??o[0];break}case"ArrowLeft":{let l=o.indexOf(e.currentTarget)-1;n=o[l]??o[o.length-1]}}n?.focus()};return(0,r.jsx)("div",{className:"not-prose",children:(0,r.jsxs)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs tabs-list",n),children:[i.map(e=>{let{value:n,label:t,attributes:s}=e;return(0,r.jsx)("li",{role:"tab",tabIndex:l===n?0:-1,"aria-selected":l===n,ref:e=>{o.push(e)},onKeyDown:u,onClick:d,...s,className:(0,a.Z)("tab tab-lifted tab-item",s?.className,l===n&&"tab-active tab-item-active"),children:t??n},n)}),(0,r.jsx)("div",{className:"tab tab-lifted tab-item tab-spacer"})]})})}function b(e){let{lazy:n,children:l,selectedValue:a}=e,s=(Array.isArray(l)?l:[l]).filter(Boolean);if(n){let e=s.find(e=>e.props.value===a);return e?(0,r.jsx)("div",{children:(0,t.cloneElement)(e)}):null}return(0,r.jsx)("div",{children:s.map((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==a}))})}function x(e){let n=function(e){let{defaultValue:n,queryString:l=!1,groupId:r}=e,a=function(e){let{values:n,children:l}=e;return(0,t.useMemo)(()=>{let e=n??(t.Children.toArray(l).filter(e=>"\n"!==e).map(e=>{if(!e||t.isValidElement(e)&&function(e){let{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]).map(e=>{let{props:{value:n,label:l,attributes:r,default:t}}=e;return{value:n,label:l,attributes:r,default:t}});return!function(e){let n=(0,d.lx)(e,(e,n)=>e.value===n.value);if(n.length>0)throw Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,l])}(e),[s,p]=(0,t.useState)(()=>(function(e){let{defaultValue:n,tabValues:l}=e;if(0===l.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:l}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${l.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}let r=l.find(e=>e.default)??l[0];if(!r)throw Error("Unexpected error: 0 tabValues");return r.value})({defaultValue:n,tabValues:a})),[m,b]=function(e){let{queryString:n=!1,groupId:l}=e,r=(0,i.k6)(),a=function(e){let{queryString:n=!1,groupId:l}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!l)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return l??null}({queryString:n,groupId:l});return[(0,c._X)(a),(0,t.useCallback)(e=>{if(!a)return;let n=new URLSearchParams(r.location.search);n.set(a,e),r.replace({...r.location,search:n.toString()})},[a,r])]}({queryString:l,groupId:r}),[x,j]=function(e){let{groupId:n}=e,l=n?`docusaurus.tab.${n}`:null,[r,a]=(0,u.Nk)(l);return[r,(0,t.useCallback)(e=>{l&&a.set(e)},[l,a])]}({groupId:r}),f=(()=>{let e=m??x;return h({value:e,tabValues:a})?e:null})();return(0,o.Z)(()=>{f&&p(f)},[f]),{selectedValue:s,selectValue:(0,t.useCallback)(e=>{if(!h({value:e,tabValues:a}))throw Error(`Can't select invalid tab value=${e}`);p(e),b(e),j(e)},[b,j,a]),tabValues:a}}(e);return(0,r.jsxs)("div",{className:"tabs-container",children:[(0,r.jsx)(m,{...e,...n}),(0,r.jsx)(b,{...e,...n})]})}function j(e){let n=(0,p.Z)();return(0,r.jsx)(x,{...e},String(n))}},80980:function(e,n,l){l.d(n,{Z:function(){return i},a:function(){return s}});var r=l(27378);let t={},a=r.createContext(t);function s(e){let n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);